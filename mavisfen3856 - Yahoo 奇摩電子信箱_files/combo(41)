YUI.add("mail-ui-searchutils",function(D){var B=D.common.Utils.substitute,A=D.common.persist.UserData,C=D.common.Utils.unescapeHtml;D.namespace("mail.ui");D.mail.ui.SearchUtils={showAlert:function(G,E){var F=E||{};F.hd=F.hd||strings.str_branding_mail;switch(G){case"emptySelection":return;case"multipleSelection":return;case"fullHeader":F.hd=strings.str_menu_view_full_headers;F.modal_classes="lg";F.focusedNode=".default";break;case"fullHeaderError":F.hd=strings.str_menu_view_full_headers;F.bd=strings.str_error_no_body_returned;break;case"MultiFromRefinement":F.bd=strings.str_modal_multi_from_refinement;break;case"MultiFolderRefinement":F.bd=strings.str_modal_multi_folder_refinement;break;case"SearchPuncError":F.hd=strings.str_srch_punc_header;F.bd=B(strings.str_srch_punc_body,null,null,null,strings);break;case"searchNoChat":F.bd=strings.str_srch_no_chats;break;case"redirectMsgSuccess":F.hd="Redirect Messages";F.bd="Message redirection <b>successful.</b>";break;case"redirectMsgFailure":F.hd="Redirect Messages";F.bd="Message redirection <b>failed.</b>";break;default:return;}D.use("common-ui-dialog-helper",function(H){H.common.ui.DialogHelper.alert(F);});},showConfirm:function(G,E){var J,H,I,F;switch(G){case"removeAll":J="str_modal_message_delete_all_title";H="str_modal_message_delete_all_question";break;case"redirectMsg":I="Redirect messages";F='Redirect to: &nbsp; <input id="redirectMsg" class="field-name " type="text" size="30" value="buggy_messages@yahoo.com" name="redirectMsg">';break;default:return;}D.use("common-ui-dialog-helper",function(K){K.common.ui.DialogHelper.confirm({hd:I||strings[J],bd:F||strings[H]},{ok:{handler:function(M,L){E();L.destroy();},stopDestroy:true}});});},getPaginationControls:function(E,F){return"";},getAttachmentProperties:function(H){var F=H?H.split("/"):[""],G=F[0].toLowerCase(),E=F[1]&&F[1].toLowerCase();switch(G){case"image":return{"type":strings["str_srch_photo"],"icon":"img","refineBy":"image"};case"text":case"application":return D.mail.ui.SearchUtils.getAttachmentProperties(E);case"plain":return{"type":strings["str_srch_plain"],"icon":"txt","refineBy":"plain"};case"html":return{"type":strings["str_srch_html"],"icon":"","refineBy":"html"};case"htm":return{"type":strings["str_srch_other"]+" ("+strings["str_srch_html"]+")","icon":"","refineBy":"htm"};case"excel":case"vnd.ms-excel":return{"type":strings["str_srch_excel"],"icon":"xls","refineBy":"excel"};case"mp3":case"audio":case"x-wav":case"x-ms-wma":return{"type":strings["str_srch_music"],"icon":"audio","refineBy":"audio"};case"mspowerpoint":return{"type":strings["str_srch_powerpoint"],"icon":"ppt","refineBy":"mspowerpoint"};case"vnd.ms-powerpoint":return{"type":strings["str_srch_other"]+" ("+strings["str_srch_powerpoint"]+")","icon":"ppt","refineBy":"vnd.ms-powerpoint"};case"mpeg":return{"type":strings["str_srch_video"],"icon":"video","refineBy":"mpeg"};case"mpg":return{"type":strings["str_srch_other"]+" ("+strings["str_srch_video"]+")","icon":"video","refineBy":"mpg"};case"video":return{"type":strings["str_srch_other"]+" ("+strings["str_srch_video"]+")","icon":"video","refineBy":"video"};case"msword":return{"type":strings["str_srch_word"],"icon":"doc","refineBy":"msword"};case"vnd.ms-word":return{"type":strings["str_srch_other"]+" ("+strings["str_srch_word"]+")","icon":"doc","refineBy":"vnd.ms-word"};case"zip":return{"type":strings["str_srch_zip"],"icon":"zip","refineBy":"zip"};case"x-compress":return{"type":strings["str_srch_other"]+" ("+strings["str_srch_zip"]+")","icon":"zip","refineBy":"x-compress"};case"x-compressed":return{"type":strings["str_srch_other"]+" ("+strings["str_srch_zip"]+")","icon":"zip","refineBy":"x-compressed"};case"x-gzip":return{"type":strings["str_srch_other"]+" ("+strings["str_srch_zip"]+")","icon":"zip","refineBy":"x-gzip"};case"x-tar":return{"type":strings["str_srch_other"]+" ("+strings["str_srch_zip"]+")","icon":"zip","refineBy":"x-tar"};case"pdf":return{"type":strings["str_srch_pdf"],"icon":"pdf","refineBy":"pdf"};default:return{"type":strings["str_srch_other"]+" ("+(F[1]||F[0])+")","icon":"","refineBy":F[1]||F[0]};}},isEnableAddToContacts:function(H){var G=this,F;if(H.total!=1){return false;}for(var E in H.hash){F=H.hash[E];return((F&&F.from)?!G.isKnownEmailAddress(F.from[0].address):false);}},isKnownEmailAddress:function(F){if(D.contacts&&D.contacts.utils&&D.contacts.api){var E=D.contacts,G=E.utils,H=E.api;if(!F||F===""){return 1;}if(A.isUsersEmailAddress(F)||G.isEmailKnown(F)){return 1;}if(!G.areContactsLoaded()){H.load();return 1;}return 0;}else{return 1;}},processListData:function(F,E){var G=0,H=F.hits?F.hits.length:0,M,K=[],L=F,J=[];for(G=0;G<H;G++){J[G]=[];M=F.hits[G];try{if(M.fromObj){M.from=D.JSON.parse(C(M.fromObj));}J[G][0]={displayname:M.from.name,address:M.from.email};}catch(I){typeof globals!=="undefined"&&globals.report?globals.report("caughterror:..-build-mail-ui-msearch-utils-searchUtils:1",I,"TRY_CATCH",1,1,1):window.console&&console.log&&console.log("caughterror:..-build-mail-ui-msearch-utils-searchUtils:1");}K[G]={fid:E,mid:M.mid,subject:M.subject?C(M.subject):"",subjectDir:(NeoConfig.bidi&&M.subjectDir)?M.subjectDir:"",xapparentlyto:M.xapparentlyto,date:M.rawDate||M.receivedDate,snippet:(NeoConfig.hasConv&&M.snippet)?M.snippet:"",size:M.size,inboxservices:(M.inboxservices&&D.Lang.isString(M.inboxservices)&&M.inboxservices.match("data-certified"))?[{name:"crt",value:"transactional"}]:[],from:(E==="Sent"||E==="Draft")?[{displayname:M.toEmail}]:J[G],flags:{flagged:(typeof M.flags.isFlagged!=="undefined")?M.flags.isFlagged:M.flags.match("flagged"),read:(typeof M.flags.isRead!=="undefined")?M.flags.isRead:!M.flags.match("unread"),forwarded:(typeof M.flags.isForwarded!=="undefined")?M.flags.isForwarded:M.flags.match("forwarded"),replied:(typeof M.flags.isReplied!=="undefined")?M.flags.isReplied:M.flags.match("replied")},msgicon:(M.msgicon?M.msgicon:""),attachments:{length:(typeof M.flags.hasAttachment!=="undefined")?M.flags.hasAttachment:((M.hasOwnProperty("hide_attachments_else"))?0:1)}};
}L.hits=K;return L;},highlightSearchTerm:function(E){return E.replace(new RegExp("\\^_([^^]*?)\\^_","g"),'<span class="found">$1</span>');},cleanSearchTermMark:function(E){return E.replace(new RegExp("\\^_([^^]*?)\\^_","g"),"$1");},truncateSearchSnippet:function(G){var F=G.indexOf('<span class="found">'),E,H=function(L,J){var K=J-1,I=false;if(L.charAt(J)!==" "){while(K>=0){if(L.charAt(K)===" "){break;}K--;}if(K>=3||((K>=0)&&!L.match(/^(\.\.\.)/))){J=K;}}if(L.charAt(J)===" "){L=L.substring(J+1);I=true;}return{"finalString":L,"isTruncated":I};};if(F>=0){if((G.match(/^(\.\.\.)/)&&F>10)||(!G.match(/^(\.\.\.)/)&&F>7)){E=H(G,F-7);if(E.isTruncated){return"..."+E.finalString;}}}return G;}};},"1.0.0",{requires:["common-utils","common-persist-user-data"]});YUI.add("mail-ui-search-model",function(B){var K=B.common.Utils,I=K.escapeHtml,D=K.unescapeHtml,J=B.mail.ui.SearchUtils,M=B.mail.ui.common.StringUtils,C=B.common.persist.UserData,H=B.common.net.SessionMgr,A=K.ymmastats,L=B.common.net.Error;var G=function(Q){var T,O,R=/((unflagged|flagged|unread|read|replied|forwarded)\:1)|(attachmenttypes:((\"[^"]+\")|[^ ]+))|(from:((\"[^"]+\")|[^ ]+))/gi,S,N,P;if(Q.query.keyword){S=Q.query.keyword.match(R);if(S){Q.query.flags=Q.query.flags?Q.query.flags:{};N=S.length;for(P=0;P<N;P+=1){T=S[P].split(":");O=T[1].replace(/\"/g,"");switch(T[0]){case"unflagged":Q.query.flags.flagged=0;break;case"flagged":Q.query.flags.flagged=1;break;case"read":Q.query.flags.read=1;break;case"unread":Q.query.flags.read=0;break;case"replied":Q.query.flags.replied=1;break;case"forwarded":Q.query.flags.forwarded=1;break;case"attachmenttypes":Q.query.attachmenttypes=O;break;case"from":Q.query.from=O;break;}}}}return Q;};var E=function(N){var Q=this,P={},O={start:{value:0},count:{getter:function(S){var R;if(typeof S==="undefined"){R=NeoConfig.pagedResults?C.get("userUIPref.messagesPerPage")*1:10;return(R<100)?100:R;}return S;}},query:{setter:function(){Q.set("response","");}},sorting:{setter:function(R){if(R.sortKey==="date"){Q.sorting=(R.sortOrder==="up"?"%2B":"%2D")+R.sortKey;}else{Q.sorting=(R.sortOrder==="up"?"%2B":"%2D")+R.sortKey+"%2Ddate";}},getter:function(){return Q.sorting;}},response:{setter:function(R){Q.response=R;}}};B.augment(Q,B.Attribute);Q.addAttrs(O,N||{});B.augment(Q,B.EventTarget);Q.on("Request:start",function(){P=new K.Stopwatch("MSWS-Request");});Q.on("Request:complete",function(){if(P.stop){P.stop();B.fire("util:ymstats",{"name":"webservice_latency","unit":"ms","type":"duration","dataum":P.d,"tags":{"api":"MailSearch","farm":(NeoConfig.farm?NeoConfig.farm.substr(1):"xxxx"),"colo":((NeoConfig.mailEnv==="prod")?NeoConfig.hostName.split(".")[3]:"")}});}});};B.mix(E.prototype,{req:null,prepareResponse:function(R){var V=this,U,P,W=5,b,Z=V.get("query"),N=R.folders,T=R.fids;b={};if(Z.date&&!Z.date.start){b.date=Z.date;}if(Z.flags){b.flags={};for(var S in Z.flags){if(S==="read"){if(parseInt(Z.flags[S],10)===1){b.flags.read=1;}else{b.flags.unread=1;}}else{b.flags[S]=Z.flags[S];}}}if(Z.attachmenttypes){b.attachmenttype=J.getAttachmentProperties(Z.attachmenttypes);}if(Z.from){b.from=Z.from;}if(Z.fnums){b.fnums=[];if(N){for(U=0,P=Z.fnums.length;U<P;U++){b.fnums[U]=N[Z.fnums[U]];}}}R.refinedby=b;if(R.hits&&R.hits.length&&N){for(U=0,P=R.hits.length;U<P;U++){R.hits[U].folder=N[R.hits[U].fnum];R.hits[U].fid=T[R.hits[U].fnum];if(!R.hits[U].flags){R.hits[U].flags={};}}}R.grouplist=R.grouplist||{};if(Z.date&&Z.date.start){delete R.grouplist.date;}if(R.grouplist.attachmenttype&&!Z.attachmenttypes){var O={},a;b=[];for(U=0,P=R.grouplist.attachmenttype.length;U<P;U++){a=J.getAttachmentProperties(R.grouplist.attachmenttype[U].id);if(O[a.type]){O[a.type].count=parseInt(O[a.type].count,10)+parseInt(R.grouplist.attachmenttype[U].count,10);}else{O[a.type]=B.mix(a,R.grouplist.attachmenttype[U]);}}b=B.Object.values(O);b.sort(function(d,c){return(d.type===c.type)?0:((d.type>c.type)?1:-1);});R.grouplist.attachmenttype=b;}if(R.grouplist.folder&&N){b=[];var X="";for(U=0,P=R.grouplist.folder.length;U<P;U++){R.grouplist.folder[U].folder=N[R.grouplist.folder[U].id];X=encodeURIComponent(R.grouplist.folder[U].folder);R.grouplist.folder[U].displayName=M.getSystemFolderName(X,X);b.push(R.grouplist.folder[U]);}b.sort(function(d,c){return(d.displayName===c.displayName)?0:((d.displayName>c.displayName)?1:-1);});R.grouplist.folder=b;}if(R.grouplist.from){b=[];for(U=W,P=R.grouplist.from.length;U<P;U++){b.push(R.grouplist.from[U]);}b.sort(function(d,c){return(d.id===c.id)?0:((d.id>c.id)?1:-1);});R.grouplist.from=[].concat(R.grouplist.from.slice(0,W),b);}if(R.grouplist.date){b=[];for(U=0,P=R.grouplist.date.length;U<P;U++){b.push(R.grouplist.date[U]);}b.sort(function(d,c){return(d.id===c.id)?0:((d.id<c.id)?1:-1);});R.grouplist.date=b;}if(R.grouplist.flags){b=[];var Q,Y={id:"unread",count:R.total};for(U=0,P=R.grouplist.flags.length;U<P;U++){Q=R.grouplist.flags[U];if(R.refinedby.flags&&R.refinedby.flags[Q.id]){continue;}if(Q.id==="read"){Y=null;if((R.total-Q.count)>0){b.push({id:"unread",count:R.total-Q.count});}}else{b.push(Q);}}if((Z.flags&&parseInt(Z.flags.read,10)===0)||(R.refinedby&&R.refinedby.flags&&R.refinedby.flags.unread)){Y=null;}Y&&b.push(Y);R.grouplist.flags=b;}return R;},execute:function(P,N,T){var S=this,U,V=[],X,Y=function(a,c){var d={total:0,hits:null},b=(c)?c.status:"",g=c.statusText?c.statusText.replace(/\s/g,"_"):"",Z=L.show;S.req=null;switch(b){case 200:try{d=B.JSON.parse(c.responseText);}catch(f){typeof globals!=="undefined"&&globals.report?globals.report("caughterror:..-build-mail-ui-msearch-model-msws:1",f,"TRY_CATCH",1,1,1):window.console&&console.log&&console.log("caughterror:..-build-mail-ui-msearch-model-msws:1");}A.stat("search","result=>success,env=>"+NeoConfig.mailEnv+",farm=>"+NeoConfig.farm.substr(1));break;case 400:if(c.statusText!=="Search Failed"){Z(null,strings.str_error_BadRequest,strings.str_error_MailErrorTitle,{modal_classes:"lg"});}A.stat("search","result=>failure,env=>"+NeoConfig.mailEnv+",farm=>"+NeoConfig.farm.substr(1));break;case 401:case 402:Z(null,strings.str_error_MissingCredentials,strings.str_error_MailErrorTitle,{modal_classes:"lg"});A.stat("search","result=>failure,env=>"+NeoConfig.mailEnv+",farm=>"+NeoConfig.farm.substr(1));break;case 500:A.stat("search","result=>failure,env=>"+NeoConfig.mailEnv+",farm=>"+NeoConfig.farm.substr(1));break;case -4:A.stat("search","result=>abort,env=>"+NeoConfig.mailEnv+",farm=>"+NeoConfig.farm.substr(1));return;default:A.stat("search","result=>failure,env=>"+NeoConfig.mailEnv+",farm=>"+NeoConfig.farm.substr(1));}if(b!==200){B.fire("util:ymstats",{"name":"ue_client_error","tags":{"api":"MailSearch","tae":"20","code":b,"colo":((NeoConfig.mailEnv==="prod")?NeoConfig.hostName.split(".")[3]:"xxx")}});B.fire("stat:webservice_fail",{"feature_group":"SEARCH","tae":"20","api":"MailSearch","message":b+"_"+g,"visible":"yes"});
}S.fire("Request:complete");d.start=S.get("start");d.count=S.get("count");d.query=S.get("query");S.set("response",{query:S.get("query"),response:S.prepareResponse(d)});P&&P.call(N||this,B.mix(S.get("response"),{responseCode:b}));};if(!S.get("query")||!(S.get("query").keyword||S.get("query").date||S.get("query").fnums)){Y();return;}if(S.get("query").keyword){var Q=S.get("query").keyword;if(Q.match(/subject:.*/)){Q=D(I(Q));}var R,O;if((R=/after:([^\s]+)/.exec(Q))){if((O=B.Date.parse(R[1]))){S.get("query").date=S.get("query").date||{};S.get("query").date.start=O.getTime()/1000;}}if((R=/before:([^\s]+)/.exec(Q))){if((O=B.Date.parse(R[1]))){S.get("query").date=S.get("query").date||{};S.get("query").date.end=O.getTime()/1000;}}}S.fire("Request:start");var W=new Date().getTimezoneOffset()*60*-1;U=NeoConfig.launch_protocol+document.location.host+"/mailsearch/v2/search"+"?appid=YahooMailNeo";V.push("appid=YahooMailNeo");V.push("foldername=1");V.push("tzoffset="+W);V.push("start="+S.get("start"));V.push("count="+S.get("count"));S.get("sorting")&&V.push("sorting="+S.get("sorting"));X=B.clone(S.get("query"));if(X&&!X.flags){X.flags={};}B.mix(X.flags,{"softdelete":0},true);V.push("query="+encodeURIComponent(B.JSON.stringify(X)));S.req=H.requestProxy(U,{on:{success:Y,failure:Y},method:"POST",data:V.join("&"),service:"msws",serviceCredType:"strict"});if(T&&T.origin){A.stat("search_query","type=>searchsuggestion");}else{A.stat("search_query","type=>normal");}},abort:function(){var N=this;N.req&&N.req.abort();}},true);function F(U,O,R){var P=(R)?R.status:"",N=false,T,Q,S,V=[];if(R.callback&&R.callback.service==="msws"){T=R.callback.service;Q=R.callback.method;S=R.statusText?R.statusText.replace(/\s/g,"_"):"";switch(P){case 400:V.push("E_BadRequest400_"+T+"_"+S);N=true;break;case 500:V.push("ue_alert_tae20");break;default:break;}return N;}return false;}L.onError(F);B.namespace("mail.ui");B.mail.ui.SearchRequest=E;B.mail.ui.parseSearchRequest=G;},"1.0.0",{requires:["mail-ui-searchutils","json","mail-ui-common-string-utils","datatype-date"]});YUI.add("mail-ui-list-mgr",function(C){var E=C.common.persist.UserData,B=C.mail.persist.MetaData,F=C.common.Utils.features,I="neo.pref.searchSortBy",G="userUIPref.defaultSortOrder",H={},D=true;var A=function(){var N=this,k,X,q,Q,J,h,i,e,s,x,p,AD,M=C.mail.model.DataStore.Messages,AC=M.toMessage,V={};function w(){var AE="date";X=[];q={};s=0;h=0;i=0;if(H[k]&&H[k].sortObj){Q=H[k].sortObj;}else{if(F.enabled("stickySearchSort")){AE=B.get(I)||"date";if(D){D=false;C.fire("util:ymstats",{name:"search_user_default_sort_type",tags:{sortType:AE}});}}Q={sortKey:AE,sortOrder:E.get(G)};}x=0;p=NeoConfig.pagedResults?E.get("userUIPref.messagesPerPage")*1:10;Z(p);J={all:false,rangeFrom:null,total:0,hash:{}};V={};}function Z(AE){e=(AE<100)?100:AE;AD=(AE<100)?100:AE;}function a(){if(!H[k]){H[k]={_sortObj:Q};return true;}return false;}function t(AF){var AE;k=AF;if(!H[k]){return false;}AE=H[k]._sortObj;if(AE){Q={sortKey:AE.sortKey,sortOrder:AE.sortOrder};}return true;}function v(AE){var AF=AE.split("_");return AF[AF.length-1];}function K(AH){var AE=AH.hits,AJ=AE.length,AF=0,AI=AH.start||0,AG;h=AH.total||AJ;i=AH.start||0;e=AJ;for(;AF<AJ;AF++){if(!AE[AF]||!AE[AF].mid){continue;}AG=v(AE[AF].mid);q[AG]=AI+AF;s++;AE[AF].hashKey=AG;X[AI+AF]=AE[AF];o(AG,J.all);}}function AB(AF){var AG=false,AE=J;if(Q.sortKey!==AF.sortKey){S();Q.sortKey=AF.sortKey;Q.sortOrder=AF.sortOrder;J=AE;if(F.enabled("stickySearchSort")){B.set(I,AF.sortKey);B.save();}}if(Q.sortOrder!==AF.sortOrder){if(h===s){X.reverse();R();AG=true;}else{S();}J=AE;Q.sortKey=AF.sortKey;Q.sortOrder=AF.sortOrder;}x=0;i=0;H[k]._sortObj=Q;return AG;}function R(){var AH,AJ,AG,AI=s-X.length,AE,AF=J;if(AI>0){i=i-AI;if(i<0){i=0;}if(AI>p){x=(x&&AI/p<=x)?x-(AI/p):x;}else{x=(x&&x*p>=(s-AI))?Math.floor((s-AI)/p)-1:x;}if(h&&AI){h=h-AI;}}AH=X;AJ=i;AG=x;AE=h;AF.serverTotal=AE;S();J=AF;K({hits:AH,total:AE});i=AJ;x=AG;}function f(){return{list:X};}function y(AJ,AE){var AG=(AJ*AE),AI=(((AJ+1)*AE)<h)?((AJ+1)*AE)-1:h-1,AH=[];if(X[AG]){for(var AF=AG;AF<=AI;AF++){if(X[AF]){AH.push(X[AF]);}}}return AH;}function m(AE){return q[v(AE)];}function W(AE){return(AE>=0)&&X[AE];}function L(AF){var AE=q[v(AF)];if(typeof AE==="undefined"){return;}return X[AE];}function P(AF){var AE=q[v(AF)];if(typeof AE==="undefined"){return;}return(AE===0)?X[AE]:X[--AE];}function T(AF){var AE=q[v(AF)];if(typeof AE==="undefined"){return;}return(AE===s-1)?X[AE]:X[++AE];}function c(AI){var AH={serverTotal:h,serverIndex:i,serverSize:e,cacheIndex:x,cacheSize:p,list:[]},AF,AE;switch(AI){case"first":if((x-1)<0&&NeoConfig.pagedResults){AH.cacheIndex=-1;return AH;}x=0;break;case"prev":if((x-1)<0){AH.cacheIndex=-1;return AH;}x=x-1;if((x*p)<i){AF=i-AD;i=(AF>0)?AF:0;}break;case"next":if((x+1)>Math.ceil(h/p)-1){AH.cacheIndex=x+1;return AH;}x=x+1;AE=x*p;if((AE>i)&&!(X[AE])){AF=i+AD;i=(AF<=h)?AF:i;}break;case"last":if((x+1)*p>=h){AH.cacheIndex=x+1;return AH;}i=((Math.ceil(h/AD)-1)*AD);x=Math.ceil(h/p)-1;break;default:var AG=parseInt(AI,10);if(h<1){return AH;}if(!isNaN(AG)){if(AG>0&&AG<=Math.ceil(h/p)){x=AG-1;i=(Math.floor((x*p)/AD))*AD;break;}}if(V.list&&V.list.length){return V;}break;}AH.cacheIndex=x;AH.serverIndex=i;AH.list=y(x,p);V=AH;return AH;}function d(){return c("first");}function U(AF){var AE={serverTotal:h,serverIndex:i,serverSize:e,cacheIndex:x,cacheSize:p,list:y(AF,p)};return AE;}function l(){return c("prev");}function j(){return c("current");}function r(){return c("next");}function O(){return c("last");}function S(){w();}function n(AL,AR,AF){if(AL<=-1){return;}var AK=this,AQ=AK.getItemFromIndex(AL),AJ=AQ?M.isCached(AF,AQ.mid):false,AN=((NeoConfig.prefetchMsgsCheckMail==1)?4:(AJ?4:2)),AO=[],AM=1,AG=0,AE=0,AI=2,AH=1;function AP(AS){var AT=AK.getItemFromIndex(AS);if(AT&&!M.isCached(AF,AT.mid)){AO.push(AT);return 1;}return 0;}while(AM){if(AE<AI&&!AP(AL-AH)){AE++;}if(AG<AI&&!AP(AL+AH)){AG++;}AM=(AO.length<AN)&&!(AE==AI&&AG==AI);AH++;if(AH>100){break;}}for(AH=0;AH<AO.length;AH++){AR.push(AO[AH]);}}function g(AF,AG){var AE;if(!AF){return;}AE=q[v(AF)];if(typeof AE!=="undefined"){X[AE]=AG;return true;}}function b(AI,AL){AL=(typeof AL!=="undefined")?AL:true;var AJ,AF,AK,AH=0,AG,AE=[];if(!AI){return;}AK=(C.Lang.isArray(AI))?AI:[AI];AG=AK.length;for(;AH<AG;AH++){AJ=v(AK[AH]);AF=q[AJ];if((typeof AF!=="undefined")&&(AL==true)){X.splice(AF,1);if(NeoConfig.pagedResults){J.all=false;}R();AE.push(AJ);}else{if(AL===false){h=h-1;}}}return{cacheTotal:s,serverTotal:h,removedItems:AE};}function z(AH){var AG=j();J.all=AH;for(var AF=0,AE=AG.list.length;AF<AE;AF++){AG.list[AF]&&o(v(AG.list[AF].mid),AH);}}function AA(AG){J.all=AG;for(var AF=0,AE=X.length;AF<AE;AF++){X[AF]&&o(v(X[AF].mid),AG);}}function o(AG,AH){var AF=v(AG),AE=q[AF];if(typeof AE==="undefined"){return;}if(!AH){if(J.hash[AF]){J.total--;if(J.total===0){J.rangeFrom=null;}delete J.hash[AF];}else{return J;}}else{if(X[AE]&&!J.hash[AF]){J.total++;if(J.total===1){J.rangeFrom=AE;}C.mix(X[AE],AC(X[AE].fid,X[AE]));J.hash[AF]=X[AE];}else{if(X[AE]&&J.total===1){N.fire("itemSelect",{key:AG,state:AH,selection:J});}return J;}}X[AE].selected=(AH)?"checked":"";J.all=!NeoConfig.pagedResults?(h===J.total):(V.list&&V.list.length===J.total);J.allCacheSelected=!NeoConfig.pagedResults?(s===J.total):J.all;J.serverTotal=h;J.index=AE;N.fire("itemSelect",{key:AG,state:AH,selection:J});return J;}function Y(AF){for(var AE in AF){switch(AE){case"cacheSize":p=(AF[AE]<10)?10:AF[AE];Z(p);break;default:break;}}}function u(){return({sortInfo:Q,selection:J,serverTotal:h,serverIndex:i,serverSize:e,cacheTotal:s,cacheIndex:x,cacheSize:p,origServerSize:AD});}C.augment(N,C.EventTarget);w();C.mix(N,{generateKey:v,persist:a,warmCache:t,store:K,sort:AB,getAllCachedItems:function(){return X;},getItemIndex:m,getItemFromIndex:W,getPrevItem:P,getItem:L,getNextItem:T,getFirstPage:d,getPrevPage:l,isPageInCache:U,getCurrentPage:j,getNextPage:r,getLastPage:O,getPage:c,getNeighbors:n,updateCacheInfo:Y,getCacheInfo:u,update:g,remove:b,flush:S,select:o,selectAll:AA,selectPage:z,getAllLoadedPages:f,getSelectedItems:function(){return J;
},getSortInfo:function(){return Q;}});};C.namespace("mail.ui");C.mail.ui.ListMgr=A;},"1.0.0",{requires:["mail-common-utils-features","mail-persist-meta-data"]});YUI.add("mail-recent-searches",function(B){var E=NeoConfig.recentSearchList?NeoConfig.recentSearchList:[],R=B.mail.persist.MetaData,F="neo.pref.savedSearch",M='<li role="option" class="recent-search-delete-enabled" data-count=""><div class="recent-search-item"><span class="ac-value">{{item-text}}</span><span class="recent-search-delete recent-seach-right-side icon icon-small-close"></span></div></li>',U='<li role="option" data-count=""><span class="ac-label small">{{str_autocomplete_search}}</span><span class="ac-value">{{item-text}}</span></li>';function K(W){var X=yui.Node.create("<div></div>"),V=[];B.Array.each(W,function(Y){X.setHTML(Y);V.push(X.get("text"));});return V;}function T(X,W){var V;if(!W){return{value:X};}V=X.toLowerCase().indexOf(W.toLowerCase());if(V!==-1){return{value:X,match:{start:V,end:V+W.length}};}return null;}function S(Z){var X=Z.value,V=Z.match,Y,W;if(!V){return X;}if(NeoConfig.bidi){Y=X.substring(0,V.start);W=X.substring(V.end);X=Y+B.comms.Intl.highlightString(X.substring(V.start,V.end),Y,W)+W;}else{X=X.substring(0,V.start)+"<b>"+X.substring(V.start,V.end)+"</b>"+X.substring(V.end);}return X;}function C(a,W){var Y,Z,X=E.length,b,V=[];for(Y=0,Z=0;Y<X&&Z<W;Y+=1){b=T(E[Y],a);if(b){V.push(b);Z+=1;}}return V;}function P(W){var Y,X=W.length,V=[];for(Y=0;Y<X;Y+=1){V.push(L(W[Y],Y));}return V;}function L(Y,X){var V=(NeoConfig.intl==="us"&&/en-US/.test(NeoConfig.lang))?M:U,W=S(Y);V=V.replace('data-count=""','data-count="'+(X+1)+'"');V=V.replace(/\{\{str_autocomplete_search\}\}/g,X===0?strings.str_autocomplete_search:"&nbsp;");V=V.replace(/\{\{item-text\}\}/g,W);return V;}function J(W,V){var X='<ul id="recent-searches" class="presentation">'+V+"</ul>";W.get("contentBox").append(X);}function A(X,W){var V=X.get("data");if(V.length>0){J(X,W);}else{J(X,W);if(X.get("selectFirst")){X.set("selectedIndex",0);}X.get("contentBox").setStyle("display","block").one("#recent-searches").setStyle("border-top","none");}}function D(Y,X){var W,V;W=C(Y.get("query"),X);if(W.length===0){return;}V=P(W).join("");if(V){A(Y,V);}}function Q(X,Z,a){var Y,W,V;if(!X&&!Z){return;}Y=(a&&a.source)||"search_uh_box_enter";B.fire("mt:click",{action:X?"ml_srch_sugg":"ml_srch",spid:"search_results"});B.fire("fireSearch",Z,{source:X?"search_uh_suggestion_recent":Y});W=new B.EventTarget();V=X?"ucs:mailSearchSugg":"ucs:mailSearch";W.publish(V,{broadcast:2,emitFacade:true});W.fire(V);}function H(){try{R.set(F,0);I();}catch(V){typeof globals!=="undefined"&&globals.report?globals.report("caughterror:..-build-mail-ui-searchautocomplete-recent-searches:1",V,"TRY_CATCH",1,1,1):window.console&&console.log&&console.log("caughterror:..-build-mail-ui-searchautocomplete-recent-searches:1");}}function I(){try{E=B.JSON.parse(R.get(F));NeoConfig.recentSearchList=E;}catch(V){typeof globals!=="undefined"&&globals.report?globals.report("caughterror:..-build-mail-ui-searchautocomplete-recent-searches:2",V,"TRY_CATCH",1,1,1):window.console&&console.log&&console.log("caughterror:..-build-mail-ui-searchautocomplete-recent-searches:2");}}function O(V){E=E?E:[];E.unshift(B.common.Utils.escapeHtml(V));E=B.Array.dedupe(E);if(E.length>NeoConfig.maxSearchHistory){E.pop();}R.set(F,B.JSON.stringify(K(E)));NeoConfig.recentSearchList=E;}function N(W){W=B.common.Utils.escapeHtml(W);E=E?E:[];E=B.Array.dedupe(E);var V=B.Array.indexOf(E,W);if(V>=0){E.splice(V,1);}R.set(F,B.JSON.stringify(K(E)));NeoConfig.recentSearchList=E;}var G={getACSearchItems:C,getACSearchItemsMarkup:P,addACSearchItems:D,reloadRecentSearchItems:I,clearRecentSearchItems:H,deleteSearchItem:N,addNewSearchItem:O,handleSelection:Q};B.namespace("mail.ui");B.mail.ui.RecentSearches=G;},"1.0.0",{requires:["common-utils","mail-persist-meta-data"]});YUI.add("minty_module_list_view_ad_search",function(A){A.namespace("ui.Templates");A.ui.Templates.minty_module_list_view_ad_search={base:'<div id="searchAd">{{dmcontent}}</div>',dmfavicon:'<img class="favicon" src="{{ad_favicon_url}}">',dmcontent:'<div id="searchAdFrame"><a href="{{ad_url}}" target="_blank"><span class="title">{{ad_title}}</span><span class="description">{{ad_description}}</span>{{dmfavicon}}<span class="link">{{ad_pretty_url}}</span></a></div><div id="searchAdNote">{{ad_note}}</div>'};},"1.0.0");YUI.add("minty_module_list_view_ad_skysearch",function(A){A.namespace("ui.Templates");A.ui.Templates.minty_module_list_view_ad_skysearch={base:'<div id="sponsoredAd"><div id="searchAdNote">{{str_dm_note}}</div>{{dmskycontent}}</div>',dmfavicon:'<img class="favicon" src="{{ad_favicon_url}}" />',dmskycontent:'<div class="searchAdFrame"> <a href="{{ad_url}}" target="_blank" title="{{ad_pretty_url}}"> <span class="title">{{ad_title}}</span> </a><br /> <a href="{{ad_url}}" target="_blank" title="{{ad_pretty_url}}"> <span class="description">{{ad_description}}</span> </a><br /> <a href="{{ad_url}}" target="_blank" title="{{ad_pretty_url}}"> {{dmfavicon}} <span class="link">{{ad_pretty_url}}</span> </a></div>'};},"1.0.0");YUI.add("minty_module_list_view_ad_mas_search",function(A){A.namespace("ui.Templates");A.ui.Templates.minty_module_list_view_ad_mas_search={base:'<div id="masSearchAd" class="result {{ad_class}}"> {{dmcontent}}</div>',mas_ad_lbl:'<div class="ad-lbl">{{str_srch_ad_abbr}}</div>',mas_fvicn:'<div class="favicon" style="background-image:url({{ad_favicon_url}});"></div>',dmcontent:'<a class="ad-bar" href="{{ad_url}}" target="_blank"> <div class="fixed start"> {{mas_ad_lbl}} </div> <div class="flex"> <div class="title" title="{{ad_pretty_url}}">{{ad_title}}{{mas_fvicn}}</div> <div class="description">{{ad_description}}</div> <div class="link">{{ad_pretty_url}}</div> </div> <div class="fixed end"> <div class="note">{{ad_note}}</div> </div> </a> '};},"1.0.0");YUI.add("minty_module_shell_ad_searchads",function(A){A.namespace("ui.Templates");A.ui.Templates.minty_module_shell_ad_searchads={base:"{{hasSearchAds}}",sAds_detail:'<li> <a href="{{ad_url}}" target="_blank"> <p class="title" >{{ad_title}}</p> <p class="description">{{ad_description}}</p> <p class="source">{{ad_pretty_url}}</p> </a> </li> ',hasSearchAds:'<div class="right-rail-ad hidden" id="searchAds"> <h2 class="sAds-title right-rail-ad-header hidden"><a target="_blank" href="http://info.yahoo.com/privacy/us/yahoo/adinfo_contextual.html">{{str_search_ads_title}}</a></h2> <ul> {{sAds_detail}} </ul></div>'};},"1.0.0");YUI.add("minty_module_list_view_ad_buckets_serp",function(A){A.namespace("ui.Templates");A.ui.Templates.minty_module_list_view_ad_buckets_serp={base:'<div id="masSearchAd" class="serp"> <a class="ad-bar" href="{{ad_url}}" target="_blank"> <div class="flex"> <div class="from icon mb-icon"></div> <div class="subj"> <div class="row"> <span class="ad-title">{{ad_title}}</span> {{isOfficial}} </div> <div class="row"> <span class="favicon" style="background-image:url({{ad_favicon_url}});"></span> <span class="ad-host">{{ad_pretty_url}}</span> </div> <div class="row ad-description">{{ad_description}}</div> </div> </div> <div class="fixed end">{{str_srch_sponsored}}</div> </a></div>',isOfficial:'<span class="osb">{{str_srch_ad_osb}}</span> '};},"1.0.0");YUI.add("minty_module_list_view_ad_buckets_serp_ratings",function(e){e.namespace("ui.Templates"),e.ui.Templates.minty_module_list_view_ad_buckets_serp_ratings={base:'<div id="masSearchAd" class="serp {{reducedHeightClass}} {{moneyballLikeClass}}"> {{moneyballLikeAd}} {{moneyballLikeAd_else}}</div>',has_ad_img:'<div class="mb-table-wrap mb-list-img-wrap"> <div class="mb-table-inner" style="background-image: url({{ad_favicon_url}});"></div> </div> ',has_ad_img_else:'<i class="icon mb-icon adchoices mb-sponsored mb-icon-left"></i> ',has_ad_img_dup:'<div class="fixed end"> <i class="icon mb-icon adchoices mb-sponsored mb-icon-right"></i> </div> ',moneyballLikeAd:'<div class="mb-list-ad mb-list-img-ad mb-with-img"> <a href="{{ad_url}}" target="_blank" class="adlink"> {{has_ad_img}} {{has_ad_img_else}} <div class="flex"> <div class="title mb-table-wrap"> <div class="mb-table-inner"> <div class="mb-header">{{extracted_domain_name}}</div> <div class="mb-sub-header mb-sponsored">{{str_srch_sponsored}}</div> </div> </div> <div class="subj mb-table-wrap"> <div class="mb-table-inner"> <div class="mb-header">{{ad_title}}</div> <div class="mb-sub-header">{{ad_description}}</div> </div> </div> </div> {{has_ad_img_dup}} </a> </div> ',isReducedHeightAd:"match-item-height",hasFavIcon:"{{ad_favicon_url}}",reducedHeightAd:'<div class="subject-snippet-group"> <div class="subject-action-group match-item-height"> <span class="txt">{{ad_title}}</span> </div> <span class="snippet" title="{{ad_tooltip}}"> {{ad_description}} </span> </div> ',isOfficial:'<span class="osb">{{str_srch_ad_osb}}</span> ',hasRatings:'<div class="row ad-rating"> <span class="avg-rating" style="background-image:url({{ad_rating_star_link}});"></span> <span class="num-ratings">{{ad_num_ratings}}</span> <span>{{str_reviews}}</span> </div> ',normalHeightAd:'<div class="row"> <span class="ad-title">{{ad_title}}</span> {{isOfficial}} </div> <div class="row ad-description">{{ad_description}}</div> {{hasRatings}} ',reducedHeightRatings:'<span class="match-item-height avg-rating" data-rating="{{ad_avg_rating}}"> <span class="icon icon-star"></span> <span class="icon icon-star"></span> <span class="icon icon-star"></span> <span class="icon icon-star"></span> <span class="icon icon-star"></span> </span> ',moneyballLikeAd_else:'<a class="fixed start" href="{{str_cfg_url_about_adchoices}}" target="_blank"> <span class="icon mb-icon"></span> </a> <a class="ad-bar" href="{{ad_url}}" target="_blank"> <div class="flex"> <div class="from"> <div class="favicon {{isReducedHeightAd}}" style="background-image:url({{hasFavIcon}});"></div> <div class="ad-host">{{extracted_domain_name}}</div> </div> <div class="subj"> {{reducedHeightAd}} {{normalHeightAd}} </div> {{reducedHeightRatings}} </div> </a> <a class="fixed end sponsored" href="{{str_cfg_url_about_adchoices}}" target="_blank">{{str_srch_sponsored}}</a> '}},"1.0.0");
YUI.add("mail-ui-dmsearch-view",function(e){var t=e.common.Utils,n=t.features,r=n.enabled("srpWithFolder")||n.enabled("srpWithoutFolder"),i=r&&n.enabled("searchAdResemblingMoneyball"),s=n.enabled("shortSearchAd"),o=n.enabled("shortSearchAd")||n.enabled("searchAdResemblingMoneyball"),u=NeoConfig.intl+(NeoConfig.partnerType?"_"+NeoConfig.partnerType:""),a=function(t){var n=this,r=function(){return NeoConfig.expBucketId==="CMUSGRSERP01"?e.ui.Templates.minty_module_list_view_ad_buckets_serp:NeoConfig.dmSrcTag==="yahoo_mail_mailbox_search_2"?e.ui.Templates.minty_module_list_view_ad_mas_search:o?e.ui.Templates.minty_module_list_view_ad_buckets_serp_ratings:e.ui.Templates.minty_module_list_view_ad_buckets_serp_ratings},i={rootNode:{writeOnce:!0},response:{},template:{value:r()},skytemplate:{value:e.ui.Templates.minty_module_list_view_ad_skysearch},sAdstemplate:{value:e.ui.Templates.minty_module_shell_ad_searchads}};e.augment(n,e.Attribute),n.addAttrs(i,t||{})};a.prototype={formatters:{isOfficial:function(e,n,r){return e.ad_official&&NeoConfig.lang==="en-US"?t.substitute(r.get("template").isOfficial,e,r.formatters,e,strings,null,r):""},hasFavIcon:function(e,n,r){return r.hasValidIcon(e.ad_favicon_url)?t.substitute(r.get("template").hasFavIcon,e,r.formatters,e,strings,null,r):""},isReducedHeightAd:function(e,n,i){return r&&s?t.substitute(i.get("template").isReducedHeightAd,e,i.formatters,e,strings,null,i):""},reducedHeightRatings:function(e,n,i){return r&&s&&e.ad_avg_rating?t.substitute(i.get("template").reducedHeightRatings,e,i.formatters,e,strings,null,i):""},hasRatings:function(e,n,r){return r.hasRatings(e)?t.substitute(r.get("template").hasRatings,e,r.formatters,e,strings,null,r):""},ad_class:function(){return NeoConfig.favicOnHover?"icon-hover":""},mas_ad_lbl:function(e,n,r){var i=r;return t.substitute(i.get("template").mas_ad_lbl,e,i.formatters,e,strings,null,i)},mas_fvicn:function(e,n,r){var i=r;return t.substitute(i.get("template").mas_fvicn,e,i.formatters,e,strings,null,i)},dmfavicon:function(){return""},dmcontent:function(e,n,r){var i=r;return t.substitute(i.get("template").dmcontent,e,i.formatters,e,strings,null,i)},dmskycontent:function(e,n,r){var i=r,s="",o;for(o in e)s+=t.substitute(i.get("skytemplate").dmskycontent,e[o],i.formatters,e[o],strings,null,i);return s},moneyballLikeClass:function(){return i?"resemble-moneyball":""},extracted_domain_name:function(e){var t=e.ad_pretty_url,n=document.createElement("a"),r;return/:\/\//.test(t)||(t="http://"+t),n.href=t,t=n.hostname.split("."),t.length>2?t[t.length-1].length>3?r=t[t.length-2]:t[t.length-1].length<=3&&t[t.length-2].length<=3?r=t[t.length-3]:r=t[t.length-2]:r=t[0],e.ad_pretty_url.match(new RegExp(r,"i"))[0]},moneyballLikeAd:function(e,n,r){var s=r;return i?t.substitute(s.get("template").moneyballLikeAd,e,s.formatters,e,strings,null,s):""},has_ad_img:function(e,n,r){var i=r;return r.hasValidIcon(e.ad_favicon_url)?t.substitute(i.get("template").has_ad_img,e,i.formatters,e,strings,null,i):""},has_ad_img_dup:function(e,n,r){var i=r;return r.hasValidIcon(e.ad_favicon_url)?t.substitute(i.get("template").has_ad_img_dup,e,i.formatters,e,strings,null,i):""},has_ad_img_else:function(e,n,r){var i=r;return r.hasValidIcon(e.ad_favicon_url)?"":t.substitute(i.get("template").has_ad_img_else,e,i.formatters,e,strings,null,i)},moneyballLikeAd_else:function(e,n,r){var s=r;return i?"":t.substitute(s.get("template").moneyballLikeAd_else,e,s.formatters,e,strings,null,s)},reducedHeightClass:function(){return r&&s?"reduced-height-ad match-item-height":""},reducedHeightAd:function(e,n,i){var o=i;return r&&s?t.substitute(o.get("template").reducedHeightAd,e,o.formatters,e,strings,null,o):""},normalHeightAd:function(e,n,r){var i=r;return s?"":t.substitute(i.get("template").normalHeightAd,e,i.formatters,e,strings,null,i)}},render:function(){var t=this,r=t.get("response");e.mail.Tabs.getActiveTab().widgetType==="search"&&!n.enabled("searchresults")&&t.renderNorthAd("#masSearchAd",r[0]),t.renderSearchAd(r)},bindAdRatingClickHandler:function(t,n){t&&n.ad_rating_detail_page&&t.on("click",function(t){t.preventDefault(),e.fire("util:ymstats",{name:"dmsearch_click_ratings",tags:{intl:u,bkt:NeoConfig.expBucketId}}),window.open(n.ad_rating_detail_page,"_blank")})},renderNorthAd:function(n,i){var s=this,o=s.get("rootNode"),u=o.one(n),a=o.one("div.list-view-items"),f=o.one(".inner"),l;if(!i)return;l=e.Node.create(t.substitute(s.get("template").base,i,s.formatters,i,strings,s.get("template"),s)),u&&u.remove(!0),s.applyBucketLogic(l),a?r?a.insertBefore(l,a.one(".list-view-item")||a.get("firstChild")):a.insertBefore(l,a.one("#search-my-world-slot-srp")||a.one(".list-view-items-group-title")||a.one(".list-view-item")||a.get("firstChild")):f?o.insertBefore(l,f):o.insertBefore(l,o.get("firstChild")),s.bindAdRatingClickHandler(l.one(".ad-rating"),i)},applyBucketLogic:function(e){var t=[],n,r,i,s=e.one(".ad-lbl");if(NeoConfig.theme&&NeoConfig.theme.id==="purple")switch(NeoConfig.expBucketId){case"CMUSGRSS01":e.addClass("original-bg");return;case"CMUSGRSS02":e.one(".description").prepend(e.one(".favicon"));return;case"CMUSGRSS03":s.replace('<div class="mb-icon icon lnk"></div>');return;case"CMUSGRSS04":s.replace(e.one(".favicon"));return;case"CMUSGRSS05":e.addClass("pattern-bg");return;case"CMUSGRSS06":e.addClass("search-ad-thin");return;case"CMUSGRSS07":n=e.one(".link"),r=e.one(".title"),i=e.one(".description"),e.addClass("merged").one(".ad-lbl").replace(e.one(".favicon")),t.push("<strong>"+r.get("text")+"</strong>"),t.push(i.get("text")),t.push("<strong>"+n.get("text")+"</strong>"),r.remove(),n.remove(),i.set("innerHTML",t.join(" &mdash; "));return;case"CMUSGRSSC1":return}s&&s.replace('<div class="mb-icon icon lnk"></div>'),NeoConfig.dmSrcTag==="yahoo_mail_mailbox_search_4"&&e.addClass("mbStyle")},renderSponsoredAd:function(n,r){var i=this,s=e.one(n),o=e.one("#theAd"),u,a,f,l,c;if(!r)return;a=t.substitute(i.get("skytemplate").base,r,i.formatters,r,strings,i.get("skytemplate"
),i),f=e.Node.create(a),s.appendChild(f),o.addClass("withSponsoredAd"),u=e.one("body"),l=u.hasClass("wide-right-rail")?"#sb_rel_tgtWSKY":"#sb_rel_tgtSKY",c=e.one(l),c&&c.hide()},cleanUpSponsoredAd:function(){var t=e.one("#sponsoredAd"),n=e.one("#theAd"),r,i,s;t&&t.remove(!0),n.hasClass("withSponsoredAd")&&(n.removeClass("withSponsoredAd"),r=e.one("body"),i=r.hasClass("wide-right-rail")?"#sb_rel_tgtWSKY":"#sb_rel_tgtSKY",s=e.one(i),s&&s.show())},renderSearchAd:function(n){var r=this,i=e.one("#theAd #searchAds"),s=i&&i.one("ul"),o,u,a,f,l;if(!n||!n.length||!s)return;s.get("childNodes").remove(),i.one("h2").removeClass("hidden"),o=n.length;for(a=0;a<o;a++)f=n[a],u=t.substitute(r.get("sAdstemplate").sAds_detail,f,r.formatters,f,strings,r.get("sAdstemplate").sAds_detail,r),l=e.Node.create(u),(f&&f.ad_favicon_url==="http://l.yimg.com/pp/favicons-new/default.png"||f.ad_favicon_url==="https://s.yimg.com/pp/favicons-new/default.png"||!f.ad_favicon_url)&&l.addClass("nofav"),s.appendChild(l)},hasRatings:function(e){return e.ad_num_ratings&&e.ad_rating_star_link&&e.ad_rating_detail_page},hasValidIcon:function(e){return e&&e!=="https://s.yimg.com/pp/favicons-new/default.png"}},e.namespace("mail.ui"),e.mail.ui.dmsearchView=a},"1.0.0",{requires:["node-base","node-event-delegate","attribute-base","event-base","minty_module_list_view_ad_search","minty_module_list_view_ad_skysearch","minty_module_list_view_ad_mas_search","minty_module_shell_ad_searchads","minty_module_list_view_ad_buckets_serp","minty_module_list_view_ad_buckets_serp_ratings","mail-common-utils-features"]});
YUI.add("mail-ui-sponsoredsearch-model",function(e){var t=e.common.Utils,n=t.escapeHtml,r=t.unescapeHtml,i=e.common.net.SessionMgr,s=/(((to|from|folder|subject|size|attachmentcount|attachmentname|attachmentsize|attachment|is|on|has|links)\:)|((before|after)\:)((\(.*?\))|(\d{4}\/\d{2}\/\d{2}))?|(\')|(\"))/gi,o=NeoConfig.intl+(NeoConfig.partnerType?"_"+NeoConfig.partnerType:""),u=NeoConfig.enableCategorySearch&&NeoConfig.dmSrcTag==="yahoo_mail_mailbox_search_3"?1:0,a=function(t){var n=this,r={seedTerm:{},partner:{},response:{setter:function(e){n.response=e}},path:{},proxyPrefix:{},source:{}};e.augment(n,e.Attribute),n.addAttrs(r,t||{}),e.augment(n,e.EventTarget)},f=function(e){return e?e.replace("http://l.yimg.com","https://s.yimg.com"):""};e.mix(a.prototype,{req:null,prepareMultiResponse:function(e){var i=this,s,o,u,a,l,c,h,p,d,v,m,g,y,b=!0,w=/(<([bui(strong)]|[^>]|[\/bui(strong)]*)>)/gi,E,S,x=[];if(e.length){for(S=0;S<e.length;S++)E=e[S],s=E.getElementsByTagName("ClickUrl")[0].childNodes[0].nodeValue,o=r(E.getAttribute("title")),u=r(E.getAttribute("description")),a=t.removeHtml(u),l=E.getAttribute("siteHost"),c=f(E.getAttribute("faviconUrl")),h=E.getAttribute("OSB"),p=E.getAttribute("MRRating"),d=E.getAttribute("MRNumberOfRatings"),v=E.getAttribute("MRDetailPageLink"),m=f(E.getAttribute("MRStarLink")),b=o.match(/<.*>/)||u.match(/<.*>/),b&&(g=o.replace(w,""),y=u.replace(w,""),b=g.match(/<.*>/)||y.match(/<.*>/)),b&&i.stat("sponsoredsearch_adcall_made","failure:badtags"),b||(i.stat("sponsoredsearch_adcall_made","success:displayed"),x.push({ad_url:s,ad_title:o,ad_description:u,ad_tooltip:a,ad_pretty_url:l,ad_note:strings.str_srch_sponsored,ad_seedTerm:n(this.get("seedTerm")),ad_official:h,ad_avg_rating:p,ad_num_ratings:d,ad_rating_detail_page:v,ad_rating_star_link:m,ad_favicon_url:c}));return x}i.stat("sponsoredsearch_adcall_made","failure:noads")},cleanSeedTerm:function(e){var t=/^(subject)\:"|^(subject)\:|("$)/gi;return u?e.replace(s,""):e.replace(t,"")},getIntlMarket:function(){var t=["us","uk","de","fr","it","es","ch","at","nl","no","dk","se","fi","au","br","hk","tw","ca","mx","ar","in","sg","ie","co","cl","ve","pe"],n="us";return e.Array.indexOf(t,NeoConfig.intl)>=0&&(n=NeoConfig.intl),n},execute:function(s,a){var f=this,l,c=[],h=NeoConfig.expBucketId,p=function(t,n){var r=null,i=null,o=n?n.status:"";switch(o){case 200:try{r=e.XML.parse(n.responseText),i=r.getElementsByTagName("Listing");break}catch(u){typeof globals!="undefined"&&globals.report?globals.report("caughterror:..-build-mail-ui-sponsoredsearch-sponsoredSearchModel:1",u,"TRY_CATCH",1,1,1):window.console&&console.log&&console.log("caughterror:..-build-mail-ui-sponsoredsearch-sponsoredSearchModel:1")}break;default:f.stat("sponsoredsearch_adcall_made","failure:netfailure")}var l=f.prepareMultiResponse(i);s&&s.call(a,l)};if(!f.get("seedTerm")||!f.get("partner"))return;if(f.get("seedTerm")){var d=f.get("seedTerm");u?d=r(n(d)):d.match(/subject:.*/)&&(d=r(n(d))),f.set("seedTerm",d.replace(/([\#|\%|\&])/g," "))}c.push("outputCharEnc=utf8"),c.push("keywordCharEnc=utf8"),c.push("mkt="+f.getIntlMarket()),c.push("adultFilter=any"),c.push("Partner="+t.settings.value("search_ads_partner")),c.push("bolding=true"),c.push("enableFavicon=1"),c.push("Keywords="+encodeURIComponent(f.cleanSeedTerm(f.get("seedTerm")))),c.push("serveUrl="+NeoConfig.launch_protocol+document.location.host),c.push("affilData="+encodeURIComponent("ip="+NeoConfig.ipAddress+"&ua="+navigator.userAgent)),c.push("longAdsTitle=1"),c.push("adEnableMerchRating=1"),c.push("osb=1"),c.push("maxCount="+t.settings.value("dm_max_listings")),h!=="0"?c.push("type="+h):f.get("source")&&c.push("type="+encodeURIComponent(f.get("source"))),l=NeoConfig.ssEndPoint+c.join("&"),e.fire("util:ymstats",{name:"sponsoredsearch_ad_request",tags:{intl:o,bkt:NeoConfig.expBucketId}}),f.req=i.requestProxy(l,{on:{success:p,failure:p},method:"GET",responseType:"xml",service:"sponsoredsearch",serviceCredType:"strict",timeout:2e3})},stat:function(t,n){e.fire("util:ymstats",{name:t,tags:{status:n,intl:o,bkt:NeoConfig.expBucketId,srctag:this.get("partner")}})}},!0),e.namespace("mail.ui"),e.mail.ui.sponsoredsearchRequest=a},"1.0.0",{requires:["common-net-sessionmgr","mail-common-utils-settings"]});
YUI.add("mail-ui-dmsearch-model",function(e){var t=e.common.Utils,n=t.escapeHtml,r=t.unescapeHtml,i=e.common.net.SessionMgr,s=/(((to|from|folder|subject|size|attachmentcount|attachmentname|attachmentsize|attachment|is|on|has|links)\:)|((before|after)\:)((\(.*?\))|(\d{4}\/\d{2}\/\d{2}))?|(\')|(\"))/gi,o=NeoConfig.intl+(NeoConfig.partnerType?"_"+NeoConfig.partnerType:""),u=NeoConfig.enableCategorySearch&&NeoConfig.dmSrcTag==="yahoo_mail_mailbox_search_3"?1:0,a=function(t){var n=this,r={seedTerm:{},partner:{},response:{setter:function(e){n.response=e}},path:{},proxyPrefix:{},source:{}};e.augment(n,e.Attribute),n.addAttrs(r,t||{}),e.augment(n,e.EventTarget)},f=function(e){return e?e.replace("http://l.yimg.com","https://s.yimg.com"):""};e.mix(a.prototype,{req:null,prepareResponse:function(e){var t=this,i,s,o,u,a,f,l,c,h=!0,p=/(<([bui(strong)]|[^>]|[\/bui(strong)]*)>)/gi;if(e.Results&&e.Results.ResultSet&&e.Results.ResultSet[0]&&e.Results.ResultSet[0].Listing&&e.Results.ResultSet[0].Listing[0]){i=e.Results.ResultSet[0].Listing[0].ClickUrl.v_data,s=r(e.Results.ResultSet[0].Listing[0].a_title),o=r(e.Results.ResultSet[0].Listing[0].a_description),u=e.Results.ResultSet[0].Listing[0].a_siteHost,a=e.Results.ResultSet[0].Listing[0].a_OSB,f=e.Results.ResultSet[0].Listing[0].a_faviconUrl?e.Results.ResultSet[0].Listing[0].a_faviconUrl.replace("http://l.yimg.com","https://s.yimg.com"):"",h=s.match(/<.*>/)||o.match(/<.*>/),h&&(l=s.replace(p,""),c=o.replace(p,""),h=l.match(/<.*>/)||c.match(/<.*>/)),h&&t.stat("dmsearch","failure:badtags");if(!h)return t.stat("dmsearch","success:displayed"),{ad_url:i,ad_title:s,ad_description:o,ad_pretty_url:u,ad_official:a,ad_note:strings.str_srch_sponsored,ad_seedTerm:n(this.get("seedTerm")),ad_favicon_url:f}}t.stat("dmsearch","failure:noads")},prepareMultiResponse:function(e){var t=this,i,s,o,u,a,l,c,h,p,d,v,m,g=!0,y=/(<([bui(strong)]|[^>]|[\/bui(strong)]*)>)/gi,b,w=[];if(e.Results&&e.Results.ResultSet&&e.Results.ResultSet[0]&&e.Results.ResultSet[0].Listing){for(var E in e.Results.ResultSet[0].Listing)b=e.Results.ResultSet[0].Listing[E],i=b.ClickUrl.v_data,s=r(b.a_title),o=r(b.a_description),u=b.a_siteHost,a=b.a_OSB,l=f(b.a_faviconUrl),c=b.a_MRRating,h=b.a_MRNumberOfRatings,p=f(b.a_MRDetailPageLink),d=f(b.a_MRStarLink),g=s.match(/<.*>/)||o.match(/<.*>/),g&&(v=s.replace(y,""),m=o.replace(y,""),g=v.match(/<.*>/)||m.match(/<.*>/)),g&&t.stat("dmsearch","failure:badtags"),g||(t.stat("dmsearch","success:displayed"),w.push({ad_url:i,ad_title:s,ad_description:o,ad_pretty_url:u,ad_official:a,ad_note:strings.str_srch_sponsored,ad_seedTerm:n(this.get("seedTerm")),ad_favicon_url:l,ad_avg_rating:c,ad_num_ratings:h,ad_rating_detail_page:p,ad_rating_star_link:d}));return w}t.stat("dmsearch","failure:noads")},cleanSeedTerm:function(e){var t=/^(subject)\:"|^(subject)\:|("$)/gi;return u?e.replace(s,""):e.replace(t,"")},execute:function(t,s){var a=this,f,l=[],c=NeoConfig.expBucketId,h=a.get("partner"),p=function(n,r){var i={},o=r?r.status:"";switch(o){case 200:try{i=e.JSON.parse(r.responseText);break}catch(u){typeof globals!="undefined"&&globals.report?globals.report("caughterror:..-build-mail-ui-dmsearch-dmsearchModel:1",u,"TRY_CATCH",1,1,1):window.console&&console.log&&console.log("caughterror:..-build-mail-ui-dmsearch-dmsearchModel:1")}break;default:a.stat("dmsearch","failure:netfailure")}i=a.prepareMultiResponse(i),t&&t.call(s,i)};if(!a.get("seedTerm")||!a.get("partner"))return;if(a.get("seedTerm")){var d=a.get("seedTerm");u?d=r(n(d)):d.match(/subject:.*/)&&(d=r(n(d))),a.set("seedTerm",d.replace(/([\#|\%|\&])/g," "))}f=a.get("proxyPrefix")+a.get("path")+"?",l.push("partner="+h),l.push("url="+document.location.host),l.push("serveUrl="+document.location.host),l.push("affilData="+encodeURIComponent("ur=&ip="+NeoConfig.ipAddress+"&ua="+navigator.userAgent)),l.push("seedTerm="+encodeURIComponent(a.cleanSeedTerm(a.get("seedTerm")))),l.push("adultFilter=clean"),h==="yahoo_mail_https_ctxt"||h==="yahoo_mail_https_2_ctxt"||h==="yahoo_mail_https_3_ctxt"?(l.push("cmSourceTag="+h),l.push("maxRT=0"),l.push("maxCM=5")):(l.push("maxListings="+NeoConfig.dmMaxListings),l.push("cookie="+encodeURIComponent(e.Cookie.get("B"))),c!=="0"?l.push("type="+c):a.get("source")&&l.push("type="+encodeURIComponent(a.get("source"))),c!=="CMUSGRSM04"&&c!=="CMUSGRSMC1"&&l.push("enableFavicon=1")),NeoConfig.dmSrcTag!=="yahoo_mail_mailbox_search_2"&&(l.push("longAdsTitle=1"),l.push("enableMerchRating=1")),f+=l.join("&"),e.fire("util:ymstats",{name:"dmsearch_adcall_made",tags:{intl:o}}),a.req=i.requestProxy(f,{on:{success:p,failure:p},method:"GET",service:"dmsearch",serviceCredType:"strict",timeout:5e3})},stat:function(t,n){e.fire("util:ymstats",{name:t,tags:{status:n,intl:o,srctag:this.get("partner"),bkt:NeoConfig.expBucketId}})}},!0),e.namespace("mail.ui"),e.mail.ui.dmsearchRequest=a},"1.0.0",{requires:["common-net-sessionmgr","mail-common-utils-settings"]});
YUI.add("mail-ui-dmsearch-controller",function(e){var t=e.common.Utils,n=NeoConfig.intl+(NeoConfig.partnerType?"_"+NeoConfig.partnerType:""),r=function(t){var n=this,r={rootNode:{},seedTerm:{},partner:{},response:{setter:function(e){n.response=e}},responseTime:{value:0},path:{value:strings.str_cfg_dm_feed_path},proxyPrefix:{value:strings.str_cfg_dm_proxy_prefix},source:{}};e.augment(n,e.Attribute),n.addAttrs(r,t||{}),e.augment(n,e.EventTarget)};r.prototype={sponsoredsearchRequest:null,stat:function(t){e.fire("util:ymstats",{name:t,tags:{intl:n,bkt:NeoConfig.expBucketId}})},process:function(r){var i=this,s=(new Date).getTime(),o=function(o){var u=(new Date).getTime()-s,a,f=NeoConfig.ssOpt?"sponsoredsearch":"dmsearch";i.set("responseTime",u),o?(i.set("response",o),o.length>0&&(a={keyword:o[0].ad_seedTerm,response:o},NeoGV.searchAds.push(a),NeoGV.searchAds.currentKeyword=o[0].ad_seedTerm)):i.get("rootNode")&&(i.stat("dmsearch_staticad"),i.set("response",i.getStaticAd())),t.features.enabled("bingads")&&e.fire("showBingAds",{data:o}),e.fire("util:ymstats",{name:f+"_adcall_responsetime",unit:"ms",type:"duration",dataum:u,tags:{intl:n}}),r&&r(o)},u,a,f,l,c,h;NeoConfig.ssOpt?i.sponsoredsearchRequest=new e.mail.ui.sponsoredsearchRequest({seedTerm:i.get("seedTerm"),partner:i.get("partner"),path:i.get("path"),proxyPrefix:i.get("proxyPrefix"),source:i.get("source")}):i.sponsoredsearchRequest=new e.mail.ui.dmsearchRequest({seedTerm:i.get("seedTerm"),partner:i.get("partner"),path:i.get("path"),proxyPrefix:i.get("proxyPrefix"),source:i.get("source")}),u=(i.get("seedTerm")||"").trim();if(u)if(NeoGV.searchAds){l=NeoGV.searchAds,c=l.length,h=!1;for(a=0;a<c;a++){f=l[a];if(f.keyword===u){i.set("response",f.response),i.set("responseTime",1),h=!0,t.features.enabled("bingads")&&e.fire("showBingAds",{data:f.response});break}}h||i.sponsoredsearchRequest.execute(o,i)}else NeoGV.searchAds=[],i.sponsoredsearchRequest.execute(o,i);else i.stat("dmsearch_blank_seed")},getStaticAd:function(){var e=window.strings;return{ad_url:t.substitute(e.str_cfg_url_dm_static_content_mail_search_tip,e),ad_title:e.str_dm_title,ad_description:e.str_dm_description,ad_pretty_url:e.str_dm_pretty_url,ad_note:""}},render:function(){var t=this,n=new e.mail.ui.dmsearchView({rootNode:t.get("rootNode"),response:t.get("response")||{}});if(t.get("responseTime")&&!t.get("response"))return;n.render(),!t.get("responseTime")&&!t.get("response")&&t.after("responseChange",function(){t.render()})}},e.namespace("mail.ui"),e.mail.ui.dmsearchController=r},"1.0.0",{requires:["event-base","mail-ui-dmsearch-view","mail-ui-sponsoredsearch-model","mail-ui-dmsearch-model","mail-common-utils-features"]});
YUI.add("mail-services-v3",function(C){var B=[NeoConfig.launch_protocol,location.hostname,"/ws/v3/batch","?appid=YahooMailNeo","&wssid="+encodeURIComponent(NeoConfig.wssid),"&windowid="+encodeURIComponent(NeoConfig.windowId),"&r="+new Date().getTime()].join("");var A=function(E,D){this.requests=E;this.options=D;};A.prototype={execute:function(){var D={method:"POST",headers:{"Accept":"application/json, multipart/form-data","Content-Type":"application/json"},data:C.JSON.stringify({requests:this.requests}),context:this,on:{success:C.bind(this._handleBatchResponse,this),failure:C.bind(this._handleFailure,this)}};C.io(B,D);},_extractMultipartResponse:function(E){var K=C.Lang.trim(E.getResponseHeader("Content-Type").split("boundary=")[1]),H=E.responseText,D="\r?\n?[-]*"+K+"[-]*\r?\n?",F,I,J,G={};I=new RegExp(D,"igm");J=H.split(I);if(J.length>1){C.Array.each(J,function(N){var L,M;if(N===""||N==="--"||N==="\r\n"){return;}M=N.match(/Content-RequestId: (.*)\s/);if(!M){return;}L=M[1];if(!L||L==="Status"){return;}F=N.indexOf("\r\n\r\n");G[L]=C.Lang.trim(N.substr(F+1));});}return G;},_handleBatchResponse:function(F,D){var E;if(D.status!==200){this._handleFailure();return;}E=this._extractMultipartResponse(D);this.options.success&&this.options.success.call(this.options.context,E);},_handleFailure:function(){this.options.failure&&this.options.failure.call(this.options.context);}};C.namespace("mail.services").V3={execute:function(E,D){new A(E,D).execute();}};},"1.0.0",{requires:["io"]});YUI.add("search-ult",function(e){e.mix(e.common.Utils.RapidCM,{hovercard_search_email:["msgRead","msgRdTb","msgHdr","lzngMnu","lzngEml"],msglist_search_from:["msgLst","{{activeTab}}","msgLst","sbjSrch"],msglist_search_subj:["msgLst","{{activeTab}}","msgLst","frmSrch"],search_uh_box_click:["hdr","hdr","srchMailBtn"],search_uh_box_enter:["hdr","hdr","srchMlEntr"],search_uh_suggestion_recent:["hdr","hdr","srchBx","srchDD","ddRcnt"],search_uh_suggestion_people:["hdr","hdr","srchBx","srchDD","ddPpl"],search_box_click:["hdr","hdr","srchMailBtn"],search_box_enter:["hdr","hdr","srchMlEntr"],search_suggestion_recent:["hdr","hdr","srchBx","srchDD","ddRcnt"],search_suggestion_people:["hdr","hdr","srchBx","srchDD","ddPpl"],search_box_adv_search:["srch","hdr","hdr","srchBx","srchDD","advSrch","advSBtn"],smartview_custom_keyword:["smrtVwLst","leftRail","smrtVwLst","svKywrd"],smartview_custom_contact:["smrtVwLst","leftRail","smrtVwLst","svCntct"],smartview_unread:["smrtVwLst","leftRail","smrtVwLst","svUnrd"],smartview_starred:["smrtVwLst","leftRail","smrtVwLst","svStr"],smartview_important:["smrtVwLst","leftRail","smrtVwLst","svImprtnt"],smartview_people:["smrtVwLst","leftRail","smrtVwLst","svPpl"],smartview_social:["smrtVwLst","leftRail","smrtVwLst","svScl"],smartview_travel:["smrtVwLst","leftRail","smrtVwLst","svTrv"],smartview_shopping:["smrtVwLst","leftRail","smrtVwLst","svShp"],smartview_finance:["smrtVwLst","leftRail","smrtVwLst","svFnc"],srp_msg_open:["srchTb","srchTb","msgLst","msg"],srp_often_cced:["srchTb","srchTb","srchRtRl","oftenCC"],srp_header_section_clicked:["srchTb","srchTb","srchHdr","srchSec"],srp_right_rail_see_all_clicked:["srchTb","srchTb","srchRtRl","srchSeeAll"],srp_header_filter_clicked:["srchTb","srchTb","srchHdr","srchFlter"],srp_doc_gallery:["srchTb","srchTb","srchList","srchDcLst","srchDcItm"],srp_photo_gallery:["srchTb","srchTb","srchList","srchPhLst","srchPhItm"],srp_contact_email:["srchTb","srchTb","srchRtRl","srchCCard","ctctEmail"],srp_photo_right_rail:["srchTb","srchTb","srchRtRl","srchRPhoto","srchRPhItm"],srp_doc_right_rail:["srchTb","srchTb","srchRtRl","srchRDoc","srchRDcItm"],srp_msg_right_rail:["srchTb","srchTb","srchRtRl","srchRMsg","srchRMsgItm"],srp_oftenCC_right_rail:["srchTb","srchTb","srchRtRl","srchRCC","srchRCCItm"],search_sort_click:["srchTb","srchTb","srchLstTlbr","viewMenu","msgSort"],attach_download_menu_selected_from_srch:["msgRead","msgRdTb","msgFtr","atmSDld"],attach_dropbox_saveto_selected_from_srch:["msgRead","msgRdTb","msgFtr","atmSDbD"],attach_download_all_selected_from_srch:["msgRead","msgRdTb","msgFtr","atmADbD"],attach_dropbox_saveall_selected_from_srch:["msgRead","msgRdTb","msgFtr","atmADbD"],attach_single_preview_from_srch:["msgRead","msgRdTb","msgFtr","atmSPrv"],attach_slideshow_download_single_from_srch:["msgRead","msgRdTb","msgFtr","atmSlD"],attach_dropbox_save_slideshow_from_srch:["msgRead","msgRdTb","msgFtr","atmSlDbD"],attach_all_preview_from_srch:["msgRead","msgRdTb","msgFtr","atmAPrev"]}),e.mix(e.common.Utils.RapidVM,{srp_msg_display:["srp_msg_open"]})},"1.0.0",{requires:["common-utils-rapid-clickmap","common-utils-rapid-viewmap"]});
YUI.add("mail-ui-mailSearchController",function(e){var t=e.common.Utils,n=t.escapeHtml,r=t.unescapeHtml,i=t.Stopwatch,s=e.mail.ui.SearchBar,o=e.common.persist.UserData,u=e.mail.persist.MetaData,a=e.mail.model.DataStore,f=["open","forward","reply_sender","reply_all","edit","fullheader","addcontact","set_encodings","print","quick_filter"],l=e.mail.ui.SearchUtils,c=[48,49,50,51,52,53,54,55,56,57],h=[strings.str_cfg_sc_keycode_reply_to_all,strings.str_cfg_sc_keycode_movemenu_display,strings.str_cfg_sc_keycode_message_forward,strings.str_cfg_sc_keycode_mark_as_read,strings.str_cfg_sc_keycode_flag_selected_messages,strings.str_cfg_sc_keycode_reply_to_sender,strings.str_cfg_sc_keycode_print,strings.str_cfg_sc_keycode_close_tab],p=[65,68,70,75,76,82,80,220],d={},v=["from","attachmenttypes","fnums","date","flags"],m=h.length,g,y={amazon:{type:"PRD",payload:"domain:amazon.com"}},b=NeoConfig.intl+(NeoConfig.partnerType?"_"+NeoConfig.partnerType:""),w=NeoConfig.refineTop,E=42;for(g=0;g<m;++g)d[h[g]]=p[g];var S=function(t){var r=this,i,s={fid:{setter:function(e){r.fid=e||"%40S%40Search",r.listMgr.warmCache(r.fid),t.type==="list"&&r.listMgr.persist()}},customTitle:{},noRefine:{},disableScrollToSearch:{},isSnippet:{setter:function(e){u.set("neo.pref.showSnippetsFresh",e)},getter:function(){return r.type==="list"?!1:u.get("neo.pref.showSnippetsFresh")}},query:{value:{},setter:function(t){var n=e.Lang.trim(t.keyword),i;r.appliedRefinements=!1;if(!n)return;for(i in t)if(e.Array.indexOf(v,i)!==-1){r.appliedRefinements=!0;break}r.fire("search:start"),r.set("title",strings.str_tabs_search+(n.length?": "+n:"")),r.abort(),r.reset(),r.listMgr.flush()}},prefilterRefinements:{value:!0},showDDWithSearchResults:{value:!1},addToRecentSearches:{value:!0},searchRequestId:{},displayQueryInSearchBar:{value:!0},searchId:{value:""},tabNode:{setter:function(e){e.addClass("srch-loading"),r.on("closeChange",r.close)},validator:function(e){return e},writeOnce:!0},searchingContact:{value:"",setter:function(t){var i;if(t===undefined)return;i=e.Lang.trim(t),i.length&&r.set("customTitle",n(i))}},data:{},stopWatchRT:{},responseTime:{value:0}};S.superclass.constructor.call(r),r.listMgr=new e.mail.ui.ListMgr,r.modules={},r.type=t.type,r.supportPreview=r.type==="list",r.evt=[],r.bulkThreshold=r.listMgr.getCacheInfo().origServerSize,r.listMgr.on("itemSelect",r.listMgrItemSelectHandler,r),r.on("search:start",r.onSearchStartHandler,r),r.on("search:complete",r.onSearchCompleteHandler,r),r.after("activeChange",r.afterActiveChangeHandler,r),r.requests=[],r.delRequests=[],r.dsConvRefresh=!1,r.before("titleChange",function(e){var t=r.get("customTitle");t&&(t==="#"?e.newVal=strings.str_tabs_search:t.noLabel?e.newVal=t.value:e.newVal=strings.str_tabs_search+": "+t)},r),r.on("search:start",function(){i=(new Date).getTime(),r.get("tabNode")&&r.get("tabNode").addClass("srch-loading")}),r.on("darlaEvent",function(){r.set("responseTime",(new Date).getTime()-i)}),r.on("darlaEvent",function(){var t=this,n=t.listMgr.getCurrentPage(),r,i,s=t.listMgr.isPageInCache(n.serverSize/n.cacheSize+n.cacheIndex);s.list.length||(n.cacheIndex+1)*n.cacheSize<n.serverTotal&&n.serverIndex+n.serverSize<n.serverTotal&&(r={query:t.get("query"),startMid:n.serverIndex+n.serverSize},i=function(e){t.type==="list"&&(e.hits=e.messageInfo,e.count=e.numInfo,e.total=e.folder.total,e.fid=t.fid,e=l.processListData(e,t.fid));if(e.hits||e.response)e.start=e.startInfo,t.listMgr.store(e.response||e)},t.type!=="search"&&e.Lang.later(100,t,function(){t.makeRequest("list",r,i)}))}),r.evt.push(e.on("ds:msg:remove",r.removeMsgHandler,r),e.on("ds:msg:change",r.changeMsgHandler,r),e.on("ds:msg:add",r.addMsgHandler,r),e.on("ds:conv:change",r.changeConvHandler,r),e.on("ds:conv:remove",r.removeConvHandler,r),e.on("ds:folder:change",function(e,t,n,i){var s,o,u;if(r.type!=="list")return;if(i==="ds:msg:"){for(u=0;u<t.length;u++)if(t[u].folderInfo.fid===r.fid){s=" <i>("+t[u].total+")</i>";break}s&&r.set("title",r.fid+s);return}for(u=0;u<t.length;u++)if(t[u].folderInfo.fid==="Inbox"){o=!0;break}i==="checkmail"&&r.fid==="Inbox"&&o&&(r.fire("search:start"),r.listMgr.flush(),r.abort(),r.makeRequest("list",{fid:"Inbox"}))},r),e.on("msgsview:movetonewfolder",function(){var t=e.mail.Tabs.getActiveTab();t&&t.widget&&t.widget===r&&r.toolbarHandler.call(r,{dataAction:"folder-new"})},r),e.on("timeChunkSettingChange",function(){var t=r.listMgr.getSortInfo();if(t.sortKey==="date"||t.sortKey!=="date"&&NeoConfig.timeChunk)e.mail.Tabs.getActiveTab().widgetType==="search"?(r.timeChunkSettingChanged=!1,r.listMgr.sort({sortKey:"date",sortOrder:"down"}),r.modules.listview.fire("doMailSearch",{query:r.get("query")})):r.timeChunkSettingChanged=!0},r)),r.addAttrs(s,t||{}),r.listMgr.persist(),e.augment(r,e.EventTarget),r.set("charCodes","13,27,33,34,37,38,39,40,46,188,190,"+c.join(",")+","+h.join(","))};e.extend(S,e.mail.ui.BaseWidget),e.mix(S.prototype,{NAME:"MailSearch",type:"searchlist",reset:function(){var e=this,t=e.modules;if(t){for(var n in t)t[n]&&typeof t[n].close=="function"&&(t[n].close(),t[n]=null);t={}}},render:function(t){var n=this;n.set("tabNode",e.Node.one(t)),n.type==="list"&&(n.listMgr.flush(),n.renderLaunchToInbox()),n.statuses=e.Node.create('<div id="lv-statuses-container"><div class="list-view-status status"></div></div>'),n.loader=n.statuses.one(".list-view-status"),n.loader.appendChild(e.Node.create('<div class="s-loader"></div>')),t.appendChild(n.statuses)},renderLaunchToInbox:function(){var e=this,t=e.listMgr.getSortInfo(),n=NeoConfig.pagedResults?o.get("userUIPref.messagesPerPage")*1:10,r,i=NeoConfig.folders.numberOfFolders,s={fid:"Inbox",numInfo:n<100?100:n,bidiDetection:NeoConfig.bidi,sortKey:t.sortKey==="from"?"sender":t.sortKey,sortOrder:t.sortOrder},u={hits:NeoConfig.msgListObj,count:NeoConfig.msgListObj.length,type:"list",fid:"Inbox",sortOrder:t.sortOrder};e.set("fid","Inbox");for(r=0;r<i;r++)if(NeoConfig.folders.folder[r].folderInfo.fid===s.fid){u.total=NeoConfig.folders.folder[r].total;break}
u.start=t.sortOrder==="up"?u.total-NeoConfig.msgListObj.length:0,e.set("searchRequest",s),e.searchResponseHandler({response:u,rendered:t.sortOrder==="up"?!1:!0})},updateSearchQueryDisplay:function(){var t=this.get("query"),i=t&&t.keyword||"",o=e.Lang.trim(i),u=this.get("searchingContact");this.get("displayQueryInSearchBar")?u?s.getSearchField().set("value",r(n(u))):s.getSearchField().set("value",r(n(o))):s.getSearchField().set("value","")},resetSearchQueryDisplay:function(){s.getSearchField().set("value","")},sync:function(){var t=this,n=e.Lang.trim(t.get("query").keyword||"");this.updateSearchQueryDisplay(),t.stopWatchRT=t.getStopwatch({source:"workspace"}),t.set("title",strings.str_tabs_search+(n.length?": "+n:"")),e.mail.ui.SearchRequest.headerSearch=0,t.makeRequest("search",{query:t.get("query"),prefilterRefinements:t.get("prefilterRefinements")},t.searchResponseHandler),t.preloadDependencies()},getStopwatch:function(e){var t=this,n={};return e.source==="workspace"?n=t.get("stopWatchRT"):n=new i("Search","start"),n.source=e.source,n},preloadDependencies:function(){var t="_shared_module_search_with_snippet_rollup",n=(NeoConfig.isSSL?"https://s.yimg.com":"http://mail.yimg.com")+"/ok/u/assets/img/display-img/",r=["profile_16a.png","profile_16b.png","profile_16c.png","profile_16d.png","profile_16e.png"],i;e.use("mail-ui-advancedSearchController","mail-ui-searchGroupsController","mail-ui-searchListController","mail-ui-toolbarController","contacts-api","contacts-api-utils","stylesheet","mail-ui-messageaction","mail-ui-inboxmenu-base","mail-common-inline-edit",t);for(var s=0,o=r.length;s<o;s++)i=new Image,i.src=n+r[s]},getSortParam:function(){var e=this,t=e.listMgr.getSortInfo(),n,r="none";return t.sortKey==="attachmentcount"?(n="date",r="hasAttachment"):t.sortKey==="flagged"?(n="date",r="flagged"):t.sortKey==="unRead"&&(n="date",r="unRead"),r==="none"?{reqMix:!1}:{reqMix:!0,sortKey:n,groupBy:r}},_getSortInfo:function(){var t=this.listMgr.getSortInfo();return t.sortKey==="relevance"&&(t=e.merge(t,{sortKey:"from",sortOrder:"down"})),t},makeRequest:function(t,n,r){var i=this,s=i._getSortInfo(),u={start:n.startMid||0,query:e.clone(n.query),sorting:s,prefilterRefinements:"prefilterRefinements"in n?n.prefilterRefinements:!0},a,f,l,c=n.query.predictiveSearchType?{type:n.query.predictiveSearchType}:e.Object.getValue(y,[n.query.keyword.trim().toLowerCase()]),h=NeoConfig.pagedResults?o.get("userUIPref.messagesPerPage")*1:10;if(t==="list")n.fid&&i.set("fid",n.fid),u={fid:n.fid||i.fid,startInfo:n.startMid||0,numInfo:h<100?100:h,bidiDetection:NeoConfig.bidi,sortKey:s.sortKey==="from"?"sender":s.sortKey,sortOrder:s.sortOrder},f={success:r||function(e){i.set("searchRequest",u),i.searchResponseHandler.call(i,{response:{hits:e.messageInfo,count:e.numInfo,total:e.folder.total,type:"list",fid:n.fid||i.fid,start:n.startMid||0}})},failure:function(){},timeout:NeoConfig.wsListTimeout||6e4,suppressCodes:["*"],suppressLogs:n.fid==="%40C%40Chats"&&["Client.FolderIdDoesntExist"],exceptCodes:[999]},l=i.getSortParam(),l.reqMix&&e.mix(u,{sortKey:l.sortKey,groupBy:l.groupBy},!0),i.requests.push(e.mail.Controller.Messages.list(u,f));else{i.stopWatchRT&&i.stopWatchRT.start(1,"serverRequest"),n.disableRefinements||(n.prefilterRefinements&&(u=e.mail.ui.parseSearchRequest(u)),u.query.keyword=u.query.keyword||"",u.query.keyword.toLowerCase().indexOf("in:trash")===-1&&(u.query.keyword+=" -in:trash",u.query.keyword=e.Lang.trim(u.query.keyword)),u.query=e.mix(u.query,{group:{from:{},folder:{},flags:{order:"desc"},attachmenttype:{},date:{unit:n.query.date&&n.query.date.year?"month":"year"}}},!0)),n.count&&(u.count=n.count),a=new e.mail.ui.SearchRequest(u),i.set("searchRequest",a),a.execute(r,i);var p=n.query;e.common.Utils.features.enabled("noAdsForPeopleInKeywordSRP")||e.common.Utils.features.enabled("noAdsForPeopleInPeopleSRP")?i.makeDmRequest():(!p.isContactSearch||p.isCompany||e.common.Utils.features.enabled("PeopleSearchAds"))&&(!p.isContactSearch||!NeoConfig.isCorpmail)&&i.makeDmRequest(),e.common.Utils.features.enabled("predictiveSearchSRP")&&c&&e.use("mail-ui-searchmyworld-srp",function(e){var t=new e.mail.ui.PredictiveSearch.SMW_SRP(c)})}},peopleQueryClassification:function(t){var n="http://pplsearch1.socgr.vip.bf1.yahoo.com:4080/classify?p=",r=new Promise(function(r,i){e.mail.services.V3.execute([{id:"PeopleQueryClassification",uri:n+encodeURIComponent(t),method:"GET"}],{success:function(t){var n;try{n=e.JSON.parse(t.PeopleQueryClassification),r(n)}catch(s){typeof globals!="undefined"&&globals.report?globals.report("caughterror:..-build-mail-ui-msearch-mailSearchController:1",s,"TRY_CATCH",1,1,1):window.console&&console.log&&console.log("caughterror:..-build-mail-ui-msearch-mailSearchController:1"),i(s)}},failure:function(){i()}})});return r},makeDmRequest:function(){var t=this,n,r=t.get("query"),i=null,s=!0,o=t.get("query").adKeyword||t.get("query").keyword||"",u=t.get("query").source||"",a=o.match(/^from:/i)?!0:!1,f,l;l=o.replace(/(\s|^)in:("[^"]+"|'[^']+'|\S+)(?=\s|$)/g,""),l=l.replace(/(\s|^)(is:|has:)(?="[^"]+"|'[^']+'|\S+)/g," ").trim(),o=(l||o).trim(),u=u.replace(/_(enter|click|recent|people)$/g,""),NeoConfig.dmEnabled&&o&&(!a||a&&s)?(f=function(){var r;if(n&&o&&e.Lang.trim(o)!==""&&(!a||a&&s)){r=n.get("responseTime");if((!r||r>NeoConfig.dmSLA)&&t.get("responseTime")>NeoConfig.dmSLA)return;var i=t.get("tabNode"),u=i.one(".content.search")!==null?i.one(".content.search"):i.one(".result>.list-view");n.set("rootNode",u),n.render()}},t.get("dmDarlaEvent")&&t.get("dmDarlaEvent").detach(),t.set("dmDarlaEvent",t.after("darlaEvent",f)),n=new e.mail.ui.dmsearchController({seedTerm:o,partner:NeoConfig.dmSrcTag,source:u}),e.common.Utils.features.enabled("noAdsForPeopleInKeywordSRP")&&!r.isContactSearch?i=r.keyword:e.common.Utils.features.enabled("noAdsForPeopleInPeopleSRP")&&r.isContactSearch&&(i=t.get("searchingContact")),i?t.peopleQueryClassification(i).then(function(e){e.peopleQuery||n.process()},function(){n.process()})
:n.process()):e.fire("util:ymstats",{name:"dmsearch_not_enabled",tags:{intl:b,mp:!NeoConfig.hasAds}})},abort:function(){var t=this,n,r=t.get("searchRequest");if(t.type==="list")for(n=0;n<t.requests.length;n++)t.requests[n].abort();else r&&r.abort();e.fire("global:search:abort")},openInPreviewPane:function(t){var n=this,r=e.mail.model.DataStore.Messages.toMessage(n.fid,t),i=[],s=n.msgPane.get("message");if(n.type==="list"&&NeoConfig.pageMode==0){if(s==null||s.message.mid!==r.mid)n.listMgr.getNeighbors(n.listMgr.getItemIndex(t.mid),i,n.fid),n.msgPane.set("message",{fid:n.fid,message:r,neighbors:i,index:null}),n.msgPane.render("#inboxcontainer");return}},requestAction:function(t,n,r){var i=this,s=e.one("#redirectMsg"),o=s&&s.get("value");e.use("mail-ui-messageaction",function(e){var s={action:t,fid:i.fid,forwardAsAttachment:n.forwardAsAttachment||!1,msgs:n.msgs,msgInfo:n.msgInfo,destinationFid:n.destinationFid,redirectToEmail:o,index:n.index};if(t==="openInPane"){i.openInPreviewPane(n.msgs[0]);return}if(t==="open"){var u,a=i.listMgr,f=[];NeoConfig.prefetchMsgsFolders&&a.getNeighbors(s.index,f,s.fid),i.type==="search"?u=i.get("searchRequest")&&i.get("searchRequest").getAttrs():i.type==="list"&&(u=i.get("searchRequest")),u&&delete u.response,e.mix(s,{fid:n.msgs&&n.msgs[0].fid||i.fid,sortCol:a.getSortInfo(),query:i.get("query"),neighbors:f,arrMsgSeq:a.getAllCachedItems(),searchRequestAttrs:u,searchListMgr:e.clone(a),processData:l.processListData,type:i.type},!0)}e.mail.ui.MessageAction.handle(t,s,r)})},retainSelection:function(e){var t=this,n=t.modules.listview,r,i,s={open:!0,read:!0,unread:!0,flagged:!0,unflagged:!0,fullheader:!0,set_encodings:!0,spam:!0,sendercompromised:!0,phished:!0,"delete":t.type==="list"?!0:!1,move:t.type==="list"?!0:!1,trash:t.type==="list"?!0:!1};if(!s[e]){t.listMgr.selectAll(!1),n&&n.selectItems(!1);if(NeoConfig.pagedResults&&n){r=n.get("focusNode");if(r){i=t.listMgr.getNextItem(r.getAttribute("data-key"));try{n.setFocusNode(t.listMgr.generateKey(i.mid),!0,!0),n.set("firstSelectedMid",i.mid),t.listMgr.select(i.mid,!0)}catch(o){}}}}},handleMessageAction:function(t,n){var r=this,i=r.modules.listview,s=r.listMgr.getSelectedItems(),o=r.listMgr.getCacheInfo(),u=n.fid,a=n.selectedItems,c=n.cbk,h=n.forwardAsAttachment;switch(a.total){case 0:l.showAlert("emptySelection");return;case 1:break;default:if(e.Array.indexOf(f,t)!==-1){l.showAlert("multipleSelection");return}}var p=s.all&&!NeoConfig.pagedResults?o.serverTotal-o.cacheTotal+s.total:s.total;!NeoConfig.pagedResults&&!a.singleOp&&p>=r.bulkThreshold?e.use("mail-ui-bulk-progress",function(e){var n=e.mail.ui.BulkProgressbar,f;r.modules.bulkProgress=n,n.set("action",t),n.set("progress",0),n.render(),n.once("cancelProgress",function(){r.modules.bulkProgress=null,f=NeoConfig.pagedResults?r.listMgr.getCurrentPage():r.listMgr.getFirstPage(),i&&(i.pruneItems(),i.appendPageData(f),r.retainSelection(t))},r),o.serverTotal!=o.cacheTotal&&s.all?r.bulkActionHandler(t,u,{startMid:0,serverTotal:s.serverTotal},s.serverTotal):r.cacheActionHandler(t,u,e.clone(a))}):t==="delete"&&n.selectedItems.total>1&&r.listMgr.getCurrentPage().list.length==n.selectedItems.total?l.showConfirm("removeAll",function(){r.cacheActionHandler(t,u,e.clone(a),c,h)}):r.cacheActionHandler(t,u,e.clone(a),c,h)},cacheActionHandler:function(t,n,r,i,s){var o=this,u=0,a=r.total>o.bulkThreshold,f=o.modules.bulkProgress,l=[],c=[],h,p,d=o.modules.listview,v=r.index;if(a&&!f)return;for(var m in r.hash){u+=1,l.push(r.hash[m]),p=r.hash[m].mid,c.push(p),delete r.hash[m];if(u>=o.bulkThreshold||e.Object.size(r.hash)===0){o.requestAction(t,{msgs:l,msgInfo:l,destinationFid:n,forwardAsAttachment:s,index:v},{success:function(u){o.type==="list"&&o.delRequests.length>0?d.appendPageData(o.delRequests[o.delRequests.length-1]):NeoConfig.pagedResults&&o.listMgr.getCacheInfo().cacheSize>=100&&o.isMutableAction(t,{response:o.get("data")})?d.appendPageData(o.listMgr.getCurrentPage()):NeoConfig.pagedResults&&o.listMgr.getCacheInfo().cacheSize<100&&o.isMutableAction(t,{response:o.get("data")})&&(d.pruneItems(),d.appendPageData(o.listMgr.getCurrentPage()));if(u===t){o.retainSelection(t);return}h=(r.total-e.Object.size(r.hash))/r.total*100,f&&f.set("progress",h),h<100&&o.cacheActionHandler(t,n,r,i,s),h===100&&(i&&i.success&&i.success(u),o.retainSelection(t))},failure:function(e){i&&i.failure&&i.failure(e),o.retainSelection(t)}});return}}},bulkActionHandler:function(e,t,n,r){var i=this,s,o;s={query:i.get("query"),count:i.bulkThreshold,startMid:n.startMid||0,disableRefinements:!0},o=function(s){var o=s.response.hits,u=[],a=i.listMgr.getSelectedItems(),f;for(var l=0,c=o.length;l<c;l++)f=i.listMgr.getItem(o[l].mid),(!f&&a.all||f&&f.selected==="checked")&&u.push(o[l]);if(u.length>0)i.requestAction(e,{msgs:u,msgInfo:u,destinationFid:t},function(){var o,u,a,f=i.modules.bulkProgress;if(!f)return;if(!s.response||!s.response.hits){f.set("progress",100);return}i.isMutableAction(e,s)?(o=0,u=r-s.response.hits.length,a=(n.serverTotal-u)/n.serverTotal*100):(o=n.startMid+s.response.hits.length,u=r,a=o/u*100),f.set("progress",Math.floor(a)),o<r&&i.bulkActionHandler(e,t,{startMid:o,serverTotal:n.serverTotal},u)});else{var h=i.modules.bulkProgress;h&&h.set("progress",100)}},i.type==="search"&&i.makeRequest("search",s,o)},isMutableAction:function(t,n){if(n&&n.response.refinedby&&e.Object.size(n.response.refinedby)){if(typeof n.response.refinedby.flags!="undefined"&&typeof n.response.refinedby.flags.unread!="undefined"&&t==="read")return!0;if(typeof n.response.refinedby.flags!="undefined"&&typeof n.response.refinedby.flags.flagged!="undefined"&&t==="unflagged")return!0;if(typeof n.response.refinedby.fnums!="undefined"&&typeof n.response.refinedby.fnums[0]!="undefined")switch(t){case"inbox-move":case"folder-new":case"move":case"delete":return!0}}else switch(t){case"inbox-move":case"folder-new":case"spam":case"sendercompromised":case"phished":return!0}return!1},searchResponseHandler:function(t){var n=this,r=t.response,i=
e.mail.Tabs.getActiveTab(),s=n.stopWatchRT,o;r.responseCode=t.responseCode,s&&(s.matches=r.hits&&r.hits.length||0,s.start(1,"renderSearch"),s.start(2,"renderSearchContent"));if(i&&i.widget&&i.widget!=n){n.once("activeChange",function(){if(n.type==="list"&&t.response&&n.fid!==t.response.fid)return;e.Lang.later(2,n,function(){n.searchResponseHandler(t)})},n),delete t.rendered;return}e.fire("tictac:search:complete",{data:r,tab:i}),r.type="search",r.showDD=n.get("showDDWithSearchResults"),n.get("tabNode")&&n.get("tabNode").removeClass("srch-loading"),n.set("data",r),n.reset(),n.listMgr.flush();if(!r||!r.total||r.hits&&r.hits.length===0){n.renderAdvancedSearch(r),s&&s.stop();return}n.listMgr.store(r),o=n.type==="list"&&t.response.sortOrder==="up"?n.listMgr.getLastPage():n.listMgr.getCurrentPage(),o.rendered=n.type==="list"&&o.list.length===0?!0:r.rendered,n.renderSearchList(o),n.type==="search"&&n.renderSearchGroups(r),s&&s.stop()},renderAdvancedSearch:function(t){var n=this,r,s;r=new i("renderAdvancedSearch"),e.fire("navigation:switch",{type:"empty-search"}),n.type==="list"?e.use("mail-ui-emptyFolderController",function(e){s=new e.mail.ui.EmptyFolderController({rootNode:n.get("tabNode")}),s.process(),r.stop(),n.fire("search:complete")}):(e.use("contacts-api","contacts-api-utils",function(e){var t=e.contacts,n=t.utils,r=t.api;n.areContactsLoaded()||r.load()}),e.use("mail-ui-advancedSearchController",function(e){var i;n.renderToolbar(""),i=new e.mail.ui.AdvancedSearchController({data:n.get("data"),query:n.get("query"),searchingContact:n.get("searchingContact"),rootNode:n.get("tabNode"),responseCode:t.responseCode}),n.modules.AdvancedSearch=i,i.process(),i.on("doMailSearch",function(e){n.stopWatchRT=n.getStopwatch({source:"advancedSearch"}),n.set("query",e.query),n.updateSearchQueryDisplay(),n.makeRequest("search",{query:e.query},n.searchResponseHandler)}),r.stop(),n.fire("search:complete")}))},renderToolbar:function(n){var r=this,s,o,u,a;s=new i("renderToolbar"),o=NeoConfig.hasConv?"minty_module_toolbar_inbox_search_thread_rollup":"minty_module_toolbar_inbox_search_fresh_rollup",e.use("mail-ui-toolbarController","mail-ui-button-ctxt",o,function(e){var i;r.modules.topToolbar||(r.set("contentToolbar",""),i=new e.mail.ui.ToolbarController({data:n,rootNode:e.one("#toolbar"),template:e.ui.Templates[o],listMgr:r.listMgr,fid:r.fid,position:"top"}),r.modules.topToolbar=i,i.process(),i.after("activeChange",function(e){r.set("contentToolbar",e.newVal?i.get("widget"):"")},r),i.on("close",function(){r.set("contentToolbar","")}),i.on("itemSelected",r.toolbarHandler,r),r.set("contentToolbar",i.get("widget"))),u=e.one("#pagetoolbar"),u&&u.addClass("hideReplyGroup"),a=u.one("#match-messagelist-sizing"),a&&a.addClass("viewOnRight"),t.features.enabled("viewMenuV2")&&e.one("#btn-conv-view span")&&e.one("#btn-conv-view span").set("innerHTML",e.mail.ui.common.StringUtils.getSortKeyString(r.listMgr.getSortInfo().sortKey)),s.stop()})},renderSearchList:function(t){var n=this,r=n.get("isSnippet"),s="_shared_module_search_with_snippet_rollup",o;o=new i("renderSearchList"),t.type=n.type,t.showDD=n.get("showDDWithSearchResults"),t.noRefine=n.get("noRefine"),t.disableScrollToSearch=n.get("disableScrollToSearch"),e.use("mail-ui-searchListController",s,function(e){var i=new e.mail.ui.SearchListController({listMgr:n.listMgr,isSnippet:r,data:t,searchId:n.get("searchId"),rawData:n.get("data"),query:n.get("query"),rootNode:n.get("tabNode"),makeRequest:e.bind(n.makeRequest,n),fid:n.fid});n.modules.listview=i,i.process(),i.on("doMailSearch",function(e){n.stopWatchRT=n.getStopwatch({source:"searchList"}),n.set("query",e.query),n.updateSearchQueryDisplay(),n.makeRequest("search",{query:e.query},n.searchResponseHandler)}),i.on("messageAction",function(e){n.handleMessageAction(e.action,e.params)}),i.on("toggleSearchView",function(){n.toggleSearchViewHandler()},n),i.on("openInPreviewPane",function(e){var t=e.mid.split("_");n.openInPreviewPane(e.message.hash[t[t.length-1]])},n),i.on("updatePagination",function(e){var t=this,n=t.modules.topToolbar,r=t.modules.bottomToolbar;n&&n.updatePaginationStatus(e.pageData),r&&r.updatePaginationStatus(e.pageData),t.type==="list"?t.handleDarlaEvent():t.fire("darlaEvent",{action:"search_results"})},n),n.modules.bottomToolbar=null,n.stopWatchRT&&n.stopWatchRT.start(3,"renderToolbar"),n.renderToolbar(n.get("data")),o.stop(),n.fire("search:complete"),n.type==="list"&&NeoConfig.pageMode==0&&(n.msgPane||(n.msgPane=new e.mail.ui.MessagePane),n.msgPane.set("message",null),n.msgPane.render("#inboxcontainer"))}),NeoConfig.useDD&n.supportPreview&&e.use("mail-ui-messagesview-dd","mail-ui-messagesview-resize",function(e){typeof e.mail=="object"&&typeof e.mail.MessagesViewDD=="object"&&e.mail.MessagesViewDD.setDD(n),typeof e.mail=="object"&&typeof e.mail.ui.MessagesViewColResize=="object"})},renderSearchGroups:function(t){var n=this,r;r=new i("renderSearchGroups"),e.use("mail-ui-searchGroupsController",function(e){var i=new e.mail.ui.SearchGroupsController({data:t,query:n.get("query"),searchingContact:n.get("searchingContact"),rootNode:NeoConfig.refineTop?n.get("tabNode"):e.one("#shellnavigation")});n.modules.SearchGroups=i,i.process(),i.on("doMailSearch",function(t){n.stopWatchRT=n.getStopwatch({source:"searchGroups"}),n.set("query",t.query),e.fire("contactdetail:filter",t),n.updateSearchQueryDisplay(),n.makeRequest("search",{query:t.query,prefilterRefinements:n.get("prefilterRefinements")},n.searchResponseHandler)}),r.stop()}),e.fire("navigation:switch",{type:"searchNav"})},onKeyDown:function(t){var n=this,r=t.altKey,i=t.metaKey,s=t.ctrlKey,o=t.shiftKey,u="";t.keyCode=d[t.keyCode]||t.keyCode;switch(t.keyCode){case 68:if(!(r||i||s))return o&&e.common.Utils.features.enabled("folderManagement")?e.fire("toolbar:ui-automation","menu","move","find"):e.fire("toolbar:ui-automation","menu","move"),!0;break;case 220:if(i||s)return n.set("close",1),u=e.one("body").getAttribute("data-open"),u==="searchNav"&&(u=""),e.fire("navigation:switch"
,{type:u}),e.mail.Tabs.switchToTab(e.mail.Tabs.tabs[0]),!0;break;case 27:return n.type==="search"&&(n.set("close",1),u=e.one("body").getAttribute("data-open"),u==="searchNav"&&(u=""),e.fire("navigation:switch",{type:u}),e.mail.Tabs.switchToTab(e.mail.Tabs.tabs[0])),!0}return n.modules.listview.keydownHandler(t)},toolbarHandler:function(t,n){var r=this,i,s=r.modules.listview;switch(t.dataAction){case"selectAll-message":var o=!r.listMgr.getSelectedItems().allCacheSelected;r.listMgr.selectAll(o),s.selectItems(o);break;case"select-dd":s.createSelectMenu(t.item);break;case"relevance":case"sender":case"subject":case"date":case"date-asc":case"date-desc":case"unRead":case"attachment":case"sort-flagged":s&&(t.currentTarget=t.item,s.viewClickHandler(t));break;case"fullpage-view":case"scroll-view-prev":case"scroll-view-prev-beside":case"scroll-view-noprev":i=new e.mail.ui.MailView,i.switchView(t.dataAction);break;case"tab":e.use("common-ui-navtabs",function(){e.common.ui.NavTabs.setTabs(1)});break;case"recent":e.use("common-ui-navtabs",function(){e.common.ui.NavTabs.setTabs(0)});break;case"themes":e.use("mail-ui-themes",function(e){e.mail.ui.Themes.showThemesDialog()});break;default:r.modules.listview.actionHandler(t,n)}},toggleSearchViewHandler:function(){var e=this,t=!e.get("isSnippet"),n;n=e.listMgr.getCurrentPage(),!NeoConfig.pagedResults&&n.cacheIndex>0&&(n=e.listMgr.getFirstPage()),n.list.length&&(e.set("isSnippet",t),e.modules.listview.close(),e.modules.listview=null,e.renderSearchList(n)),e.updateToolbars()},listMgrItemSelectHandler:function(){var e=this;e.updateToolbars()},updateToolbars:function(){var e=this,t,n,r,i=[e.modules.topToolbar,e.modules.bottomToolbar],s=e.listMgr.getSelectedItems();for(t=0;t<2;++t)n=i[t],n&&(r=n.get("widget"),r&&r.setButtonContext&&r.setButtonContext(s.total))},removeMsgHandler:function(e,t){var n=this,r,i=t?t.length:0,s=n.modules.listview,o={},u,a,f,l=s&&s.get("focusNode"),c=n.get("tabNode"),h=0,p,d;for(r=0;r<i;r++){if(!t[r].flags.isSpam&&n.type==="search")continue;n.listMgr.select(t[r].mid,!1),u=n.listMgr.generateKey(t[r].mid),l&&l.getAttribute("data-key")==u&&(a=n.listMgr.getItemIndex(t[r].mid),f=n.listMgr.getItemFromIndex(a+1)||n.listMgr.getItemFromIndex(a-1)),n.listMgr.getSelectedItems().all===!0?NeoConfig.pagedResults?o=n.listMgr.remove(t[r].mid):n.listMgr.getSelectedItems().index===i-1?o=n.listMgr.remove(t[r].mid,!1):(o=n.listMgr.remove(t[r].mid),s.removeItem(u)):(o=n.listMgr.remove(t[r].mid),s.removeItem(u)),h+=1}o.serverTotal===0?(n.reset(),n.renderAdvancedSearch({})):(NeoConfig.pagedResults?(s.pruneItems(),s.setStatus(strings.str_msg_list_loading),p=n.listMgr.getCurrentPage(),d=!(p.list.length===0&&p.cacheIndex*p.cacheSize<p.serverTotal),n.type==="search"||d?s.appendPageData(p):n.delRequests.push(p)):(h&&s.appendPageData(n.listMgr.getNextPage()),n.listMgr.getSelectedItems().all&&n.listMgr.getSelectedItems().index!==i-1&&s.clearLoadingStatus()),o.serverTotal&&s.updateTitle(o)),f&&(s.setFocusNode(n.listMgr.generateKey(f.mid),!1,!0),n.type==="list"&&NeoConfig.pageMode==0&&(n.listMgr.select(f.mid,!0),n.openInPreviewPane(f)))},addMsgHandler:function(e,t,n){var r=this;n==="encoding"&&r.changeMsgHandler(e,t,t,t,n)},changeMsgHandler:function(n,r,i,s,o){var u=this,f,l=i.length,c=u.modules.listview,h,p,d,v,m=e.mail.model.DataStore.Messages.toMessageInfo;for(f=0;f<l;f++){d=u.listMgr.getItem(i[f].mid),v=m(n,i[f]),d&&v&&(p=t.merge(d,v));if(!p)continue;if(h=s[f].folderInfo)p.folder=a.Folders.get(h.fid).folderInfo.name,p.fid=h.fid;s[f].flags&&(typeof s[f].flags.isRead!="undefined"&&(p.flags.read=s[f].flags.isRead),typeof s[f].flags.isFlagged!="undefined"&&(p.flags.flagged=s[f].flags.isFlagged)),s[f].header&&t.merge(p,m(n,s[f])),u.listMgr.update(i[f].mid,p);switch(o){case"move":case"remove":u.type==="search"&&c.updateItemFolder(u.listMgr.generateKey(i[f].mid),p),c.updateItemClass(i[f].mid,n==="Trash"?"Trash-move":"move");break;case"flag":for(var g in s[f].flags)c.updateItemClass(i[f].mid,g+"-"+s[f].flags[g]);break;case"encoding":c.updateItemSubject(u.listMgr.generateKey(i[f].mid),p)}}},changeConvHandler:function(e){var t=this;e==="move"&&(t.dsConvRefresh=!0)},removeConvHandler:function(){var e=this;e.dsConvRefresh=!0},onSearchStartHandler:function(){var n=this,r=n.get("tabNode"),s;n.loader&&n.loader.removeClass("hidden"),n.searchStopwatch=new i("MailSearch"),r&&(s=r.all("div.content"),s&&s.remove(),r.one("h3.loading")&&r.one("h3.loading").removeClass("hidden")),t.features.enabled("bingads")&&e.fire("global:search:start"),e.fire("util:ymstats",{name:"search_total"})},onSearchCompleteHandler:function(){var n=this,r=n.get("tabNode"),i=n.get("data"),s,o,u=n.get("searchRequestId"),a=n.stopWatchRT||{};n.get("showDDWithSearchResults")||t.features.enabled("bingads")||t.features.enabled("localsearch")?e.fire("darlaEvent",{action:"disableRightRailAdForActiveTab"}):t.features.enabled("removeSearchDisplayAds")?e.fire("darlaEvent",{action:"disableRightRailAdForActiveTab"}):e.fire("darlaEvent",{action:"enableRightRailAdForActiveTab"}),n.loader&&n.loader.addClass("hidden"),r&&r.one("h3.loading")&&r.one("h3.loading").addClass("hidden"),n.searchStopwatch&&n.searchStopwatch.stop&&n.searchStopwatch.stop(),a.action="results",s=e.common.Utils.features.enabled("simple")?{action:"search_refinement",value:n.get("query").adKeyword}:{action:"search_refinement"},i&&i.refinedby&&e.Object.size(i.refinedby)?(n.fire("darlaEvent",s),a.action="refinement"):n.get("query").keyword?n.get("query")&&n.get("query").isContactSearch?n.fire("darlaEvent",{action:"search_people",value:n.get("query").keyword}):n.fire("darlaEvent",{action:"search_results",value:n.get("query").keyword}):n.type==="list"?n.handleDarlaEvent():n.fire("darlaEvent",{action:"search_results"}),NeoConfig.recentSearch&&n.get("query").keyword&&e.mail.ui.searchTab.widget.get("addToRecentSearches")&&e.mail.ui.RecentSearches.addNewSearchItem(n.get("query").keyword),e.fire("search-stat:renderComplete"),e.fire("global:search:complete",{searchRequestId
:u,appliedRefinements:n.appliedRefinements}),this.get("query").isContactSearch||e.fire("simple:onSearchComplete",!1,this.get("query")),t.features.enabled("localsearch")&&e.fire("localsearch:onSearchComplete",{searchId:n.get("searchId")}),i&&!i.total?e.fire("util:ymstats",{name:"search_empty_results"}):i.hits.length&&(o=n.listMgr.getSortInfo(),e.fire("mt:view",{action:"srp_msg_display",append:{mSrchId:n.get("searchId"),mSrchQry:n.get("query").keyword,mSrchTtl:i.total,mYid:NeoConfig.loginId,mSrtTyp:o.sortKey,mSrtOrd:o.sortOrder,mSrchMds:i.hits.slice(0,50).map(function(e){return e.mid})}}))},handleDarlaEvent:function(e){var t=this,n={Inbox:"folderview_inbox","%40C%40Chats":"folderview_chat",Draft:"folderview_draft",Sent:"folderview_sent",Trash:"folderview_trash","%40B%40Bulk":"folderview_bulk"},r,i,s=t.get("data");i=e||!s||!s.total||s.hits&&s.hits.length===0,r=n[t.fid]||"folderview_custom",t.fire("darlaEvent",{action:i?r+"_empty":r})},afterActiveChangeHandler:function(t){var n=this,r=n.modules,i=n.get("query").keyword,s=n.get("data"),o=e.one("#shellnavigation");t.newVal?this.updateSearchQueryDisplay():this.resetSearchQueryDisplay(),e.fire("searchTabActive",t.newVal);if(r)for(var u in r)r[u]&&r[u].set("active",t.newVal);n.type==="search"?t.newVal?(n.dsConvRefresh&&(n.dsConvRefresh=!1,n.sync()),typeof t.prevVal!="undefined"&&(s&&s.refinedby&&e.Object.size(s.refinedby)?n.fire("darlaEvent",{action:"search_refinement"}):i?n.fire("darlaEvent",{action:"search_results",value:i}):n.fire("darlaEvent",{action:"search_results"})),n.timeChunkSettingChanged&&(n.timeChunkSettingChanged=!1,n.listMgr.sort({sortKey:"date",sortOrder:"down"}),n.modules.listview.fire("doMailSearch",{query:n.get("query")}))):o.all(".items").removeClass("hidden"):t.newVal&&n.handleDarlaEvent()},close:function(){var t=this,n=t.evt,r;t.abort(),t.reset(),s.getSearchField().set("value",""),e.one("#shellnavigation").all(".items").removeClass("hidden");for(r in n)e.detach(n[r]);e.mail.ui.searchTab=null}},!0),e.namespace("mail.ui"),e.mail.ui.Search=S},"1.0.0",{requires:["json","mail-ui-basewidget","common-utils","mail-ui-searchutils","mail-ui-search-model","mail-ui-list-mgr","mail-recent-searches","mail-ui-dmsearch-controller","mail-common-utils-features","mail-services-v3","search-ult"]});
