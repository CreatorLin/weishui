YUI.add("xobni-contacts-search-api",function(e){function s(t){try{return e.JSON.parse(t)}catch(n){typeof globals!="undefined"&&globals.report?globals.report("caughterror:..-build-comms-shared-src-xobniContacts-xobni-contacts-search-api:1",n,"TRY_CATCH",1,1,1):window.console&&console.log&&console.log("caughterror:..-build-comms-shared-src-xobniContacts-xobni-contacts-search-api:1"),n}}function o(){return e.common.net.Session.genReqID?e.common.net.Session.genReqID():"NO_YMREQID_LOADED"}function u(){return e.QueryString.stringify({ymreqid:o(),wssid:NeoConfig.wssid})}var t=e.xobniContacts.Utils,n=t.getXobniBaseURL(),r=e.common.Utils.ymmastats,i;e.namespace("xobniContacts").searchAPI={fetch:function(t,u,a){var f=t.timeout||2e3,l="limit"in t?t.limit:5,c,h,p,d;return c=n.url+"/v4/contacts/s?",h={q:t.query,l:t.limit||l,ymreqid:o()},p=e.QueryString.stringify(h),i=(new Date).getTime(),d={on:{success:function(t,n){var o=n.responseText&&n.responseText.length&&s(n.responseText),a=o&&e.Lang.isArray(o.r)?o.r:[];r.stat("xobni_contacts_s_latency","","milliseconds","duration",(new Date).getTime()-i),u&&u(a)},failure:function(e,t){t.statusText!=="abort"&&(t.statusText==="timeout",a&&a())}},timeout:f},n.xdr&&(d.xdr=n.xdr),t.origin?r.stat("search_xobnicontact","type=>searchsuggestion"):r.stat("search_xobnicontact","type=>normal"),e.io(c+p,d)},lookup:function(t,u,a){var f=t.timeout||2e3,l,c,h,p;return l=n.url+"/v4/contacts/lookup?",i=(new Date).getTime(),c={ep:t.ep,ymreqid:o(),wssid:NeoConfig.wssid},h=e.QueryString.stringify(c),p={on:{success:function(e,t){var n=t.responseText&&t.responseText.length&&s(t.responseText);r.stat("xobni_lookup_latency","","milliseconds","duration",(new Date).getTime()-i),u&&u(n)},failure:function(e,t){var n=t.responseText&&t.responseText.length&&s(t.responseText);t.statusText!=="abort"&&a(n)}},timeout:f},n.xdr&&(p.xdr=n.xdr),e.io(l+h,p)},edit:function(t,o,a){var f,l;return f=n.url+"/v4/contacts/edit?"+u()+"&y-dc=hc-"+NeoConfig.buildNumber,i=(new Date).getTime(),l={method:"POST",data:e.JSON.stringify(t.data),headers:{"Content-Type":"text/plain"},on:{success:function(e,t){var n=t.responseText&&t.responseText.length&&s(t.responseText);r.stat("xobni_edit_latency","","milliseconds","duration",(new Date).getTime()-i),o&&o(n)},failure:function(e,t){a(s(t))}}},n.xdr&&(l.xdr=n.xdr),e.io(f,l)},removePhoto:function(t,o,a){var f,l;return f=n.url+"/v4/contacts/removePhoto?"+u()+"&y-dc=hc-"+NeoConfig.buildNumber,i=(new Date).getTime(),l={method:"POST",data:e.JSON.stringify(t.data),headers:{"Content-Type":"text/plain"},on:{success:function(e,t){var n=t.responseText&&t.responseText.length&&s(t.responseText);r.stat("xobni_removePhoto_latency","","milliseconds","duration",(new Date).getTime()-i),o&&o(n)},failure:function(e,t){a(s(t))}}},n.xdr&&(l.xdr=n.xdr),e.io(f,l)},contactsByEp:function(t,o,a){var f,l;return f=n.url+"/v4/contacts/by/ep?"+u()+"&y-dc=hc-"+NeoConfig.buildNumber,i=(new Date).getTime(),l={method:"POST",data:e.JSON.stringify({ep:t.eps,contact_limit:1}),headers:{"Content-Type":"text/plain"},on:{success:function(e,t){var n=t.responseText&&t.responseText.length&&s(t.responseText);r.stat("xobni_contactsByEp_latency","","milliseconds","duration",(new Date).getTime()-i),o&&o(n)},failure:function(e,t){a(s(t))}}},n.xdr&&(l.xdr=n.xdr),e.io(f,l)},workflow:function(t,o,a){var f,l;return f=n.url+"/credentials/workflow?source="+t+"&"+u(),i=(new Date).getTime(),l={method:"POST",on:{success:function(e,t){var n=t.responseText&&t.responseText.length&&s(t.responseText);r.stat("xobni_workflow_latency","","milliseconds","duration",(new Date).getTime()-i),o&&o(n)},failure:function(e,t){a(s(t))}}},n.xdr&&(l.xdr=n.xdr),e.io(f,l)},formatted:function(t,o){var a,f;return a=n.url+"/v4/util/credentials/formatted?"+u(),i=(new Date).getTime(),f={on:{success:function(e,n){var o=n.responseText&&n.responseText.length&&s(n.responseText);r.stat("xobni_formatted_latency","","milliseconds","duration",(new Date).getTime()-i),t&&t(o)},failure:function(e,t){o&&o(s(t))}}},n.xdr&&(f.xdr=n.xdr),e.io(a,f)},photo:function(t,s,o){var u,a;return u=n.url+"/v4/contacts/"+t.id+"/photo?spsize=10X10&u="+t.updated+"&y-dc=hc-"+NeoConfig.buildNumber,i=(new Date).getTime(),a={method:"GET",on:{success:function(e,t){var n=t.getResponseHeader("x-image-source");r.stat("xobni_photo_latency","","milliseconds","duration",(new Date).getTime()-i),s&&s(n)},failure:function(e,t){o&&o()}}},n.xdr&&(a.xdr=n.xdr),e.io(u,a)}}},"1.0.0",{requires:["io-base","querystring-stringify-simple","json","ymma-stats","xobni-utilities","common-net-session"]});
YUI.add("_shared_module_xobni_contact_search_results_rollup",function(A){A.namespace("ui.Templates");A.ui.Templates._shared_module_xobni_contact_search_results_rollup={base:"<div class='xobniPersonResult {{hasname}}' title=\"{{title}}\"> <div class='xobniPersonPic' style='background-image:url({{imageUrl}});' alt='thumbnail'></div> <div class='textHolder'> <span class='ac-value' role='option'> {{nameHighlightChunks}} <em> <div class=\"ac-value-email\"> {{emailHighlightChunks}} </div> <div class=\"ac-value-more\"> {{hasMoreThanOneEmail}} </div> </em> </span> </div></div>",hasname:"has-name",title:"str",highlight:"<b>{{str}}</b>",highlight_else:"{{str}}",nameHighlightChunks:"{{highlight}}{{highlight_else}} ",highlight1:"<b>{{str}}</b>",highlight_else1:"{{str}}",emailHighlightChunks:"({{highlight1}}{{highlight_else1}})</em> ",hasMoreThanOneEmail:"{{str}} "};},"1.0.0");YUI.add("xobni-contacts-search",function(A){var K=A.xobniContacts.searchAPI,B=A.common.Utils,T=B.substitute,D=A.ui.Templates,R,V,M="xobniContactSearch",H="aclist-separator",P="{contactId}",a=0,U=A.common.Utils.ymmastats,N,J=A.xobniContacts.Utils.getXobniBaseURL();function S(){return M;}function c(j){var h=D._shared_module_xobni_contact_search_results_rollup,g=0,Y=j.length,e,d,k=[],f;f={nameHighlightChunks:function(i){var l=[];A.Array.forEach(i.nameHighlightChunks,function(m){m.str=B.escapeHtml(B.unescapeHtml(m.str));if(m.highlight){l.push(T(h.highlight,m));}else{l.push(T(h.highlight_else,m));}});return l.join("");},emailHighlightChunks:function(i){var l=[];A.Array.forEach(i.emailHighlightChunks,function(m){m.str=B.escapeHtml(B.unescapeHtml(m.str));if(m.highlight){l.push(T(h.highlight1,m));}else{l.push(T(h.highlight_else1,m));}});return l.join("");},hasMoreThanOneEmail:function(i){if(i.original&&A.Array.test(i.original.a_e)){var l=i.original.a_e.length;if(l>0){return T(strings.str_xobni_search_suggestion_email_and_more,{num:l});}}return false;},hasname:function(i){return i.name&&i.name.length?h.hasname:"";},title:function(l){var i=[l.email];if(l.original&&A.Array.test(l.original.a_e)){A.Array.each(l.original.a_e,function(m){i.push(m);});}return i.join("&#013;");}};for(g=0;g<Y;++g){e=j[g];d=T(h.base,e,f,null,strings,D);k.push(d);}return k;}function Z(){return H;}function I(Y){if(a++===Number.MAX_VALUE){a=1;}return"xobni-contact-search_"+Y+a;}function L(Y){A.fire("search:input",{query:{keyword:Y,source:"search_uh_suggestion_people"},displayQueryInSearchBar:false,prefilterRefinements:false,showDDWithSearchResults:true,searchRequestId:I(Y),addToRecentSearches:false});}function Q(i,m,g,k,h,d){var f=A.mail.ui.EntitySearch.findExactMatch(g.name),Y=f?f.id:g.id,l=true,j=arguments;if(A.Tictac&&!A.Tictac.contactdetails){l=false;}else{if(!A.Tictac){A.once("tictacs-loaded:ws:postLoad",function(){Q.apply(undefined,j);});return;}}if(l){if(f){A.fire("searchSuggestion:start",{type:"entity",id:f.id,source:"search_uh_entity"});}else{A.fire("searchSuggestion:start",{type:"xContact",contactId:g.id,isFromQuery:true,source:"search_uh_suggestion_people"});}}else{L(Y);}U.stat("searchsuggestions_contact","index=>"+(h+1));d("");}R={getType:S,render:c,activateIfFirstItem:false,getSeparatorClass:Z};V={getType:S,handleSelection:Q};function E(f,d){if(!f){return[];}var e=[],Y=0;A.Array.each(d,function(i){var h=i.s,g=i.l;if(h<Y){e.push({highlight:false,str:f.substring(Y,h-1)});Y=h;}else{if(h>Y){e.push({highlight:false,str:f.substring(Y,h)});Y=h;}}if(h===Y){e.push({highlight:true,str:f.substr(h,g)});Y=h+g;}});if(Y<=f.length-1){e.push({highlight:false,str:f.substr(Y)});}return e;}function F(d,f){var e=d.e||"",Y=d.f,g=(Y&&Y.email)||[];if(f){return E(e,g);}else{return e;}}function W(d,f){var e=d.n||"",Y=d.f,g=(Y&&Y.name)||[];if(f){return E(e,g);}else{return e;}}function C(Y,d){return A.Array.map(Y,function(e){var g=d.contactIdStrToReplace,f=d.imageUrlTmpl.replace(g,e.i),h={},i;if(A.common.net.Session.genReqID){h.ymreqid=A.common.net.Session.genReqID();}else{h.ymreqid="NO_YMREQID_LOADED";}if(!h.ymreqid){h.ymreqid="NO_YMREQID";}i=A.QueryString.stringify(h);if(i){if(f.indexOf("?")===-1){f+="?";}else{f+="&";}f+=i;}return{id:e.i,name:W(e,false),email:F(e,false),nameHighlightChunks:W(e,true),emailHighlightChunks:F(e,true),imageUrl:f,original:e};});}function G(f,d){var e,Y={};if(N&&f.length>0){U.stat("searchsuggestions_xobni_roundtrip","","milliseconds","duration",new Date().getTime()-N);}this._resetPendingIO();this._prevResultsLen=f.length;if(d){e=C(f,{imageUrlTmpl:this._imageUrlTmpl,contactIdStrToReplace:P});Y[M]=e;d(Y);}}function X(d){var Y={};this._resetPendingIO();if(d){Y[M]=[];d(Y);}}function O(Y){if(!Y){Y={};}this._pendingIO=null;this._prevQuery=null;this._prevResultsLen=undefined;this._limit=("limit" in Y)?Y.limit:5;this._timeout=("timeout" in Y)?Y.timeout:5000;this._imageUrlTmpl=J.url+"/v4/contacts/"+P+"/photo?fallback_url="+encodeURIComponent("https://s1.yimg.com/dh/ap/social/profile/profile_a48.png");}O.prototype={fetch:function(d,Y){this._resetPendingIO();if(d&&d.length){if(this._prevResultsLen===0&&this._prevQuery&&this._prevQuery.length&&d.indexOf(this._prevQuery)===0){this._prevQuery=d;G.call(this,[],Y);}else{this._prevQuery=d;this._prevResultsLen=undefined;N=new Date().getTime();this._pendingIO=K.fetch({query:d,limit:this._limit,timeout:this._timeout,origin:"searchSuggestions"},A.rbind(G,this,Y),A.bind(X,this,Y));}}else{this._prevQuery="";G.call(this,[],Y);}return{abort:A.bind(this._resetPendingIO,this)};},_resetPendingIO:function(){if(this._pendingIO&&this._pendingIO.isInProgress()){this._pendingIO.abort();}this._pendingIO=null;}};function b(Y){return new O(Y);}A.namespace("mail.ui").XobniContactsSearch={getDataFetcher:b,getRenderer:function(){return R;},getSelectionHandler:function(){return V;},doPeopleSearch:function(Y,f,e,d){this.doPeopleSearchByType(Y,"message",f,e,d);},doPeopleSearchByType:function(d,Y,i,h,f){var e=this,g;A.xobniContacts.isXobnified(function(k){if(k){e.getDataFetcher().fetch(d,function(m){if(m&&m.xobniContactSearch&&m.xobniContactSearch.length){if(A.mail.ui.EntitySearch&&A.mail.ui.EntitySearch.findExactMatch){g=A.mail.ui.EntitySearch.findExactMatch(m.xobniContactSearch[0].name);}if(g){A.fire("searchSuggestion:start",{type:"entity",id:g.id});}else{A.fire("searchSuggestion:start",{type:"xContact",contactId:m.xobniContactSearch[0].id,viewType:Y,isToQuery:h==="Sent"||h==="Draft",isFromQuery:!(h==="Sent"||h==="Draft"),source:f});}}else{var l=A.contacts.utils.getContactsByEmail(d);if(l&&l[0]&&l[0].id){A.fire("searchSuggestion:start",{type:"abContact",contactId:l[0].id,emailAddress:d,viewType:Y,isToQuery:h==="Sent"||h==="Draft",isFromQuery:!(h==="Sent"||h==="Draft"),source:f});}else{i();}}});}else{var j=A.contacts.utils.getContactsByEmail(d);if(j&&j[0]&&j[0].id){A.fire("searchSuggestion:start",{type:"abContact",contactId:j[0].id,emailAddress:d,isToQuery:h==="Sent"||h==="Draft",isFromQuery:!(h==="Sent"||h==="Draft")});
}else{i();}}});}};},"1.0.0",{requires:["querystring-stringify-simple","common-utils","xobni-contacts-search-api","ac-entity-search","contacts-api-utils","_shared_module_xobni_contact_search_results_rollup","ymma-stats","xobni-utilities","isXobnifiedCheck","common-net-session"]});