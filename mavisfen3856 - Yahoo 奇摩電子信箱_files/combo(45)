YUI.add("comms-utils-stack-tracer",function(A){var I,F,G=A.namespace("comms.utils.StackTracer");G.getStack=function(J){J=J||new Error();if(J.fileName){D(J);}if(J.stack===undefined){B(J);}J.lineNumber=J.lineNumber||J.line;J.fileName=J.fileName||J.sourceURL;F=J.stack;return F;};G.depth=function(){var J=new Error();I=1;G.getStack(J);I=0;return J.depth-1;};function B(O){var L,P,N,K=[],J=[],M=arguments;try{while(!N&&(L=M.caller?M.caller.callee:M.callee.caller)){if(J.length>50){N="*** stack too deep, stopping";}for(P=0;P<K.length;P++){if(L===K[P]){N="*** recursion, stopping";}}M=L.arguments;K.push(L);J.push(N||C(L));}}catch(Q){J.push("*** error going to next level, may be the end of the JS stack");}O.depth=J.length;O.stack=J.join(" >> ");}function D(K){var N,L=0,J=[],M=K.stack.split(/\r\n|\r|\n/);N=M.pop();N&&M.push(N);K.depth=M.length;while((N=M[L++])){J.push((E(N)||"(anonym fn)")+" at "+H(N));}K.stack=J.join(" >> ");}function H(J){return J?J.substr(J.lastIndexOf("/")+1):"";}function E(K){var J=K.indexOf("@");return(J!==-1)?K.substr(0,J):"";}function C(M){var L,J,K;try{J=M.toString();K=J.match(/function\s+([^\s(]+)/);if(K&&K.length>1){L=K[1];}}catch(N){}L=L||"{?}";L=L.replace(/^(\s+)?(.*\S)(\s+)?$/g,"$2");return L;}},"1.0.0");YUI.add("common-utils-error",function(E){var A=E.namespace("common.Utils.error"),D=0,F=1;if(typeof globals==="undefined"){globals={};}globals.report=A.report=function(){var M,U,N,K,Q,P,R=[],I=[],V=0,Z=arguments,G,J=0,O=0,H,S,b={"convpane":"CONVREAD","messagepane":"MESSAGEREAD","search":"SEARCH","convlist":"CONVLIST","messagelist":"MESSAGELIST"},X,T,Y=NeoConfig.browser&&NeoConfig.browser.match(/.*_.*_/),L=E.mail.ui.Recorder;while(V<Z.length){M=Z[V++];if(typeof M==="string"){R.push(M);}else{if(M instanceof Error){U=M;}else{I.push(M);}}}Q=R[1]||"WIN_ERR_LOG";try{I[1]&&(N=E.comms.utils.StackTracer.getStack(U));}catch(W){E.fire("MailLog",{m:"Unable to get stack",ex:W});}K=R[0];P=NeoConfig.farm?NeoConfig.farm.substr(1):"";if(Q==="TRY_CATCH"){S=K.match(/^caughterror:.*?(.{0,60})$/)[1].replace(/[^\w]/gi,"_");E.fire("util:ymstats",{"name":"storm_try_catch","tags":{"agent":Y,"source":S,"mp":!NeoConfig.hasAds}});}else{if(D<1000){E.fire("util:ymstats",{"name":"storm_jsexception","tags":{"agent":Y,"type":Q,"env":NeoConfig.mailEnv,"mp":!NeoConfig.hasAds,"farm":P}});D++;}else{if(D===1000){E.fire("util:ymstats",{"name":"storm_jsexception_overlimit","tags":{"agent":Y,"type":Q,"env":NeoConfig.mailEnv,"mp":!NeoConfig.hasAds,"farm":P}});E.fire("MailLog",{m:"storm_jsexception_overlimit",yid:NeoConfig.loginId},1,"JSException");D++;}}}L&&L.getLastClickSig(true);G=(U?U.name+":"+U.message:"");X={m:"JSExMsg="+K.replace(/ /g,"_"),label:"JSExType="+Q,errorMsg:"JSExErrMsg="+G.replace(/ /g,"_"),failedModules:C()};if(N){X.stack="\n"+N;}if(!I[3]&&NeoConfig.log_error_yapache){E.fire("MailLog",X,1,"JSException");}if(I[2]){T={m:K,label:Q,errorMsg:G,failedModules:C(),stack:N?"\n"+N:""};B(T);}if(E.mail.Tabs&&typeof E.mail.Tabs.getActiveTab==="function"){J=E.mail.Tabs.getActiveTab();O=J?J.widgetType:0;}H=b[O]?b[O]:O;E.fire("stat:js_fail",{"api":Q,"tab":H,"visible":"no"});};function B(H){if(!(NeoConfig.showErrors&&(NeoConfig.isInternal||NeoConfig.isAMT))){return;}var N=document,G=N.createElement("div"),P,M,J,K,I="";for(K in H){I+="["+K+": "+H[K]+"]<br/>";}I=I.split("&");I=I.join("&amp;&#8203;");G.className="error-dlg";G.innerHTML='<div class="error-dlg-hd" id="pinkBoxHdr'+F+'">'+"ERROR "+F+" "+H.m+'<span id="pinkBoxClose'+F+'" class="error-dlg-close">X</span>'+"</div>"+'<div id="pinkBox'+F+'" class="error-dlg-bdy">'+I+"</div>";J=N.getElementById("pinkBoxHolder");if(!J){J=N.createElement("div");J.id="pinkBoxHolder";J.className="collapsed";N.body.appendChild(J);}J.appendChild(G);P=N.getElementById("pinkBoxHdr"+F);M=N.getElementById("pinkBoxClose"+F);function O(){if(M.removeEventListener){M.removeEventListener("click",O,false);}else{if(M.detachEvent){M.detachEvent("onclick",O);}}if(P.removeEventListener){P.removeEventListener("click",L,false);}else{if(P.detachEvent){P.detachEvent("onclick",L);}}J.removeChild(G);G.removeChild(P);P.removeChild(M);G=P=M=null;}function L(){if(J.className.indexOf("collapsed")===-1){J.className="collapsed";}else{J.className="";}}if(M.addEventListener){M.addEventListener("click",O,false);}else{if(M.attachEvent){M.attachEvent("onclick",O);}}if(P.addEventListener){P.addEventListener("click",L,false);}else{if(P.attachEvent){P.attachEvent("onclick",L);}}F++;}function C(){var J,H,G=[];try{H=globals.failures;for(J in H){G.push(J+":"+H[J]);}G.sort();G=G.join(", ");}catch(I){G=I.toString();}return G;}},"1.0.0",{requires:["common-ui-tabs-base","comms-utils-stack-tracer","ymma-stats","mail-ui-recorder"]});