YUI.add("mail-models-draft",function(e){function o(e){return!!r[e]}function u(e){var t={};return e.name&&(t.name="Doe"),e.email&&(t.email="doe@x.com"),t}function a(t,n){switch(t){case"simpleBody":n.html&&(n.html="<html-filtered>"),n.text&&(n.text="<text-filtered>");break;case"to":case"cc":case"bcc":case"from":case"replyTo":e.Lang.isArray(n)&&e.Array.each(n,function(e){n=u(e)})}return n}function f(){this.csid=null,this.mid=null,this.cid=null,this.state="uninitialized",this.captcha=null,this.to=[],this.cc=[],this.bcc=[],this.replyto={name:"",email:""},this.from={name:"",email:""},this.subject="",this.body={html:"",text:""},this.origin={action:null,fid:null,oMsg:null,yqtdPrefix:"",ctxReq:null,forwardAsAttachment:!1,errInfo:null},this.folder={id:""},this.attachments=[],this.inreplyto="",this.references=[],this.spame="U",this.draftModelId=i++,this.publish("stateChanged"),this.isRead=!0}var t=e.common.Utils.verify,n=e.common.Utils.guid,r=e.Array.hash(["uninitialized","saved","unsaved","saving","savingAndSending","sending","captchaing","sent","final"]),i=1,s=e.Array.hash(["Y","N","C","U"]);e.mix(f.prototype,{fireEvent:function(t,n){try{this.fire.apply(this,arguments)}catch(r){e.fire("MailLog",{m:"ComposeV3: Draft: Exception occured while firing event : "+t,exp:r})}},addAttachment:function(e){this.attachments.push(e);if(!e.contentId()){var t="<"+n()+"@yahoo.com"+">";e.setContentId(t)}this.fireEvent("attachmentAdded",e)},removeAttachment:function(e){var t=0,n=this.attachments;for(t=0;t<n.length;t++)if(n[t].contentId()===e){n[t].setState("deleted");break}},isFresh:function(){return!this.origin.oMsg||this.origin.oMsg.sourceFolderInfo.fid!=="Draft"},generateCsid:function(){var e;this.hasCsid()||(e="000000000"+(Math.floor(Math.random()*1e9)+(new Date).getTime()%1e9).toString(),this.csid=e.substr(e.length-10))},hasCsid:function(){return!!this.csid},hasMid:function(){return!!this.mid},isInConv:function(){return e.common.Utils.getVal(this,"origin.oMsg.cid",null)!==null},isRejectedOnCaptcha:function(){return!!e.common.Utils.getVal(this,"captcha.captchaPayload")},isUploadingAttachments:function(){return(this.state==="saving"||this.state==="savingAndSending"||this.state==="unsaved")&&this.attachments.filter(function(e){return e.state()==="uploading"}).length>0},isUploadingInlineImages:function(){return(this.state==="saving"||this.state==="savingAndSending"||this.state==="unsaved")&&this.attachments.filter(function(e){return(e.state()==="uploading"||e.state()==="pending")&&e.isInline()&&e.isImage()}).length>0},hasAttachmentsToReconcile:function(){return this.attachments.filter(function(e){return e.state()==="saved"||e.state()==="uploaded"||e.state()==="pending"&&e.size()!==0}).length>0},_createAttachJson:function(t,n,r){var i=[],s=2;return t=t||{},e.Array.each(n,function(e){var n=e.state(),o=e.size(),u={disposition:e.disposition()},a=n==="saved"||n==="uploaded",f=n==="pending"&&o!==0||r&&n==="uploading";if(a||f)a?(u.messageReference={id:e.mid(),pid:e.partId()},u.contentId=e.contentId()):f&&(e.setPartId("multipart://att"+s),t.iframeUpload&&e.setPartId("multipart://"+t.iframeUpload.multipartName),u.multipartName=e.partId(),u.contentId=e.contentId(),s++),i.push(u)}),i},jsonifyObj:function(t,n){var r=this,i,s=["subject","to","cc","bcc"],o=["folder"],u={actions:{responseMessage:!0,responseMessageV2:!0},message:{csid:r.csid,captcha:r.captchaAnswer,flags:{spam:!1,read:this.isRead},headers:{}},simpleBody:{}};return t=t||{},r.body.html!==""?u.simpleBody.html=r.body.html:u.simpleBody.text=r.body.text,this.attachments.length>0&&(u.simpleBody.attachments=this._createAttachJson(t,this.attachments,n)),r.body.html?u.simpleBody.html=r.body.html:u.simpleBody.text=r.body.text,e.Array.each(o,function(e){u.message[e]=r[e]}),e.Array.each(s,function(e){u.message.headers[e]=r[e]}),i=r.makeInReplyTo(),i?(u.message.inReplyTo=i,u.message.newMessage=!1):u.message.newMessage=!0,r.replyto.email&&(u.message.headers.replyTo=[r.replyto]),u.message.headers.from=[r.from],u},setRead:function(e){this.isRead=e},jsonify:function(t){return e.JSON.stringify(this.jsonifyObj(t),null,4)},getLogInfo:function(t){var n=this.jsonifyObj(t,!0);return n.draftModelId=this.draftModelId,e.JSON.stringify(n,a)},setState:function(n,r){var i={prev:this.state,next:n};t(o(n),"Draft: Illegal model state: "+n);if(i.prev==="final"||i.prev==="sent"&&i.next!=="final")return;i.next!==i.prev&&e.fire("MailLog",{m:"v3 draft state change",info:"modelID: "+this.draftModelId+", next: "+i.next+", prev: "+i.prev}),this.state=n,r&&(i.err=r),this.fireEvent("stateChanged",i)},setSpame:function(e){t(!!s[e],"Draft: Illegal spame code: "+e),this.spame=e},setHeader:function(e){this.to=e.to||[],this.cc=e.cc||[],this.bcc=e.bcc||[],this.from=e.from||{},this.replyto=e.replyto||{},this.subject=e.subject||""},setOrigin:function(e){this.origin=e;var t=this.origin.oMsg,n,r;t&&(n=this.origin.action==="edit",r={from:t.from,subject:t.subject,cc:n?t.cc:this.cc,bcc:n?t.bcc:this.bcc},this.setHeader(r)),this.fireEvent("originChanged")},setBody:function(e,t){var n=this.body.text!==e||this.body.html!==t;n&&this.state==="saved"&&this.setState("unsaved"),this.body.text=e||"",this.body.html=t||""},notifyBodyChanged:function(e){this.fireEvent("bodyChanged",e)},notifyHeaderChanged:function(e){this.fireEvent("headerChanged",e)},isSaved:function(){return this.state==="saved"},isSpame:function(){return this.spame==="N"},makeInReplyTo:function(){var t,n,r=!1;return t=e.common.Utils.getVal(this,"origin.oMsg",null),t&&(this.origin.action==="edit"?(n=e.common.Utils.getVal(t,"inReplyToV3MsgRef",null),n&&n.messageReference&&(r={replied:n.replied?!0:!1,forwarded:n.forwarded?!0:!1,messageReference:{id:n.messageReference.id}})):r={replied:this.origin.action==="reply_sender"||this.origin.action==="reply_all",forwarded:this.origin.action==="forward",messageReference:{id:this.origin.oMsg.mid}}),r&&r.messageReference&&r.replied^r.forwarded?r:undefined}}),e.augment(f,e.EventTarget,!0,null,{prefix:"draft"}),e.namespace("Mail.Models"
).Draft=f},"1.0.0",{requires:["common-utils","event-custom","json","oop"]});
YUI.add("mail-model-attachment",function(D){var C=D.common.Utils.verify,A=D.Array.hash(["saved","pending","uploading","failed","infected","deleted","uploaded"]);var B=function(M,O){var G=O,K=M,F="pending",J=O.partId,E=O.contentId,H=true,I=null,N={prefix:"attachment"},L;if(G&&G.partId){F="saved";}L={getFilename:function(){return G.filename;},isImage:function(){var P=G.filename.match(/[^.]+$/)[0];if(P){P=P.toLowerCase();}return !!B.IMAGE_EXTENSIONS[P];},contentId:function(){return E;},deleted:function(){this.fire("deleted");},disposition:function(){return G.disposition||"attachment";},getDownloadUrl:function(){return G.downloadUrl;},getThumbnailUrl:function(){return G.thumbnailurl;},file:function(){return G.file;},isInline:function(){return G.referencedInline===true||G.disposition==="inline";},inputEl:function(){return G.inputEl;},mid:function(){return K;},size:function(){return G.size||0;},state:function(){return F;},partId:function(){return J;},setContentId:function(P){E=P;},setData:function(P){G=D.clone(P);if(G.partId){this.setPartId(G.partId);}},setMid:function(P){K=P;},setPartId:function(P){J=P;},setProgress:function(P){this.loaded=P;this.fire("progress",this.loaded);},setState:function(Q){var P=!!A[Q];C(P,"Attachment: Illegal model state: "+Q);if(Q!==F){D.fire("MailLog",{"m":"v3 attach state change","info":"contentId: "+(E?E:"none")+", filename: "+(G.filename?G.filename:"none")+", next: "+Q+", prev: "+F});}F=Q;this.fire(F);this.fire("changedState",F);},setSavedInfo:function(P){this._savedInfo=P;},getSavedInfo:function(){return this._savedInfo;}};return D.augment(L,D.EventTarget,H,I,N);};B.IMAGE_EXTENSIONS=D.Array.hash(["jpg","jpeg","gif","png","bmp","tiff","tif","jif","jfif","jp2","jpx","j2k","j2c","pcd"]);D.namespace("mail.Models").Attachment=B;},"1.0.0",{requires:["common-utils","event-custom"]});YUI.add("mail-controller-text-processor",function(D){function A(){}var C=D.common.Utils,B={address:1,blockquote:1,body:1,caption:1,center:1,col:1,colgroup:1,dd:1,dir:1,div:1,dl:1,dt:1,fieldset:1,form:1,h1:1,h2:1,h3:1,h4:1,h5:1,h6:1,li:1,menu:1,ol:1,p:1,pre:1,table:1,tbody:1,td:1,tfoot:1,th:1,thead:1,tr:1,ul:1};D.mix(A.prototype,{convertToPlain:function(H,I,G){var J=H.cloneNode(true),F=D.Node.getDOMNode(J),E=this.convertGuts(F);if(I){E=this._formatPlaintextForDisplay(E,true);}if(G){E=this.clearNonBreakingSpaces(E);}return E;},convertHTMLToPlain:function(G,I){var E=D.Node.create("<div>"+G+"</div>"),H=D.Node.getDOMNode(E),F=this.convertGuts(H);if(I){F=this._formatPlaintextForDisplay(F);}return F;},clearNonBreakingSpaces:function(E){return E.replace(/\xA0/g," ");},convertGuts:function(F){var E=D.UA.ie;if(!E){this._removeIrrelevantTextNodes(F);}else{F.innerHTML=F.innerHTML.replace(/(((<div\s+[^>]*>)|(<div\s*>))&nbsp;<\/div>)/gi,"<BR/>");}return this._richToPlain(F,false,"").replace(/\n[\s\xA0]+$/,"");},_richToPlain:function(H,L,M){var O=D.one(H),J,P;if(O.hasClass("compose-ignore")){return"";}else{if(H.nodeType===1||H.nodeType===11){var G=H.tagName;if(D.UA.ie&&H.tagName==="DIV"&&H.getAttribute("class")&&H.getAttribute("class")!==null&&H.getAttribute("class").indexOf("hr")!==-1){G="HR";}switch(G){case"SCRIPT":case"STYLE":case"LINK":case"OBJECT":case"EMBED":return"";case"HR":P=H.previousSibling;return(this._isLineBreak(P)?"":"\n")+M+"________________________________\n"+M;case"BR":return"\n"+M;case"BLOCKQUOTE":M+=">";default:J=[];var E=H.firstChild;var K=0;while(E!==null){var N=this._richToPlain(E,E.tagName==="PRE",M);if(E.nodeType===1){if(this._getDisplayType(E)==="block"&&J.length>0&&E.tagName!=="TD"){var I=N.match(/^[ \t\r\n\v\f]*$/);if(!I||E.tagName==="LI"){J.push("\n"+M);}}switch(E.tagName){case"LI":K++;J.push("\t"+(E.parentNode.tagName==="OL"?K+".":"*")+" ");break;}}if(N){J.push(N);}if(E.nodeType===1){switch(E.tagName){case"TD":J.push(" ");break;}}E=E.nextSibling;}return J.join("");}}else{if(H.nodeType===3){J=H.nodeValue;if(!L){P=H.previousSibling;var F=P?this._getDisplayType(P):null;J=this._isLineBreak(P)?J:J.replace(/\n[ \t\r\n\v\f]+/g," ");if(P===null||this._isLineBreak(P)){J=J.replace(/^[ \t\r\n\v\f]+/,"");}else{if(F==="block"){J=J.replace(/^[ \t\r\n\v\f]+/,"\n");}else{if(F==="inline"){J=J.replace(/^[ \t\r\n\v\f]+/," ");}}}J=J.replace(/[ \t\r\n\v\f]+$/," ");}return J;}else{return"";}}}},_isLineBreak:function(E){if(E===null||E.nodeType!==1){return false;}return E.tagName==="BR";},_getDisplayType:function(E){if(E===null||E.nodeType!==1){return null;}if(E.style.display){if(E.style.display==="block"){return"block";}else{if(E.style.display==="inline"){return"inline";}}}return B[E.tagName.toLowerCase()]?"block":"inline";},_removeIrrelevantTextNodes:function(H){if(H.nodeType===1||H.nodeType===11){var F=H.firstChild;while(F!==null){var J=F.nextSibling;this._removeIrrelevantTextNodes(F);F=J;}}else{if(H.nodeType===3){var G=H.nodeValue;if(G.match(/^[ \t\r\n\v\f]*$/)){var E=H.previousSibling;var I=E?this._getDisplayType(E):"inline";if(I==="inline"&&!this._isLineBreak(E)){H.nodeValue=H.nodeValue.replace(/\n.*/," ");}else{H.parentNode.removeChild(H);}}}}},_formatPlaintextForDisplay:function(F,E){F=C.escapeHtml(F);if(E){F=F.replace(/\t/g,"&nbsp;&nbsp;&nbsp;&nbsp;");F=F.replace(/( ){2}/g,"&nbsp;&nbsp;");}F=F.replace(/\n/ig,"<br />");return F;},_removeControlCharacters:function(F){var G=F,E=/[\x01-\x08\x0B-\x0C\x0E-\x1F\x7F-\x84\x86-\x9F]/ig;G=G.replace(E,"");return G;},process:function(E){var F=this.convertToPlain(E,false,true);F=this._removeControlCharacters(F);return F;}});D.namespace("mail.Controller").TextProcessor=new A();},"1.0.0",{requires:["common-utils","node"]});YUI.add("mail-models-serializers-draft-gdm-unserializer",function(e){var t=function(e,t,n){for(var r in n){var i=n[r];if(t.hasOwnProperty(i.contentId)){var s=t[i.contentId];s.setMid(e.mid),s.setData(n[r]),s.setProgress(1),s.setState("uploaded")}}},n=function(e,t){var n,r=t.length,i;for(n=0;n<r;n++){var s=t[n];e.hasOwnProperty(s.contentId)&&(i=e[s.contentId],i.setSavedInfo(s))}},r=function(e){e.attachments.filter(function(e){e.state()==="uploaded"&&e.setState("saved")})},i=function(e,t){e.mid=t.mid,e.cid=t.cid},s=function(){};e.mix(s.prototype,{update:function(s,o,u){var a=u.result.messageV2,f=u.result.simpleBody.attachments||[];i(s,a),o&&e.Object.size(o)>0?(n(o,f),t(s,o,a.part.slice(1))):r(s)},addAttachments:function(t,n,r){if(n.attachments){var i,s,o=!0;for(s=0;s<n.attachments.length;s++)o=r?r(n.attachments[s]):!0,o&&(i=new e.mail.Models.Attachment(n.mid,n.attachments[s]),t.addAttachment(i))}},addNonInlineAttachments:function(e,t){this.addAttachments(e,t,function(e){return e.referencedInline!==!0&&e.disposition!=="inline"})},hasNonInlineAttachments:function(e){var t,n;if(e.attachments)for(t=0;t<e.attachments.length;t++){n=e.attachments[t];if(n.referencedInline!==!0&&n.disposition!=="inline")return!0}return!1},addIds:function(e,t){i(e,t),e.csid=t.csid,e.csid||(e.draftToDelete=t.mid)}}),e.namespace("Mail.Models.Serializers").DraftGdmUnserializer=s},"1.0.0",{requires:["mail-model-attachment"]});
YUI.add("mail-controller-signature-processor",function(D){var A=D.common.persist.UserData,B=D.common.Utils;function C(){}D.mix(C.prototype,{insertSignature:function(E,F){var I=this,H,G=I.getSignature(A.get("userSendPref.defaultID"));if(G){H=this.injectSignature(E.body.html,F,G);if(H){E.setBody(null,H);}}},getSignature:function(I){var J=A.get("userSendPref"),F,E,H;if(strings.str_cfg_tog_use_accountbased_signature&&I&&I!==J.defaultFromAddress){E=A.get("aliases.alias");for(var G=0;G<E.length;++G){H=E[G];if(I===H.address){F={text:H.signature,isRich:H.signatureType==="d",isActive:H.addSignature};break;}}}else{F={text:J.signatureText,isRich:J.richTextSignature==="plainhtml"||J.richTextSignature==="dhtml",isActive:J.signatureActive};}return F&&F.isActive&&F.text?F:null;},injectSignature:function(J,G,K){var H=this,F,E,M=K&&K.isRich,L=K&&K.text;if(!L){return"";}L=H._getSignatureText(L,M);L="<div class='signature'>"+L+"</div>";if(!M){L=H._cleanAndEscapeSignature(L);}else{if(!G||G==="plain"){try{E="<br>";L=L.replace(/((<br\s+[^>]*>)|(<br\s*>))((<br\s+[^>]*>)|(<br\s*>))((<br\s+[^>]*>)|(<br\s*>))/gi,E);L=L.replace(/((<br\s+[^>]*>)|(<br\s*>))((<br\s+[^>]*>)|(<br\s*>))/gi,E);L=L.replace(/((<p\s+[^>]*>)|(<p\s*>)&nbsp;<\/p>)/gi,E);L=L.replace(/(((<div\s+[^>]*>)|(<div\s*>))&nbsp;<\/div>)/gi,E);L=L.replace(/(<br\s+[^>]*>)|(<br\s*>)/gi,E);L=L.replace(/(<br\/\s+[^>]*>)|(<br\/\s*>)/gi,E);L=L.replace(/(<p\s+[^>]*>)|(<p\s*>)/gi,"");L=L.replace(/<\/p>/gi,E);L=L.replace(/(<hr\s*>)/gi,E+"________________________________"+E);L=D.mail.Controller.TextProcessor.convertHTMLToPlain(L,true);}catch(I){}}}J=J||"";F=J!=="";if(L!==""){if(D.UA.ie||D.UA.webkit){if(F){J=J+"<div></div><div>&nbsp;</div>"+L;}else{J="<div></div><div>&nbsp;</div>"+L+J;}}else{if(F){J=J+"<div>&nbsp;</div>"+L;}else{J="<div>&nbsp;</div>"+L+J;}}}return J;},_getSignatureText:function(F,E){if(F!==null){if(!E){F=F.replace(/<vbr>|\n/gi,"<br />");return"<div>"+F+"</div>";}else{F=F.replace(/<vbr>/gi,"");}}return F||"";},_cleanAndEscapeSignature:function(G){var F,E;G=B.unescapeHtml(G);G=G.replace(/<hr\s*[^>]*>/gi,"<div><hr></div>");G=G.replace(/((<br\s+[^>]*>)|(<br\s*>))((<br\s+[^>]*>)|(<br\s*>))((<br\s+[^>]*>)|(<br\s*>))/gi,"endptagpblanklineppblanklinepstartptag");G=G.replace(/((<br\s+[^>]*>)|(<br\s*>))((<br\s+[^>]*>)|(<br\s*>))/gi,"endptagpblanklinepstartptag");G=G.replace(/((<p\s+[^>]*>)|(<p\s*>)&nbsp;<\/p>)/gi,"endptagpblanklinepstartptag");G=G.replace(/(((<div\s+[^>]*>)|(<div\s*>))&nbsp;<\/div>)/gi,"endptagpblanklinepstartptag");G=G.replace(/(<br\s+[^>]*>)|(<br\s*>)/gi,"brtag");G=G.replace(/(<br\/\s+[^>]*>)|(<br\/\s*>)/gi,"brtag");G=G.replace(/(<p\s+[^>]*>)|(<p\s*>)/gi,"startptag");G=G.replace(/(<p\s+[^>]*>)|(<p\s*>)/gi,"startptag");G=G.replace(/<\/p>/gi,"endptag");F=G.replace(/<div\s+[^>]*dir\s*=\s*[\'|\"]ltr[\'|\"]\s*[^>]*>/gi,"ltrstartptag");F=F.replace(/<div\s+[^>]*dir\s*=\s*[\'|\"]rtl[\'|\"]\s*[^>]*>/gi,"rtlstartptag");F=F.replace(/(<div\s+[^>]*>)|(<div\s*>)/gi,"startptag");G=F.replace(/<\/div>/gi,"endptag");E=B.escapeHtml(G);E=E.replace(/brtag/g,"<br />");E=E.replace(/ltrstartptag/g,"<div dir='ltr'>");E=E.replace(/rtlstartptag/g,"<div dir='rtl'>");E=E.replace(/startptag/g,"<div>");E=E.replace(/endptag/g,"</div>");E=E.replace(/pblanklinep/g,"<br/><br/>");return E;}});D.namespace("mail.Controller").SignatureProcessor=new C();},"1.0.0",{requires:["mail-controller-text-processor","common-persist-user-data","common-utils"]});YUI.add("mail-ui-mailcompose-header-form-list-helper",function(e){function s(){var e=new i,t,n,s=r?r.getAccount():null;return e.init(),t=e.getFromList(),n=e.getSelectedIndex(),s&&s!==r.getPrimaryAccount()?{name:s.description,email:s.email}:{name:t[n].name,email:t[n].addr}}function o(e,t){return!t&&e.header.replyto&&e.header.replyto.length>0?e.header.replyto[0]:e.header.from}function u(e){var n,r={email:t.get("userSendPref.defaultFromAddress"),name:t.get("userSendPref.defaultFromName")};return e.fid==="Sent"?o(e.oMsg):(n=a(e.oMsg.header.to,r),n||(n=a(e.oMsg.header.cc,r)),n||(n=a(e.oMsg.header.bcc,r)),n||(n=s()),n)}function a(n,r){var i,s=null,o={},u=(t.get("externalAccounts")||{}).extAccount||[],a=(t.get("aliases")||{}).alias||[],f=(t.get("disposableAddresses")||{}).deaName||[],l=function(e){if(e&&e.address&&e.address===o.email)return s={email:e.address,name:e.fromName},!0};for(i=0;!s&&i<n.length;i++){o=n[i];if(o.email===r.email)return r;e.Array.some([].concat(u,a,f),l)}return s}function f(){var e={},n=(t.get("externalAccounts")||{}).extAccount||[],r=(t.get("aliases")||{}).alias||[],i=(t.get("disposableAddresses")||{}).deaName||[],s=n.concat(r,i),o=t.get("userSendPref"),u,a,f=s.length;o.defaultID&&(e[o.defaultID]=1),o.defaultFromAddress&&(e[o.defaultFromAddress]=1);for(a=0;a<f;a++)if(u=s[a].address)e[u]=1;return e}function l(){var e=(t.get("externalAccounts")||{}).extAccount||[],n=(t.get("aliases")||{}).alias||[],r=(t.get("disposableAddresses")||{}).deaName||[];return[].concat(e,n,r)}function c(n){var r=n,i=t.get("userSendPref.defaultFromAddress");return i===n?r=t.get("userSendPref.defaultReplyToAddress")||i:e.Array.some(l(),function(e){var t=e&&e.address&&e.address;return t===n?(r=e.replyTo||e.address,!0):!1}),r=e.Lang.trim(r),e.comms.Utils.isValidEmail(r)?r:n}var t=e.common.persist.UserData,n=NeoConfig.accounts,r=e.mail.model.DataStore.Accounts,i=function(){this._init=!1,this._fromAddrList=[],this._selectedItemIndex=0,this._visible=!1};i.prototype={_buildAddresListItem:function(e,n){var r=t.get("userSendPref")&&t.get("userSendPref").defaultFromName||"";return{addr:e.address||e.email,name:e.fromName||r,source:n,isRTL:e.fromNameDir==="rtl",isDefault:!!e.isDefault}},_verifyInit:function(){if(!this._init)throw"FromOptionList is not initialized."},_populateAddressList:function(){var r,i,s,o=[],u,a,f=(t.get("externalAccounts")||{}).extAccount||[],l=(t.get("disposableAddresses")||{}).deaName||[],c=(t.get("aliases")||{}).alias||[],h=n.imapInAccounts?n.imapInAccounts:[],p=t.get("userSendPref"),d=[{list:h,length:h.length,type:"imapIn",allowedAsFrom:function(e){return e.status==="ENABLED"}},{list:f,length:f.length,type:"externalAccounts",allowedAsFrom:function(e){return!!e&&!!e.mailFromAllowed}},{list:l,length:l.length,type:"disposableAddresses",allowedAsFrom:function(e){return!(!e||!!strings.tog_check_active_compos&&!e.activeComposition)}},{list:c,length:c.length,type:"aliases",allowedAsFrom:function(e){return!!e}}];for(i=0;i<d.length;i++){a=d[i];for(r=0;r<a.length;r++)s=a.list[r],a.allowedAsFrom(s)&&(u=this._buildAddresListItem(s,a.type),e.comms.Utils.isValidEmail(u.addr)&&o.push(u))}p&&(u=this._buildAddresListItem({address:p.defaultFromAddress,fromName:p.defaultFromName,isDefault:!0},"default"),e.comms.Utils.isValidEmail(u.addr)&&o.push(u)),this._fromAddrList=o},_sortAddressList:function(){this._fromAddrList=this._fromAddrList.sort(function(e,t){var n=e.name+e.addr,r=t.name+t.addr;return n<r?-1:n>r?1:0})},changeSelection:function(e){var t=0;for(t=0;t<this._fromAddrList.length;t++)if(this._fromAddrList[t].addr===e)return this._selectedItemIndex=t,!0;return!1},getSelectedIndex:function(){return this._verifyInit(),this._selectedItemIndex},getFromList:function(){return this._verifyInit(),e.clone(this._fromAddrList)},getVisible:function(){return this._verifyInit(),this._visible},init:function(){var e=t.get("userSendPref");this._populateAddressList(),this._sortAddressList(),this._fromAddrList.length>(e?1:0)&&(this._visible=!0),this.changeSelection(e.defaultID||e.defaultFromAddress),this._init=!0}},e.namespace("mail.Controller").mailComposeFromListHelper={FromOptionList:i,getReplyFromAddress:u,getDefaultFromAddress:s,getAllAccountEmails:f,getReplyTo:c}},"1.0.0",{requires:["comms-utils","common-persist-user-data","mail-persist-meta-data"]});
YUI.add("mail-controller-reply-processor",function(e){function x(){return strings.str_cfg_tog_compose_autoattach_prefix||T(m)==="yes"}function T(e){return d.get("cg.pref."+e)}function N(e,t){var n=i.getVal(e,"origin.action"),r=i.getVal(e,"origin.parentMsg"),s=i.getVal(e,"origin.parentMsg.fid"),o,u,a;return n!=="edit"&&!t.fetchGDM?Promise.resolve(e.origin.oMsg):t.fetchGDM?(o={fid:s||"Inbox",msg:r||e,cachekey:"Prime"},a=this.requestMessage(r,o),a.then(function(t){return t},function(t){return t}),a):(u=i.getVal(e,"origin.parentMsg.part"),u&&u.length>0?Promise.resolve(e.origin.parentMsg):Promise.resolve())}function C(n,r){var i,s,o=t&&t.Controller?t.Controller.Messages:{},u=n?n.mid||0:0;if(u&&r.fid)return s=new Promise(function(t,n){function s(e){t(e)}function u(e){n(e)}var i={success:s,failure:u,suppressCodes:"[*]"};r.fid&&r.msg?o.get(r,i):e.fire("MailLog",{m:"GDM failed in attach in reply",fid:r.fid,msg:r.msg},1,"attachInReplyFailure")}),s}function k(e){var t=0,n=e.attachments;for(t=0;t<n.length;t++)n[t].setState("deleted")}function L(t,n){var r=this,s=t.origin.action,o,u,a=i.getVal(t,"origin.parentMsg.flags.hasAttachment");return a&&(o=new e.Mail.Models.Serializers.DraftGdmUnserializer,u=r.getParentMsg(t,n),u.then(function(n){o.addNonInlineAttachments(t,n)},function(t){})),u}function A(e,t){var n=e.to.concat(e.cc),r,s,o=t.to.concat(t.cc),u={};for(r=0;r<o.length;r++){var a=i.getVal(o[r],"email");u[a]||(u[a]=1)}for(s=0;s<n.length;s++){var f=i.getVal(n[s],"email");if(!u[f])return{hasNewRecipients:!0}}return{hasNewRecipients:!1}}function O(e){var t=v+e.replace(/\r?\n|(.{0,80})\r?\n|(.{1,80})$|(.{1,80} +)/mg,"$1$2$3<br />"+v);return t=t.replace(/(^[\>|(?:&gt;)]+|\<br \/\>(?:\>|\&gt\;)*)/mgi,"$1 "),t.substring(0,t.length-v.length)}function M(t,n){var r,i=document.createElement("div");return i.innerHTML=t,r=e.mail.Controller.Compose.convertGuts(i),n||(r=s(r)),i.innerHTML="",i=null,r}function _(e){var t=e.oMsg.part;if(t)for(var n=0;n<t.length;n++)if(t[n].subtype==="html")return!0;return!1}function D(e){return e&&(e=e.replace(y,"$1"),e=e.replace(b,"$1"),e=e.replace(w,"")),e}function P(e){var t,n;return e?{fontFamily:t=B(!0),fontSize:n=j(!0)}:H()}function H(){var e,t;return t=p.get("userUIPref.composeFontFamily"),t=t.split("|"),t.length>1?t=t[0]:(t=B(!1),p.set("userUIPref.composeFontFamily",t+"|1")),t||(t=B(!1),p.set("userUIPref.composeFontFamily",t+"|1")),e=p.get("userUIPref.composeFontSize"),e?e+="px":e=j(!1),{fontFamily:t,fontSize:e}}function B(e){return e?F()[0]:strings.str_rte_default_font}function j(e){if(e){var t=F();return""+parseInt(t[1],10)+t[2]}return parseInt(strings.str_rte_default_font_size,10)+"px"}function F(){return e.mail.ui.common.Fonts.getPlainTextOption()||[strings.str_comp_plaintext_default_font,strings.str_comp_plaintext_default_font_size,"px"]}function I(e,t){var n=0,r=t.length,i=new Array(r);while(r--)i[n]=e(t[n++]);return i}function q(e){return e.name?e.name:e.email}function R(e){var t="";return e.name&&(t=U(e.name)?'"'+e.name+'"':e.name),e.email&&(t+=t.length?" <"+e.email+">":e.email),t}function U(e){return e.match(/[;,"<>@]/)!==null}function z(e,t){return!t&&e.header.replyto&&e.header.replyto.length>0?e.header.replyto[0]:e.header.from}function W(e,t,n){return e=X(e,n),I(t?R:q,e).join("; ")}function X(e,t){return V(e,t)}function V(e,t){var n,r,i,s=[],o;for(n=0;n<e.length;n++){o=!1;if(!e[n].email)continue;i=e[n].email.toLowerCase();if(t)for(r=0;r<t.length;r++)if(i===t[r].email.toLowerCase()){o=!0;break}o||(s.push({name:e[n].name,email:e[n].email}),t&&t.push(e[n]))}return s}function $(){return new RegExp("(^re:\\s?)|(^fw:\\s?)|(^"+strings.str_comp_reply_spRE+"\\s?)|"+"(^"+strings.str_comp_reply_spFWD+"\\s?)","i")}function J(){}var t=e.mail,n=e.mail.Controller.Messages,r=e.common,i=r.Utils,s=i.escapeHtml,o=i.unescapeHtml,u=i.substitute,a=t.Controller.mailComposeFromListHelper,f=a.getReplyFromAddress,l=a.getDefaultFromAddress,c=e.ui.Templates,h=c._shared_module_compose_reply,p=r.persist.UserData,d=t.persist.MetaData,v=">",m="general.prefixreplyquotetype",g=null,y=new RegExp(/<a[^>]*href="([^\s]*?)"[^>]*>[\s]*<span[^>]*id="?lw_\d*?_\d*?"?[^>]*>http(([\s]|[^\s])*?)<\/span>[\s]*<\/a>/ig),b=new RegExp(/<span[^>]*id="?lw_\d*?_\d*?"?[^>]*>(([\s]|[^\s])*?)<\/span>/ig),w=new RegExp(/<script[^>]*[^>]*>(([\s]|[^\s])*?)<\/script>/ig),E={subject_prefix:function(e){return strings[e.action==="forward"?"str_comp_reply_spFWD":"str_comp_reply_spRE"]},subject_data:function(e){return g||(g=$()),e.oMsg.header.subject.replace(g,"")}},S={quotetext_header:function(){return x()?h.qthdr:""},quotetext_footer:function(){return x()?h.qtftr:""},fontfamily:function(){return H().fontFamily},fontsize:function(){return H().fontSize},deffontfamily:function(){return B(!1)},deffontsize:function(){return j(!1)},from_data:function(e){return s(o(R(z(e.oMsg,!0))))},to_data:function(e){return s(o(W(e.oMsg.header.to,!0)))},cchdr:function(e){return e.oMsg.header.cc.length>0?u(h.cchdr,e,S,null,strings):""},cc_data:function(e){return s(o(W(e.oMsg.header.cc,!0)))},date_data:function(e){return s(i.dateFormatter(new Date(e.oMsg.header.receivedDate*1e3),strings.str_tog_dateformat_header_l10n))},subject_data:function(e){return s(o(e.oMsg.header.subject))},reply_rich_body:function(e){return D(e.oMsg.body.display)},forward_rich_body:function(e){return e.action==="forward"?h.forward_rich_body:!1},reply_rich_header:function(e){var t=NeoConfig.hasConv?"":h.rulerHeader,n=e.action==="forward"?h.fwdhdr:t;return u(n,null,null,null,strings)},reply_plain_body:function(e){var t=D(e.oMsg.body.display);if(x()){try{t=M(t)}catch(n){}t=O(t)}return t},reply_plain_header:function(e){return strings[e.action==="forward"?"str_comp_reply_fwdHeader":"str_comp_reply_origHeader"]},quoteprefix:function(){return x()?v+" ":""},headerDir:function(){return NeoConfig.isRTL?' dir="rtl" ':' dir="ltr" '}};e.mix(J.prototype,{fetchOrigin:function(t,r,i,s,o){var u=this,a=t.origin;if(a.action&&a.fid&&a.oMsg){a.ctxReq&&e.mail.Controller.Messages&&n.abort(a.ctxReq);
var f,l={truncateAt:null},c={success:function(e,t){u._fetchSuccess(e,t),o&&o()},failure:function(e,t){u._fetchFailure(e,t)},draft:t,isDraft:r,isRichText:i,stopwatch:s};f={fid:a.fid,msg:a.oMsg,cachekey:"Prime",ovparams:l},s&&!s.CMGStart&&(s.CMGStart=new Date),e.use("mail-controller-messages",function(){e.mail.Controller.Messages.get(f,c)})}},_fetchSuccess:function(e,t){var n=this,r=t.draft,i=r.origin,s=t.stopwatch,o={};e.mid?(s&&(s.CMGEnd||(s.CMGEnd=new Date,t.respProps&&(s.wasCached=t.respProps.wasCached)),s.CMGSize=e.body.display.length),i.oMsg=n.validateMsg(e),i.ctxReq=null,i.errInfo="ok",i.yqtdPrefix=e.yivPrefixNumber,r.setOrigin(i),n._updateFromOrigin(i,r,t.isDraft,t.isRichText,o)):n._fetchFailure({msg:this.message},t)},validateMsg:function(t){var n,r;if(t&&t.header&&t.header.replyto&&t.header.replyto.length>0){r=t.header.replyto;for(n=r.length-1;n>=0;n--)!e.comms.Utils.isValidEmail(r[n].email)&&r.splice(n,1)}return t},_fetchFailure:function(e,t){var n=t.draft,r=n.origin;r.errInfo=e,n.setOrigin(r)},_updateFromOrigin:function(t,n,r,i,s){var o=this,u,a;o._markAsRead(n),u=o._transformOrigin(t,n,r,i);if(!r){var l=f(t),c=e.mail.Controller.SignatureProcessor.getSignature(l.email),h,p=!0;s&&s.noSig&&(p=!1),c&&p&&(h=e.mail.Controller.SignatureProcessor.injectSignature(null,u.isRichText,c),u.prolog=strings.str_cfg_tog_insert_signature_bottom?u.prolog+h:h+u.prolog)}n.setOrigin(t),a=new e.Mail.Models.Serializers.DraftGdmUnserializer,r&&a.addIds(n,t.oMsg),t.action==="forward"||t.action==="edit"?a.addAttachments(n,t.oMsg):a.addAttachments(n,t.oMsg,function(e){return e.referencedInline===!0||e.disposition==="inline"}),n.cc&&n.cc.length>0&&(u.header.cc||(u.header.cc=[]),u.header.cc=u.header.cc.concat(n.cc)),n.bcc&&n.bcc.length>0&&(u.header.bcc||(u.header.bcc=[]),u.header.bcc=u.header.bcc.concat(n.bcc)),o.updateDraft(n,u)},updateDraft:function(e,t){e.setHeader(t.header),e.setBody(null,t.prolog),e.notifyHeaderChanged({reply:!0}),e.notifyBodyChanged({reply:!0,isRichText:t.isRichText})},_markAsRead:function(t){e.use("mail-controller-messages-ops",function(){var n=t.origin,r={},i=new Array(n.oMsg);r.read=1,e.mail.Controller.Messages.flag({fid:n.fid,mid:i,setFlags:r},{failure:function(){},suppressCodes:["Client.MessageIdsNotFound"]})})},_transformOrigin:function(e,t,n,r){var i=this,s,o=e,u={prolog:null,header:null,attachments:null,isRichText:r};return n?(u.header=o.oMsg.header,u.prolog=D(o.oMsg.body.display),u):(u.header=i.getHeaderContent(o),s=i.getBody(t,o,r),u.prolog=s.markup,u.isRichText=s.isRichText,u)},getBody:function(e,t,n){var r=_(t),i;return NeoConfig.hasConv?i=u(n||r?h.reply_rich_short:h.reply_plain_short,t,S,e,strings):i=u(n||r?h.reply_rich:h.reply_plain,t,S,e,strings),!n&&r&&(n=!0),{markup:i,isRichText:n}},getHeaderContent:function(t){var n=this,r,i=t.action==="reply_sender"||t.action==="reply_all",s={from:null,to:null,cc:null,subject:null},u=[],a=[],c=t.fid==="Sent"||t.fid==="%40S%40Search"&&t.oMsg.sourceFolderInfo.fid==="Sent";return s.from=i?f(t):l(),i&&(r=z(t.oMsg),!c&&t.action==="reply_sender"?(a.push(r),s.to=a):(c||a.push(r),u.push(r),u.push(s.from),s.to=a.concat(X(t.oMsg.header.to,u)),s.cc=X(t.oMsg.header.cc,u),c&&s.to.length===0&&s.cc.length===0&&(s.to=t.oMsg.header.to,s.to.length===0&&(s.cc=t.oMsg.header.cc)))),s.subject=o(n.seedSubject(t)),c||e.Array.each(t.oMsg.header.replyto||[],function(t){var n=s.to;n&&e.Array.indexOf(n,t)<0&&e.Array.indexOf(a,t)<0&&s.to.push(t)}),s},seedSubject:function(e){var t=e.action==="reply_sender"||e.action==="reply_all"||e.action==="forward";return t?(e.oMsg.header.subject===strings["str_msg-view_no_subject"]&&(e.oMsg.header.subject=""),u(h.subject.replace(/\s+$/,""),e,E,null,strings)):e.oMsg.header.subject}}),e.mix(J.prototype,{getDefaultFromAddress:l,htmlToText:M,getStyleFontFamily:B,getStyleFontSize:j,getDefaultFontInfo:P,matchRecipients:A,getParentMsg:N,requestMessage:C,includeAttachment:L,excludeAttachment:k}),e.namespace("mail.Controller").ReplyProcessor=new J},"1.0.0",{requires:["mail-models-draft","comms-utils","mail-model-attachment","mail-controller-messages","mail-controller-text-processor","common-persist-user-data","mail-persist-meta-data","mail-models-serializers-draft-gdm-unserializer","mail-ui-common-fonts","_shared_module_compose_reply","mail-controller-signature-processor","mail-ui-mailcompose-header-form-list-helper"]});
YUI.add("mail-models-validators-send",function(A){A.namespace("mail.Models.Validators").send={MAX_NUM_OF_RECIPIENTS:100,YNC_ADDR_WHITELIST:["sgproxy_test_10@localhost","sgproxy_test_20@localhost","sgproxy_test_40@localhost","sgproxy_test_50@localhost"],validateAddress:function(C){var E=Array.prototype.concat(C.to,C.cc,C.bcc),F=E.length,D,B={valid:true};for(D=0;D<F;D++){if(!A.comms.Utils.isValidEmail(E[D].email)){if(this.YNC_ADDR_WHITELIST.indexOf(E[D].email)!==-1){continue;}B.valid=false;B.invalidAddress=E[D].email;return B;}}return B;},validatePresenceOfRecipients:function(C){var B={valid:true};if(C.to.length<1&&C.cc.length<1&&C.bcc.length<1){B.valid=false;}return B;},validateNotUploadingAttachments:function(B){return({valid:!B.isUploadingAttachments()});},validateCleanAttachments:function(B){var C=0;var D=0;A.each(B.attachments,function(E){if(E.state()==="infected"){C++;}else{if(E.state()==="failed"){D++;}}});return{valid:(C+D===0),cntInfected:C,cntFailed:D};},validatePresenceOfContent:function(C){var D=A.Lang.trim(C.subject),B={valid:true};if(D.length<1){B.valid=false;}return B;},validateNumberOfRecipients:function(D){var B={valid:true},C=D.to.length+D.cc.length+D.bcc.length;if(C>this.MAX_NUM_OF_RECIPIENTS){B.valid=false;}return B;},validateSpame:function(C){var B={valid:true};if(C.isSpame()){B.valid=false;}return B;},validateCaptcha:function(C){var B={valid:true};if(C.isRejectedOnCaptcha()&&!C.captchaAnswer){B.valid=false;}return B;},checkForAttachment:function(C){var B={valid:true},E=A.common.Utils.getVal(C,"origin.action"),D;if(E==="edit"&&A.common.Utils.getVal(C,"attachments").length===0){D=C.makeInReplyTo();if(A.common.Utils.getVal(D,"replied")){E="reply_sender";}}if(A.common.Utils.getVal(C,"origin.parentMsg.flags.hasAttachment")&&(E==="reply_all"||E==="reply_sender")){B.valid=false;}return B;}};},"1.0.0",{requires:["comms-utils","common-utils"]});YUI.add("mail-ui-mailcompose-base-header-v3",function(e){function B(e){var t=this;t.composeView.attView&&t.composeView.attView.reposAttachObj(e)}function j(){e.ACWidgetInst&&e.ACWidgetInst.hide()}function F(e){e.removeAttribute("aria-owns"),e.removeAttribute("aria-activedescendant")}function I(e){e.removeAttribute("aria-describedby")}function q(){var t=e.ACWidgetInst;t.get("ac").get("host").set("aria-owns",t.get("contentBox").generateID())}function R(e){var t=e.ancestor("ul"),n=t.all(".lozenge-static"),r;n.size()>0&&(r=[],n.each(function(e){r.push(e.generateID())})),r?e.set("aria-describedby",r.join(" ")):e.removeAttribute("aria-describedby")}function U(e){var t;t=e.get("value").replace(/([^,; ]+?@[^ ,;]+?\.[a-z]+?>?)[ ;]+([^ ,;])/ig,"$1, $2"),e.set("value",t)}function z(e,t){var n=e.get("value"),r=n.length,i=parseInt(e.ancestor(".ac-input").getStyle("width"),10)-40,s=150,o=17,u=this;t&&(n?(U(e),u._lozengeIt(e)):setTimeout(function(){U(e),u._lozengeIt(e)},500)),r>o?(s+=(r-o)*10,s>i&&(s=i),e.setStyle("width",s+"px")):e.setStyle("width","")}function W(t){var r=!1,i=null,s=null,o=/(<[^<>]+@[^<>]+\.[^<>]+>)|(\([^\(\)]+@[^\(\)]+\.[^\(\)]+\))|(\[[^\[\]]+@[^\[\]]+\.[^\[\]]+\])/,u,a=t.replace(/\".*\"/g,"");return!n(a)||a.indexOf("@")<0?{fail:!0,email:t,name:t}:(o.test(t)?(u=t.match(o),s=u[0],i=n(t.replace(s,"")),s=s.substring(1,s.length-1)):s=i=n(t),e.comms.Utils.isValidEmail(s)||(r=!0),{fail:r,email:s,name:i})}function X(e){var t=0,n=0,r=e.length,i=[],s=!1,o=!1;for(n=0;n!==r;n++){var u=e.charAt(n);switch(u){case'"':s=!s;break;case"&":o=!0;break;case";":o&&(o=!1);break;case",":s||(i.push(e.slice(t,n)),t=n+1)}}return t!==n&&i.push(e.slice(t,n)),i}function V(t){var n=t.ancestor("ul"),r=n.all(".hLozenge"),i;r&&(F(t),I(t),r.remove(),e.fire("lozenge:remove"),_&&(i=t.ancestor(".ac-input"),this._toggleHideRecptsBtn(i.get("id"),!1)))}function $(){var t=this,n;if(!t.isLozengeHighlighted)return;n=t.composeView.baseNode.all(".hLozenge.focus"),n.removeClass(x),F(e.all("#to-field, #cc-field, #bcc-field")),t.allLozengesSelected=!1,t.isLozengeHighlighted=!1}function J(e,t){var n=this;n._removeLozengeHighlights(),e.toggleClass(x),n.isLozengeHighlighted=!0;var r=e.one(".lozenge-static").generateID();t.setAttrs({"aria-owns":r,"aria-activedescendant":r})}function K(e){var t=this,n=e.ancestor("ul"),r=n.all(".hLozenge");r&&(r.addClass(x),t.isLozengeHighlighted=!0),t.allLozengesSelected=!0}function Q(e){var t=this,r,i,s;r=e.ancestor(),i=n(e.get("value"));if(!n(i)){e.set("value","");return}i&&i.indexOf('"')>-1?s=X(i):(i.lastIndexOf(",")===i.length-1&&(i=i.substring(0,i.length-1)),s=i.split(/[;,]+/)),t._makeLozenges(s,r),R(e),e.set("value",""),t.checkOtherLozengeBoxes()}function G(){var t=this,n=t.composeView.baseNode,r,i;n.all("li.hLozenge").size()>100&&(i=new e.common.ui.Notification({type:"fade",className:"top",parent:"shellcontent",parentType:"id"}),r=d._shared_module_offscreen_bin_notification_notifications.addlozenge_exceededmax,i.on("clickEvent",function(){i.destroy()}),i.notify(l(r,null,null,null,strings),5e3))}function Y(e,t){var r=this,i,s=e.length,o,u,a,f;for(i=0;i<s;i++)u=e[i],n(u),u&&(a=W(u),f=r._createLozenge(a),t.insert(f,t));_&&(o=t.ancestor(".ac-input"),r._toggleHideRecptsBtn(o.get("id"))),r.composeView.resizeRTE(),r._checkRecipientCount(),r.composeView._setDirty(),r.checkOtherLozengeBoxes()}function Z(t,n){var r,i,s,o,u=[];D[n]=[];for(i=0;i<t.length;i++)o=t[i],D[n].push(o),u.push(o.email);s=u.join(",");var a={label:l(strings.str_hdr_more_recipients,{num_more_recipients:u.length},0,0,strings),hover:s,state:"normal",data:s,menu:null,edit:!1,copy:!1,parentClass:"group",dataClass:"more_recp more",action:"expand-recpts",valFn:function(){return!0}},f=new e.comms.ui.Lozenge(a);return f.getNode()}function et(t){var n,r;if(!t)return null;t.name=t.name||t.email;if(strings.str_cfg_tog_compose_enable_nickname){var i=b.getContactsByEmail(t.email),s;i&&(s=b.getFirstFieldValue(i[0],"nickname"),s&&(t.isNN=!0,t.name=s))}n||(n={email:t.email,firstName:t.name||t.email}),t.fail?r=strings.str_comp_error_email_lozenge_attr:r=t.email;var o,u={label:h(t.name),hover:h(r),state:t.fail?"error":"normal",data:t,menu:null,edit:!0,copy:!0,parentClass:"draggable"};o=new e.comms.ui.Lozenge(u);var a=o.getNode();return a.set("role","presentation"),e.mail.e2e&&e.mail.e2e.hasStarted&&e.mail.e2e.hasStarted()&&e.mail.e2e.isValid()&&e.mail.e2e.validateRecipients([t.email],function(e){e[0].recipient===t.email&&e[0].valid&&a._node.classList.add("lozenge-secure")}),a}function tt(t){var n=t.getData("lozenge"),r=n.data,i=n.error;if(t.hasClass("group"))return;if(strings.str_cfg_tog_compose_enable_nickname&&r.name&&r.isNN){var s=e.contacts.utils,o=s.getContactsByEmail(r.email),u,a;u=s.getFirstFieldValue(o[0],"name"),a=u?u.familyName+" "+u.givenName:"",r.name=a}if(i){this.currentAddress=r.email,this.validAddress=!1;if(!this.allowWhitelist||this.currentField!=="to"||e.mail.Models.Validators.send.YNC_ADDR_WHITELIST.indexOf(r.email)===-1)return}this[this.currentField].push(r)}function nt(){var e=this,t={to:[],cc:[],bcc:[],validAddress:!0,allowWhitelist:NeoConfig.isAMT||!!NeoConfig.isInternal||!!NeoConfig.isInternalIP,currentAddress:"",currentField:""},n,r,i,o,u,a,f,l,c,h,p,d;return n=e.composeView.baseNode.one(".cm-to.ac-input").all(".hLozenge"),t.currentField="to",n.each(tt,t),r=e.composeView.baseNode.one(".cm-cc.ac-input").all(".hLozenge"),t.currentField="cc",r.each(tt,t),i=e.composeView.baseNode.one(".cm-bcc.ac-input").all(".hLozenge"),t.currentField="bcc",i.each(tt,t),u=((s.get("externalAccounts")||{}).extAccount||[]).length,a=((s.get("aliases")||{}).alias||[]).length,f=((s.get("disposableAddresses")||{}).deaName||[]).length,u>0||a>0||f>0?e.composeView.type&&e.composeView.type==="inlineCompose"?t.from={email:e.composeView.draft.get("header").from.email,name:e.composeView.draft.get("header").from.name}:(l=e.composeView.baseNode.one(".from-select").get("value"),c=l.lastIndexOf("<"),h=l.lastIndexOf(">"),p=l.substring(c+1,h),d=l.substring(0,c-1),t.from=
{email:p,name:d}):t.from={email:s.get("userSendPref.defaultFromAddress"),name:s.get("userSendPref.defaultFromName")},o=e.composeView.baseNode.one(".cm-subject-field"),o?t.subject=o.get("value"):t.subject=e.composeView.draft.get("header").subject,t}function rt(t,n,r){var i,s,o,u,a,f,c,h=e.mail.ui.PaneUtils,p=n.recipients,d=n.more_recipients,v=n.to_str;if(t)return s=t.to||[],o=t.cc||[],u=t.bcc||[],a=s.concat(o,u),i=a.length,f=function(e){var t={to:h.getConvName(e),rcpt_id:h.getAddress(e),rcpt_name:h.getConvName(e)};return t},c=h.createRecipientList(a,p,null,r,f),r!==""&&a.length>r&&(c+=l(d,{num_more_recipients:a.length-r},0,0,strings)),c=l(v,null,null,null,strings)+c,c}function it(e){var t=at("cc"),n,r,i=this.composeView.baseNode,s=i.one(t.groupNode+" .address-btns");typeof e!="boolean"&&(n=at("bcc"),r=i.all(t.groupNode+" .hLozenge, "+n.groupNode+" .hLozenge"),e=r.size()>0?!1:!0),s[e?"removeClass":"addClass"]("hidden")}function st(e,t){var n=at(e),r=this.composeView.baseNode.one(n.groupNode),i=r.one(".compose-hide-recpts"),s,o,u;typeof t=="undefined"&&(o=r.all(".hLozenge"),u=o.size(),t=u>_+1),e!=="to"&&this._showHideCcBccOption(t?!1:""),i[t?"removeClass":"addClass"]("hidden")}function ot(e,t){var n=this.composeView,r=at(e),i=n.baseNode.one(r.groupNode),s=n.baseNode.one(r.node),o=s.ancestor("li"),u=[],a,f,l,c,h,p,d;d=i.one(".hLozenge.group"),d&&d.remove(!0),a=i.all(".hLozenge"),p=a.size(),l=t?!1:_+1===p?p:_,a.each(function(e,t){l&&t>=l?(e.addClass("hidden"),u.push(e.getData("lozenge").data)):e.removeClass("hidden")}),u.length?(h=Z(u,e),o.insert(h,o),this._toggleHideRecptsBtn(e,!1)):_&&p>_&&this._toggleHideRecptsBtn(e,!0),n.resizeRTE()}function ut(e,t,n){var r=this.composeView,i=at(t),s=r.baseNode.one(i.node),o=s.ancestor("li"),u,a,f,l;l=n?!1:_;for(u=0;u<e.length;u++)a=e[u],f=this._createLozenge({name:a.name,email:a.email}),l&&u>=l&&f.addClass("hidden"),o.insert(f,o),r.resizeRTE(),this._checkRecipientCount(),r._setDirty();_&&this._manageHideMoreOptions(t,n),this._showHideCcBccOption(),R(s)}function at(e,t){return{list:t&&t[e],node:".cm-"+e+"-field",groupNode:".cm-"+e+"-group"}}function ft(t){var n=this,r=n.composeView,i,s,o,a,l,c,h=r.type==="inlineCompose"?r.baseNode.one(".thread-recipients"):null,p="",v=[],m=["to","cc","bcc"],g=function(e){var t={to:f.getConvName(e),email:f.getAddress(e)};return t};for(s in m)c=m[s],l=at(c,t),a=l.list,a&&(o=l.node,h&&o!==".cm-bcc-field"&&(v=v.concat(a)),n._createAddressList(a,c));h&&(p=f.createRecipientList(v,d._shared_module_thread_thread_display_rollup.recipients1,null,null,g),h.setContent(p));if(t.cc&&t.cc.length!==0||t.bcc&&t.bcc.length!==0)n._bccSwitch(!0,!1,"cc"),n._bccSwitch(!0,!1,"bcc");if(r.type==="fullCompose"){t.from&&t.from.email&&(u&&t.from.email!==u.getAccount().email?n._setFromMenu(u.getAccount()):n._setFromMenu(t.from));if(t.subject){r.baseNode.one(".cm-subject-field").set("value",t.subject);var y=e.UA.ie>0&&e.UA.ie<10,b=y&&r.baseNode.one(".IEplaceholder");y&&b&&b.addClass("hidden"),r._setDirty()}}n.checkOtherLozengeBoxes()}function lt(e){var t=this,n=t.composeView.baseNode.all("div.ac-input input"),r=t.composeView.baseNode.all("div.subject input");e?(n.removeAttribute("readOnly"),r.removeAttribute("readOnly")):(n.setAttribute("readOnly",!0),r.setAttribute("readOnly",!0))}function ct(e){!P||!e?P.changeSelection(s.get("userSendPref.defaultID")):P.changeSelection(e.email),this._buildFromMenu()}function ht(t,n){var r=this,i=t.result.value.filters,o=i.length,u,a,f,l,c,h,p,d;if(o===0){d=s.get("userSendPref.defaultFromAddress");for(h=0;h<length;h++)if(d===n[h].email){r._setFromMenu(d);break}}else{a=e.one("#storm-listnav li.selected i"),u=a?a.get("text"):null;if(u)for(h=0;h<o;h++)if(i[h].actions[0].value.folderActionValueBean.folder.name===u){c=i[h].criterions,l=c.length;for(p=0;p<l;p++){f=c[p];if(f.field==="TO"&&pt(f.value,n)){r._setFromMenu(f.value);return}}}}}function pt(e,t){var n=t.length,r;for(r=0;r<n;r++)if(t[r].addr===e||t[r].email===e)return!0;return!1}function dt(t,n){var r=this,i,s,o,a,f;if(t.length===0)return;if(t.length===1)r._setFromMenu(t[0]);else{if(!pt(n,t)){r._setFromMenu();return}P||(P=new e.mail.Controller.mailComposeFromListHelper.FromOptionList,P.init()),i=P.getFromList(),pt(n,i)?(a={email:n},r._setFromMenu(a)):(s=r.getMatchedAddresses(t,i),o=s.length,o===0?r._setFromMenu():o===1?r._setFromMenu(s[0]):e.common.Utils.features.enabled("imapIn")?u?r._setFromMenu(u.getAccount()):e.use("mail-controller-filters-v3",function(e){f=e.mail.Controller.FiltersV3Controller.listFilters({suppressNotification:!0,suppressStat:!1}),f.then(function(t){r._processFiltersForReplyFrom(t,s)},function(t){r._setFromMenu(s[0])})}):r._setFromMenu(s[0]))}}function vt(e,t){var n=e.length,r=t.length,i=[],s,o,u;for(s=0;s<n;s++){u=e[s];for(o=0;o<r;o++)if(u.email===t[o].addr){i.push(u);break}}return i}function mt(e,t){var n=this,r,i,s=(e.isRTL?"rtl":!1)||(strings.str_tog_loadRTLCss?"rtl":"ltr"),o,u;return NeoConfig.bidi?(o=(s==="rtl"?"\u202b":"\u202a")+e.name+"\u202c",u=(s==="rtl"?"\u202b":"\u202a")+"\u200e&lt;"+e.addr+"&gt;\u200e\u202c",i=c(o)+" "+u):i=c(e.name,p)+" &lt;"+e.addr+"&gt;",r=l(m,{isDefault:t,address:i},n.composeView.formatters,null,strings),r}function gt(){var t=this,n=t.composeView.baseNode.one(".from-select"),r,i,s,o=[],u,a;P||(P=new e.mail.Controller.mailComposeFromListHelper.FromOptionList,P.init()),u=P.getFromList(),a=P.getSelectedIndex();for(r=0;r<u.length;r++)i=u[r],s=t._buildOptionMarkup(i,r===a),o.push(s);n.purge(!0,"change"),n.setContent(o.join("")),P.getVisible()?t.composeView.baseNode.one("div.account-select").removeClass(S):t.composeView.baseNode.one("div.account-select").addClass(S),n.on("change",function(){t.composeView._setDirty()})}function yt(){var e=this,t=v.show_full_header,n=l(t,e.draft,e.composeView.formatters,null,strings,d);e.hdr=e.composeView.baseNode.one(".compose-header"),e.hdr.setContent(n),e._bindUIHeader(),e._buildFromMenu()}function bt(e,t){var n=this,r;t=t||!1,r=t?1:0,n._bccSwitch(r,!1,"cc")}function wt(e){var t,n=-1
;return typeof e.get("selectionEnd")=="number"?n=e.get("selectionEnd"):document.selection&&document.selection.createRange&&(t=document.selection.createRange(),t.moveStart("character",-e.get("value").length),n=t.text.length),n}function Et(t,n){n=n||"bcc";var r=this,i=r.composeView.baseNode,s=i.one(".cm-"+n+".ac-input").all(".hLozenge"),u=i.one(".cm-"+n+"-field"),a=n==="bcc"?w:E;t||s.isEmpty()&&u.get("value").length===0?(r._bccSwitch(t,!0,n),a!==w&&o.set(a,t)):(e.fire("util:ymstats",{name:"compose_hdr_close_confirm_"+n}),e.fire("mt:click",{action:"compose_hdr_close_confirm_"+n}),r.composeView.confirm(null,strings["str_comp_conf_"+n],function(){s.each(function(e){e.remove(),r.composeView._setDirty()}),u.set("value",""),r._bccSwitch(!1,!0,n),a!==w&&o.set(a,!1)}))}function St(t,n,r){r=r||"bcc";var i=this,s=i.composeView.baseNode.all(".cm-btn-show-"+r),o=i.composeView.baseNode.one(".cm-"+r+"-group");typeof n=="undefined"&&(n=!0),t?(o.removeClass(S),s.addClass(S),n&&i.composeView.setFocus(r)):(o.addClass(S),s.removeClass(S),n&&i.composeView.setFocus(r));var u=i.composeView.baseNode.one(".cm-bcc-group"),a=i.composeView.baseNode.one(".cm-cc-group"),f=i.composeView.baseNode.one(".btn-bcc-in-cc");u.hasClass(S)&&(t?f.removeClass(S):a.hasClass(S)?f.addClass(S):f.removeClass(S)),i._reposAttachObj(k),i.composeView.resizeRTE(),e.fire("recalculateScrollToRepositionSend")}function xt(t){var n=this;NeoConfig.isCorpmail?e.use("ac-corp-widget",function(){n._initAutoComplete2(t)}):n._initAutoComplete2(t)}function Tt(t){var n={"to-field":".cm-to","cc-field":".cm-cc","bcc-field":".cm-bcc"},r=this,i=NeoConfig.isCorpmail?y.ui.ACCorpWidget:y.ui.ACWidget,s=t.get("id");if(s&&n[s]){t.removeClass("whiteout");var o=r.composeView.baseNode.one(n[s]),u=function(){r.listeners.push(e.ACWidgetInst.get("ac").on("ac:query",function(t){var n=this,r=t.value,i,s;if(b.areContactsLoaded()){var o=new e.comms.FilterContacts;o.updateFilterItems(r),i=o.fastMatch(),i.queryStr=r,s=e.bind(n.reload,n,i),s(i)}}))};e.ACWidgetInst?e.ACWidgetInst.get("ac").get("alignNode")!==o&&(e.ACWidgetInst.get("ac").destructor(),e.ACWidgetInst.refresh({acNode:o,acTarget:t,width:o.getStyle("width"),selectFirst:!0}).setAlign().render(),u(),r._setACWidgetARIAOwns()):(r.offscreenContent&&r.offscreenContent.remove(),r.offscreenContent=e.Node.create(l(d._shared_module_offscreen_bin_compose.base,{},null,null,strings,d)),e.one(document.body).append(r.offscreenContent),e.ACWidgetInst=(new i({acNode:o,acTarget:t,contentBox:"#ac-to-results",selectFirst:!0})).setAlign().render(),r._setACWidgetARIAOwns(),e.ACWidgetInst.after("visibleChange",function(t){var n=this.get("ac").get("host"),r=e.ACWidgetInst.get("contentBox").one("li"),i=t.newVal&&r?!0:!1;n.set("aria-expanded",i),i||n.set("aria-activedescendant","")}),e.ACWidgetInst.after("selectedIndexChange",function(e){var t="";e.newVal>-1&&(t=this.get("contentBox").one(".yui3-acwidget-selected").generateID()),this.get("ac").get("host").set("aria-activedescendant",t)}),u())}}function Nt(){var e=this,t=e.listeners;if(t){var n=t.length,r;for(r=0;r<n;r++)t[r]&&t[r].detach();t.length=0}e.lozengeDD&&e.lozengeDD.destroy(!0),e.hdr&&(e.hdr.detachAll(),e.hdr.remove()),H.superclass.ondestroy.call(e,arguments)}function Ct(e){var t=this,n=e.target,r=n.ancestor("div.ac-input",!1),i;if(r){i=r.get("id"),t.composeView.focusNode=i,r.addClass(T),r.get("parentNode").addClass("active");if(r.one(".hLozenge.group")){t._manageHideMoreOptions(i,!0);return}}if(n.hasClass("cm-to-field")||n.hasClass("cm-cc-field")||n.hasClass("cm-bcc-field"))t.composeView._registerFocus(n),t._initAutoComplete(n),t.checkOtherLozengeBoxes()}function kt(t){e.one("div.ac-results:hover")||e.one("div.ac-results li.over")||e.one("li.yui3-aclist-item-hover")||(j(),this._lozengeIt(t),e.ACWidgetInst.get("ac").set("queryValue",""))}function Lt(e){var t=this,n=e.target,r=t.composeView.draft;if(n.hasClass("cm-to-field")||n.hasClass("cm-cc-field")||n.hasClass("cm-bcc-field"))e.preventDefault(),this.handleACBlur(n);else if(n.get("id")==="subject-field"){var i=n.get("value");i&&i!==""&&r.subject&&typeof r.subject!="undefined"&&r.subject!==i&&t.composeView._setDirty()}}function At(e,t){var n=this,r=e.target,i=e.keyCode,s,o,u=r.ancestor("div"),a=u.one(".hLozenge.focus"),f=r.get("value"),l,c,h=r.get("id");if(h){s={"to-field":t.one("#to_add_contacts"),cc_show_btn_in_to:"to",cc_hide_btn:"cc","cc-field":t.one("#cc_add_contacts"),"bcc-field":t.one("#bcc_add_contacts"),bcc_show_btn_in_cc:t.one("#cc_hide_btn"),bcc_hide_btn:"bcc"},o={"to-field":t.one("#cc_show_btn_in_to"),to_add_contacts:"to",cc_add_contacts:"cc",cc_hide_btn:t.one("#bcc_show_btn_in_cc"),bcc_add_contacts:"bcc",cc_show_btn_in_to:t.one("#bcc_show_btn_in_to"),"cc-field":t.one("#cc_hide_btn"),"bcc-field":t.one("#bcc_hide_btn")};if(i===39)if(r.get("nodeName")==="A"||!f&&!a||f&&wt(r)===f.length){l=o[h];if(l){n.composeView.setFocus(l);if(l==="to"||l==="cc"||l==="bcc"){var p=t.one("#"+l);c=p.one(".hLozenge"),c&&(n._selectSingleLozenge(c,p),p.addClass("whiteout"))}return}}}if(!r.get("value")){e.preventDefault();var d;if(a)i===37?(d=a.previous(),d||(s[h]&&n.composeView.setFocus(s[h]),n._removeLozengeHighlights(),r.removeClass("whiteout"))):(d=a.next(),d.hasClass("hLozenge")||(d=null,n._removeLozengeHighlights(),r.removeClass("whiteout"))),d&&(n._removeLozengeHighlights(),n._selectSingleLozenge(d,r));else if(i===37){var v=r.ancestor();d=v.previous(),d&&d.hasClass("hLozenge")?(n._removeLozengeHighlights(),n._selectSingleLozenge(d,r),r.addClass("whiteout")):s[h]&&n.composeView.setFocus(s[h])}}}function Ot(t){var n=this,r=t.keyCode,i=t.target;if(!i.get("value")){var s=i.ancestor(),o=i.ancestor(".ac-input"),u=o.all(".hLozenge.focus"),a=u.size();t.halt();if(n.allLozengesSelected){n.removeAllLozenges(i),i.removeClass("whiteout");return}var f,l;a?(n.removeARIAFocus(i),n.removeARIADescription(i),a===1?(f=u.item(0),l=f.next(),l===s&&(l=f.previous()),l?n._selectSingleLozenge(l,i):i.removeClass("whiteout")):i.removeClass("whiteout"),n.composeView._setDirty
(),u.detachAll(),u.remove(),u=null,e.fire("lozenge:remove"),_&&n._toggleHideRecptsBtn(o.get("id"))):r===8&&(l=s.previous(),l&&(n._removeLozengeHighlights(),n._selectSingleLozenge(l,i),i.addClass("whiteout"))),n.checkOtherLozengeBoxes(),n.composeView.resizeRTE()}}function Mt(){var e=this,t=e.composeView.baseNode.one(".cm-to.ac-input").all(".hLozenge").size(),n=e.composeView.baseNode.one(".cm-cc.ac-input").all(".hLozenge").size(),r=e.composeView.baseNode.one(".cm-bcc.ac-input").all(".hLozenge").size(),i=0;return i=t+n+r,e.totalLozenges=i,i}function _t(){var e=this,t=e.lozengeCount();t<=0?e.composeView._showSendBtn(!1):e.composeView._showSendBtn(!0)}function Dt(){var t=e.ACWidgetInst;return t.canHandleEnter?t.canHandleEnter():t&&t.isVisible()&&(t.get("data").length>0||NeoConfig.isCorpmail&&t.get("gabData").length>0)}function Pt(t,n){var r=this,i=e.ACWidgetInst,s=t.decodeCategory(n.get("value")),o=function(e,t,n,r,i){switch(t){case"amp":if(n)return o(e,n,"",r+5,i);return"&";case"#39":return"'";case"quot":return'"';case"lt":return"<";case"gt":return">";case"#35":return"#";default:return""}};if(s){var u,a=[];for(u in s){var f=s[u];if(f){var l="",h=f.firstname&&c(f.firstname),p=f.middlename&&c(f.middlename),d=f.lastname&&c(f.lastname),v=f.nickname&&c(f.nickname);l=i.buildName(h,p,d,v),l=l+"("+f.email+")",a.push(l.replace(/&((?:[a-zA-Z]+)|(?:#[0-9]+));(?:([a-zA-Z]+|(?:#[0-9]+));)?|([;,])/gi,o))}}r._makeLozenges(a,n.ancestor()),r.addARIADescription(n),n.set("value","")}else r._lozengeIt(n)}function Ht(t){var n=this,i=t.target,s=t.ctrlKey,o=t.metaKey,u=e.ACWidgetInst,a=e.UA.os,f=s&&(a==="linux"||a==="windows"||a==="win")||o&&(a==="macintosh"||a==="mac");if(i.get("nodeName")==="A")return;f&&!t.altKey&&n.composeView.handleComposeAction("send",t);var l=new e.comms.FilterContacts;if(n.canACWidgetInstHandleEnter())u.handleEnter(t,u);else{l.updateFilterItems(i.get("value"));var c=l.fastMatch();if(c&&c.length){var h=c[0],p=r(u.getItemMarkup(h));p.one("span.ac-remove-item").remove(),i.set("value",p.get("text"))}}t.halt();if(!i.get("value")){t.preventDefault();var d=i.ancestor("div"),v=d.one(".hLozenge.focus");v&&v.getData("lozenge").startEdit();return}n.setACCategory(l,i)}function Bt(t){var n=this,r=t.target,i=t.ctrlKey,s=t.metaKey,o=e.ACWidgetInst,u,a,f=(u=o.get("data"))&&u.length,l=(a=o.get("gabData"))&&a.length;if(i||s||!r.get("value"))return;if(f>=2||l>=2)return;f===1||l===1?(t.halt(),o&&o.isVisible()&&r.simulate("keydown",{keyCode:13})):(t.halt(),n._lozengeIt(r))}function jt(e){var t=this,n=e.target,r=e.ctrlKey,i=e.metaKey;if(!r&&!i||n.get("value"))return;e.halt(),t._selectAllLozenges(n),n.addClass("whiteout")}function Ft(t){var n=this,r,i=t.target,s=t.ctrlKey,o=t.metaKey,u=t.altKey,a=e.ACWidgetInst,f=(r=a.get("data"))&&r.length;if(!i.get("value"))if(a.hasItemSelected){if(!a.hasItemSelected())return}else if(!a.isVisible())return;!s&&!o&&!u&&(f>=1&&t.halt(),n.composeView.keepHdrFocus=!0,i.simulate("keydown",{keyCode:13}))}function It(n){function u(){var e=r.hdr,n=t.ui.MessagePaneUtils,i="";e.all("li.focus").each(function(e){i+=e.one("input").get("value"),i+="; "}),i!==""&&(i=i.substring(0,i.length-1),n.initializeCopyText(),n.copyToClipboard(i,null,document.activeElement))}var r=this,i=n.ctrlKey,s=n.metaKey,o=e.UA.os==="macintosh"?s:i;o&&(n.stopPropagation(),u())}function qt(t){var n=this,r=t.target,i=t.ctrlKey,s=t.metaKey,o=e.UA.os==="macintosh"?s:i,u=t.type==="paste"?!0:!1;(o||u)&&setTimeout(function(){n.updateTextField(r,!0)},0)}function Rt(t){var n=this,r=t.target,i=t.shiftKey,s=t.ctrlKey,o=t.metaKey,u=e.UA.os==="macintosh"?o:s;r.removeClass("whiteout"),!u&&!i&&n._removeLozengeHighlights()}function Ut(e){var t=this,n=e.target;if(n.hasClass("cm-to-field")||n.hasClass("cm-cc-field")||n.hasClass("cm-bcc-field")){var r=t.composeView.baseNode.one(".ac-input.compose-field-focus .recipient-input input"),i=t.totalLozenges;r===null&&i<=0?t.composeView._showSendBtn(!1):r.getDOMNode().value===""&&i<=0?t.composeView._showSendBtn(!1):t.composeView._showSendBtn(!0)}}function zt(t){var n=this,r=n.hdr,i=t.keyCode,s=t.shiftKey,o=t.ctrlKey,u=t.metaKey,a=t.altKey,f=e.UA.os==="macintosh"?u:o,l,c=t.target,h=NeoConfig.infinitePane,p=c?c.get("type")?c.get("type").toLowerCase()||"":"":"",d=c?c.get("tagName").toLowerCase():"",v=function(){return c.ancestor("div.cm-to ul,.cm-cc ul,div.cm-bcc ul")},m;e.fire("HoverCard:hideHoverCard"),!p||p!=="text"&&p!=="textarea"?d&&(d==="input"||d==="textarea")&&t.stopPropagation():t.stopPropagation(),c.hasClass("cm-from-field")&&h&&(t.keyCode===37||t.keyCode===39)&&t.stopPropagation(),!(s&&o&&u&&a)&&(i===188||i===186)&&c.hasClass("lozenge-edit")&&v()&&(m=v().one("li.recipient-input input"),m?m.focus():c.blur());if(c.hasClass("cm-subject-field")||c.hasClass("cm-to-field")||c.hasClass("cm-cc-field")||c.hasClass("cm-bcc-field")||c.get("nodeName")==="A"){h&&(t.keyCode===37||t.keyCode===39)&&t.stopPropagation();if((i===83||i===89&&s||i===85&&s)&&(o||u)||i===27){n.composeView.get("keydownHandler")?n.composeView.get("keydownHandler")(t):n.composeView.onKeyDown(t);return}if(c.hasClass("cm-subject-field")){l=(o||u)&&!a&&!s||i===9,(!l||f&&i===86)&&n.composeView._setDirty(),i===9&&!s&&(c.blur(),n.composeView.setFocus("body"),t.halt()),i===13&&f&&!t.altKey&&(n.composeView.handleComposeAction("send",t),t.halt());return}switch(i){case 37:case 39:n.handleLeftRightArrow(t,r);break;case 8:case 46:n.handleDelete(t);break;case 13:n.handleEnter(t);break;case 32:n.handleSpacebar(t);break;case 65:n.handleSelectAll(t);break;case 38:break;case 9:n.handleTab(t);break;case 67:n.handleCopy(t,r);break;case 86:n.handlePaste(t);break;default:n.handleDefaultKeydown(t)}}}function Wt(){var e=this,t=e.hdr,n=e.listeners;n.push(t.on("blur",e.setInputBlur,e)),n.push(t.on("keydown",e.keyHandler,e)),n.push(t.on("keyup",e.sendEnableKeyHandle,e)),n.push(t.one("#subject-field").on("keyup",function(){e.composeView._setDirty()})),n.push(t.on("change",function(t){var n=t.target;(n.hasClass("cm-to-field")||n.hasClass("cm-cc-field")||n
.hasClass("cm-bcc-field"))&&e.composeView._setDirty()}))}function Xt(t){var n=this,r=t.dataAction;switch(r){case"reply_all":case"reply_sender":case"forward":n.switchReplyMode(t.dataAction),e.fire("mt:click",{action:"reply_card_menu_"+r});break;case"edit_subject":n.allowSubjectEdit(!0)}}function Vt(t){var n=this,r=n.composeView.draft.origin,i=e.common.ui.MenuHelper,s=t.target;e.use("mail-ui-inboxmenu-base","_shared_module_offscreen_bin_menus_reply_modes",function(e){e.mail.ui.InboxMenu.insert("menu-reply-modes",function(){var r=e.one("#menu-reply-modes");i.create(s,{menu:r,flushLeft:!1,isContext:!1,xy:[t.clientX,t.clientY]},function(){r.on("menuSelected",n.onReplyModeSelected,n),r.after("menu:state",function(t){var n=t.state;n==="hide"&&(s.removeClass("pressed"),s.unplug(e.Plugin.Menu),this.destroy(!0))})})},r.fid,{origin:r,isQuickReply:n.composeView.get("isQuickReply")})})}function $t(){var t=this,n,r,i,s;t.listeners.push(t.hdr.delegate("click",function(r){var i=a.getDataAction(r).action;switch(i){case"menu":t.loadReplyModeMenu(r),e.fire("mt:click",{action:"reply_card_"+i});break;case"qr-cancel":t.neoFire("qrCancel"),e.fire("ToolTips:hideTooltips"),e.fire("mt:click",{action:"reply_card_"+i});break;case"expand-recpts":s=r.target.ancestor(".ac-input"),n=s.get("id"),t._manageHideMoreOptions(n,!0);break;case"hide-recpts":s=r.target.ancestor(".field").one(".ac-input"),n=s.get("id"),t._manageHideMoreOptions(n,!1)}},".compose-header"))}function Jt(){var t=this,r=t.composeView.baseNode,i=r.one("input.cm-subject-field"),s=r.one("input.cm-to-field"),o=r.one("input.cm-cc-field"),u=r.one("input.cm-bcc-field"),a=e.UA.ie>0&&e.UA.ie<10,f=a&&r.one(".IEplaceholder"),l=t.hdr;NeoConfig.bidi&&i.plug(e.Plugin.BidiTextEntry),t._bindAutoComplete(),t.listeners.push(t.hdr.delegate("paste",qt,"#to-field, #cc-field, #bcc-field",t)),t.listeners.push(e.on("lozenge:highlight",function(){t.isLozengeHighlighted=!0})),NeoConfig.useDD&&t.composeView.type==="fullCompose"&&e.use("common-ui-lozengeDD",function(e){e.Lang.later(0,0,function(){t.lozengeDD=new e.common.ui.lozengeDD({composeView:t.composeView,dragSelector:".draggable"})})}),t.listeners.push(l.on("focus",Ct,t)),t.listeners.push(i.after("focus",function(){t.composeView._registerFocus(i),a&&f.addClass("hidden")})),t.listeners.push(i.on("change",function(){a&&f.addClass("hidden")})),t.listeners.push(s.after("blur",function(){s.ancestor("div").removeClass(T),t.composeView.resizeRTE()})),t.listeners.push(o.after("blur",function(){o.ancestor("div").removeClass(T),t.composeView.resizeRTE()})),t.listeners.push(u.after("blur",function(){u.ancestor("div").removeClass(T),t.composeView.resizeRTE()})),t.listeners.push(i.after("blur",function(n){t.neoFire("updateSubject"),a&&e.Lang.trim(n.target.get("value"))===""&&f.removeClass("hidden")})),t.listeners.push(l.delegate("click",function(n){n.halt(),t._reposAttachObj(N);var r={to_add_contacts:".cm-to",cc_add_contacts:".cm-cc",bcc_add_contacts:".cm-bcc"},i={wspath:NeoConfig.socdirProxyPath,guid:NeoConfig.neoguid,wssid:NeoConfig.wssid,requestFn:e.common.net.SessionMgr.requestProxy,selectAll:!1,lookForSelect:!0,lookForInput:!0,onDone:function(e,n){var i,s,o,u=n.get("id"),a=t.composeView.baseNode.one(r[u]),f=a.all("li"),l=f.item(f.size()-1);for(i in e)s={name:e[i].name,email:h(e[i].field.value)},o=t._createLozenge(s),t.composeView._setDirty(),l.insert(o,l),t.composeView.resizeRTE(),t._checkRecipientCount();_&&t._toggleHideRecptsBtn(a.get("id")),t._reposAttachObj(C),t.composeView._restoreFocus()},onCancel:function(){t._reposAttachObj(C)}};e.use("contacts-ui-choosecontactdialog",function(e){t.composeView.cancelDialogLoad||e.fire("ccd:create",i,n.currentTarget)});var s=n.currentTarget.get("id"),o="addbcc";s==="to_add_contacts"?o="addrec":s==="cc_add_contacts"&&(o="addcc"),e.fire("mt:click",{action:"cmps_"+o,append:{t1:"cmpsTb"}})},".choose-contact")),t.listeners.push(l.delegate("click",function(e){var n=e.target,r=e.currentTarget,i=r.getElementsByTagName("INPUT"),s=i.item(i.size()-1),o;if(n.hasClass("lozenge-edit"))return;o=r.get("scrollTop"),n.hasClass("compose-hide-recpts")||n.hasClass("more_recp")?s===t.composeView.focusNode?t.composeView.setFocus(t.composeView.editor.getRTE()):t.composeView._restoreFocus():s.focus(),n.hasClass("lozenge-static")||n.hasClass("lozenge-edit")?(r.set("scrollTop",o),s.addClass("whiteout")):(s.removeClass("whiteout"),t._removeLozengeHighlights(),r.set("scrollTop",r.get("scrollHeight")))},"div.ac-input")),t.listeners.push(l.on("keyup",function(e){var r=e.target,i=r.get("value"),s=i.length,o=i[s-1];if(!(r.hasClass("cm-to-field")||r.hasClass("cm-cc-field")||r.hasClass("cm-bcc-field")))return;s>0&&t.composeView._setDirty();if(o===";"||o===","){e.halt(),i=n(i);if(i.length===1){r.set("value","");return}if(!i)return;t._lozengeIt(r)}t.updateTextField(r),t._reposAttachObj(k)}))}function Kt(e,t){var n=e.action===L;n?(t.removeClass("ico-thread-reply"),t.addClass("ico-thread-reply-all")):(t.removeClass("ico-thread-reply-all"),t.addClass("ico-thread-reply"))}function Qt(t){t=t||0;var n=this,r=n.composeView.draft.origin,s=n.composeView.baseNode,o=s.all(".replyall-toggle-btn a"),u,a,f=s.one(".qr-card-actions");t||(t=r.action===A?L:A),r.action=t,f&&f.replace(l(d._shared_module_compose_quick_reply_card_actions.base,{reply_type:M[t]},null,null,strings)),t===A?(o.set("text",strings.str_comp_btn_reply_all),!n.composeView.get("isQuickReply")&&e.fire("mt:click",{action:"cmps_rplysndr",append:{t1:"cmpsTb"}}),n.composeView.composeTictacApi.render(n.composeView.baseNode.one(".attachments-pane")),i.excludeAttachment(n.composeView.draft)):t===L?(o.set("text",strings.str_comp_btn_reply_sender),!n.composeView.get("isQuickReply")&&e.fire("mt:click",{action:"cmps_rplyall",append:{t1:"cmpsTb"}}),n.composeView.composeTictacApi.render(n.composeView.baseNode.one(".attachments-pane")),i.excludeAttachment(n.composeView.draft)):t===O&&(!n.composeView.get("isQuickReply")&&e.fire("mt:click",{action:"cmps_fwd",append:{t1:"cmpsTb"}}),n.allowSubjectEdit
(!1),i.excludeAttachment(n.composeView.draft),i.includeAttachment(n.composeView.draft,{fetchGDM:!0}),n.composeView.composeTictacApi.render(n.composeView.baseNode.one(".attachments-pane"))),n.composeView.type==="inlineCompose"&&Kt(r,o),a=i.getHeaderContent(r),u=s.one(".cm-subject-field"),u&&(a.subject=u.get("value"));var c=s.one(".cm-to-field"),h=s.one(".cm-cc-field");n.removeAllLozenges(c),n.removeAllLozenges(h),n.setHeader(a),n.composeView._restoreFocus()}function Gt(){var e=this,t=e.hdr,n,r,i=e.composeView.draft.origin,s=i&&i.oMsg&&i.oMsg.header,o=i&&i.oMsg&&i.oMsg.body,u=s&&(s.to?s.to.length:0)+(s.cc?s.cc.length:0)||0,a=i.action,f,l,c,h=e.composeView.baseNode,p=h.all(".replyall-toggle-btn"),d,v={},m,y,b=1,w;i.fid==="Sent"&&a===A&&(i.action=L);if(a!==L&&a!==A||!o||!u)return;if(s.replyto){w=s.replyto.length;for(d=0;d<w;d++)v[s.replyto[d].email]=1}m=s.to.concat(s.cc),f=g()||{},w=m.length;for(d=0;d<w;d++){l=m[d].email||"";if(y&&l!==y||w===1&&!(l in f||l in v))b=0;y=l,(l in f||l in v)&&!c?c=0:c=1}if(a&&c&&!b&&h.one(".replyall-toggle-btn")&&i.fid!=="Sent"){p.removeClass("hidden"),n=t.one("#to"),r=t.one(".address-btns");if(r&&n.getX()+n.get("clientWidth")+r.get("clientWidth")+20>t.get("clientWidth")+t.getX()){p.addClass("hidden");return}e.composeView.type==="inlineCompose"&&Kt(i,h.all(".replyall-toggle-btn a")),e.listeners.push(h.delegate("click",function(){e.switchReplyMode()},".address-btns .replyall-toggle-btn a",e))}}function Yt(e){var t=this.hdr.one(".subject");t.removeClass("hidden"),e&&setTimeout(function(){t.one("input").focus()},0)}var t=e.mail,n=e.Lang.trim,r=e.Node.create,i=e.mail.Controller.ReplyProcessor,s=e.common.persist.UserData,o=t.persist.MetaData,u=t.model.DataStore.Accounts,a=e.common.Utils,f=t.ui.PaneUtils,l=a.substitute,c=a.escapeHtml,h=a.unescapeHtml,p=strings.str_cfg_tog_unescape_ncr,d=e.ui.Templates,v=d._shared_module_compose_message_header_fresh,m=v&&v.compose_from_address,g=e.mail.Controller.mailComposeFromListHelper.getAllAccountEmails,y=e.contacts,b=y.utils,w="neo.pref.compose.showBcc",E="neo.pref.compose.showCc",S="hidden",x="focus",T="compose-field-focus",N="offscreen",C="restore",k="move",L="reply_all",A="reply_sender",O="forward",M={reply_sender:strings.str_reply,reply_all:strings.str_reply,forward:strings.str_forward},_=a.features.enabled("showHideComposeRecipients")?a.settings.value("recipientThresholdVal"):!1,D={},P,H=function(e,t){var n=this;n.isLozengeHighlighted=!1,n.allLozengesSelected=!1,n.composeView=t,n.offscreenContent=null,n.listeners=[],H.superclass.constructor.apply(n,arguments),n.neoEvent("updateSubject",{emitFacade:!0,broadcast:1}),n.neoEvent("qrCancel",{emitFacade:!0,broadcast:1})};e.extend(H,t.ui.BaseWidget),e.mix(H.prototype,{NAME:"HeaderBase",render:yt,getHeader:nt,setHeader:ft,enableHeader:lt,allowEditing:bt,_bindUIHeader:Jt,bind:$t,loadReplyModeMenu:Vt,setInputFocus:Ct,setInputBlur:Lt,keyHandler:zt,lozengeCount:Mt,sendEnableKeyHandle:Ut,handleACBlur:kt,handleLeftRightArrow:At,handleDelete:Ot,handleEnter:Ht,handleSpacebar:Bt,handleTab:Ft,handleSelectAll:jt,handleCopy:It,handlePaste:qt,handleDefaultKeydown:Rt,setACCategory:Pt,canACWidgetInstHandleEnter:Dt,checkOtherLozengeBoxes:_t,_bindAutoComplete:Wt,ondestroy:Nt,destroy:Nt,hideACWidget:j,_cmdBccSwitch:Et,_reposAttachObj:B,_setFromMenu:ct,removeAllLozenges:V,_removeLozengeHighlights:$,_createLozenge:et,enableSwitchReplyButton:Gt,switchReplyMode:Qt,_lozengeIt:Q,_manageHideMoreOptions:ot,_createAddressList:ut,_toggleHideRecptsBtn:st,_showHideCcBccOption:it,_checkRecipientCount:G,_makeLozenges:Y,_selectSingleLozenge:J,_selectAllLozenges:K,_tokenizeAddresses:X,removeARIAFocus:F,_setACWidgetARIAOwns:q,removeARIADescription:I,addARIADescription:R,updateTextField:z,_buildOptionMarkup:mt,_buildFromMenu:gt,createAddress:W,_initAutoComplete:xt,_initAutoComplete2:Tt,_processFiltersForReplyFrom:ht,addressInList:pt,_bccSwitch:St,_getRecptList:rt,getCursorLocation:wt,onReplyModeSelected:Xt,setReplyFrom:dt,getMatchedAddresses:vt,allowSubjectEdit:Yt,_ccSwitch:function(){}},!0),e.namespace("mail.Views").ComposeHeader=H},"1.0.0",{requires:["comms-ui-lozenge","ac-widget","_shared_module_offscreen_bin_compose","mail-controller-reply-processor","_shared_module_offscreen_bin_notification_notifications","mail-controller-compose-text","contacts-api","_shared_module_compose_message_header_fresh","mail-models-validators-send","mail-ui-basewidget","mail-common-utils-features","mail-ui-mailcompose-header-form-list-helper","mail-model-datastore","mail-common-utils-settings","mail-ui-pane-utils"]});
YUI.add("mail-error-v3",function(B){var C=B.mail.Errormap,A=false;B.namespace("mail.Error");B.mix(B.mail.Error,{handleV3:function(D){var H,E,G,I=D||[];for(var F=0;F<I.length;F++){E=I[F];if(B.mail.Error.isDependencyFailure(F,E.code)){continue;}E.method=E.id||this.extractMethod(E.resource);H=C.getErrorInfo(E);A=this.getErrorType(E.code);if(!G){G={"code":E.code,"message":H.message,"tae":H.tae,"type":A,"notificationDisplayed":false};}if(!H.suppressNotification&&A!==this.errorType.TEMPORARY&&A!==this.errorType.CLIENT){B.mail.Error.showTae(H);G.notificationDisplayed=true;}this.statV3(H,E);E.url=E.url?E.url:D.url;this.logV3(H,E);}return G;},extractMethod:function(F){var D,E;if(!F){return"unknown";}D=F.split("?");E=D[0].split("/");return(E.length&&E[E.length-1])||"unknown";},isFailedDependency:function(){return false;},statV3:function(I,F){var G,D,E,H={"convpane":"CONVREAD","messagepane":"MESSAGEREAD","search":"SEARCH","convlist":"CONVLIST","messagelist":"MESSAGELIST"};D=B.mail.Tabs.getActiveTab().widgetType;G=H[D]?H[D]:D;E=B.mail.Error.getColo();if(I.suppressStat){B.fire("util:ymstats",{"name":"client_error","tags":{"api":F.method,"tae":I.tae,"code":(I.customCode||F.code),"farm":NeoConfig.farm.substr(1),"colo":E,"httpStatusCode":F.status}});B.fire("stat:webservice_fail",{"tab":G,"tae":I.tae,"api":F.method,"message":F.code,"visible":"no"});}else{B.fire("util:ymstats",{"name":"ue_client_error","tags":{"api":F.method,"tae":I.tae,"code":(I.customCode||F.code),"farm":NeoConfig.farm.substr(1),"colo":E,"httpStatusCode":F.status}});B.fire("stat:webservice_fail",{"tab":G,"tae":I.tae,"api":F.method,"message":F.code,"visible":"yes"});}},logV3:function(G,D){var E=(G.suppressStat?"":"UE_")+"DEBUG_TAE:"+(G.tae||"null")+":"+(D.method||"null")+":"+(D.code||"null")+":"+NeoConfig.farm+":"+D.url+":NewV3",F={m:E,api:(D.method||"null")+" ",reason:(D.code||"null")+" ",errinfo:G,yid:NeoConfig.loginId,response:D};B.fire("MailLog",F,1,"tae"+G.tae);},getErrorType:function(E){var D;if(E&&E.match(/.+-.+/)){D=E.split("-")[0];switch(D){case"EP":return this.errorType.PERMANENT;case"EC":return this.errorType.CLIENT;case"ET":return this.errorType.TEMPORARY;}}return this.errorType.UNKNOWN;},errorType:{PERMANENT:"perm",TEMPORARY:"temp",CLIENT:"client",UNKNOWN:"unknown"},platform:{isAvailable:function(){return A!==B.mail.Error.errorType.PERMANENT;}},cleanUpOnSuceess:function(){A=false;}});},"1.0.0",{requires:["mail-error","common-ui-tabs-base","common-net-error","mail-errormap","ymma-stats","json-stringify","_shared_module_offscreen_bin_modal_launch_error_rollup"]});YUI.add("mail-ui-mailcompose-v3",function(e){function h(){var e=this;c.superclass.ondestroy.call(e,arguments)}function p(){var e=this;return e.dirty}function d(t,n,r,i,s){var o=this,u=t?t:strings.str_comp_dialogheader;if(o.suppressDialog===!0){r();return}e.use("common-ui-dialog-helper",function(e){var t={hd:u,bd:n,suppressRestoreFocus:!0};e.common.ui.DialogHelper.confirm(t,{ok:{text:s,handler:r},cancel:{handler:function(){o._restoreFocus(),i&&i()}}})}),o.hiliteCP&&o.hiliteCP.hide(),o.textCP&&o.textCP.hide()}function v(){var e=this;return e.draft.isUploadingAttachments()?1:0}function m(e){var t=this;t.focusNode=e,t.neoFire("composeEvent",{action:"setFocusNode",focusNode:e})}function g(){var e=this;e.setFocus(e.focusNode)}function y(){this.controller.edited(),this.dirty=!0,this.resetSaveTimer()}function b(){var e=this;e.controller.isEdited()&&(e.controller.unedited(),e.dirty=!1,e._cancelSaveTimer())}function w(){var t=this,n,r;return t.isRichText!==null?t.isRichText:(r=e.common.persist.UserData.get("userUIPref.useRichText"),n=r&&r!=="plain",t.isRichText=n,n)}function E(t){var n=this;n.isRichText!==t&&(n.isRichText=t,e.common.persist.UserData.set("userUIPref.useRichText",t?"dynamic":"plain"),setTimeout(function(){e.common.persist.UserData.saveOne("userUIPref.useRichText")},10),n.fire("isRichTextChanged"))}function S(){var t=this,n=!0,r=e.mail.Error.platform.isAvailable(),i=new Date-t.lastAutoSaveTime,s=Math.max(0,t.autoSaveTimePeriod-i);t._cancelSaveTimer(),r&&!NeoConfig.isAMT&&(t.saveTimer=e.later(s,t,function(){t.isAutoSave=!0,t.lastAutoSaveTime=new Date,t.save(),t._cancelSaveTimer()},[],!n))}function x(){var e=this;e.saveTimer&&(e.saveTimer.cancel(),e.saveTimer=null)}function T(t,n){var r=this,i=t?t:strings.str_comp_dialogheader;r.allowSend?e.use("common-ui-dialog-helper",function(e){r.allowSend=!1;var t={hd:i,bd:n,suppressRestoreFocus:!0},s=function(){r.allowSend=!0,r._restoreFocus()};e.common.ui.DialogHelper.alert(t,{ok:{handler:s},cancel:{handler:s}})}):r._restoreFocus()}function N(){this._cancelSaveTimer(),this.controller.save(this.isAutoSave)}function C(){return}function k(){var e=this;if(e.draft===null)return;e.updateSaveText(!0)}function L(){var e=this,t=e.richFontInfo,r=t.fontFamily,i=t.fontSize;return r||(r=n.getStyleFontFamily(!1)),i||(i=n.getStyleFontSize(!1)),{fontFamily:r,fontSize:i,foreColor:t.foreColor,backColor:t.backColor}}function A(){var e=this;e.isAutoSave=!1,e.save(),e.header&&e.header.hideACWidget(),e.dirty="ForceClose",e._closeAfterWarning(!0)}function O(){var n=this,r=n.areAttachmentsPending(),i='<button id="{{btnID}}ModalOverlay" class="btn left right {{default}}" role="button" data-action="{{btnID}}">{{btnLabel}}</button>';e.use("common-ui-dialog-helper",function(e){var s=t(i,{btnID:"SaveDraft","default":"default",btnLabel:strings.str_comp_savetodrafts_fresh}),o=t(i,{btnID:"DontSave",btnLabel:r?strings.str_comp_closewithoutsaving:strings.str_comp_abandon}),u=t(i,{btnID:"Continue","default":r?"default":"",btnLabel:r?strings.str_comp_returntomessage:strings.str_comp_keepwriting}),a=r?u+o:s+o+u,f=r?strings.str_comp_close_attachmentprocessing:strings.str_comp_close_confirm,l={modal_classes:"lg saveDraftDialog",hd:strings.str_comp_close,bd:f,ft:a,suppressRestoreFocus:!0},c={SaveDraft:{handler:function(){n.doSaveAndClose()}},DontSave:{handler:function(){n.header&&n.header.hideACWidget(),n.dirty="ForceClose",!n.hasHardDraft&&n.getDraftMID()&&e.use("mail-ui-proxyevents",function(){e.mail.ui.MailEventsProxy.handleUI({action:"delete"},"Draft",null,[{fid:"Draft",mid:n.getDraftMID(),force:!0}])}),n._closeAfterWarning(!1)}},Continue:{handler:function(){n.blockAutoSave=!1,n.cancelDialogLoad=!1,n._restoreFocus()}}},h=function(t){n.blockAutoSave=!0,t&&n.setFocus("to"),e.common.ui.DialogHelper.createCommon(l,c,function(e){e.set&&e.set("adAction","disableRetriggerOnOk")})};n.neoFire("composeEvent",{action:"showSaveDialog",sdcbk:e.bind(h,n),sdinline:n.type==="inlineCompose"})})}function M(){return this.draft.mid}function _(n){function o(){var t=e.common.Utils.features,n=t.enabled("NotificationsV2"),i=t.enabled("deleteDraftIcon"),s,o,u,a;r.getDraftMID()?e.use("mail-ui-proxyevents",function(){e.mail.ui.MailEventsProxy.handleUI({action:"delete"},"Draft",null,[{fid:"Draft",mid:r.getDraftMID(),force:!0}])}):i&&n&&r.dirty===!0&&(s=function(){},o={},a=[{fid:"Draft",mid:null,force:!0}],u=["Trash","Draft",a,null,"msg"],e.use("mail-ui-proxyevents",function(){e.mail.ui.MailEventsProxy.showMoveNotification(s,o,u)}))}var r=this,i=r.areAttachmentsPending(),s='<span id="{{btnID}}ModalOverlay" class="btn left right {{default}}"><a href="#" data-action="{{btnID}}">{{btnLabel}}</a></span>';if(!n){o();return}e.use("common-ui-dialog-helper",function(e){var n=t(s,{btnID:"Discard","default":"default",btnLabel:strings.str_comp_discard}),u=t(s,{btnID:"Continue","default":i?"default":"",btnLabel:strings.str_comp_keepwriting}),a=i?u+n:n+u,f=i?strings.str_comp_discard_attachmentprocessing:strings.str_comp_discard_confirm,l={modal_classes:"lg",hd:strings.str_comp_deletedraft,bd:f,ft:a,suppressRestoreFocus:!0},c={Discard:{handler:function(){r.header&&r.header.hideACWidget(),r.dirty="ForceClose",o(),r._closeAfterWarning(!1)}},Continue:{handler:function(){r.blockAutoSave=!1,r.cancelDialogLoad=!1,r._restoreFocus()}}},h=function(){r.blockAutoSave=!0,e.common.ui.DialogHelper.createCommon(l,c,function(e){e.set&&e.set("adAction","disableRetriggerOnOk")})};r.neoFire("composeEvent",{action:"showDeleteDraftDialog",sdcbk:e.bind(h,r)})})}function D(t){var n=this,r=n.baseNode&&n.baseNode.one(".attachment-button-attach"),i=n.baseNode&&n.baseNode.one("#rtetext");e.UA.gecko>0&&i&&(i.focus(),i.blur()),n.cancelDialogLoad=!0,n.hiliteCP&&n.hiliteCP.hide(),n.textCP&&n.textCP.hide();if(n.dirty==="ForceClose")return!0;var s=n.isDirty()||n.getDraftMID()&&!n.hasHardDraft&&!t,o=n.areAttachmentsPending();return o&&(s=n.dirty=1),n.get("isQuickReply")?n.doDiscardDraft(s):s?f.enabled("deleteDraftIcon")&&!o?n.doSaveAndClose():n.showSaveDraftDialog
():r&&r.fire("compose:close"),!s}var t=e.common.Utils.substitute,n=e.mail.Controller.ReplyProcessor,r=e.common.Utils,i=e.mail.model.DataStore,s=r.log,o=e.ui.Templates,u={reply_sender:strings.str_reply,reply_all:strings.str_reply,edit:strings.str_reply,forward:strings.str_forward},a=o._shared_module_compose_message_header_fresh,f=r.features,l=!1,c=function(n,r,h){var p=this,d=h&&h.showSubject;p.controller=r,p.header=new e.mail.Views.ComposeHeader(n,p),p.draft=n,p.isDraft=!p.draft.isFresh(),p.title=strings.str_comp_nosubject,p.parent=null,p.baseNode=null,p.compArea=null,p.loadingArea=null,p.type="compose",p.dirty=!1,p.focusNode=null,p.attachmentsLoading=[],p.attView=null,p.loadingTimer=null,p.allowEdit=!1,p.allowSend=!0,p.richFontInfo={fontFamily:null,fontSize:null},p.saveTimer=null,p.lastAutoSaveTime=new Date,p.hasHardDraft=!1,p.blockAutoSave=!1,p.lastSave=null,p.lastSaveType=null,p.isSending=!1,p.isRichText=null,p.isAutoSave=!1,i.Sessions.reset(),s("#SS: mailcompose init"),p.cancelDialogLoad=!1,p.contentLoaded=!1,p.stopwatch=h?h.stopwatch:null,p.origMsgFID=h?h.fid:null,p.suppressDialog=!1,l=f.enabled("rtePopoutToolbar"),l?p.formatTmpl=o._shared_module_rte_well_content_format_pop_out:p.formatTmpl=o._shared_module_rte_well_content_format_fresh,p.handles=[],p.autoSaveTimePeriod=(NeoConfig.autoSaveInSec||120)*1e3,p.formatters={page_well_email:function(){return t(o._shared_module_rte_well_tabs_compose.base,{},p.wellTabFormatters,null,strings,o)},page_well_format:function(){return t(p.formatTmpl.base,{},p.formatters,null,strings,o)},page_well_format_fresh:function(){return t(p.formatTmpl.base,{},p.formatters,null,strings,o)},page_well_emoticons:function(){return t(o._shared_module_rte_well_content_emoticons.base,{},p.formatters,null,strings,o)},page_well_attachments:function(){return t(o._shared_module_rte_well_content_attachments.base,{},p.formatters,null,strings,o)},quick_reply_card_actions:function(){if(f.enabled("deleteDraftIcon")){var e=p.parent&&p.parent.hasClass("quickReply");return e?null:t(a.quick_reply_card_actions,{},p.formatters,0,strings,o)}return t(a.quick_reply_card_actions,{},p.formatters,0,strings,o)},show_delete_draft_icon:function(){if(f.enabled("deleteDraftIcon"))return t(o._shared_module_compose_fresh_conv.show_delete_draft_icon,{},null,null,strings,o)},inConvReplyBucketBorder:function(){return f.enabled("convReplyBucket")?o._shared_module_compose_fresh_conv.inConvReplyBucketBorder:""},quickCompose:function(){if(p.get("isQuickReply"))return t(a.quickCompose,{},0,0,strings,o)},make_reply_all:function(){if(p.get("isQuickReply"))return;var e=p.draft.origin,n=e.action,r={title:n==="reply_all"||e.fid==="Sent"?strings.str_comp_btn_reply_sender:strings.str_comp_btn_reply_all};return n!=="reply_all"&&n!=="reply_sender"?"":t(a.make_reply_all,r,0,0,strings)},make_reply_all_qr:function(){var e=p.draft.origin,n=e.action,r={title:n==="reply_all"||e.fid==="Sent"?strings.str_comp_btn_reply_sender:strings.str_comp_btn_reply_all};return n!=="reply_all"&&n!=="reply_sender"?"":t(a.make_reply_all_qr,r,0,0,strings)},spellCheckEnabled:function(){return f.enabled("spellCheck")?t(p.formatTmpl.spellCheckEnabled,{},p.formatters,null,strings,o):""},is_rtl:function(){var e;return NeoConfig.bidi?(e=strings.str_tog_loadRTLCss?p.formatTmpl.is_rtl:p.formatTmpl.is_rtl_else,t(e,{},p.formatters,null,strings,o)):""},bidi:function(){return NeoConfig.bidi?t(p.formatTmpl.bidi,{},p.formatters,null,strings,o):""},page_compose_conversation:function(){return""},compose_from_address:function(){return t(a.compose_from_address,{},p.formatters,null,strings,o)},timestamp_id:function(){return(new Date).getTime()},fromSelected:function(e){return e.isDefault?' selected="selected" class="nsel"':""},fromAddress:function(e){return typeof e=="string"?e:typeof e=="object"&&typeof e.address=="string"?e.address:""},global_path_img:function(){return NeoConfig.globalPathImg+"/u/assets/img"},display_av_logo:function(){return NeoConfig.avLogoUrl?t(o._shared_module_rte_well_content_file_count.display_av_logo,{},p.formatters,null,strings,o):""},antivirus_logo_path_img:function(){return NeoConfig.avLogoUrl},page_compose_email_else:function(){return"hidden"},extraBottomMargin:function(){return l?o._shared_module_rte_well_content_attachments_well_fresh.extraBottomMargin:""},reply_type:function(){var e=p.draft.origin.action;return e?u[e]:strings.str_reply},smartscroll:function(){return e.common.Utils.features.enabled("smartscroll")?o._shared_module_compose_fresh_conv.smartscroll:""},intl_fonts:function(){function n(e,n){var r=o._shared_module_rte_well_content_fontnamesize_fresh;return t(r.intl_fonts,{},{font_value:function(){return e},font_name:function(){return n}},null,strings,o)}var r="";if(strings.str_cfg_intl_fonts){var i=e.JSON.parse(strings.str_cfg_intl_fonts);e.Array.each(i,function(e){r+=n(e.value,e.name)})}return r},show_formatter_well:function(){return l?"":t(o._shared_module_rte_well_fresh_conv.show_formatter_well,{},p.formatters,null,strings,o)},show_popout_toolbar:function(){return l?t(o._shared_module_rte_well_fresh_conv.show_popout_toolbar,{},p.formatters,null,strings,o):""},show_attachment_icon:function(){return NeoConfig.useAttComposerTT?t(o._shared_module_rte_well_fresh_conv.show_attachment_icon,{},p.formatters,null,strings,o):""},ca_icon:function(){return f.enabled("richcompose")&&(!p.get("isQuickReply")||f.enabled("richcomposeInQuickReply"))?t(o._shared_module_rte_well_fresh_conv.ca_icon,{},p.formatters,null,strings,o):""},bottomToolbar:function(){return t(o._shared_module_compose_fresh.bottomToolbar,{},p.formatters,null,strings,o)},subject_hidden:function(){return p.get("isQuickReply")&&!d?a.subject_hidden:""},less_than_IE10:function(){var n=e.UA.ie>0&&e.UA.ie<10;return n?t(a.less_than_IE10,{},p.formatters,null,strings,o):""},is_underline:function(){return NeoConfig.enableUnderline?t(p.formatTmpl.is_underline,{},p.formatters,null,strings,o):""},has_quote:function(){var e=p.draft.origin.action;if(NeoConfig.hasConv&&(e==="reply_sender"||
e==="reply_all"||e==="edit"))return t(o._shared_module_compose_message_body.has_quote,{},p.formatters,null,strings,o)},ca_active:function(){return f.enabled("richcompose")&&(!p.get("isQuickReply")||f.enabled("richcomposeInQuickReply"))?o._shared_module_compose_fresh_conv.ca_active:""}},c.superclass.constructor.call(p),p.addChild(p.header),p.header.on("HeaderBase:updateSubject",function(){p.neoFire("composeEvent",{action:"updateSubject"})}),p.header.on("HeaderBase:qrCancel",function(){p.neoFire("composeEvent",{action:"qrCancel"})})};e.extend(c,e.mail.ui.BaseWidget),e.mix(c.prototype,{NAME:"MailCompose",isDirty:p,_setDirty:y,_setClean:b,getHeader:function(){return this.header.getHeader()},_setHeader:function(e){this.header.setHeader(e)},areAttachmentsPending:v,resetSaveTimer:S,canClose:D,showSaveDraftDialog:O,doSaveAndClose:A,doDiscardDraft:_,getRichFontInfo:L,saveProgress:k,getDraftMID:M,_alertProblem:T,_invokeSaveDraft:C,save:N,_cancelSaveTimer:x,_closeAfterWarning:function(){},_registerFocus:m,_restoreFocus:g,_getTextMode:w,_setTextMode:E,confirm:d,ondestroy:h},!0),e.namespace("mail.Views").MailCompose=c},"1.0.0",{requires:["autocomplete_css","common-persist-user-data","mail-persist-meta-data","mail-controller-messages","mail-model-datastore","mail-controller-reply-processor","_shared_module_compose_message_header_fresh","mail-ui-mailcompose-base-header-v3","comms-utils","mail-ui-basewidget","editor-inline","mail-services-message-service","mail-error-v3","mail-common-utils-features"]});
YUI.add("_shared_module_compose_attach_item",function(A){A.namespace("ui.Templates");A.ui.Templates._shared_module_compose_attach_item={base:'<li role="presentation" class="disposition-{{disposition}}"> <span class="filename">{{filename}}</span> <div class="options"> <a class="remove" href="#">{{str_comp_remove}}</a> <a class="download" href="{{download_url}}"> {{str_comp_attach_btn_download}} <i class="icon icon-chevron-down" aria-haspopup="true"></i> </a> </div> <div class="progress-bar"> <span class="progress"> <span class="progress-content"></span> </span> </div></li>'};},"1.0.0");YUI.add("_shared_module_compose_thumbnail_item",function(A){A.namespace("ui.Templates");A.ui.Templates._shared_module_compose_thumbnail_item={base:'<li class="thumbnail-item disposition-{{disposition}}" role="presentation"> <div class="options"> <div class="remove icon icon-small-close"></div> <div class="download photo-overlay"> <a title="{{str_comp_attach_btn_download}}" href="{{download_url}}">{{str_comp_attach_btn_download}}<i aria-haspopup="true" class="icon icon-chevron-down"></i></a> </div> </div> <div class="progress-bar"> <span class="progress"> <span class="progress-content"></span> </span> </div></li>'};},"1.0.0");YUI.add("mail-services-attach-io",function(F){F.namespace("Mail.ComposeV3");function A(H){var G=[window.location.protocol+"//",window.location.host,"/ws/mail/v2.0/jsonrpc?","appid="+"YahooMailNeo","&m="+H,"&wssid="+NeoConfig.wssid,"&windowid="+NeoConfig.windowId,"&r="+new Date().getTime()].join("");return G;}function B(G){return{"fid":"Draft","aid":G.contentId(),"filename":G.file(),"mid":G.mid(),"pid":G.partId(),"size":G.size()};}function E(){var G=new Date();return"Attachments_"+G.getFullYear()+(G.getMonth()+1)+G.getDate();}function D(G,I,H){F.io(G,{method:"POST",data:F.JSON.stringify(I),headers:{"Content-Type":"application/json"},on:H});}var C={getDownLoadUrl:function(I){var J="VirusScanAttachments",G=A(J),H={"method":J,"params":[{"downloadInfo":[B(I)],"archiveName":E(),"archive":false}]};return new Promise(function(M,L){var K={"success":function(P,O){try{var N=F.JSON.parse(O.response||O.responseText).result.attachInfoResult[0];if(N.virusFound.length===0){M(N.downloadUrl);}else{L(Error("virusfound"));}}catch(Q){L(Q);}},"failure":function(N){L(N);}};D(G,H,K);});}};F.namespace("Mail.Services").AttachIO=C;},"1.0.0",{requires:["io","json-parse","json-stringify"]});YUI.add("mail-ui-tray",function(B){var E=B.common.ui.MenuHelper,A=B.Mail.Services.Plugins,L=B.common.Utils,I=L.substitute,P=L.escapeHtml,G=L.unescapeHtml,F=B.Mail.Services.AttachIO,D=B.ui.Templates._shared_module_compose_attach_item.base,M=B.ui.Templates._shared_module_compose_thumbnail_item.base,H="in-progress";function N(){this.isInternal=true;this.label=strings.str_comp_attachment_save_to_computer;this.iframes=[];}N.prototype={deleteIframe:function(){var R=0;for(R=0;R<this.iframes.length;R++){document.body.removeChild(this.iframes[R]);}this.iframes=[];},download:function(R){var S=this;S.deleteIframe();R.forEach(function(U){var T=document.createElement("iframe");T.src=U.url;T.width=0;T.height=0;T.style.display="none";document.body.appendChild(T);S.iframes.push(T);},this);},destroy:function(){this.deleteIframe();}};function O(R){this.model=R.model;this.container=R.container;this.filesView=R.filesView;this.thumbnailsView=R.thumbnailsView;this.localDownloader=new N();}O.prototype={constructor:O,render:function(){var R=this.model,S=this;if(R.attachments.length>0){this.container.removeClass("hidden");if(R.attachments.length>1){this.container.one(".attachments-header").removeClass("hidden");}R.attachments.forEach(this.sync,this);}this.filesView.removeClass("hidden");R.on("attachmentAdded",this.sync,this);this.container.one(".removeAll").on("click",function(T){T.preventDefault();R.attachments.forEach(function(U){U.setState("deleted");});this.fire("attachmentRemoved");},this);this.container.one(".avLogo").setStyle("display","inline");this._createMenu();A.on("added:attachmentDownloader",this._createMenu,this);this.container.one(".error").one(".dismiss").on("click",function(T){T.target.ancestor(".error").addClass("hidden");T.preventDefault();T.stopPropagation();});this.showMessageInfo=(function(T){var V=null,U;U=function(Y,W,X){if(!T.getDOMNode()){return;}X=X||10000;W=W||"";T.setContent(Y);if(Y===""){T.addClass("hidden");}else{T.removeClass("hidden");}if(V){clearTimeout(V);}V=setTimeout(function(){if(W===""){if(T&&T.getDOMNode()){T.addClass("hidden");}return;}U(W,"",2000);},X);};return U;}(this.container.one(".self-close-msg")));this.hidMessageInfo=function(){S.showMessageInfo("","",0);};R.on("stateChanged",B.bind(this.handleAttachmentProgress,this));},handleAttachmentProgress:function(V){var T=9999*1000,R=this.model.attachments,U=(V.next==="saving")&&(!!R)&&((R.filter(function(W){return(W.state()==="uploading"||W.state()==="pending");})).length),S='<span class="spinner">'+strings.str_comp_attach_upload_progress+"</span>";if(U){this.showMessageInfo(S,strings.str_comp_attach_reattach_failure_title,T);}else{this.hidMessageInfo();}},sync:function(W){var S,U=W.getThumbnailUrl(),R=window.URL||window.webkitURL;function X(Y,Z){var a=new Image();a.onload=function(){if(!Y.getDOMNode()){return;}var b=Y.getStyle("backgroundImage"),c;if(typeof(b)==="string"&&R){c=b.match(/url\((.+)\)|^(blob:.+)/);if(c){R.revokeObjectURL(c[1]||c[2]);}}Y.setStyle("backgroundImage","url("+Z+")");};a.src=Z;}if(W.isImage()){S=B.Node.create(I(M,{download_url:"#",disposition:(W.isInline())?"inline":"attachment"},0,0,strings));if(R&&W.file()){S.setStyle("backgroundImage","url("+R.createObjectURL(W.file())+")");}if(W.state()==="saved"||W.state()==="uploaded"){if(U){X(S,W.getThumbnailUrl());}}else{W.on("changedState",function(){if(!S.getDOMNode()){return;}if(this.state()==="saved"||this.state()==="uploaded"){X(S,this.getThumbnailUrl());S.removeClass(H);}});}this.thumbnailsView.append(S);}else{S=B.Node.create(I(D,{filename:P(G(W.getFilename())),download_url:"#",disposition:(W.isInline())?"inline":"attachment"},0,0,strings));this.filesView.append(S);}if(W.state()==="pending"||W.state()==="uploading"){S.addClass(H);}S.one(".remove").on("click",function(Y){Y.preventDefault();W.setState("deleted");this.fire("attachmentRemoved");},this);S.one(".download").on("click",function(Y){this._download(W,this.localDownloader);Y.preventDefault();},this);S.one('.download [aria-haspopup="true"]').on("click",function(Y){this._showDownloadMenu(Y.target,W);Y.halt();},this);function T(){var Y=this.container.one(".error");Y.removeClass("hidden");S.one(".remove").setStyle("display","block");S.one(".download").addClass("hidden");S.addClass("attach-fail");this.updateUI();}function V(){B.one("#attachment-button-input")&&B.one("#attachment-button-input").set("value","");}W.on("saved",V,this);W.on("failed",T,this);W.on("infected",T,this);W.on("deleted",function(){S.remove().destroy();this.updateUI();},this);W.on("progress",function(Z){if(!S.getDOMNode()){return;}var Y=S.one(".progress");if(Z<1){Z=100*Z;if(Y){Y.setStyle("width",Z+"%");}}else{S.removeClass(H);}});this.updateUI();},updateUI:function(){var T=this.container,R=this.model.attachments.filter(function(Z){return !Z.isInline();}),V=T.one(".attachments-header"),S=R.filter(function(Z){return Z.state()!=="deleted";}).length,Y=V.one(".info"),X,U,W="";if(S<1){Y.addClass("hidden");T.addClass("hidden");V.addClass("hidden");}else{if(S>1){Y.removeClass("hidden");}else{Y.addClass("hidden");T.removeClass("hidden");V.removeClass("hidden");}}T.one(".totalAttached").set("text",S);X=R.filter(function(Z){return Z.state()==="failed";});U=R.filter(function(Z){return Z.state()==="infected";});if(X.length===0&&U.length===0){this.container.one(".error").addClass("hidden");}else{if(U.length===1){W=strings.str_rte_attachments_virus_single;}else{if(U.length>1){W=I(strings.str_rte_attachments_virus_mult,{num_virus_files:U.length});}else{W=strings.str_comp_attach_upload_error;}}this.container.one(".error span").setContent(W);}if(this.container.scrollIntoView){this.container.scrollIntoView();B.fire("attachmentsChanged",this.container);}},showError:function(){this.container.one(".error").removeClass("hidden");this.updateUI();},destroy:function(){var R=this;if(R._menuContainer){R._menuContainer.remove(true);}if(R.localDownloader){R.localDownloader.destroy();}},_createMenu:function(){var S=this,R=A.get("attachmentDownloader");if(R.length===0){return;
}R.unshift(this.localDownloader);S._downloaders=R;if(S._menuContainer){S._menuContainer.remove(true);}S._menuContainer=B.Node.create('<div class="optionMenu"></div>');S._menuContainer.append(C(S._downloaders));B.one("body").append(S._menuContainer);},_showDownloadMenu:function(R,S){var T=this;E.create(R,{menu:T._menuContainer,blur:true},function(){T._menuContainer.on("menuSelected",function(U){T._downloadMenuOptionSelected(U.dataAction,S);});});},_download:function(S,R){var T=this;T.showMessageInfo(strings.str_comp_attach_scanning,strings.str_comp_attach_download_network_error);F.getDownLoadUrl(S).then(function(U){T.hidMessageInfo();return R.download([{filename:P(G(S.getFilename())),url:U}]);})["catch"](function(U){T.showMessageInfo(strings.str_error_DownloadError);});},_downloadMenuOptionSelected:function(R,S){this._download(S,this._downloaders[R]);}};function C(S){var R=S.map(function(U,T){return'<li role="presentation">'+'<a role="menuitem" data-action="'+T+'" tabindex="-1">'+U.label+"</a>";});R.unshift("<ul>");R.push("</ul>");return R.join("");}var J=true,K=null,Q={prefix:"attachmentsTray"};B.augment(O,B.EventTarget,J,K,Q);B.Tray=O;},"0.0.1",{requires:["node","comms-utils","event-custom","common-ui-menu-helper","mail-services-plugins","_shared_module_compose_attach_item","_shared_module_compose_thumbnail_item","mail-services-attach-io"]});YUI.add("mail-controller-html-processor",function(e){function t(){}e.mix(t.prototype,{_convertAmpersand:function(e){return e.replace(/&amp;/g,"&")},_addTrackingParams:function(e){var t=/^https?:\/\/[a-zA-Z]+\.yahoo\.*/,n=/^https?:\/\/.*\.yahoo\.co\.jp.*/,r=/^https?:\/\/[a-zA-Z]+\.tumblr\.*/,i=e.getDOMNode(),s,o,u,a;s=i.href,o=i.search;if(!n.test(s)&&(t.test(s)||r.test(s)))if(!o)s=i.origin+i.pathname+"?soc_src=mail&soc_trk=ma"+i.hash;else{o=o.substring(1),u=o.split("&"),o="";for(a=0;a<u.length;a++)u[a].indexOf("soc_src=")!==0&&u[a].indexOf("soc_trk=")!==0&&(o+=u[a]+"&");s=i.origin+i.pathname+"?"+o+"soc_src=mail&soc_trk=ma"+i.hash}return s},_processAnchors:function(e){var t=e.all("a"),n=this;return t.each(function(e){var t;try{t=e.get("href")}catch(r){t=""}typeof t=="string"&&(t=n._addTrackingParams(e),t=n._convertAmpersand(t),e.set("href",t))}),e},_insertEmptyLineBeforeQuotedText:function(t){var n=t.one(".yahoo_quoted"),r="qtdSeparateBR",i=r.length,s,o;n=n?n:t.one("div[class*='yqt']"),n&&(s=n.previous(function(e){return o=e.get("className"),o&&o.indexOf(r,o.length-i)!==-1}),!s&&n.insert(e.Node.create(e.ui.Templates._shared_module_compose_reply.forward_rich_body),"before"))},_expandQuotedText:function(e,t){var n,r,i;if(e.one(".yahoo_quoted")&&e.one(".yahoo_quoted").getStyle("display")!=="block"||t){n=e.one(".yahoo_quoted"),this._insertEmptyLineBeforeQuotedText(e),n&&n.setStyle("display","block");if(t)for(i=0;i<t.length;i++)r=e.one("."+t[i]+"yahoo_quoted"),r&&r.setStyle("display","block")}return e.get("innerHTML")},_removeControlCharacters:function(e){var t=e,n=/[\x01-\x08\x0B-\x0C\x0E-\x1F\x7F-\x84\x86-\x9F]/ig;return t=t.replace(n,""),t},_removeOriginalMessageDelimiter:function(e){var t=e;return t=t.replace("<!-- ORIGINAL -->",""),t},_removeCursor:function(e){var t=e;return t=t.replace(/<br\b([^>]*?)\bclass="yui-cursor"(.*?)>/ig,""),t},_removeParagraphTags:function(e){var t=e;return t=t.replace(/<p\b([^>]*)>/ig,"<div$1>"),t=t.replace(/<\/p\b[^>]*>/ig,"</div>"),t},_wrapWithUserFontInfo:function(e,t){var n=e;return n=["<html><body>",'<div style="color:',t.foreColor,"; background-color:",t.backColor,"; font-family:",t.fontFamily,";font-size:",t.fontSize,'">',n,"</div></body></html>"].join(""),n},process:function(t,n){var r=t,i=e.Node.create("<div>"+r+"</div>");return i=this._processAnchors(i),r=this._expandQuotedText(i,n),r=this._removeOriginalMessageDelimiter(r),r=this._removeControlCharacters(r),r=this._removeCursor(r),r=this._removeParagraphTags(r),r},wrap:function(e,t){return this._wrapWithUserFontInfo(e,t)}}),e.namespace("mail.Controller").HtmlProcessor=new t},"1.0.0",{requires:["_shared_module_compose_reply"]});
YUI.add("_shared_module_compose_dropzone",function(A){A.namespace("ui.Templates");A.ui.Templates._shared_module_compose_dropzone={base:'<div class="compose-droparea"> <div class="dropzone-text"> <span class="icon icon-attachment"></span> <span>{{str_comp_drag_here}}</span> </div></div>'};},"1.0.0");YUI.add("mail-captcha-turnkey-iframe",function(B){var A=B.namespace("Mail.Captcha.Turnkey").Iframe=function(E,C){this.el=document.createElement("iframe");var D=B.one(this.el);D.setAttribute("frameborder",0);D.setAttribute("scrolling",0);D.setAttribute("width",E);D.setAttribute("height",C);};B.mix(A.prototype,{cleanup:function(){this.el.parentNode.removeChild(this.el);},getDoc:function(){return this.el.contentDocument;},getBody:function(){return this.getDoc().body;},getHead:function(){return this.getDoc().head;},write:function(C){var D=B.common.Utils.unescapeHtml(C);D=D.replace(/http:\/\/l.yimg.com\//g,"https://s.yimg.com/");this.getDoc().write(D);},makeIframeContent:function(C){return""+"<html><head><style>"+(C.css||"")+"</style><script>"+(C.js||"")+"<\/script></head><body>"+(C.html||"")+"</body></html>";},exec:function(E){var C=Array.prototype.slice.call(arguments,1),D=this.getIn(E);if(typeof D!=="function"){throw new Error(typeof(D)+" is not a function");}return D.apply(this,C);},getIn:function(D,C){if(!D){return;}if(!C){C=this.el.contentWindow;}if(typeof D==="string"){D=D.split(".");}if(D.length===1){return C[D[0]];}var E=D.splice(0,1)[0];C=C[E];if(!C){return;}return this.getIn(D,C);},assocIn:function(E,D,C){if(!E){return;}if(!C){C=this.el.contentWindow;}if(typeof E==="string"){E=E.split(".");}if(E.length===1){C[E[0]]=D;return(C[E[0]]);}var F=E.splice(0,1)[0];C=C[F]||(C[F]={});return this.assocIn(E,D,C);}});},"0.0.1",{requires:["node","common-utils"]});YUI.add("mail-captcha-turnkey-view",function(E){var B=350,C=180,A='<div style="width:'+B+"px;height:"+C+'px;"></div>',F={X:50,Y:130};var D=E.namespace("Mail.Captcha.Turnkey").View=function(G){var H=this;this.markup=G.markup;this.script=G.script;this.css=G.css;this.el=document.createElement("div");this.yel=E.one(this.el);this.iframe=new E.Mail.Captcha.Turnkey.Iframe(B,C);this._onComplete=E.bind(this._onComplete,this);this._onReject=E.bind(this._onReject,this);this.content=G.content;E.Object.each(this.events,function(I,J){H.yel.on(J,E.bind(H[I],H));});};E.mix(D.prototype,{COMPLETE_CALLBACK:"YAHOO.CAPTCHA.hook.complete",REJECT_CALLBACK:"YAHOO.CAPTCHA.hook.reject",TEMPLATE:'<div class="captcha-iframe"></div>',events:{"click":"_submitHandler"},_submitHandler:function(){this.injectCallbacks();this.iframe.exec("YAHOO.CAPTCHA.hook");if(this.captchaDlg){this.captchaDlg.destroy();}},_createCaptchaDialog:function(I){var J=this,G={hd:strings.str_comp_captcha_modal_header,bd:A,centered:true},H={ok:{handler:I.okCallback,stopDestroy:true},cancel:{handler:I.cancelCallback,stopDestroy:false}};E.common.ui.DialogHelper.confirm(G,H,function(L){var K=L._parentNode.one(".modal-bd");L.set("width",I.width+"px");L.set("height",I.height+"px");L._parentNode.one(".modal").setStyle("width",I.width+"px");J.el.innerHTML=J.TEMPLATE;E.one(J.el).one(".captcha-iframe").appendChild(J.iframe.el);K.setContent("");K.appendChild(J.el);J.embedTurnkeyCaptcha();if(typeof(I.createdCallback)==="function"){I.createdCallback(L);}});},_createInvisibleCaptcha:function(){this.invisibleCaptchanNode=E.Node.create('<div class="invisible-captcha-node"></div>');this.invisibleCaptchanNode.appendChild(this.iframe.el);E.one("body").appendChild(this.invisibleCaptchanNode);this.embedTurnkeyCaptcha();this._submitHandler();E.all(".invisible-captcha-node").setStyle("display","none");},render:function(){var H=this,G={okCallback:E.bind(this._submitHandler,this),cancelCallback:function(I){H._reject(I);},width:(B+F.X),height:(C+F.Y),createdCallback:function(I){H.captchaDlg=I;}};if(H.content.Mode==="invisible"){H._createInvisibleCaptcha();}else{H._createCaptchaDialog(G);}},invoke:function(H,G){this._resolve=H;this._reject=G;},embedTurnkeyCaptcha:function(){var G=this.iframe.makeIframeContent({html:this.markup,css:this.css,js:this.script});this.iframe.write(G);},injectCallbacks:function(){this.iframe.assocIn(this.COMPLETE_CALLBACK,this._onComplete);this.iframe.assocIn(this.REJECT_CALLBACK,this._onReject);},cleanup:function(){this.el.parentNode.removeChild(this.el);},_onComplete:function(G){this._resolve(G);},_onReject:function(G){this._reject(G);}});},"0.0.1",{requires:["common-ui-dialog-helper","mail-captcha-turnkey-iframe","oop","node"]});YUI.add("mail-views-send-validation-error-handlers",function(e){function t(e){this.composeView=e}t.prototype={SEND_STATES:{ADDRESS_INVALID:"addInvld",ADDRESS_EMPTY:"addEmpty",SUBJECT_AND_CONTENT_INVALID:"sbCntInvld",SPAM_DETECTED:"spame"},_makeInvalidAddressMessage:function(t){return strings.str_comp_invalidAddressA+"<br><br>"+e.common.Utils.escapeHtml(t)+"<br><br>"+e.common.Utils.substitute(strings.str_comp_invalidAddressB,null,null,null,strings)},handleAddressInvalid:function(e){var t=strings.str_comp_title_invalidAddr,n=this._makeInvalidAddressMessage(e);this.composeView._alertProblem(t,n),this.composeView.lastSendState=this.SEND_STATES.ADDRESS_INVALID},handleNoRecipients:function(){var t=strings.str_comp_title_emptyToField,n=strings.str_comp_emptyToField;this.composeView._alertProblem(t,n),this.composeView._registerFocus(e.one("#to-field")),this.composeView.lastSendState=this.SEND_STATES.ADDRESS_EMPTY},handleTooManyRecipients:function(){var e=strings.str_comp_dialogheader,t=strings.str_comp_send_toomanyrecipients;this.composeView._alertProblem(e,t)},handleUploadInProgress:function(){var e=strings.str_comp_dialogheader,t=strings.str_comp_still_uploading;this.composeView._alertProblem(e,t)},handleBadAttachments:function(e){var t=e?strings.str_rte_attachments_alert_virus_title:strings.str_comp_dialogtitle_invalidSendAttachments,n=e?strings.str_rte_attachments_alert_virus:strings.str_comp_dialogbody_invalidSendAttachments;this.composeView._alertProblem(t,n)},handleEmptyMessage:function(t,n){var r=strings.str_modal_send_msg_title,i=strings.str_comp_invalidSubject,s=strings.str_comp_send,o=this;this.composeView.confirm(r,i,function(){t()},function(){n(),o.composeView.restoreAfterDialog(e.one("#subject-field"))},s),this.composeView.lastSendState=this.SEND_STATES.SUBJECT_AND_CONTENT_INVALID},handleSpame:function(){var e=strings.str_comp_title_spame,t=strings.str_comp_spame;this.composeView._alertProblem(e,t),this.composeView.lastSendState=this.SEND_STATES.SPAM_DETECTED},handleCaptcha:function(t,n,r){r.captchaAnswer=null;var i=r.captcha.captchaPayload.createResponse.Content,s=new e.Mail.Captcha.Turnkey.View({markup:i.Turnkey,script:i.Javascript.CONTENT,css:i.CSS.CONTENT,content:i});(new Promise(function(e,t){s.render(),s.invoke(e,t)})).then(function(e){r.captchaAnswer=e,t()})["catch"](n)},handleNewRecipients:function(t,n,r){var i=e.mail.Controller.ReplyProcessor,s=r.draft,o={to:s.to,cc:s.cc},u,a;u=i.getParentMsg(s,{fetchGDM:!0}),u.then(function(f){var l=new e.Mail.Models.Serializers.DraftGdmUnserializer,c={},h={},p,d,v;c.oMsg=f,c.action="reply_all",c.fid=e.common.Utils.getVal(s,"origin.parentMsg.fid"),p=i.getHeaderContent(c),d=i.matchRecipients(o,p),d.hasNewRecipients&&l.hasNonInlineAttachments(c.oMsg)?(a={ok:function(){e.fire("mt:click",{action:"cmps_dlg_attch_rply_ok"}),l.addNonInlineAttachments(s,f),r&&(r.attachOnSend=!0),t()},cancel:function(r){v=e.common.Utils.getVal(r,"item").hasClass("icon")&&e.common.Utils.getVal(r,"item").hasClass("close"),v?(e.fire("mt:click",{action:"cmps_dlg_attch_rply_cls"}),n()):(e.fire("mt:click",{action:"cmps_dlg_attch_rply_no"}),t()),t()}},h={hd:strings.str_comp_new_recipient_added,bd:strings.str_comp_new_recipient_body,suppressRestoreFocus:!0},e.common.ui.DialogHelper.confirm(h,{ok:{text:strings.str_comp_new_recipient_dialogue_ok_button,handler:a.ok},cancel:{text:strings.str_comp_new_recipient_dialogue_cancel_button,handler:a.cancel}})):t(f)},function(t){n(t)})}},e.namespace("mail.Views").SendValidationErrorHandlers=t},"1.0.0",{requires:["common-utils","node","mail-captcha-turnkey-view","mail-controller-reply-processor","mail-models-serializers-draft-gdm-unserializer"]});
YUI.add("mail-ui-composetictacapi",function(e){function o(e){var t=[],n=e.map(function(e,n){var r=e.label,i=e.className||"";if(i!=="parent-attach-file")return'<li class="'+i+'" role="presentation">'+'<a role="menuitem" data-action="'+n+'" tabindex="-1">'+r+"</a></li>";t.push(u(e))});return n.unshift("<ul>"),n.push("</ul>"),t.unshift(n.join("")),t.join("")}function u(e){var t=e.className,n=e.label,r=0;return'<ul><li class="'+t+'" role="presentation">'+'<a role="menuitem" data-action="attachFromParent" tabindex="-1">'+n+"</a></li> </ul>"}function a(e){var t=this;t._handles=[],t.editor=e,t.editor.once("ready",function(){s.get("composeEditor").forEach(t._plugEditorPlugin,t),t._handles.push(s.on("added:composeEditor",t._plugEditorPlugin,t))})}var t=e.common.ui.MenuHelper,n=e.mail.Controller.ReplyProcessor,r=e.common.Utils.features,i=e.common.Utils,s=e.Mail.Services.Plugins;a.prototype={render:function(e){var t=this;t._parent=e,t._renderMenu(),t._handles.push(s.on("added:composeUploader",t._renderMenu,t))},bindUI:function(){},destroy:function(){var e=this;e._menuContainer&&(e._menuContainer.remove(),e._menuContainer.destroy(!0)),e._handles.forEach(function(e){e.detach()})},_plugEditorPlugin:function(e){var t=this;e.getPlugin().then(function(e){t.editor.getRTE().plug(e)})},_attachFromComputerMenuitem:function(){var e=this;return{label:strings.str_comp_attachment_from_computer,className:"menu-attach-file",choose:function(){return window.setTimeout(function(){e._parent.one("#attachment-button-input").getDOMNode().click()},1),Promise.resolve([])}}},_showIncludeOriginalAttachOptn:function(t){var r=this,s=i.getVal(r,"editor.composeView.draft"),o=i.getVal(r,"editor.composeView.draft.origin"),a=i.getVal(o,"action"),f,l,c,h,p,d;c=e.common.Utils.getVal(s,"attachments"),c.forEach(function(e){e.isInline()||(l=!0)}),a==="edit"&&!l&&(d=s.makeInReplyTo(),i.getVal(d,"replied")&&(a="reply_sender")),p=n.getParentMsg(s,{fetchGDM:!1}),p.then(function(n){var i=0,s=n.attachments,o;if(!n)return;for(i=0;i<s.length;i++){o=s[i];if(o.disposition!=="inline"&&o.referencedInline!==!0){h=!0;break}}r._menuContainer&&(!l&&h&&a==="reply_all"||a==="reply_sender")&&(t.push(r._includeParentAttachment()),r._menuContainer.append(u(r._includeParentAttachment())))},function(t){})},_includeParentAttachment:function(){var t=this,r=i.getVal(t,"editor.composeView.controller"),s;return{label:strings.str_comp_attach_parent,className:"parent-attach-file",attachmentHandler:function(){var i=t.editor.rte.composeView.draft;s=n.includeAttachment(i,{fetchGDM:!0}),s.then(function(){var n=e.one(".parent-attach-file");n&&(n.addClass("disabled"),r.attachInReply=!1),Promise.resolve([])},function(){Promise.reject([])})}}},_renderMenu:function(){var n=this,u=i.getVal(n,"editor.composeView.draft.origin");n._uploaders=s.get("composeUploader");if(n._uploaders.length===0)return;window.FormData&&window.FileReader&&n._uploaders.unshift(n._attachFromComputerMenuitem()),r.enabled("attachInReply")&&e.common.Utils.getVal(u,"parentMsg.flags.hasAttachment")&&n._showIncludeOriginalAttachOptn(n._uploaders),n._menuContainer&&(n._menuContainer.remove(),n._menuContainer.destroy(!0)),n._menuBtn=n._parent.one(".attach-btn-menu"),n._menuBtn.removeClass("hidden"),n._menuBtn.on("click",function(r){t.create(r.currentTarget,{menu:n._menuContainer,blur:!0},function(){r.preventDefault(),n._menuContainer.on("menuSelected",function(t){var r,i=n._uploaders.length;t.dataAction==="attachFromParent"?(r=e.one(".parent-attach-file"),r&&!r.hasClass("disabled")&&(e.fire("mt:click",{action:"cmps_attchReply_mnu"}),n._uploaders[i-1].attachmentHandler())):n._uploadMenuOptionSelected(t.dataAction)})})}),n._menuContainer=e.Node.create('<div class="optionMenu"></div>'),n._menuContainer.append(o(n._uploaders)),e.one("body").append(n._menuContainer)},_uploadMenuOptionSelected:function(e){var t=this,n=t._uploaders[e];n.choose().then(function(e){t.editor.getRTE().fire("cardify",e.cardInfo,e.type)},function(){})}},e.namespace("mail.Views").ComposeTictacApi=a},"1.0.0",{requires:["event-custom","common-ui-menu-helper","mail-services-plugins","mail-controller-reply-processor","mail-common-utils-features"]});
YUI.add("rte-file-utils",function(B){var A={dragObjContainsFiles:function(C){var D=0;if(C.dataTransfer.types){for(D=0;D<C.dataTransfer.types.length;D++){if(C.dataTransfer.types[D]==="Files"){return true;}}}return false;},dragObjContainsOnlyImages:function(C){var E=0,D;if(C.dataTransfer&&C.dataTransfer.types&&(C.dataTransfer.items||C.dataTransfer.files)){D=(C.dataTransfer.items||C.dataTransfer.files);for(E=0;E<D.length;E++){if(D[E].type.indexOf("image")!==0){return false;}}}else{return false;}return true;},dragShouldShowDropzone:function(C){var D=0;if(C.dataTransfer.types){for(D=0;D<C.dataTransfer.types.length;D++){if(C.dataTransfer.types[D]==="Files"||C.dataTransfer.types[D]==="showdroptarget"){return true;}}}return false;},getFilteredFile:function(C,D){var F=(C.dataTransfer&&C.dataTransfer.files)||[],E=[];F=[].slice.call(F);E=F.filter(function(G){switch(D){case"image":return(G.type.indexOf("image")>=0);case"nonimage":return(G.type.indexOf("image")<0);default:return true;}});return E;},inlineImageEnabled:function(){return(window.FileReader&&window.URL&&B.mail.Core.feature("inlineimage").isOn()&&B.mail.Core.feature("ymrte").isOn()&&B.mail.Core.feature("composev3").isOn());},canProcessImage:function(C){if(C.dataTransfer&&C.dataTransfer.types&&window.FileReader&&window.URL){return true;}return false;},doesClipboardContainFiles:function(C){var D=C.clipboardData&&C.clipboardData.types;if(!(D&&D.length>0)){return false;}D=Array.prototype.slice.call(D,0);if(D&&D.indexOf("Files")>=0){return true;}return false;},getFileFromDataURI:function(H){var E=H.match(/^data:(.+)?;(.+?),/),G,C,J,D,K,I,F;if(!E||!window.atob){return null;}J=H.split(",")[1];if(E[2]==="base64"){G=atob(J);}else{G=window.unescape(J);}I=G.length;C=E[1];D=new Uint8Array(I);for(K=0;K<I;K++){D[K]=G.charCodeAt(K);}F=new Blob([D],{type:C});F.name="datauri-file."+C.substring(6);return F;},getFilesfrmDragObj:function(C){return C.dataTransfer.files||[];},getImageFilesfrmClipBoard:function(C){var F=0,G=[],E,D;D=C.clipboardData.items||C.clipboardData.files;for(F=0;F<D.length;F++){E=(D[F].getAsFile)?D[F].getAsFile():(D[F]);if(E&&E.type.indexOf("image")>=0){E.name="blob.jpg";G.push(E);}else{return[];}}return G;}};B.namespace("mail.rte").fileUtil=A;},"0.0.1",{requires:[]});YUI.add("mail-ui-fullcompose-v3",function(e){function S(t){var n=this,r,i;n.composeViewRendered&&(n.isDraft?r="draft":(i=n.draft&&n.draft.get&&n.draft.origin,r=i?i.action:null),r=r||"new",e.Lang.later(90,null,function(){n.neoFire("composeEvent",{action:"darlaEvent",type:"compose_"+r})})),t.cbk&&t.cbk()}function x(e){var t=this;t.get("isQuickReply")||t.header.hideACWidget(),t.dirty&&t.dirty!=="ForceClose"&&NeoConfig.saveOnHideCompose&&(t.isAutoSave=!0,t.save()),t.hiliteCP&&t.hiliteCP.hide(),t.textCP&&t.textCP.hide(),e.cbk&&e.cbk()}function T(){var e=this,n=e.baseNode,r=n.one(".cm-subject-field"),i=n.one("input.cm-subject-field");return i.ancestor("div").removeClass(v),{subjectVal:t(r.get("value")),subjectDir:NeoConfig.bidi?r.getStyle("direction"):null}}function N(){var t=this,n=t.draft,r=t.closeSrc,i,s=n.origin;s&&s.action!==null?s=s.action:s="new",i={action:"cmps_tab_cls",append:{t1:"cmpsTb",ltxt:s,cmpsType:t.get("isQuickReply")?"QR":"fullCmps"}};switch(r){case"closeBtn":break;case"escKey":i.append.actn="keybrd";break;case"cancelBtn":i.action="tlbr_cancelcompose"}t.set("close",1),e.fire("mt:click",i)}function C(){var t=this,n=t.attComposer,r;t.blockSave=!0,t.saveTimer&&t.saveTimer.cancel(),t.resizeRTEDelayTimer&&t.resizeRTEDelayTimer.cancel(),t._clearOriginTimers(),t.hiliteCP&&t.hiliteCP.hide(),t.textCP&&t.textCP.hide(),!e.Lang.isNull(t.spellCheckView)&&!e.Lang.isUndefined(t.spellCheckView)&&t.spellCheckView.destroy(),t.spellCheckView=null,n&&(n.cleanup(),t.attComposer=null),t.tray&&t.tray.destroy(),r=t.rteFormatter,r&&(r.fontFamilyOptions&&r.fontFamilyOptions.remove().destroy(!0),r.fontSizeMenu&&r.fontSizeMenu.remove().destroy(!0),r.fontNameMenu&&r.fontNameMenu.remove().destroy(!0),r.formatButtons&&r.formatButtons.remove().destroy(!0),r.fontColorMenu&&r.fontColorMenu.remove().destroy(!0),r.textIndentation&&r.textIndentation.remove().destroy(!0),r.textAlignment&&r.textAlignment.remove().destroy(!0),r.textLists&&r.textLists.remove().destroy(!0),r.emotionMenu&&r.emotionMenu.remove().destroy(!0)),t.rtSwitch=null,t.baseNode&&(e.each(t.handles,function(e){e.detach()}),t.handles=null,t.baseNode.remove().destroy(!0)),t.composeTictacApi.destroy(),t.rteFormatter&&(t.rteFormatter.destroy(),t.rteFormatter=null),t.header=null,t.formatters=null,t.container=null,e.fire("compose:rte:blur"),E.superclass.ondestroy.call(this,arguments)}function k(){var e=this,t,n=e.baseNode.one(".ac-input.focus .recipient-input input");n&&e.header._lozengeIt(n),t=e.baseNode.all(".compose-header .field .hLozenge");if(t.size()>100){this._warnTooManyRecipients();return}e._invokeSend(!0)}function L(){var e=this;e._cancelSaveTimer(),e.controller.send()}function A(){e.use("common-ui-dialog-helper",function(){a.ui.DialogHelper.alert({hd:strings.str_comp_dialogheader,bd:strings.str_comp_send_toomanyrecipients,suppressRestoreFocus:!0},{ok:{handler:function(){}},cancel:{handler:function(){}}})})}function O(t){if(!this.dropzone){var n=c(h._shared_module_compose_dropzone.base,{},0,0,strings);this.dropzone=e.Node.create(n),t?(this.baseNode.one(".footer-separator").appendChild(this.dropzone),this.baseNode.one(".footer-separator").setStyles({position:"relative",maxHeight:"200px"}),this.baseNode.one(".bottomToolbar").removeClass("smartFixed")):this.baseNode.appendChild(this.dropzone)}}function M(){this.dropzone&&(this.dropzone.remove(),this.dropzone=null,o.inlineImageEnabled()&&(this.baseNode.one(".footer-separator").setStyles({position:null,maxHeight:null}),this.doResizeRTE(),e.fire("recalculateScrollToRepositionSend")))}function _(e){var t=e.cloneNode(!0),n=e.parentNode;return t.value=null,n.replaceChild(t,e)}function D(){var t=this,n=t.draft,r=t.handles,s;t.attachIcon=t.baseNode.one(".attachment-button-attach"),NeoConfig.backButtonFull||e.fire("initPage"),r.push(t.editor.on({keyDown:function(n){var r=!1;e.fire("HoverCard:hideHoverCard");if(n.ctrlKey||n.metaKey||n.altKey||n.shiftKey||n.keyCode===27)r=t.get("keydownHandler")?t.get("keydownHandler")(n):t.onKeyDown(n);r?n.halt():(t._setDirty(),t.uploadFormDirty&&H(t),setTimeout(function(){t.get("isQuickReply")&&t.resizeRTE()},0))},focus:function(n){t._registerFocus(n.editor),t.header._removeLozengeHighlights(),e.fire("compose:rte:active",{editor:n.editor,cv:t})},blur:function(n){e.fire("compose:rte:blur",{editor:n.editor,cv:t})},nodeChange:function(e){e&&(e.type==="paste"||e.type==="drop"||e.type==="undoLoadState")&&t._setDirty()},ready:function(){t.postRender(),t.focusNode&&t.setFocus(t.focusNode)}})),r.push(n.on("compose:restoreFocus",function(){t.focusNode instanceof e.Node?t._restoreFocus():t.setFocus("body",0,1)},t)),r.push(t.baseNode.delegate("click",function(n){var r=n.currentTarget,i=r.get("parentNode"),s=i.hasClass("cc-btn")?"cc":"bcc",o=i.get("id");n.halt(!1);var u=o==="btn-show-"+s+"-in-to"||o==="btn-show-"+s+"-in-cc",a="cmps_"+(u?"shw"+s:"hd"+s);t.header._cmdBccSwitch(u,"bcc"),t.header._cmdBccSwitch(u,"cc"),e.fire("mt:click",{action:a,append:{t1:"cmpsTb"}}),t._restoreFocus()},"span.cc-btn a, span.bcc-btn a")),r.push(t.compArea.on("click",function(n){"quoted-text"===n.target.getAttribute("data-action")&&(t._expandQuotedReply(),e.fire("mt:click",{action:"cmps_qtd_txt"}))})),r.push(t.baseNode.delegate("click",function(){t._clearOriginTimers(),t._displayLoading(),i.fetchOrigin(n,t.isDraft,t._getTextMode())},"a.retryOrigin")),t.on("renderComplete",function(){t.contentLoaded=!0,e.use("mail-controller-sendconfirm","mail-ui-sendconfirmview-base-conv",function(){})}),t._addFocusListenersFresh(),r.push(t.baseNode.on("keydown",function(e){var n,r=e.target;e.keyCode===13&&r.ancestor("div.rte-well-container")&&(e.halt(),t.focusNode=r,n=r.one("b"),n&&n.simulate("click"))})),r.push(t.baseNode.delegate("click",function(e){var n=f.getDataAction(e).action;t.handleComposeAction(n,e)},".bottomToolbar > span")),r.push(t.baseNode.delegate({click:function(){H(t)},focus:function(){var e=t.baseNode.one("#attachment-button-input");e.ancestor("span").addClass("focused")},blur:function(){var e=t.baseNode.
one("#attachment-button-input");e.ancestor("span").removeClass("focused")},change:function(){var e=this.getDOMNode();window.FormData&&window.FileReader?t.fire("attachmentUpload",{files:[].slice.call(e.files)}):e.value!==""&&(this.uploadFormDirty=!0,t.fire("attachmentUploadForm",{inputEl:e}))}},"#attachment-button-input")),t.baseNode.one(".attachments-pane").removeClass("hidden"),r.push(t.baseNode.on("drop",function(e){var n=e._event.dataTransfer.files;n&&n.length&&t.fire("attachmentUpload",{files:[].slice.call(n)})})),s={dragover:function(n){var r=o.inlineImageEnabled();if(e.Array.indexOf(n._event.dataTransfer.types,"Files")>=0||e.Array.indexOf(n._event.dataTransfer.types,"showdroptarget")>=0)clearTimeout(t._dragTimer),t._showDropzone(r);n.preventDefault()},dragleave:function(e){var n=window.innerWidth,r=window.innerHeight,i=e.clientX,s=e.clientY;i<=0||i>=n||s<=0||s>=r?t._hideDropzone():(clearTimeout(t._dragTimer),t._dragTimer=setTimeout(function(){t._hideDropzone()},300))},drop:function(n){t._hideDropzone(),e.fire("dropHandled"),n.preventDefault()}},window.FileReader&&r.push(e.one("body").on(s)),r.push(e.on("dropHandled",function(){t._hideDropzone()})),r.push(e.on("windowresize",function(){t.resizeRTE()})),t._showSendBtn(!1),t.composeTictacApi.bindUI()}function P(){var t=this.baseNode.one(".attachment-button-form"),n=t.one("#jsonString"),r=2,i=this.draft.attachments.filter(function(e){return e.state()==="pending"}),s=JSON.parse(this.draft.jsonify({iframeUpload:{multipartName:"uploadfile"}}));s.actions.responseContentType="text/plain",i.forEach(function(e){e.setPartId(r),r++,e.setProgress(.5)}),n||(n=e.Node.create('<input type="hidden" name="jsonString" id="jsonString">'),t.insertBefore(n,t.get("firstChild"))),n.set("value",JSON.stringify(s)),this.draft.formId=t.get("id")}function H(e){var t=e.baseNode.one(".attachment-button-form");t&&t._node.reset(),e.uploadFormDirty=!1}function B(e){e?this.neoFire("composeEvent",{action:"showSendBtn"}):this.neoFire("composeEvent",{action:"hideSendBtn"})}function j(){var e=this,t=e.rteFormatter,n=e.handles;t.bindUI(),n.push(t.on("formatter:action",function(t){e._setDirty(),e._setComposePreference(t.act,t.val)})),n.push(e.after("isRichTextChanged",function(){e.editor.set("isRich",!NeoConfig.low_bandwidth&&e.isRichText),e.rteFormatter&&e.rteFormatter._switchEditMode(e.isRichText)})),e._intlBindUIRTE()}function F(){var t=this,n=l.enabled("spellCheck"),r,i,s,o;r=t.rteFormatter=new e.mail.ui.RTEFormatter({isBidi:NeoConfig.bidi,isSpellCheckEnabled:n,editor:t.editor,globalPathImage:t.formatters.global_path_img()}),r.renderUI(t.baseNode.one(".rte-well-container")),r._switchEditMode(t._isRTEActive()),t._bindWellUIFresh(),i=t.richFontInfo.fontFamily,s=t.richFontInfo.fontSize,s&&(o=parseInt(s.replace("pt",""),10),o=e.Array.indexOf(g,o),o>=0&&(r.selectedFSIndex=o+1)),r.selectedFNIndex=i,n&&t._initializeSpellCheck(),t._bindTextSwitchFresh()}function I(){var t=this,n,r,i=t.getRTEDocNode(),s=t.compArea.one(".compose-quoted-text"),o=i.one(".yahoo_quoted"),u=t.quotedTextBody,a;i.append(t.quotedTextBody),t.quotedTextBody="",p._insertEmptyLineBeforeQuotedText(i),o&&o.setStyle("display","block"),n=f.getVal(t.draft.origin,"yqtdPrefix");if(n)for(r=0;r<n.length;r++)a=t.getRTEDocNode().one("."+n[r]+"yahoo_quoted"),a&&a.setStyle("display","block");s&&s.remove(),e.fire("processedEditorHtml",{processHtml:function(t){var r=e.Node.create("<div>"+t+u+"</div>");return p._expandQuotedText(r,n)},rteNode:i}),e.fire("recalculateScrollToRepositionSend"),t.resizeRTE()}function q(){var e=this;e.hasRTEFormatter&&e.initializeRTEFormatter(),e.baseNode.one(".attachments-pane").addClass(d)}function R(){}function U(t){var n=this,r,s;if(t){n.parent=t,r=c(h._shared_module_compose_fresh_conv.base,n.draft,n.formatters,null,strings,h),t.append(r),n.baseNode=t.one(".compose"),n.get("isQuickReply")||(n.baseNode.addClass("full-compose"),n.baseNode.addClass("content")),n.compArea=n.baseNode.one("div.compose-message").one("div.inner"),n.loadingArea=n.compArea.one("div.msg-loadingpane"),n.footer=n.baseNode.one(".footer-separator");var o=i.getDefaultFontInfo(!n._isRTEActive());n.richFontInfo.fontFamily=o.fontFamily,n.richFontInfo.fontSize=o.fontSize,s=n.baseNode.one("div.cm-plaintext"),s&&s.get("parentNode").removeChild(s),e.UA.gecko&&n.compArea.ancestor("td").setStyle("height","0"),n.header.enableHeader(!1),n._renderWellsFresh(),n.bindUI(),n.header.render(),n.header.bind(),n.composeViewRendered=!0,n.editor.render(n.baseNode);var u=n.baseNode.one(".attachments-well");z(this,u)}}function z(t,n){t.tray=new e.Tray({model:t.draft,container:n,filesView:n.one(".file-attach"),thumbnailsView:n.one(".thumbnails-attach")}),t.tray.on("attachmentRemoved",function(){t._setDirty(),t.save()}),t.tray.render()}function W(){var e=this,t=e.footer.getY();e.footer.setStyles({position:"fixed",top:t+"px"})}function X(){NeoConfig.tabs&&!NeoConfig.hasConvView?(this.resizeRTEDelayTimer&&this.resizeRTEDelayTimer.cancel(),this.resizeRTEDelayTimer=e.later(300,this,this.doResizeRTE)):this.doResizeRTE()}function V(){var t=this,n,r=0,i,s=0,o,u,a=l.enabled("richcompose"),f=a?500:300,c=953,h=t.baseNode.one("div.attachments-well");s=h?h.getStyle("height"):0,s=s==="auto"?0:parseInt(s,10),i=e.one("body").get("offsetHeight");if(t.get("close"))return;if(!t.get("isQuickReply")){n=parseInt(t.compArea.getY(),10),i=e.one("body").get("offsetHeight"),o=i-n-w-10;var p=o-.2*i;p>f&&(p=f);if(l.enabled("fullheightcompose")||a&&i<=c)p=o,r=20,t.baseNode.one("#to").addClass("fullheight-input"),t.baseNode.one("#cc").addClass("fullheight-input"),t.baseNode.one("#bcc").addClass("fullheight-input");t.compArea.setStyles({maxHeight:o+"px",minHeight:p+"px"}),u=p-s-r>0?p-s-r:0,t.editor.rteArea.setStyles({minHeight:u+"px"})}else if(!NeoConfig.smartscroll){parseInt(t.baseNode.getStyle("height"),10)>t.maxHeight&&(t.maxHeightFn&&(t.maxHeight=t.maxHeightFn()),t.compArea.setStyles({maxHeight:t.maxHeight-parseInt(t.header.hdr.getStyle("height"),10)-w+"px"}));var d=t.baseNode
.get("parentNode").get("offsetTop")-t.containerNode.get("scrollTop")+parseInt(t.baseNode.getStyle("height"),10)+6-t.containerNode.get("offsetHeight");d>0&&t.containerNode.set("scrollTop",t.containerNode.get("scrollTop")+d)}}function $(){function i(i){var s=i.params,o,u,a,f,l={format:1};if(!l.hasOwnProperty(s.tab))return;if(!t.baseNode)return;s.tooltip=s.tooltip||"";if(s.tab!=="format")return;u=s.name||"Stationery",a='<span class="btn menu" data-app="'+i.appInstance+'">'+'<a class="icon '+u+'" href="#" title="'+s.tooltip+'">'+'<i role="presentation" class="plaintext">'+s.label+"</i></a></span>",f=n(a);try{t.baseNode.one("."+s.tab+"-pane").one(".om-buttons").append(f)}catch(c){}o=e.stamp(f),r.push(f.on("click",function(e){e.preventDefault(),i.handler(o,t)})),r.push(e.on("om:click_btn",function(e){if(!e.app||!e.app.instance||!e.tab)return;i.appInstance===e.app.instance&&i.handler(o,t)}))}var t=this,r=t.handles;e.each(u,i),r.push(e.on("om:compose_add_btn",function(){i(u[u.length-1])}))}function J(t,r,i){var s=this,o=s.handles,u=n('<ul class="om-buttons"></ul>'),a=s.baseNode.one("div.rte-well-container");e.UA.ie===0&&(u.appendChild(t),a.addClass("largefiles")),e.Tictac&&e.Tictac.flickr&&(u.appendChild(i),o.push(i.on("click",function(t){e.fire("mt:click",{action:"cmps_attflk",append:{t1:"cmpsTb"}}),t.preventDefault()})),a.addClass("largefiles")),e.Tictac&&e.Tictac.dropbox&&(u.appendChild(r),o.push(r.on("click",function(t){e.fire("mt:click",{action:"cmps_attlgfl",append:{t1:"cmpsTb"}}),t.preventDefault()})),a.addClass("largefiles")),s.attComposer&&(s.attComposer.attachLargeBtn=u),o.push(e.on("om:click_btn",function(e){if(!e.app||!e.app.instance||!e.tab)return}))}function K(){var t=this,n,r,s,o,u,a,f=t.draft;t._bindDraft(),t._isOrigin()?(t.slowOriginReqTimer=setTimeout(function(){t._handleSlowOriginRequest()},b),t.loadingTimer=setTimeout(function(){t._displayLoading()},y),t.editor.hideArea(),i.fetchOrigin(f,t.isDraft,t._getTextMode(),t.stopwatch),t.isDraft?t.hasHardDraft=!0:(s=f.origin,e.Lang.later(90,null,function(){t.neoFire("composeEvent",{action:"darlaEvent",type:"compose_"+s.action})})),n=f.origin.oMsg,r=n&&n.header&&n.header.to,a=n&&n.header&&n.header.xapparentlyto,t.header.setReplyFrom(r,a),o=n.header?n.header.from:n.from,o&&t.isDraft&&e.later(10,t,function(){t.header._setFromMenu(o)})):(t.header.setHeader(f),u=f.cc&&f.cc.length>0||f.bcc&&f.bcc.length>0,t._allowEditing(f.body.html,u),t.dirty=t.controller.isPopulated()?!0:!1,e.later(0,t,wt,[f.to&&f.to.length>0?"body":"to"]),t.neoFire("composeEvent",{action:"darlaEvent",type:"compose_new"})),t._initOpenMailButtons(),e.fire("FullCompose:fullComposeReady",{rte:t.editor,rteActive:t._isRTEActive(),context:t}),e.fire("compose-stat:fullComposeReady"),e.fire("read-stat:draftRendered"),!NeoConfig.smartscroll&&t.get("isQuickReply")&&t.compArea.setStyles({minHeight:"150px",maxHeight:t.maxHeight-parseInt(t.header.hdr.getStyle("height"),10)-w-6+"px"}),t.resizeRTE()}function Q(){function i(){var t;if(r[e.rteTabIndex]==="#switchtext-plain"||r[e.rteTabIndex]==="#switchtext-rich")return n.one(r[e.rteTabIndex]);if(!e._isRTEActive()&&r[e.rteTabIndex]===".attach-btn-menu a")return e.rteTabIndex=r.length-1,n.one(r[e.rteTabIndex]);do t=n.one(r[++e.rteTabIndex]);while(!t||t.ancestor().hasClass(d)||t.ancestor().getStyle("display")==="none");return t}function s(){var t;if(e.rteTabIndex===0)return n.one(r[e.rteTabIndex]);if(!e._isRTEActive()&&r[e.rteTabIndex]==="#switchtext-plain")return e.rteTabIndex=1,n.one(r[e.rteTabIndex]);do t=n.one(r[--e.rteTabIndex]);while(!t||t.ancestor().hasClass(d)||t.ancestor().getStyle("display")==="none");return t}function o(t){var n,r,o=e.baseNode.one(".attachments-pane");switch(t.keyCode){case 9:t.shiftKey||(n=e.baseNode.one(".attachments-well"),n&&!n.hasClass(d)?(r=n.one('li.attachmentVisible span.left a[tabIndex="0"]'),r||(r=n.one("li.attachmentVisible span.left a"),r&&r.set("tabIndex",0))):(t.target.blur(),e.setFocus("body"),t.halt()));break;case 13:case 32:t.target!==o?t.target._node.click():t.target.one("input")&&t.target.one("input")._node.click();break;case 37:t.target&&t.target.set("tabIndex",-1),r=s(),r&&r.set("tabIndex",0),r.focus();break;case 39:t.target&&t.target.set("tabIndex",-1),r=i(),r&&r.set("tabIndex",0),r.focus();break;default:}}var e=this,t=e.handles,n=e.baseNode.one("div.rte-well-container"),r=[".attachments-pane","#btn-fontname","#btn-fontsize","span.bold","span.italic","span.underline","#btn-forecolor","#btn-backcolor","#btn-insertunordered","#btn-insertnumbered","#btn-outdent","#btn-indent","span.align-l","span.align-c","span.align-r","#links","#emoticon","span.Stationery","#spellCheck","#btn-spell-langs","#switchtext-plain","#switchtext-rich"];t.push(n.delegate("keydown",o,'div.attachments-pane, span[role="button"]'))}function G(t){var n=this,r=t.keyCode,i=(t.ctrlKey||t.metaKey)&&!t.altKey&&!t.shiftKey,s=e.UA.os,o=t.ctrlKey&&(s==="linux"||s==="windows"||s==="win")||t.metaKey&&(s==="macintosh"||s==="mac"),u,a;switch(r){case 27:a=e&&e.one(".btn-close-msg"),a&&a._node.click();break;case 85:o&&t.shiftKey&&!e.UA.ie&&(!e.UA.gecko||e.UA.gecko>1.92)&&(u=n.baseNode.one(".attachments-pane input"),u._node.click(),t.halt());break;case 13:if(o&&!t.altKey){var f={spid:"sent",append:{t1:"cmpsTb",actn:"keybrd",cmpsType:n.get("isQuickReply")?"QR":"fullCmps"},action:"tlbr_send"};return n.lastSendState&&(f.append.ltxt=n.lastSendState),e.fire("mt:click",f),n.send(),t.frameEvent&&t.frameEvent.halt(),t.halt(),!0}if(t.target.get("nodeName")==="A")return t.target.simulate("click"),!0;break;case 65:i&&n._expandQuotedReply();break;case 83:if(i)return n.isAutoSave=!1,n.save(),t.frameEvent&&t.frameEvent.halt(),t.halt(),!0;break;case 88:if((t.ctrlKey||t.metaKey)&&t.shiftKey&&!t.altKey)return t.frameEvent.halt(),NeoConfig.bidi&&(n.editor.invokeCommand("swapdir",null),n.fire("formatter:action",{act:"swapdir",val:null})),!0;break;case 89:if((t.ctrlKey||t.metaKey)&&t.shiftKey&&!t.altKey)return t.halt(),n.allowEdit&&n._cmdTextSwitch(),!0;break;
case 219:case 221:e.fire("tabview:handleKeyDown",t);break;default:}return t.frameEvent&&(t.frameEvent.stopPropagation(),t.shiftKey&&r===9),i?!0:!1}function Y(e){var t=this,n=t.baseNode.one("div.rte-well-container"),r,i=n.one(".attachments-well");t.rteTabIndex=0,i&&!i.hasClass(d)?(i.all("li.attachmentVisible span.left a").each(function(e){!r&&e.get("tabIndex")===0&&(r=e)}),r||(r=i.one("li.attachmentVisible span.left a"),r&&r.set("tabIndex",0))):(r=n.one(".attachments-pane"),r&&r.set("tabIndex",0)),r&&t.setFocus(r),e.frameEvent.halt()}function Z(t){var n=e.Node.getDOMNode(t);return n!==null?n.tagName.toUpperCase()==="DIV":!1}function et(){var t=this,n={msg:{mid:t.draft.mid},fid:"Sent"},r=l.enabled("NotificationsV2");if(r){var i=function(t,r){r==="view"&&e.fire("openMessage",n)};e.use("common-ui-notification-v2",function(e){e.common.ui.NotificationV2.notify(strings.str_comp_msg_sent,{type:"info",cbk:i,duration:4e3,speed:"fast"})})}else{var s=new e.common.ui.Notification({type:"fade",className:"top",parent:"shellcontent",parentType:"id"}),o=e.ui.Templates._shared_module_offscreen_bin_notification_notifications.send_success;s.on("clickEvent",function(t){switch(t.action){case"closeNotification":s.destroy();break;case"view":e.fire("openMessage",n)}}),s.notify(c(o,null,null,null,strings),4e3)}}function tt(){var e=this,t;e.lastSaveType=e.isAutoSave?1:0,e.resetSaveTimer(),e.isAutoSave||(e.hasHardDraft=!0),e.isAutoSave=!1,e.dirty=!1,t=f.dateFormatter(new Date,strings.str_tog_dateformat_rsstime_l10n),t=c(strings.str_comp_saved,0,0,0,{saved_time:t}),e.updateSaveStatusText(t),e.fire("compose:saveSuccess")}function nt(t){var n=this,r,i;n.lastSaveType=-1,n.neoFire("composeEvent",{action:"saveComplete",saveSuccess:!1}),!n.isAutoSave&&!t.notificationDisplayed&&(i=strings.str_error_MessageSaveFailed,e.common.ui.NotificationV2.notify(i,{type:"error",close:!0,speed:"show-medium"})),n.isAutoSave=!1,n._setDirty(),r=strings.str_comp_saveasdraftfail,n.updateSaveStatusText(r),n.fire("compose:saveFail")}function rt(e){var t=this;t.baseNode.one(".save-draft-msg")&&t.baseNode.one(".save-draft-msg").removeClass("hidden").set("innerHTML",e)}function it(t){var n=this,r;r=strings.str_tae_unabletosendmsg,n.showComposeShim(!1),t.notificationDisplayed||(t.code==="EP-4010"?n.notifySendAbuse():e.common.ui.NotificationV2.notify(r,{type:"error",close:!0,speed:"show-medium"}))}function st(){var e=this;e.sendValidationHandlers.handleSpame()}function ot(){var t=this.baseNode.one("#bcc"),n;e.use("minty_module_offscreen_bin_tooltip_growth_onboarding",function(e){n=h.minty_module_offscreen_bin_tooltip_growth_onboarding,e.fire("onboard:tip",{node:t,template:f.ezSub(n.base,{},n),fn:function(){e.fire("onboard:tipclose")},classNames:["growth-onboarding"],offset:[0,t.get("offsetHeight")-120]})})}function ut(e){var t=this;t.baseNode.one(".composeshim")[e?"removeClass":"addClass"]("hidden"),e?t.baseNode.addClass("sending"):t.baseNode.removeClass("sending"),t.neoFire("composeEvent",{action:"updateTitle",sending:e})}function at(){var e=this,t=e.draft.attachments,n=e.handles;n.push(t.on("added",function(){e._setDirty(),e.resizeRTE()})),n.push(t.on("deleted",function(){e._setDirty(),setTimeout(function(){e.resizeRTE()},50)})),n.push(t.on("updated",function(t){e.resizeRTE();if(!t.isUploadDone())return;e._setDirty()}))}function ft(e){var t=this;e.reply?t.replyContentChangeAfter(e):e.uiUpdate||(t.draft.body.html?t.editor.setContent(t.draft.body.html,!e.textConvert):t.editor.setContent(t.draft.body.html))}function lt(e){var t=this,n=t.draft,r;if(!e.reply)return;t.header.setHeader(n),r=n.subject,t.neoFire("composeEvent",{action:"replyheaderLoad",subject:r})}function ct(e){var t=this,n,r=t.draft;t._setTextMode(e.isRichText),t._setClean(),n=r.cc&&r.cc.length>0||r.bcc&&r.bcc.length>0,t._allowEditing(t.draft.body.html,n),t.header.enableSwitchReplyButton(),t.get("noFocus")||t.setFocus(r.to&&r.to.length>0?"body":"to")}function ht(){var t=this;t.rtSwitch||(t.rtSwitch=t.baseNode.all("span.switchtext")),t.rtSwitch.each(function(n){t.handles.push(n.on("click",function(n){e.fire("mt:click",{action:"cmps_stchpt",append:{t1:"cmpsTb",ltxt:t._isRTEActive()?"plaintext":"richtext"}}),n.halt(!1),t.allowEdit&&t._cmdTextSwitch()}))})}function pt(){function s(){t.editor.fire("beforeModeSwitch"),t.draft.setBody(null,t.getContent()),t._setDirty()}function o(e,n){t._setTextMode(!1),t.draft.setBody(null,n),t.draft.notifyBodyChanged({textConvert:!0}),r&&r.removeClass("narrow-rightPV")}function u(){t._setTextMode(!0),n&&!n.isToolBarFit()?r&&r.addClass("narrow-rightPV"):r&&r.removeClass("narrow-rightPV")}function a(){s(),t._expandQuotedReply(),o(t.draft,t.editor.getContentAsPlainText()),t.resizeRTE(),t.setFocus("body"),t.editor.fire("afterModeSwitch")}var t=this,n=e.mail.ui.MailView&&e.mail.ui.MailView.prototype,r=e.one("#shellcontent"),i;t._isRTEActive()?t.editor.hasContent()?(i=!0,t.confirm(strings.str_rte_plaintext,strings.str_comp_conf_plainText,a)):a():(s(),u(t.draft),t.editor.fire("afterModeSwitch")),!i&&t.setFocus("body")}function dt(){return!NeoConfig.low_bandwidth&&this._getTextMode()}function vt(){return this.spellCheckView&&this._isRTEActive()}function mt(e){return this.baseNode.one(".cm-"+e+" ul li")}function gt(){return this.editor.getContent()+this.quotedTextBody}function yt(){return this.editor.richFontInfo}function bt(){return this.editor.getRTE()}function wt(t,n,r){var i=this,s=!0,o,u=i.editor.getRTE();if(typeof t=="string"){o=i.baseNode.one(".compose-header");if(o)switch(t){case"to":case"cc":case"bcc":case"subject":o=i.baseNode.one(".compose-header"),t=o.one(".cm-"+t+"-field");break;case"body":t=u,s=r&&e.UA.os==="macintosh"&&e.UA.chrome>=11?0:i.editor.get("ready")}}s&&(t===u?i.editor.setFocus(n):t&&t.focus()),t&&i._registerFocus(t)}function Et(e,t){return'<div class="'+t+'">'+e+"</div>"}function St(t,n){var r=this,i,s,o,u,a,l=[],c,h,p="yahoo_quoted";r._clearOriginTimers(),r.header.enableHeader(!0),r.editor.showArea(),r.loadingArea.addClass(d),r._activateWellFresh
();if(t)if(r.get("isQuickReply")&&r.draft.origin.action!=="forward"){r.isDraft||(u=e.UA.ie===9?"&nbsp;":e.Selection.CURSOR,t="<p>"+u+"</p>"+t),r.editor.setContent(t,!1);if(r.isDraft){i=f.getVal(r.draft.origin,"yqtdPrefix");for(s=0;s<i.length;s++)c="."+i[s]+p,o=r.getRTEDocNode().one(c),o&&(h=Et(o.getContent(),c),l.push(h),o.remove());this.quotedTextBody=l.join("")}else o=r.getRTEDocNode().one("."+p);o&&r.baseNode.one(".compose-quoted-text")&&r.baseNode.one(".compose-quoted-text").setStyle("display","block"),a=r.getRTEDocNode().one("."+p),a&&(this.quotedTextBody="<br>"+Et(a.getContent(),p),a.remove())}else r.editor.setContent(t,!r.isDraft);r.header.allowEditing(t,n),r.composeTictacApi.render(r.baseNode.one(".attachments-pane")),r.allowEdit=!0,r.fire("renderComplete")}function xt(e,t){var n=null;switch(e){case"fontname":n="userUIPref.composeFontFamily",t+="|1";break;case"fontsize":n="userUIPref.composeFontSize",t=parseInt(t,10),t=g[--t];break;default:}n&&t&&$t(n,t)}function Tt(){var t=this,n;t._formatPane||(t._formatPane=t.baseNode.one(".format-pane")),t.spellCheckBtn=t._formatPane.one('[data-action="spellcheck"]'),t.spellCheckMenuBtn=t.spellCheckBtn.next(),n=e.one("#menu-spell-langs"),t.handles.push(t.spellCheckBtn.on("click",function(e){e.preventDefault(),t._isSpellCheckActive()?t.spellCheckView.destroy():t._doSpellCheck(n?n.one(".active").get("text"):null)}),t.spellCheckMenuBtn.on("click",function(e){e.preventDefault(),t._openSpellCheckMenu(e)}),t.on("SpellCheck:destroy",function(){t.spellCheckView=null,t.spellCorrections=null,t.spellCheckBtn.removeClass("active")}))}function Nt(e){var t=this;t.closeSrc="cancelBtn",e&&(t.dirty="ForceClose"),t.canClose()&&t.neoFire("composeEvent",{action:"closeAction"})}function Ct(t){var n=!0,r={},i="",s=this;switch(t){case"send":r.spid="sent",s.lastSendState&&(i=s.lastSendState),s.send();break;case"savedraft":s.blockSave=!0,s._invokeSaveDraft();break;case"cancelcompose":n=!1,s.cancelCompose();break;case"delete":s.doDiscardDraft(!1),s.dirty="ForceClose",s.neoFire("composeEvent",{action:"closeAction",forceClose:!0})}n&&(r.append={t1:"cmpsTb",cmpsType:s.get("isQuickReply")?"QR":"fullCmps"},r.action="tlbr_"+t,i&&(r.append.ltxt=i),e.fire("mt:click",r))}function kt(e){var t=this,n,r=t.baseNode.one(".attachment-button-attach");e?n=t.draft.after("stateChanged",function(e){if(e&&e.next&&e.next!=="saved")return;n.detach(),t.neoFire("composeEvent",{action:"closeAction",forceClose:!0}),r.fire("compose:close")}):(r.fire("compose:close"),t.neoFire("composeEvent",{action:"closeAction",forceClose:!0}))}function Lt(){}function At(){var t=this;if(t._isSpellCheckActive())return;t.spellCheckView===null&&(l.enabled("spellCheck")?(t.spellCorrections=new e.mail.Model.SpellCorrections,t.spellCheckView=new r.ui.SpellCheckView(t,t.draft,t.spellCorrections),t.spellCheckBtn.addClass("active")):t.spellCheckView=!1)}function Ot(t){var n=this;e.use("mail-ui-composeview-spellcheck-v3",function(){n._activateSpellCheck(),n._isSpellCheckActive()&&(n.spellCheckView.doSpellCheck(t),n.setFocus("body"),n.neoFire("composeEvent",{action:"darlaEvent",type:"spell_chk"}))})}function Mt(t){var n=this;e.use("mail-ui-composeview-spellcheck-v3",function(){n._activateSpellCheck(),n._isSpellCheckActive()&&n.spellCheckView.showLangMenu(t)})}function _t(){return this.editor.getRTE().getInstance()}function Dt(){return this.editor.getDoc()}function Pt(e){var t=this,n,i=r.model.DataStore.Messages.getPermMidPart;if(e.flavor!==t.flavor)return!1;if(e&&e.oMsg&&t.getDraftMID())return i(t.getDraftMID())===i(e.oMsg.mid);if(!t._isOrigin())if(!e||!e.oMsg)return!0;return e&&e.oMsg?(n=t.draft.get.origin,e.action===n.action&&e.fid===n.fid&&e.oMsg.mid===n.oMsg.mid&&e.forwardAsAttachment===n.forwardAsAttachment):!1}function Ht(){var e=this,t=e.draft.origin;return t.action&&t.fid&&t.oMsg}function Bt(){var e=this,t;t=e.draft.origin,e._clearOriginTimers(),e._writeLoadingHtml(t.errInfo==="ok"?"pop":"slow")}function jt(){var e=this;e._writeLoadingHtml("start")}function Ft(e,t){this.editor.setContent(e,t)}function It(e){var t=this;t.loadingArea.hasChildNodes()&&t.loadingArea.get("children").remove().destroy(!0),t.loadingArea.appendChild(n(c(m.base,null,t.loadFormatters,e,strings,h)))}function qt(){var e=this;e.slowOriginReqTimer&&clearTimeout(e.slowOriginReqTimer),e.loadingTimer&&clearTimeout(e.loadingTimer)}function Rt(e){var t=this,n,r,i=t.baseNode.one(".save-draft-msg");n=function(){return e?strings.str_comp_saving_draft:t.lastSaveType===-1?c(strings.str_comp_saveasdraftfail,0,0,0,{autosave_time:t.lastSave}):t.lastSave?t.lastSaveType===1?c(strings.str_comp_autosave,0,0,0,{autosave_time:t.lastSave}):c(strings.str_comp_saved,0,0,0,{saved_time:t.lastSave}):""},r=n(),i.removeClass("hidden"),i.set("innerHTML",r)}function Ut(t){var n=this,r,i;n.allowSend?e.use("common-ui-dialog-helper",function(){n.allowSend=!1,r={hd:t?strings.str_rte_attachments_alert_virus_title:strings.str_comp_dialogtitle_invalidSendAttachments,bd:t?strings.str_rte_attachments_alert_virus:strings.str_comp_dialogbody_invalidSendAttachments,suppressRestoreFocus:!0},i=function(){n.allowSend=!0,n._restoreFocus()},a.ui.DialogHelper.alert(r,{ok:{handler:i},cancel:{handler:i}})}):n._restoreFocus()}function zt(e){var t=e||this.getSaveNotification(),n;if(!t)return;n=this.baseNode&&this.baseNode.one(".bottomToolbar"),n&&n.one(".save-draft-msg").setContent(t)}function Wt(){var e=this;return e.lastSaveType===-1?c(strings.str_comp_saveasdraftfail,0,0,0,{autosave_time:e.lastSave}):e.lastSave&&e.lastSaveType===1?c(strings.str_comp_saved_fresh,0,0,0,{saved_time:e.lastSave}):""}function Xt(){var t=this,n;return n={bidi:NeoConfig.bidi,isRTL:NeoConfig.isRTL,isFullSSL:NeoConfig.isSSL,isRich:t._isRTEActive(),getDefaultFontInfo:i.getDefaultFontInfo,convertToPlain:e.bind(e.mail.Controller.TextProcessor.convertToPlain,e.mail.Controller.TextProcessor),smartscroll:NeoConfig.smartscroll&&t.get("isQuickReply")},n}function Vt(){return this.draft.to.length>0||this.draft.cc.length>0||this.draft
.bcc.length>0||this.draft.subject.trim()!==""||this.draft.body.html!==""||this.draft.body.text!==""}function $t(t,n){e.common.persist.UserData.set(t,n),setTimeout(function(){e.common.persist.UserData.saveOne(t)},10)}function Jt(e){this.editor.getRTE().fire("cardify",e.cardInfo,e.type)}function Kt(e){var t=strings.str_comp_attachment_size_exceeded,n=c(t,0,0,0,{num:e});a.ui.DialogHelper.alert({hd:strings.str_comp_attachment_size_limit,bd:n,suppressRestoreFocus:!0},{ok:{handler:function(){}},cancel:{handler:function(){}}})}function Qt(t){var n=strings.str_comp_attachment_size_zero,r=t.map(function(t){return e.Escape.html(t.name)}),i="<strong>"+r.join(", ")+"</strong>",s=c(n,0,0,0,{filenames:i});a.ui.DialogHelper.alert({hd:strings.str_comp_attachment_size_limit,bd:s,suppressRestoreFocus:!0},{ok:{handler:function(){}}})}function Gt(){a.ui.DialogHelper.alert({hd:strings.str_comp_attach_error,bd:strings.str_comp_attach_num_files_exceeded,suppressRestoreFocus:!0},{ok:{handler:function(){}},cancel:{handler:function(){}}})}var t=e.Lang.trim,n=e.Node.create,r=e.mail,i=e.mail.Controller.ReplyProcessor,s=e.mail.Views.ComposeTictacApi,o=e.mail.rte.fileUtil,u=[],a=e.common,f=a.Utils,l=e.common.Utils.features,c=f.substitute,h=e.ui.Templates,p=e.mail.Controller.HtmlProcessor,d="hidden",v="focus",m=h._shared_module_compose_loading,g=[10,13,16,0,24,32,48],y=2e3,b=7e3,w=67,E=function(t,n,i,o,u){var a=this,f;E.superclass.constructor.call(a,t,n,o,u),a.spellCheckView=null,a.spellCheckLang=null,a.wordsToIgnore=[],a.slowOriginReqTimer=null,a.keepHdrFocus=!1,a.formatShortcutTimer=null,a.mouseFocusEvent=!1,a.composeViewRendered=!1,a.rteTabIndex=0,a.type="fullCompose",a.handles=[],a.lastSendState=null,a.closeSrc="closeBtn",a.containerNode=u.containerNode,a.hasRTEFormatter=!0,a.flavor="compose",a.addAttrs({keydownHandler:{value:null},isQuickReply:{value:!1},noFocus:{value:!1}},u),u.maxHeightFn&&(a.maxHeightFn=u.maxHeightFn,a.maxHeight=a.maxHeightFn()),f=a._getEditorConfig(),f.composeView=a,a.editor=new r.RTEView(f),a.composeTictacApi=new s(a.editor),a.addChild(a.editor),a.loadFormatters={start:function(e,t){return t==="start"?c(m.start,null,null,null,strings):""},slow:function(e,t){return t==="slow"?c(m.slow,null,null,null,strings):""},error:function(e,t){return t==="err"?c(m.error,null,null,null,strings):""},populate:function(e,t){return t==="pop"?c(m.populate,null,null,null,strings):""}},NeoConfig.bidi&&e.use("comms-intl-bidihighlight"),a.neoEvent("composeEvent",{emitFacade:!0,broadcast:1}),this.neoFire("composeEvent",{action:"addChild",subview:this}),this.set("active",!0),this.sendValidationHandlers=new e.mail.Views.SendValidationErrorHandlers(this),a.quotedTextBody=""};e.extend(E,e.mail.Views.MailCompose),E.prototype._bindDraft=function(){var e=this,t=e.draft,n;e.handles||(e.handles=[]),n=e.handles,n.push(t.on("stateChanged",function(t){t.prev==="savingAndSending"||t.prev==="sending"||t.prev==="sent"||t.prev==="captchaing"&&t.next==="unsaved"?t.next==="final"?e.sendSuccess():t.err&&e.sendFailure(t.err):(t.next==="saved"||t.next==="saving"||t.next==="unsaved"&&t.err)&&e._updateSaveStatus(t.next,t.err),(t.next==="savingAndSending"||t.next==="sending")&&e.showComposeShim(!0),(t.next==="saved"||t.next==="unsaved")&&e.showComposeShim(!1)})),n.push(t.on("bodyChanged",function(t){e.contentChangeAfter(t)})),n.push(t.on("headerChanged",function(t){e.headerChangeAfter(t)})),n.push(t.on("originChanged",function(){var t=f.getVal(e.draft.origin,"errInfo","ok");t!=="ok"&&(e._clearOriginTimers(),t.code!==a.net.Error.abort&&e._writeLoadingHtml("err"))}))},E.prototype._updateSaveStatus=function(t,n){var r=this,i=e.mail.ui.MailView&&e.mail.ui.MailView.prototype,s=e.one("#shellcontent");t==="saving"?r.draft.isUploadingInlineImages()?r.updateSaveStatusText(strings.str_comp_inline_image_attach_progress):r.updateSaveStatusText(strings.str_comp_saving_draft):t==="saved"&&r.allowEdit?r.saveSuccess():t==="unsaved"&&n&&r.saveFailure(n),i&&!i.isToolBarFit()?s&&s.addClass("narrow-rightPV"):s&&s.removeClass("narrow-rightPV")},E.prototype=e.mix(E.prototype,{NAME:"FullCompose",render:U,bindUI:D,_bindWellUIFresh:j,onKeyDown:G,onFocus:Z,closeCompose:N,hasContent:Vt,getContent:gt,getFontInfo:yt,getRTE:bt,getRTEInstance:_t,getRTEDocNode:Dt,getFirstNode:mt,setFocus:wt,contentChangeAfter:ft,headerChangeAfter:lt,replyContentChangeAfter:ct,updateSaveText:Rt,postRender:K,matchOrigin:Pt,setContent:Ft,addCards:Jt,addAttachMenuItems:J,showAttachmentSizeDialog:Kt,showAttachmentEmptyDialog:Qt,showAttachmentCountDialog:Gt,_initOpenMailButtons:$,_addFocusListenersFresh:Q,_handleShiftTabFresh:Y,_handleSendAction:k,handleComposeAction:Ct,_intlBindUIRTE:Lt,_allowEditing:St,_isRTEActive:dt,_closeAfterWarning:kt,_activateWellFresh:R,_renderWellsFresh:q,_bindTextSwitchFresh:ht,_cmdTextSwitch:pt,_showDropzone:O,_hideDropzone:M,_moveInputFileNode:_,_alertInvalidAttachments:Ut,_initializeSpellCheck:Tt,_activateSpellCheck:At,_isSpellCheckActive:vt,_doSpellCheck:Ot,_openSpellCheckMenu:Mt,_isOrigin:Ht,_handleSlowOriginRequest:Bt,_displayLoading:jt,_writeLoadingHtml:It,_clearOriginTimers:qt,_setComposePreference:xt,_bindAttachmentsTT:at,_warnTooManyRecipients:A,send:L,_showSendBtn:B,_expandQuotedReply:I,showComposeView:S,hideComposeView:x,getSubjectInfo:T,initializeRTEFormatter:F,getSaveNotification:Wt,setSaveNotification:zt,cancelCompose:Nt,resizeRTE:X,doResizeRTE:V,fixBottom:W,savePref:$t,updateUploadForm:P,notifySendAbuse:st,_getEditorConfig:Xt,sendSuccess:et,saveSuccess:tt,saveFailure:nt,sendFailure:it,updateSaveStatusText:rt,showComposeShim:ut,showGrowthTooltip:ot,ondestroy:C},!0),e.namespace("mail.Views").Compose=E},"1.0.0",{requires:["mail-ui-mailcompose-v3","mail-ui-messagepane-utils","attachments-fresh_css","mail-ui-tray","escape","mail-ui-composeview-attach","editor-base","mail-common-utils-features","editor-para","editor-br","node","stylesheet","mail-controller-reply-processor","mail-controller-signature-processor","mail-controller-html-processor","common-persist-user-data"
,"mail-models-draft","contacts-api-utils","contacts-api","filter-contacts","plugin","comms-bidi-textentry","comms-editor-autobidi","comms-intl-bidi","editor-bidi","_shared_module_compose_fresh_conv","_shared_module_toolbar_compose_fresh","_shared_module_compose_loading","_shared_module_offscreen_bin_compose","_shared_module_offscreen_bin_compose_menu_spellcheck","_shared_module_offscreen_bin_compose_modal_cancel_compose","_shared_module_rte_well_content_format_fresh","_shared_module_rte_well_content_format_pop_out","_shared_module_rte_well_content_emoticons_fresh","_shared_module_rte_well_content_fontnamesize_fresh","_shared_module_rte_well_content_attachments_fresh","_shared_module_rte_well_tabs_compose_fresh","_shared_module_offscreen_bin_notification_notifications","_shared_module_compose_dropzone","common-ui-toolbar-base","common-ui-menu-helper","_shared_module_offscreen_bin_compose_menu_list","_shared_module_offscreen_bin_compose_menu_text_align","_shared_module_offscreen_bin_compose_menu_indent","mail-views-send-validation-error-handlers","mail-ui-composetictacapi","rte-file-utils","mail-ui-mailview-base"]});
YUI.add("mail-core-net-policies-compose-policy",function(B){var A=function(){this.requests={};};B.mix(A.prototype,{enforce:function(E,D,C){B.Object.each(this.requests,function(F,H,G){E.cancel(H);});},add:function(E,D,C){if(!C.upload){this.requests[E]=C;}}});B.namespace("Mail.Core.Net.Policies").ComposePolicy=A;},"1.0.0",{requires:[]});YUI.add("mail-core-net-helpers-multipart-request-wrapper",function(B){var A={wrap:function(G){if(!G){return null;}var E=(new Date()).getTime(),I="------------------------------"+E,F="",H,D="\r\n";function C(J){F+=J+D;}H="multipart/form-data; boundary="+I;B.Array.each(G,function(J){C("--"+I);C('Content-Disposition: form-data; name="'+J.name+'"');C("Content-Type: "+J.contentType);C("");C(J.content);});C("--"+I+"--");return{data:F,contentType:H};}};B.namespace("Mail.Core.Net.Helpers").MultipartRequestWrapper=A;},"1.0.0",{requires:[]});YUI.add("mail-core-net-request",function(e){var t=0,n=e.mail.Error;e.namespace("Mail.Core.Net").Request={BATCH_TIMEOUT:35e3,BATCH_URL:"/ws/v3/batch?",EXPIRY_RETRY_COUNT:1,DEFAULT_TIMEOUT:1e4,HTTP_CONN_ERRS:[0,502,900,12002,12152,12007,12029,12030,12031,13030],MAX_RETRIES:2,_suspendCode:0,get:function(e,t,n){var r;return n||!this._isBatchable(e)?(t=this._initConfig(t),r=t.options,r.method="GET",this.send(e,t)):this.batchJSON({uri:e,method:"GET"})},post:function(t,n,r,i){var s;return i||!this._isBatchable(t)?(r=this._initConfig(r),s=r.options,s.method="POST",s.data=n,s.headers=s.headers||{},!s.headers["Content-Type"]&&!this._isFormData(n)&&!s.form&&(s.headers["Content-Type"]="application/json"),s.headers["Content-Type"]==="application/json"&&typeof n!="string"&&(s.data=e.JSON.stringify(n)),s.headers["Accept-Language"]=NeoConfig.lang,s.form&&(s.data=undefined),this.send(t,r)):this.batchJSON({uri:t,method:"POST",payloadType:"embedded",payload:n})},_initConfig:function(e){return e=e||{},e.options=e.options||{},e},_isBatchable:function(e){return e.indexOf("/mailsearch/v2/search")!==0},_parseUrlForSessionId:function(t){return e.common.Utils.getVal(e.common.Utils.parseJSON(t),"error.details.wssid")},_logRequest:function(t,n){e.fire("MailLog",{m:"v3 Request received",url:t,info:n||""})},_logResponse:function(t,n){e.fire("MailLog",{m:"v3 Response received",url:t,info:n||""})},logBatchRequest:function(t){var n=0,r={},i,s;for(n=0;n<t.length;n++)s=e.common.Utils.parseJSON(t[n].content),i=s.requests,this.unserializeRequests(i,r);return r},unserializeRequests:function(e,t){var n=0,r;if(!e)return;for(n=0;n<e.length;n++)e[n]&&(t[e[n].id]=e[n].uri,r=e[n].requests,this.unserializeRequests(r,t))},_parseJSONBatchResponse:function(t){var n=e.common.Utils,r,i,s,o,u,a,f,l,c,h,p;s=n.parseJSON(t.response||t.responseText),f={},c={},l=s.result.status.successRequests;for(r=0;r<l.length;r++)c[l[r].id]=l[r];o=n.getVal(s,"result.responses");if(o)for(r=0;r<o.length;r++)u=o[r],a={id:u.id,httpCode:u.httpCode?u.httpCode:void 0,headers:u.headers,response:u.response},i=c[u.id],i?(a.status=i,a.success=!0):a.success=!1,f[u.id]=a;h=s.result.status.failedRequests;for(r=0;r<h.length;r++)p=h[r],f[p.id]||(a={id:p.id,httpCode:p.httpCode?p.httpCode:void 0,response:{error:p.error},success:!1},f[p.id]=a);return f.url=t.url,f},batchJSON:function(n,r){var i=e.Array(n),s,o;return e.Array.each(i,function(e){n.id=n.id||"r"+t++}),o={requests:i},r=this._initConfig(r),s=r.options,s&&s.responseType==="json"&&(o.responseType="json"),s.headers=s.headers||{},s.headers["Content-Type"]="application/json",this.executeBatch(e.JSON.stringify(o,null,4),r)},batchMultipart:function(t,n){var r=e.Lang.isArray(t)?t:[t],i,s,o;return i=e.Mail.Core.Net.Helpers.MultipartRequestWrapper.wrap(r),n=this._initConfig(n),s=n.options,s.headers=s.headers||{},s.headers["Content-Type"]=i.contentType,o=this.logBatchRequest(t),this.executeBatch(i.data,n,o)},executeBatch:function(t,n,r){var i=this,s,o,u,a;return n=this._initConfig(n),a=n.options,a.headers.Accept=a.headers.Accept||"application/json",a.method="POST",a.data=t,a.timeout=this.BATCH_TIMEOUT,o=this.send(this.BATCH_URL,n,!0),s=o.then(function(e){return u=i._parseJSONBatchResponse(e),u.errDetail=i._handleBatchItemCallError(u,n,r),u}),e.mix(s,{io:o.io}),s},send:function(t,r,i,s){var o=this,u,a,f,l,c,h=e.common.net.Session.genReqID();return o._suspendCode!==0?(f=o._suspendCode,new Promise(function(e,t){t({code:f})})):(s||(s=0),t.indexOf("?")===-1&&(t+="?"),l=new Promise(function(f,l){function p(){c&&(c.cancel(),c=void 0)}function d(t,r){var s,a,c,h;p(),o._logResponse(u),s=o._getResponseJSON(r),e.Lang.isObject(s)?(n.cleanUpOnSuceess(),c=i?r:s,c.url=u,f(c)):(h={code:s,url:u,resource:u,status:r.status?r.status:0},s==="Malformed-mail"&&(h.rawText=r.response||r.responseText,h.url=u),a=n.handleV3([h]),l({status:r.status,res:r,errDetail:a}))}function v(a,c){var h,d;p(),e.common.Utils.getVal(c,"statusText")!=="timeoutClient"&&o._logResponse(u),h=o._createErrorObjectIO(c,r,u),h.url=u;switch(h.code){case"EC-4003":o._handleSessionExpiryError(f,l,c.responseText,t,r,i,s);return;case"EC-4008":o._handleReloginError(f,l,t,r,i,s);return;case"conn":if(o._handleConnectionError(f,l,t,r,i,s))return;break;case"abort":return;default:}d=n.handleV3(o._createErrorV3([h],r)),l({status:c.status,res:c,errDetail:d})}function m(e,t){var n;o._isFormData(r.options.data)?(n=t.status>=200&&t.status<300?d:v,n(t.status,t)):r.options.form&&(n=t.error?v:d,n(undefined,t))}r.options.on={success:d,failure:v,complete:m},r.options.progress&&(r.options.on.progress=r.options.progress),u=t+"&appid=YahooMailNeo&wssid="+NeoConfig.wssid+"&ts="+ +(new Date)+"&ymreqid="+h,o._logRequest(u,r.logInfo),a=e.io(u,r.options),o._isFormData(r.options.data)&&(c=e.later(r.options.timeout?r.options.timeout:o.DEFAULT_TIMEOUT,o,function(){c=void 0,a.abort&&(a.abort(),o._logClientAbort("Client-Abort-Timer",u)),v(0,{status:0,statusText:"timeoutClient"})}))}),e.mix(l,{io:a,timer:c,url:u}),l)},abort:function(e){var t=this;e.io&&e.io.abort&&(e.io.abort(),e.timer&&e.timer.cancel(),t._logClientAbort("Client-Abort-Request",e.url))},_logClientAbort:function(t,n){var r=t+":"+NeoConfig.farm+":"+(n||"null")+":NewV3",i={m:r,yid:NeoConfig.loginId};e.fire("MailLog",i)},_createErrorObjectIO:function(t,n,r){var i=0,s=-1,o,u={};try{i=t&&t.status||0,s=t&&t.readyState||-1}catch(a){}try{this._isConnErr(i)||s<=3?e.common.Utils.getVal(t,"statusText")==="timeout"?u.code="timeout":e.common.Utils.getVal(t,"statusText")==="timeoutClient"?u.code="timeoutClient":e.common.Utils.getVal(t,"statusText")==="abort"?u.code="abort":u.code="conn":(o=this._getResponseJSON(t),e.Lang.isObject(o)?u=this._createErrorObject(o,i,n):(o==="Malformed-mail"&&(u.rawText=t.response||t.responseText),u.code=o)),u.status=i}catch(a){u={code:"unknown"}}return n.suppressNotification&&(u.suppressNotification=!0),n.suppressStat&&(u.suppressStat=!0),n.logInfo&&(u.logInfo=n.logInfo),u.url=r,u.resource||(u.resource=r),u},_createErrorV3:function(e
,t){var n,r;for(n=0;n<e.length;n++)r=e[n].jsonResult,e[n].jsonResult=void 0,t.errHandler&&(e[n]=t.errHandler(e[n],r));return e},_createErrorObject:function(e,t,n){var r={};return e?!e.error||!e.error.code?r.code="MalformedFault":e.error&&(r=e.error,r.jsonResult=e):r.code="EmptyResponse-mail",r.status=t,n.suppressNotification&&(r.suppressNotification=!0),n.suppressStat&&(r.suppressStat=!0),n.logInfo&&(r.logInfo=n.logInfo),r},_getResponseJSON:function(t){var n,r;return!t||!e.Lang.isValue(t.response)&&!e.Lang.isValue(t.responseText)?"NoResponse-mail":(n=t.response||t.responseText,n?(r=this._validateJSON(n),r?r:"Malformed-mail"):"EmptyResponse-mail")},_validateJSON:function(t){var n=e.common.Utils.parseJSON(t);return n||(n=this._sanitizeJSON(t)),n},_sanitizeJSON:function(e){var t=/^\s*<!doctype\s*[^>]*?>\s*/i,n=/\n/g,r=/<script\b[^<]*(?:(?!<\/script>)<[^<]*)*<\/script>/gi;if(e.match(t))return this._retryParse(e,t);if(e.match(r))return this._retryParse(e,r);if(e.match(n))return this._retryParse(e,n)},_retryParse:function(e,t){return e=e.replace(t,""),this._validateJSON(e)},_isConnErr:function(e){for(var t=0;t<this.HTTP_CONN_ERRS.length;t++)if(e===this.HTTP_CONN_ERRS[t])return!0;return!1},_handleBatchItemCallError:function(t,r,i){var s,o,u,a,f=[];r.errHandlerBatch&&(t=r.errHandlerBatch(t));for(s in t)o=t[s],e.Lang.isObject(o)&&o.success===!1&&(a=this._createErrorObject(o.response,o.httpCode,r),i&&(a.resource=a.resource?a.resource:i[s]),f.push(a));return f.length!==0&&(f.url=t.url,u=n.handleV3(this._createErrorV3(f,r))),u},_handleSessionExpiryError:function(t,n,r,i,s,o,u){var a=this,f,l;if(e.common.net.Error.isReloginActive()||a._suspendCode!==0||u>=a.EXPIRY_RETRY_COUNT){n({code:402,res:null});return}l=a._parseUrlForSessionId(r);if(l)try{f=e.common.UserSession.getState(),f.newuser?e.common.net.Error.reloadUserChange():(e.common.net.Error.setWssid(l),u++,this.send(i,s,o,u).then(t,n))}catch(c){}else n({code:402,res:null})},_handleReloginError:function(t,n,r,i,s,o){var u=this;e.once("net:reloginSuccessful",function(){u.send(r,i,s,o).then(t,n)}),e.common.net.Error.simpleRelogin()},_handleConnectionError:function(e,t,n,r,i,s){var o=this;return s<this.MAX_RETRIES?(o.send(n,r,i,++s).then(e,t),!0):!1},_isFormData:function(e){return window.FormData&&e instanceof window.FormData},suspend:function(e){this._suspendCode=e},resume:function(){this._suspendCode=0},_bindEvents:function(){var t=this;e.on("net:reloginAttempted",e.bind(t._reloginAttemptHandler,t)),e.on("net:reloginSuccessful",e.bind(t._reloginSuccessHandler,t))},_reloginAttemptHandler:function(){this.suspend(401)},_reloginSuccessHandler:function(){this.resume()}},e.Mail.Core.Net.Request._bindEvents()},"1.0.0",{requires:["io","json","common-utils","common-net-error","common-net-session","common-user-session","mail-error-v3","mail-core-net-helpers-multipart-request-wrapper"]});
YUI.add("mail-core-net-transport",function(E){var B=E.Mail.Core.Net.Request,D=E.common.Utils.verify,A={POST:1,BATCHJSON:2,BATCHMULTIPART:3,GET:4};var C=function(F){this.policy=F;this.requestMap={};};E.mix(C.prototype,{request:function(G,H,F){return this._request(A.POST,G,H,F);},requestGet:function(G,F){return this._request(A.GET,G,null,F);},requestBatchJSON:function(F,G){return this._request(A.BATCHJSON,B.BATCH_URL,F,G);},requestBatchMultipart:function(G,F){return this._request(A.BATCHMULTIPART,B.BATCH_URL,G,F);},_request:function(F,I,J,H){var G,K;this.policy.enforce(this,I,H);switch(F){case A.POST:K=B.post(I,J,H,true);break;case A.BATCHJSON:K=B.batchJSON(J,H);break;case A.BATCHMULTIPART:K=B.batchMultipart(J,H);break;case A.GET:K=B.get(I,H,true);break;default:D(false,"Bad Request Type requested in transport layer");break;}G=this._wrapPromise(K);this.policy.add(G.id,I,H);return G;},cancel:function(G){var F=this.requestMap[G];if(F){this.requestMap[G]=null;B.abort(F);}},_wrapPromise:function(I){var K=this,J=E.common.Utils.guid(),F;K.requestMap[J]=I;F=K.requestMap[J].then(function H(){if(K.requestMap[J]){K.requestMap[J]=null;}return I;},function G(){if(K.requestMap[J]){K.requestMap[J]=null;}return I;});F.io=I.io;F.id=J;return F;}});E.namespace("Mail.Core.Net").Transport=C;},"1.0.0",{requires:["mail-core-net-request","common-utils"]});YUI.add("mail-models-serializers-draft-formdata-serializer",function(B){var A=function(C){this.draft=C;};B.mix(A.prototype,{data:function(){var C=new FormData(),D=1;C.append("jsonString",this.draft.jsonify());D++;B.Array.each(this.draft.attachments,function(E){if(E.state()==="pending"){if(E.size()===0){E.setState("failed");return;}var F="att"+D;C.append(F,E.file(),E.getFilename());E.setState("uploading");D++;}});return C;}});B.namespace("Mail.Models.Serializers").DraftFormData=A;},"1.0.0",{requires:[]});YUI.add("mail-models-serializers-draft-payloadpart-serializer",function(B){var A=function(C){this.draft=C;};B.mix(A.prototype,{format:function(){var C={partName:"jsonString",contentType:"application/json",payload:this.draft.jsonifyObj()};return[C];}});B.namespace("Mail.Models.Serializers").DraftPayloadPartSerializer=A;},"1.0.0",{requires:["mail-models-draft"]});YUI.add("mail-core-net-helpers-batch-request-helper",function(B){var A={wrapCall:function(D,I,E,F,H,C){var G={id:I,uri:D,method:H||"POST"};if(G.method=="POST"||G.method=="PUT"){G.payloadType=E?"embedded":"multipart";if(E){G.payload=F;}else{G.payloadParts=F;}}if(C){G.suppressResponse=C;}return G;},attachChildCall:function(E,C,D){if(D){C.filters=D;}C.requests=C.requests||[];C.requests.push(E);}};B.namespace("Mail.Core.Net.Helpers").BatchRequestHelper=A;},"1.0.0",{requires:[]});YUI.add("mail-core-net-helpers-cascade-request-helper",function(D){var C=D.common.Utils.verify,B="/ws/mail/v2.0/jsonrpc";var A={getV2Endpoint:function(E){C(E,"method not supplied to getV2Endpoint");return(B+"?m="+E);},getV2EndpointBatch:function(){return B;},formatV2Payload:function(F,E){C(F&&E,"method and params not supplied to formatV2Payload");return({method:F,params:E});},formatV2GdmParams:function(G,E,F){F=F||"all";C(G&&E,"fid and mid not supplied to formatV2GdmParams");return{fid:G,enableRetry:true,textToHtml:true,urlDetection:true,emailDetection:true,qtAnnotate:{enable:true},emailComposeUrl:"mailto:%e%",truncateAt:100000,charsetHint:"",annotateOption:{annotateText:"inline"},message:this.formatV2GdmMsgParams(E,F)};},formatV2GetCidsParams:function(F,E){return[{fid:F,mids:[E]}];},formatV2GdmMsgParams:function(E,F){return([{blockImages:F,restrictCSS:true,expandCIDReferences:true,enableWarnings:true,mid:E}]);}};D.namespace("Mail.Core.Net.Helpers").CascadeRequestHelper=A;},"1.0.0",{requires:["common-utils"]});YUI.add("mail-controller-conv-adapter",function(F){var D=F.mail.model.ConvStore.Conversations,C=F.mail.model.DataStore.Messages,E=F.common.Utils.getVal,A={_serializeSendMessageInfo:function(I,H,G){return{mid:H.mid,cid:I,fid:"Sent",snippet:H?H.snippet:B(H),sourceFolderInfo:{fid:"Sent"},receivedDate:E(H,"header.sentDate")||Math.floor((new Date().getTime())/1000),flags:E(H,"flags")||{"isRead":1},from:H.from,toEmail:E(H,"header.to")||G.to,subject:E(H,"header.subject")||G.subject};},_serializeSaveMessageInfo:function(G,H){return{mid:H.mid,header:{from:G.from,to:G.to,cc:G.cc,bcc:G.bcc,subject:G.subject,replyto:G.replyto,receivedDate:Math.floor((new Date().getTime())/1000)},cid:E(G,"origin.oMsg.cid"),fid:"Draft",flags:{"isRead":1},snippet:H.snippet||B(H),sourceFolderInfo:{fid:"Draft"},inReplyTo:E(G.origin,"parentMsg")?E(G.origin,"parentMsg.mimeMsgId"):E(G.origin,"oMsg.mimeMsgId")};},_send:function(L){var H={draft:L.draft,draftMid:L.draftMid},I=L.draft,K=L.draftMid,J=E(I,"origin.oMsg.cid"),M=L.msgResponse,O=L.midToCidResponse&&L.midToCidResponse[0]&&L.midToCidResponse[0].cid,G;try{K&&C.remove("Draft",K,true,null,{reason:"sent"});if(O&&(D.getPermCidPart(O)===D.getPermCidPart(J))){G=this._serializeSendMessageInfo(O,M,I);F.mail.Controller.Messages._preset({fid:"Sent",msgObj:M});D.msgAdd(J,null,G,H,true);}else{if(M){M.mid=M.mid||M.id;C.set("Sent",M,"add",false,function(P){if(P.sourceFolderInfo){P.sourceFolderInfo.name=P.sourceFolderInfo.fid="Sent";}F.mail.Controller.Messages._process(P,{fid:"Sent"});return P;});}}}catch(N){}},_save:function(L){var J={draft:L.draft,draftMid:L.draftMid},H=L.draft,M=E(H,"origin.oMsg.cid"),K=L.msgResponse,G=L.draftMid,I;if(M){I=this._serializeSaveMessageInfo(H,K);D.msgAdd(M,null,I,J);}else{if(K){I={mid:K.mid||K.id,flags:{}};C.set("Draft",I,"add");}}G&&C.remove("Draft",G,true,null,{reason:"savedraft"});},store:function(G){if(G.method==="send"){this._send(G);}else{if(G.method==="save"){this._save(G);}}}};function B(H){var G=40,I=F.Lang.trim(H.part[0].text);I=I.substring(0,G);return I.replace(/\n/g," ");}F.namespace("mail.Controller").convAdapter=A;},"1.0.0",{requires:["mail-model-convstore","mail-model-datastore","mail-controller-messages","common-utils"]});YUI.add("mail-models-attachment-preprocessor",function(D){function A(G,E){var F=0;for(F=0;F<G.length;F++){if(G[F].partId===E.partId){return G[F];}}return undefined;}function C(G,H){var E,F=H.match(/\<(.+)\>/);if(F){E=F[1];}if(!G[H]&&G[E]){G[H]=G[E];delete G[E];return true;}return false;}var B=function(){};D.mix(B.prototype,{preProcess:function(G){var R=G.normalizedResponse.attachments,H=G.normalizedResponse.parts,N=G.normalizedResponse.mid,I,J,Q,S,M,K=[],L=G.uploads||{},F=G.draft,P=F.attachments,E=F.attachments.map(function(T){return T.contentId();}),O=D.Array.hash(E,P);for(I=0;I<R.length;I++){S=R[I];Q=S.contentId;K.push(Q);C(L,Q);if(G.saveSuccess){if(C(O,Q)){O[Q].setContentId(Q);}if(!O[Q]){M=new D.mail.Models.Attachment(N,S);M.setData(A(H,S));M.setState("saved");M.setSavedInfo(S);F.addAttachment(M);}else{if(O[Q].partId()!==S.partId){O[Q].setData(A(H,S));O[Q].setMid(G.normalizedResponse.mid);}}if(F.draftToDelete&&O[Q].mid()===F.draftToDelete){O[Q].setMid(G.normalizedResponse.mid);}}}if(G.saveSuccess){for(J in O){if(K.indexOf(J)<0&&O[J].state()==="saved"){F.removeAttachment(J);}}}return R;}});D.namespace("Mail.Models.Serializers").AttachmentRespPreprocessor=B;},"1.0.0",{requires:["mail-model-attachment"]});YUI.add("mail-models-serializers-draft-messageV3-unserializer",function(e){var t=function(){};e.mix(t.prototype,{update:function(t,n){var r,i,s;s=e.common.Utils.getVal(n,"result.message"),s&&(r=e.common.Utils.getVal(s,"spame",null),t.setSpame(r?r:"U"),i=e.common.Utils.getVal(s,"csid",null),i&&(t.csid=i))}}),e.namespace("Mail.Models.Serializers").DraftMessageV3Unserializer=t},"1.0.0",{requires:["common-utils"]});
YUI.add("mail-services-compose",function(e){function f(n){t(n,"no V3 mailbox id supplied to compose service"),this.transport=new e.Mail.Core.Net.Transport(new e.Mail.Core.Net.Policies.ComposePolicy),this.v3url="/ws/v3/mailboxes/@.id=="+n+"/messages",this.gdmUnserializer=new e.Mail.Models.Serializers.DraftGdmUnserializer,this.attachmentRespPreprocessor=new e.Mail.Models.Serializers.AttachmentRespPreprocessor,this.msgUnserializer=new e.Mail.Models.Serializers.DraftMessageV3Unserializer}function l(t){var n=t.attachments.filter(function(e){return e.state()==="pending"&&e.size()!==0}),r=n.map(function(e){return e.contentId()});return e.Array.hash(r,n)}function c(t,n){t&&e.Object.each(t,function(e){e.transactionId=n.id})}function h(t,n){var r=n.loaded;t&&e.Object.each(t,function(e){e.progress=0;if(r>0){var t=r>e.file().size?1:r/e.file().size;r-=e.file().size,e.setProgress(t)}})}function p(e,t){e&&e.attachmentInfo&&t.loaded&&(e.attachmentInfo.bytesSent=Math.min(e.attachmentInfo.size,t.loaded))}function d(e,t){var n=!1;e.attachments.forEach(function(e){e.state()==="deleted"&&(n=!0,t.cancel(e.transactionId))}),n&&e.setState("unsaved")}function v(e){var t,n=0;for(t in e)e.hasOwnProperty(t)&&(n+=e[t].size());return n}function m(e){var t=Math.max(e*s,i);return t}function g(t,n,r){var i={contentInfo:t.getLogInfo()},s=n?e.Object.size(n):0;return s>0&&(i.attachmentInfo={count:s,size:r,bytesSent:0}),i}function y(t,n,r){var i,s,o,u;if(!r||e.Lang.isArray(r)&&r.length===0)e.Object.each(n,function(e){u=!0,e.setState("failed")});else for(s=0;s<r.length;s++){i=r[s],o=n[i.contentId];if(!o)continue;i.virus==="Y"?(o.setState("infected"),u=!0):o.setState("pending")}u&&t.setState("unsaved")}function b(e,t){t.forEach(function(t){var n=e.attachments.indexOf(t);n!==-1&&(e.attachments.splice(n,1),t.deleted())})}function w(t){if(t.draftToDelete){var n=function(){},r={success:n,failure:n,suppressNotification:!0};e.mail.Controller.Messages.remove({fid:"Draft",mid:t.draftToDelete,force:!0},r),t.draftToDelete=void 0}}function E(e){var t=e.SaveMessage,r=e.SendMessage,i,s;return t&&r&&t.success&&!r.success&&(i=n(t,"response.result.message.captcha"),s=n(r,"response.error"),i&&s&&(s.code="batchCaptcha")),e}function S(e,t){if(e.code)switch(e.code){case"ET-5012":x(t)&&(e.code="virusDetected");break;default:}return e}function x(e){var t,n,r;if(!e||!e.result||!e.result.simpleBody||!e.result.simpleBody.attachments)return!1;t=e.result.simpleBody.attachments;for(r=0;r<t.length;r++){n=t[r].virus;if(n&&n==="Y")return!0}return!1}var t=e.common.Utils.verify,n=e.common.Utils.getVal,r=e.mail.Controller.convAdapter,i=35e3,s=10,o="SendMessage",u="SaveMessage",a="GetDisplayMessage";e.mix(f.prototype,{save:function(t,i,s){var o=this,u,a,f=t.draftToDelete?t.draftToDelete:t.mid,h=l(t),p=e.Object.size(h)>0,v=!0,m=t.attachments.filter(function(e){return e.state()==="deleted"});return d(t,this.transport),t.generateCsid(),!p&&v?u=this.jsonSave(t,s):window.FormData&&window.FileReader?u=this.formDataSave(t,h,s):u=this.iframeSave(t,h,s),c(h,u),u.then(function(n){return o.attachmentRespPreprocessor.preProcess({uploads:h,normalizedResponse:o._normalizeResponseObject(n),draft:t,saveSuccess:!0}),w(t),o.gdmUnserializer.update(t,h,n),o.msgUnserializer.update(t,n),o._updateDraftCaptcha(t,n),b(t,m),a={method:"save",draft:t,draftMid:f,msgResponse:n.result.messageV2},r.store(a),n},function(r){var i=o.attachmentRespPreprocessor.preProcess({uploads:h,normalizedResponse:o._normalizeResponseObject(n(r,"res.response")),draft:t,saveSuccess:!1});return y(t,h,i),r}),u},jsonSave:function(e,t){var n=this,r=e.jsonify(),s={options:{timeout:i},upload:!1,errHandler:S,suppressNotification:t&&t.suppressNotification,suppressStat:t&&t.suppressStat,logInfo:g(e)},o;return o=n.transport.request(n.v3url,r,s),o},formDataSave:function(t,n,r){var i=this,s=e.Object.size(n)>0,o=v(n),u=new e.Mail.Models.Serializers.DraftFormData(t),a=u.data(),f=g(t,n,o),l={options:{progress:function(e,t){h(n,t),p(f,t)},timeout:m(o)},upload:s,errHandler:S,suppressNotification:r&&r.suppressNotification,suppressStat:r&&r.suppressStat,logInfo:f},c;return c=i.transport.request(i.v3url,a,l),c},iframeSave:function(t,n,r){var i=this,s=v(n);return e.Object.each(n,function(e){e.setState("uploading")}),new Promise(function(o,u){e.use("io-upload-iframe",function(){var e=t.formId,a={},f={options:{form:{id:e,upload:!0},timeout:m(s)},errHandler:S,suppressNotification:r&&r.suppressNotification,suppressStat:r&&r.suppressStat,logInfo:g(t,n,s)};i.transport.request(i.v3url,a,f).then(o,u)})})},sendBatch:function(e,t){var n=this,r,s,f,l={},c=e.mid;return r=this._createSendBatch(e,t),s={options:{timeout:i},errHandlerBatch:E},t&&(s.logInfo=g(e)),f=this.transport.requestBatchMultipart([r],s).then(function(i){return l.errDetail=i.errDetail,n._wasMessageSent(i,t)&&e.setState("sent"),t&&n._processBatchAPIResponse(i,u,"save",l,function(t){n._handleSaveResponse(e,t.save)||(l.failure="save")}),n._processBatchAPIResponse(i,o,"send",l,function(){n._handleSendResponse(e)}),e.isInConv()?n._processBatchAPIResponse(i,a,"sendGDM",l,function(t){n._updateConvStore(e,t.sendGDM,c)||(l.failure="sendGDM")}):n._updateMsgStore(e,c,l.save),l.failure?Promise.reject(l):l},function(t){return l.failure="batch",l.batch=t,l.errDetail=t.errDetail,Promise.reject(l)}),f},_processBatchAPIResponse:function(e,t,n,r,i){var s=e[t],o=s&&s.response;if(r.failure)return;r[n]=o,s.success?i&&i(r):r.failure=n},_createSendBatch:function(t,n){var r=e.Mail.Core.Net.Helpers.BatchRequestHelper,i=e.Mail.Core.Net.Helpers.CascadeRequestHelper,s=new e.Mail.Models.Serializers.DraftPayloadPartSerializer(t),f={select:{mid:"$..message.immutableid"}},l={select:{mid:"$..message.id"}},c,h,p,d,v,m,g;return h=n?"$(mid)":encodeURIComponent(this._transformMidToRFC4648(t.mid)),c=this.v3url+"/@.id=="+h+"/send",t.generateCsid(),p={csid:t.csid},!n&&t.captchaAnswer&&(p.captcha=t.captchaAnswer),g=v=r.wrapCall(c,o,!0,p),n&&(g=d=r.wrapCall(this.v3url,u,!1,s.format()),r.attachChildCall(v,d,f)),t.isInConv
()&&(m=r.wrapCall(i.getV2EndpointBatch(),a,!0,i.formatV2Payload(a,i.formatV2GdmParams("Sent","$(mid)","none"))),r.attachChildCall(m,v,l)),{name:"batchJson",contentType:"application/json",content:e.JSON.stringify({responseType:"json",requests:[g]})}},_handleSaveResponse:function(e,t){return w(e),this.gdmUnserializer.update(e,null,t),this.msgUnserializer.update(e,t),!this._updateDraftCaptcha(e,t)&&!e.isSpame()},_handleSendResponse:function(t){var n;try{n=t.makeInReplyTo(),n&&(n.forwarded||n.replied)&&e.mail.Controller.Messages.flag({fid:t.origin.fid,mid:[t.origin.action==="edit"?n.messageReference.id:t.origin.oMsg],setFlags:n.forwarded?{forwarded:1}:{replied:1}},{suppressCodes:["*"]})}catch(r){}},_updateConvStore:function(e,t,n){try{r.store({method:"send",draft:e,draftMid:n,msgResponse:t.result.message[0],midToCidResponse:[{cid:e.cid}]})}catch(i){return!1}return!0},_updateMsgStore:function(e,t,i){try{r.store({method:"send",draft:e,draftMid:t,msgResponse:n(i,"result.messageV2")})}catch(s){return!1}return!0},_updateDraftCaptcha:function(e,t){return e.captchaAnswer=null,t.result.message&&t.result.message.captcha?(e.captcha=t.result.message.captcha,!0):(e.captcha=null,!1)},_wasMessageSent:function(e,t){if(!e[o].success)return!1;if(t)if(!e[u].success||n(e[u],"response.result.message.captcha")||n(e[u],"response.result.message.spame","U")==="N")return!1;return!0},_transformMidToRFC4648:function(e){var t=e;return t=t.replace("+","-"),t=t.replace("/","_"),t},_normalizeResponseObject:function(t){var r,i,s,o;if(typeof t=="string")try{r=e.JSON.parse(t)}catch(u){r={}}else r=t;return i=n(r,"result.simpleBody.attachments")||[],s=n(r,"result.messageV2.part")||[],o=n(r,"result.messageV2.mid")||"",{response:r,parts:s,attachments:i,mid:o}}}),e.namespace("Mail.Services").Compose=f},"1.0.0",{requires:["common-utils","json","json-parse","mail-core-net-policies-compose-policy","mail-core-net-transport","mail-models-serializers-draft-formdata-serializer","mail-models-serializers-draft-payloadpart-serializer","mail-core-net-helpers-batch-request-helper","mail-core-net-helpers-cascade-request-helper","mail-controller-conv-adapter","mail-models-serializers-draft-gdm-unserializer","mail-models-attachment-preprocessor","mail-models-serializers-draft-messageV3-unserializer","mail-controller-messages-ops"]});
