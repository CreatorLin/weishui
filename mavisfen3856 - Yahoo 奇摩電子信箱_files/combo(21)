YUI.add("mail-ui-convpane-error",function(F){F.namespace("mail.ui");var Q=F.mail,K=Q.ui,H=K._ConvPane,O=F.common.Utils,E=O.ymmastats,M=O.substitute,J=F.ui.Templates._shared_module_thread_thread_display_rollup,D=K.MessagePaneUtils,L=K.PaneUtils;function N(T){var U=this,S="",R;if(U.filterFailError){return"";}else{if(U.conv_deleted_error){R=J.conv_deleted_error;}else{if(U.msg_deleted_error){S=L.getMsgSub(this.message);R=J.msg_deleted_error;}else{if(!T){S=L.getMsgSub(this.message);R=J.conv_loading_error;}else{S=(T&&T.header&&T.header.subject)?T.header.subject:strings["str_msg-view_no_subject"];R=J.loading_error;}}}}return M(R,{msg_subject:O.escapeHtml(S)},U.readFormatters,0,strings);}function I(){var W=this,V=W.message||{},R=W.sourceFolderInfo||0,S,T,U="";if(V.mid){S=R?R.fid:"";T=R?R.name:"";if(S){U=M(J.diff_folder_error,{newFid:S,foldername:T},0,0,strings);}}if(!U){U=W.getFailureMarkup();}return U;}function C(){return M(J.loading_slow,0,0,0,strings);}function B(){var R=this;if(R.outboundReq){R.augmentFormatters();R.slowLoad=R.msg_deleted_error=R.conv_deleted_error=R.loading_error=R.loading_moved=0;R.loading_slow=1;R.render();}}function G(i,a){var c=this,k=F.mail,b=k.model.DataStore,Y,j,U,e=c.retryPrefix(),f=i.reason,Z=i.data&&i.data.status,T=a?"preloadFailure":"loadConvFailure",S=O.Stopwatch,W=S.get("MsgInPreview"),g,h,V,d={"GetCidsInvalidMids":true,"MessageFetchFailed":true,"MessageIdsNotFound":true,"MessageNotFound":true,"GetMessageInvalidId":true,"MessageSelectionNotFound":true,"MessageIdsDeleted":true,"MessageNotFoundInNonBulk":true,"EC-4001":true,"ERROR":true},X={"ConvIdCouldNotBeFound":true,"InvalidConvId":true,"MalformedConvId":true};function R(m){var l;if(typeof m==="string"){l=m.match(/Client\.([\w\W]+)$/)||m.match(/Server\.([\w\W]+)$/);}return(l&&l[1])||m;}E.stat("convread","result=>failure,env=>"+NeoConfig.mailEnv);c.filterFailError=c.msg_deleted_error=c.conv_deleted_error=0;c.isTae4=c.isTae46=false;if(i.code==="BatchItemError"){V=i.fault&&i.fault.detail&&i.fault.detail[0]&&i.fault.detail[0].code;V=R(V);}else{V=(i.reason&&i.reason.code&&R(i.reason.code))||(i.code&&R(i.code));}g=b.Folders.get(c.fid);U=i?i.data:0;if(d[V]===true){c.isTae4=true;h="TAE4:GDM:FAILURE:"+c.numRetries+":";if(c.numRetries>=c.maxRetries){c.canRetry=false;}else{c.canRetry=true;}if(V==="EC-4001"){c.filterFailError=1;}}else{if(X[V]===true){c.canRetry=false;c.isTae46=true;if(V==="ConvIdCouldNotBeFound"){if(c.numRetries<c.maxRetries){c.canRetry=true;}}}}if(W){D.cleanUpStopwatch(W);W.stop("MsgInPreviewFailure");}W=c.stopwatch;if(W){W.stop("MsgInTabFailure");}c.augmentFormatters();Y=i.cid;c.resetRequestLoadingState(true);if(i.reason===F.mail.Controller.Messages.Error.moved){c.fireEvent("moved",j);c.sourceFolderInfo=U.sourceFolderInfo?U.sourceFolderInfo:0;c.loading_moved=1;}else{if(i.code!==F.common.net.Error.abort){if(V==="InvalidConvId"){c.conv_deleted_error=1;}else{if(V==="MessageIdsDeleted"||V==="MessageNotFoundInNonBulk"){c.msg_deleted_error=1;}}c.fireEvent("getFailure",j);c.loading_error=1;}}if(c.loading_error||c.loading_moved){c.render();}}function A(V,Z){var X=this,a,T,S=X.retryPrefix(),U=V.reason,W=Z?"preloadFailure":"loadMessageFailure",b=O.Stopwatch,R=b.get("MsgInPreview");clearTimeout(X.slowLoad);if(R){D.cleanUpStopwatch(R);R.stop("MsgInPreviewFailure");}R=X.stopwatch;if(R){R.stop("MsgInTabFailure");}X.augmentFormatters();try{T=V?V.data:0;if(T&&!T.mid&&T.callback){T=T.callback.args.primeMsg;}a=T?T.mid:0;}catch(Y){typeof globals!=="undefined"&&globals.report?globals.report("caughterror:..-build-mail-ui-mailpane-conv-error:1",Y,"TRY_CATCH",1,1,1):window.console&&console.log&&console.log("caughterror:..-build-mail-ui-mailpane-conv-error:1");a="";}X.outboundReq=X.request=null;clearTimeout(X.slowLoad);X.isRetrying=X.loading_slow=0;if(V.reason===F.mail.Controller.Messages.Error.moved){X.fireEvent("moved",a);X.sourceFolderInfo=T.sourceFolderInfo?T.sourceFolderInfo:0;T.loading_moved=1;}else{if(V.code!==F.common.net.Error.abort){X.fireEvent("getFailure",a);T.loading_error=1;}}if(T.loading_error||T.loading_moved){return M(J.msg_loading,T,X.readFormatters,null,strings);}}function P(){var T=this,R,S=3;T.maxRetries=S;if(!T.readFormatters.loading_slow){F.mix(T.readFormatters,{show_tae:function(){if(T.isTae4||T.isTae46){R=T.isTae4?"4":"46";return M(J.show_tae,{tae_code:R},null,0,strings);}},loading_slow:function(){return T.loading_slow?T.getSlowMarkup():"";},conv_loading_error:function(){return T.loading_error?T.getFailureMarkup():"";},diff_folder_error:function(){return T.loading_moved?T.getMovedMarkup():"";},loading_error:function(U){return T.getFailureMarkup(U);},multi_retry_else:function(U){return M(J.multi_retry_else,U,T.readFormatters,0,strings);},is_perm:function(){return(T.numRetries>=S)?M(J.is_perm,{msg_fail_tae_code:45},0,0,strings):"";},is_perm_else:function(U){return(T.numRetries<S)?M(J.is_perm_else,U,T.readFormatters,0,strings):"";},can_retry:function(){return T.canRetry?M(J.can_retry,null,0,0,strings):"";}});}}F.mix(H.prototype,{getFailureMarkup:N,getMovedMarkup:I,getSlowMarkup:C,onFailure:G,onMsgFailure:A,handleSlowRequest:B,augmentFormatters:P});},"1.0.0",{requires:["common-utils","_shared_module_thread_thread_display_rollup","mail-ui-pane-utils"]});