YUI.add("mail-ui-onboarding",function(e){var t=e.common.Utils.substitute,n=e.common.net.SessionMgr,r=e.common.persist.UserData,i=e.common.Utils,s=NeoConfig.theme.id,o=NeoConfig.theme.isRandom,u;e.namespace("mail.ui.Onboarding"),u=function(){function a(){function a(t){var i=t.currentTarget,s=r.one(".theme-selected");n=i.get("id"),t.halt(),s&&(s.one("a").removeAttribute("aria-selected"),s.removeClass("theme-selected")),i.addClass("theme-selected"),i.one("a").set("aria-selected",!0),e.fire("changeTheme",{theme:n})}var t=u.get("contentBox"),n=s,r=t.one("div.inner"),i=o?!0:!1;u.on("destroy",function(){i&&e.fire("saveTheme",{theme:n}),e.one("body").removeClass("onboard"),setTimeout(function(){e.fire("showThemesOnboarding")},300)}),t.on("click",function(t){var r=e.common.Utils.getDataAction(t),o=r.action;if(o==="ok"||o==="cancel")t.preventDefault(),o==="ok"?n!==s&&(i=!0):(u.set("closeAction","cancel"),e.fire("changeTheme",{theme:s})),u.destroy()}),r.plug(e.comms.ui.NodeFocusBase,{descendants:".theme a",keys:{next:"39",previous:"37"}}),t.one(".themes").delegate("click",a,"div.theme"),t.one(".themes").delegate("dblclick",function(){u.destroy()},"div.theme"),t.on("keydown",function(t){var n=t.target,r=n.simulate;switch(t.keyCode){case 38:case 40:t.preventDefault(),r("keydown",{keyCode:t.keyCode-1});break;case 13:n.get("nodeName").toLowerCase()!=="a"&&u.destroy();break;case 32:n.get("nodeName").toLowerCase()==="a"&&(t.preventDefault(),r("click"));break;case 27:e.fire("changeTheme",{theme:s}),u.destroy()}})}function f(){var t,n=e.mail.ui.ThmCfg,r=[],i={"first-light":1,"seascape-evening":1,"droplet-green":1,guadiana:1,"dark-abstract":1,"cool-abstract":1,purple:1,"deep-blue":1};typeof n[NeoConfig.theme.id]!="undefined"&&r.push(n[NeoConfig.theme.id]);for(t in i)t!==NeoConfig.theme.id&&typeof n[t]!="undefined"&&r.push(n[t]);for(t in n)t!==NeoConfig.theme.id&&i[t]!==1&&r.push(n[t]);return r}function l(){e.use("comms-ui-dialog-base","mail-ui-themes","mail-ui-themes-cfg","_shared_module_offscreen_bin_modal_onboard_rollup","modal_css","options-pages_css","themes-onboarding_css",function(e){if(!u||u.getAttrs().destroyed){var n,o,l="",h,p,d=parseInt(NeoConfig.isBizmail,10)==="1"?i.escapeHtml(r.get("userSendPref.defaultFromAddress")):i.escapeHtml(r.get("userSendPref.defaultFromName")),v=f(),m=window.devicePixelRatio&&window.devicePixelRatio>1,g,y,b=e.ui.Templates._shared_module_offscreen_bin_modal_onboard_rollup;for(y in v)n=v[y],n.img&&(m?g=n.img["bg-t-r"]?n.img["bg-t-r"]:n.img["bg-t"]:g=n.img["bg-t"]),o={selected:n===s?b.selected:"",aria_selected:n===s?b.aria_selected:"",id:n.id,name:strings["str_opt_colors_"+n.id+"_attr"]||n.id,thumbnail_class:n.img?"":'class="color" ',thumbnail_img:n.img?"<img src='"+NeoConfig.image_path+g+"' width='150px' height='100px'>":"",href:"#"},l+=t(b.themes,o,null,null,strings);h=t(b.base,{get_onboard_themes:l,theme_cancel_btn:strings.str_cfg_tog_theme_cancel?b.theme_cancel_btn:"",user_name:d,att:NeoConfig.partnerType==="sbc"?b.att:b.att_else},null,b,strings),u=new e.comms.ui.Dialog({template:h,centered:!0,clearMask:!0,noScroll:!0}),u.render(),a(),u.show(),c(),p=e.one("#onboard-dialog .theme a"),p&&p.simulate("click");var w=e.one(".yui3-overlay-clearmask");w&&e.one("body").addClass("onboard"),e.one("html").removeClass("dlg-show"),setTimeout(function(){e.one("#onboard-dialog")&&u.center()},1e3)}})}function c(){var e,t,r;r=yui.common.Utils.parseQueryString(),e=NeoConfig.launch_protocol+document.location.host+"/"+NeoConfig.scriptBase+"/setOnboardPC",r&&r.storm&&(e+="?storm=1"),t={success:function(){},failure:function(){},suppressCodes:["*"]},n.request(e,null,t,"GET",null,!0)}function h(){var e,t,r;r=yui.common.Utils.parseQueryString(),e=NeoConfig.launch_protocol+document.location.host+"/"+NeoConfig.scriptBase+"/setConvTutorial",r&&r.storm&&(e+="?storm=1"),t={success:function(){},failure:function(){},suppressCodes:["*"]},n.request(e,null,t,"GET",null,!0)}function p(){var t=[],n=[],r=[],i=[];e.on("onboard:tip",function(s){var o=s.node;if(!o)return;var u=s.template,a=s.fn,f=s.dir||"left",l=s.offset,c=o.getXY(),h=[0,0],p={},d,v,m=s.parent||e.one("body"),g=s.parent?m.getXY():[0,0],y,b,w,E=s.classNames;d=e.Node.create("<div class='onboardtip'></div>"),m.appendChild(d),l||(l=[0,0]),NeoConfig.isRTL&&(f=f==="left"?"right":"left"),f==="right"?c[0]=g[0]+parseInt(m.getComputedStyle("width"),10)-(c[0]+parseInt(o.getComputedStyle("width"),10)):c[0]=c[0]-g[0],c[1]=c[1]-g[1],h[0]=c[0]+l[0],h[1]=c[1]+l[1],d.hide(),d.set("innerHTML",u),p[f]=h[0],p.top=h[1],d.setStyles(p);if(E){w=E.length;for(b=0;b<w;b++)d.addClass(E[b])}s.evt&&(v=s.evt,i.push(e.one(v.parent).delegate(v.actionType,v.handler,v.target))),d.show(),y=d.on("click",a),s.isPersistentTooltip===!0?(r.push(d),i.push(y)):(n.push(y),t.push(d))}),e.on("onboard:tipclose",function(){e.Array.each(t,function(e){e.remove()}),t=[],e.Array.each(n,function(e){e&&e.detach()})}),e.on("onboard:tipclosePersistent",function(t){var n=t&&t.fade||!1;e.Array.each(r,function(e){e.getDOMNode()&&e.hide(n,null,function(){this.remove()})}),r=[],e.Array.each(i,function(e){e&&e.detach()})})}var u=null;e.on("finishConvOnboarding",function(){h()}),e.mix(this,{showDialog:l,setOnboardingTime:c,setConvTutorialTs:h,setupOnBoardToolTip:p})},e.mail.ui.Onboarding=new u,e.mail.ui.Onboarding.setupOnBoardToolTip()},"1.0.0",{requires:["common-utils","json-parse","node-event-simulate","onboarding_css"]});
YUI.add("minty_module_offscreen_bin_hovercard_callout",function(A){A.namespace("ui.Templates");A.ui.Templates.minty_module_offscreen_bin_hovercard_callout={base:"<div id=\"hovercardCallout\" class='hovercardTooltip yui3-tooltips'> <div class='arrow'> </div> <div class=\"bd\" tabindex='0'> <label>{{str_hovercard_new_callerid}}</label> </div></div>"};},"1.0.0");YUI.add("contacts-ui-hovercard-onboard",function(A){var D,I=A.common.Utils,H=I.ezSub,B=A.mail.persist.MetaData,J="hasHovercardCalloutShown",F=["Draft","Sent","%40B%40Bulk","Trash"],E,C,G;D=function(){var K=this;A.on("hideHoverCardCallout",A.bind(K.closeCallout,K));};D.prototype={mailPane:null,callOutDataAddress:null,callOutNode:null,call:function(K){var L=this;L.callOutNode=null;L.callOutDataAddress=null;if(L.canDisplayCallout(K)){L.setupTriggerNode(K);if(L.isKnownContact(L.callOutDataAddress)){L.callOutNode.addClass("callout");L.showCallout();L.setCalloutShown();A.fire("util:ymstats",{name:"hovercard",tags:{action:"callout"}});}}},canDisplayCallout:function(K){var L=this;return(F.indexOf(K.mailpane.fid)<0&&L.hasCalloutShown()!=="true"&&L.callOutDataAddress!==NeoConfig.emailAddress);},hasCalloutShown:function(){return B.get(J);},setCalloutShown:function(){B.set(J,"true");B.save();},showCallout:function(){var M=this,S=A.ui.Templates.minty_module_offscreen_bin_hovercard_callout,Q=H(S.base),R=M.callOutNode,L=R.get("clientHeight"),P=R.get("clientWidth"),K=(P<175)?160:175,O=(K-P)/2,N=L+22;A.fire("onboard:tip",{node:M.callOutNode,template:Q,offset:[-O,-N]});M.callOutNode.setStyle("opacity",1);A.one("#hovercardCallout").setStyle("opacity",1);R.once("mouseenter",A.bind(M.closeCallout,M));A.one("document").once("click",A.bind(M.closeCallout,M));if(C===true){M.mailPane.getRoot().one(".thread-item-list").once("scroll",A.bind(M.closeCallout,M));}if(G===true){M.mailPane.getRoot().one(".base-card").once("scroll",A.bind(M.closeCallout,M));}},closeCallout:function(){var L=this,K=L.callOutNode||A.one(".hcard.callout");if(K){K.removeClass("callout");}A.fire("onboard:tipclose");},setupTriggerNode:function(K){var M=this,L;M.mailPane=K.mailpane;C=A.mail.ui.ConvPane&&M.mailPane instanceof A.mail.ui.ConvPane;G=A.mail.ui.MessagePane&&M.mailPane instanceof A.mail.ui.MessagePane;if(C===true){L=M.mailPane.getRoot().one(".thread-item.expanded");M.callOutNode=L&&L.one(".from.hcard");}if(G===true){M.callOutNode=M.mailPane.getRoot().one(".from-loz .hcard");}M.callOutDataAddress=M.callOutNode&&M.callOutNode.getAttribute("data-address");},isKnownContact:function(K){var L=A.contacts&&A.contacts.utils.getContactsByEmail(K)||[false];if(L[0]&&L[0].id>=0){return L[0].id;}return false;}};A.namespace("mail.ui");A.mail.ui.HoverCardOnboard=new D();},"0.0.1",{requires:["event-mouseenter","mail-ui-onboarding","contacts-api-utils","contacts-api","mail-persist-meta-data","hovercard_css","minty_module_offscreen_bin_hovercard_callout"]});