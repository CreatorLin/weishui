YUI.add("tictac-attach-stats",function(a){"use strict";function b(a,b){a=a.toLowerCase(),b&&b.message&&(b.message=b.message.toLowerCase()),window.console&&window.console.log,f.stat(a,b)}var c={html5_tt_onfileselect:13,html5_tt_attachment_uploadcancelled:14,html5_tt_credentialsetfailedcallback:15,html5_tt_credentialsetsuccessful:16,html5_tt_credentialsetsuccessful_retry:17,html5_tt_credentialsetfailed:18,html5_tt_failure_uploaderror_io:19,html5_tt_no_cred:20,html5_tt_retry:21,html5_tt_success:22,html5_tt_failure:23,form_tt_onfileselect:24,form_tt_attachment_uploadcancelled:25,form_tt_attachuploadiframeerror:26,form_tt_abandon:27,form_tt_server_response:28,controller_uploaderror:29,view_upload_success:30,view_upload_failure:31,html_tt_credfetchsuccessdata:32,controller_uploadretrysuccess:33,toggleformactivated:34,download_error_json:35,download_error_general:36,download_success_error:37,download_success_errors:38,download_success_nourl:39,download_success_success:40,download_success_warning:41,download_success:42,controller_db_upload_start:43,controller_db_upload_success:44,controller_db_upload_failure:45,html5_tt_db_upload_try_failure:46,dropbox_saveto:56,enhancr_autolink_count:94,enhancr_card_added:95,enhancr_card_removed:96,enhancr_card_call_success:97,enhancr_card_call_fail:98,enhancr_fwd_or_reply:99,enhancr_promo_facebook:100,enhancr_promo_twitter:101,enhancr_promo_close_dialog:102,enhancr_promo_try_it:103},d={action:17,bucket:28,message:20,count:29,size:30},e={name:"attach",appId:"1000934436956",isSampled:0===Math.floor(100*Math.random()+0),actionEnums:c,customFieldEnums:d},f=new a.Tictac.base.Ywa(e);a.namespace("Tictac.attach").Stats={makeStatConf:function(){return{stat:b}}},a.namespace("Tictac.attach.Stats").stat=b,a.namespace("tictac.attach.Stats").stat=b},"1.0.0",{requires:["tictac-base-ywa"]});YUI.add("tictac-attach-utils",function(a){"use strict";var b=a.Array.hash(["uploadFileSizeError","uploadNoFileError","uploadAVCannotClean","uploadAVHasVirus","uploadInternalError","uploadMailboxError","uploadPartialFileError","uploadAuthError"]),c=a.Array.hash(["uploadAVInternalError","uploadAVError","uploadAVServerDown","uploadAVCleaned"]),d=a.Array.hash(["uploadAVNoVirus","uploadAVNotScannable"]),e=a.merge(b,d);a.namespace("Tictac.attach").Utils={configure:function(b,c){var d=!0;return a.each(c,function(c,e){a.Object.owns(b,e)||(d=!1,a.log("Invalid conf key: "+e))}),d?(a.mix(b,c,!0),!0):!1},trackClick:function(b,c){var d={action:b};c&&(d.append=c),a.fire("mt:click",d)},isSvrResponseRecognized:function(a){return!!e[a]},isSvrResponseWarning:function(a){return!!c[a]},isSvrResponseSuccess:function(a){return!!d[a]}},a.namespace("tictac.attach").Utils=a.Tictac.attach.Utils},"2.0",{requires:["node","json"]});YUI.add("tictac-attach-enhancr-autolink",function(a){"use strict";function b(){return window.getSelection().getRangeAt(0)}function c(a){switch(a.get("nodeType")){case Node.PROCESSING_INSTRUCTION_NODE:case Node.DOCUMENT_TYPE_NODE:return 0;case Node.TEXT_NODE:case Node.COMMENT_NODE:return a.get("length");default:return a.get("childNodes").size()}}function d(a){var b=a.get?a.get("nodeType"):a.nodeType;return b===Node.TEXT_NODE}function e(a,b){var d;return 0===c(a)||a.get("childNodes").isEmpty()?null:null!==(d=a.get("childNodes").item(b))?d:null!==(d=a.get("childNodes").item(b-1))?d:null}function f(a,b){var c=b(a,"a",!0);return c?c:!d(a)&&(c=a.one("a"))?c:null}function g(b,c,d,e){var f=document.createRange(),g=e;return f.setStart(b.getDOMNode(),c),f.setEnd(b.getDOMNode(),d),window.getSelection().removeAllRanges(),window.getSelection().addRange(f),0!==e.indexOf("http")&&(e="http://"+e),e=e.replace('"',"%22").replace("'","%27"),a.UA.ie&&a.UA.ie<11||a.UA.gecko?(f.deleteContents(),f.insertNode(a.Node.create('<a href="'+e+'">'+g+"</a>").getDOMNode())):document.execCommand("createlink",!1,e),f}function h(b,c){var f,g=a.Node(b.endContainer);return f=b.endOffset-1,a.UA.gecko&&(f=b.endOffset),g=e(g,f)||g,!a.UA.ie&&d(g)&&(g=g.previous()),c(g,"a",!0)}function i(i,m,n){function o(a,b,c){return a.ancestor(b,!!c,function(a){return a===n})}var p,q,r,s,t,u,v,w,x,y=b(),z=function(b){for(;b&&""===a.Lang.trim(b.get("text"));)b=b.get("previousSibling"),b&&d(b)&&(m=c(b));return b},A=function(b){var c=[",","?",";","!","."];return-1!==a.Array.indexOf(c,b)};if(null!==(q=e(i,m))&&(i=q,m=0),i=z(i)||i,p=f(i,o))return d(i)&&(y.endOffset===y.endContainer.length?(y.setStartAfter(p.getDOMNode()),y.collapse(!0),window.getSelection().addRange(y)):y.collapsed&&y.startOffset<1&&y.endOffset<1&&(y.setStartBefore(p.getDOMNode()),window.getSelection().addRange(y))),p;if(!d(i))return null;if(r=/[^\s]+[\s]*$/.exec(i.substringData(0,m)),!r)return null;if(s=r.index,t=r[0],u=l.test(t)?l.source:"^www\\."+k.source,!new RegExp(u,"i").test(t))return null;for(;!new RegExp(u+"$","i").test(i.substringData(s,m-s));)m--;for(v=i.substringData(s,m-s),w=v.length-1;w>=0&&A(v.charAt(w));)w--,m--;return v=w!==v.length-1?v.substring(0,w+1):v,x=g(i,s,m,v),a.Tictac.attach.Stats.stat("enhancr_autolink_count"),a.Tictac.attach.Utils.trackClick("enhancr_autolink_count"),p=h(x,o),j(p),p}function j(a){var b=document.createRange();b.setStartAfter(a.getDOMNode()),b.collapse(!0),window.getSelection().removeAllRanges(),window.getSelection().addRange(b)}var k=/([a-z0-9-]+\.)+([a-z]{2,4})(\/+[a-z0-9_.\:\;@-]*)*(\?[\&\%\|\+a-z0-9_=,\.\:\;-]*)?([\&\%\|\+&a-z0-9_=,\:\;\.-]*)([\!\#\/\&\%\|\+a-z0-9_=,\:\;\.-]*)}*/,l=/^(https?\:\/\/)[^\s]+/;a.Node.DOM_EVENTS.paste=1,a.Node.DOM_EVENTS.key.eventDef.KEY_MAP.space=32,a.Node.DOM_EVENTS.key.eventDef.KEY_MAP.enter=13,a.Node.prototype.substringData=function(){var a=this.getDOMNode();return a.substringData.apply(a,arguments)};var m=function(){this.triggers=this.constructor.TRIGGERS,m.superclass.constructor.apply(this,arguments)};a.extend(m,a.Plugin.Base,{_linkify:function(c){var d,e=b();this.get("linkingEnabled")&&(d=i(a.Node(e.startContainer),e.startOffset,this.container),d&&this._onLinkDetected(d,c))},_onKey:function(a){var b=this.triggers,c=13===a.keyCode?b.ENTER:b.SPACE;this._linkify(c)},_onPaste:function(){function b(){c._linkify(c.triggers.PASTE)}var c=this;c.pasteTimer=a.later(0,this,b)},_onLinkDetected:function(b,c){a.later(15,this,function(){this.editor.fire("link",{node:b,trigger:c})})},_afterEditorReady:function(){var b=this.listeners;this.editor=this.get("host"),this.container=this.editor.frame.get("container"),this.editor.publish("link",{emitFacade:!0}),this.editor.getInstance().EditorSelection.CURSOR='<br class="yui-cursor">',a.UA.ie>=9&&document.execCommand("AutoUrlDetect",!1,!1),b.push(this.container.on("key",a.bind(this._onKey,this),"press:space,enter")),b.push(this.container.on("paste",a.bind(this._onPaste,this)))},initializer:function(){var b=this,c=b.get("host");return b.listeners=[],c.get("isReady")?void b._afterEditorReady():void b.listeners.push(c.after("ready",a.bind(function(){b._afterEditorReady()})))},destructor:function(){var b=this;a.each(b.listeners,function(a){a.detach()}),b.pasteTimer&&b.pasteTimer.cancel()}},{NAME:"autolink",NS:"autolink",ATTRS:{host:{value:!1},linkingEnabled:{value:!0,validator:function(b){return a.Lang.isBoolean(b)}}}}),a.namespace("Tictac.attach.enhancr").AutolinkPlugin=m,m.TRIGGERS={PASTE:"paste",ENTER:"enter",SPACE:"space"}},"1.0.0",{requires:["tictac-attach-stats","tictac-attach-utils","base","plugin","event-custom","event-key","node-base"]});YUI.add("tictac-attach-enhancr-net",function(a){"use strict";function b(b,c){var f,g="/ws/comms/hlfs/",h=-1!==window.location.href.indexOf("enhancrbeta");h&&(g=g.replace(/hlfs/,"hlfs-beta")),f=[g,"?url="+encodeURIComponent(b),"&docproc=linkinfo","&proxyType=http","&clientid=mailc","&wssid="+a.common.net.SessionMgr.getWssid()].join(""),a.Tictac.base.BatchTransport.send({requests:[{id:"GetLinkInfo",uri:f,method:"GET",filters:{select:{imageURL:"$..image.url"}},suppressResponse:!1,requests:[{id:"GetSecureLink",uri:"/ws/v3/pac/url?wssid="+a.common.net.SessionMgr.getWssid(),method:"POST",payload:{urls:["$(imageURL)"]}}]}]},{success:function(a,b,f){var g=d(f,"GetLinkInfo.body.urldomain"),h=d(f,"GetLinkInfo.body.docproc"),i=d(h,"linkinfo"),j=d(i,"image.url"),k=d(f,"GetSecureLink.body.urls");i?(j&&k&&k[j]&&(i.image.url=k[j]),c.success(i,g)):(e("Did not receive a linkinfo object."),c.fail())},fail:function(){c.fail()}},{"HLFS_HeaderLine.Accept-Language":NeoConfig.lang||"en-US","HLFS_HeaderLine.LLF-Cache-Control":"max-stale=-1"})}var c=a.Tictac.base.utils,d=c.getVal,e=c.log;a.namespace("Tictac.attach.enhancr").Net={getLinkEnhancements:b}},"1.0.0",{requires:["common-net-sessionmgr","tictac-base-utils","tictac-base-mail-io","tictac-base-batch-transport"]});YUI.add("tictac-attach-rollups",function(a){a.namespace("Tictac.attach.rollups"),a.Tictac.attach.rollups.dragdrop=a.Handlebars.template(function(a,b,c,d,e){this.compilerInfo=[4,">= 1.0.0"],c=this.merge(c,a.helpers),e=e||{};var f,g="",h="function",i=this.escapeExpression;return g+="<div id='uploader-droparea' class='tictac-attach-droparea'><div>",(f=c.drag_here)?f=f.call(b,{hash:{},data:e}):(f=b.drag_here,f=typeof f===h?f.apply(b):f),g+=i(f)+"</div></div>"}),a.Tictac.attach.rollups.enhancr_card_onboarding=a.Handlebars.template(function(a,b,c,d,e){this.compilerInfo=[4,">= 1.0.0"],c=this.merge(c,a.helpers),e=e||{};var f,g="",h="function",i=this.escapeExpression;return g+='<div id="enhancrCardOnboarding" class="convstooltip yui3-tooltips" style="width: 280px;">    <div class="tooltip-arrow-left">        <div class="inner-arrow"></div>    </div>    <div class="modal tooltips-text" style="width: 280px;">        <h2 class="modal-hd">            <span class="tutorial-btn close" title="close" style="top: 15px; right: 15px;"></span>        </h2>        <div class="modal-bd" style="padding-right: 30px;">            <div class="hd" style="line-height: 18px; font-size: 16px; font-weight: bold; color: #400090; margin-bottom: 10px;">                Sharing Links in Yahoo Mail just got better.            </div>            <div class="bd" style="margin-top: 10px; margin-bottom: 10px;">Preview links right within the message.</div>            <img class="ob-img" src="',(f=c.imgUrl)?f=f.call(b,{hash:{},data:e}):(f=b.imgUrl,f=typeof f===h?f.apply(b):f),g+=i(f)+'" width="230" />        </div>        <div class="modal-ft"> <span id="okayModalOverlay" class="btn left right default" data-action="ok"><a href="#">Try it!</a></span>  </div>    <div></div>'}),a.Tictac.attach.rollups.link_enhancr_promo=a.Handlebars.template(function(a,b,c,d,e){return this.compilerInfo=[4,">= 1.0.0"],c=this.merge(c,a.helpers),e=e||{},'Now, when you share any link to a news story, image or video in Yahoo Mail, you will see a rich link preview appear within the body of your email.<br><br><a _moz_dirty="" href="http://travel.yahoo.com/blogs/compass/echoes-sinbad-sailor-flickr-photo-day-200611534.html" id="yui_3_13_0_ym1_1_1392854102955_12003">Echoes of Sinbad the sailor: Flickr photo of the day</a><div style="width:450px; font-family: \'Georgia\', \'Times\', \'Times New Roman\', \'serif\';" contenteditable="false" id="enhancrCard_0" class="link-enhancr-attachment link-enhancr-element link-enhancr-onboarding-big-card"><table class="link-enhancr-element" cellspacing="0" cellpadding="0" style="width:450px; height:170px; position: relative; margin-top:5px; margin-bottom: 5px; display: block;" id="yui_3_13_0_ym1_1_1394599549111_2978"><tbody id="yui_3_13_0_ym1_1_1394599549111_2977"><tr class="link-enhancr-element"><td colspan="6" class="link-enhancr-element" style="height: 1px; background-color: #e5e5e5;"><div class="link-enhancr-element" style="height: 1px; background-color: #e5e5e5;"></div></td></tr><tr class="link-enhancr-element" id="yui_3_13_0_ym1_1_1394599549111_2976"><td rowspan="2" class="link-enhancr-element" style="width: 1px; background-color: #e5e5e5;"><div class="link-enhancr-element" style="width: 1px; background-color: #e5e5e5;"></div></td><td class="link-enhancr-element" rowspan="2" style="vertical-align: middle; width: 168px; height: 168px; background-color: #000000;"><div class="link-enhancr-element" style="width: 168px;" align="center"><a href="http://travel.yahoo.com/blogs/compass/echoes-sinbad-sailor-flickr-photo-day-200611534.html" class="link-enhancr-card-urlWrapper link-enhancr-element" style="text-decoration: none !important; color: #000000 !important;"><img alt="image" src="http://l.yimg.com/bt/api/res/1.2/XzqRo0dnWcSFxFBuUh16Vw--/YXBwaWQ9eW5ld3M7cT04NTt3PTYwMA--/http://media.zenfs.com/en-US/blogs/compass/dhow.jpg" class="link-enhancr-thumbnail-image link-enhancr-element" width="168" height="102" style="display: block; margin: auto;"></a></div></td><td rowspan="2" class="link-enhancr-element" style="width: 1px; background-color: #e5e5e5;"><div class="link-enhancr-element" style="width: 1px; background-color: #e5e5e5;"></div></td><td class="link-enhancr-element" colspan="2" style="width: 100%; vertical-align: middle; font-family: \'Georgia\', \'Times\', \'Times New Roman\', \'serif\';" id="yui_3_13_0_ym1_1_1394599549111_2975"><div class="link-enhancr-text-part link-enhancr-element" style="line-height:16.5px; background-color: #ffffff; height: 130px; width: 279px;" id="yui_3_13_0_ym1_1_1394599549111_2974"><div class="link-enhancr-element" style="word-wrap: break-word; padding: 7px 20px 0px 14px;" id="yui_3_13_0_ym1_1_1394599549111_2973"><span class="link-enhancr-element icon  icon-shrink link-enhancr-toggle link-enhancr-toggle-onboarding"></span><span class="link-enhancr-element icon icon-close link-enhancr-delete" id="yui_3_13_0_ym1_1_1394599549111_2972"></span><a href="http://travel.yahoo.com/blogs/compass/echoes-sinbad-sailor-flickr-photo-day-200611534.html" class="link-enhancr-card-urlWrapper link-enhancr-element" style="text-decoration: none !important; color: #000000 !important;"><span class="link-enhancr-element link-enhancr-card-title" style="margin: 0; font-weight: normal;margin-bottom: 4px; font-size: 18px; line-height: 21px; max-height: 43px; color: #000000; overflow: hidden !important; display: inline-block;">Echoes of Sinbad the sailor: Flickr photo of the day</span></a><div style="font-size: 13px; line-height: 20px; color: #999999; max-height: 81px; font-family: \'Georgia\', \'Times\', \'Times New Roman\', \'serif\';overflow: hidden;" class="link-enhancr-card-description link-enhancr-element">Since ancient times, Arab merchant dhows, carrying dates and fish, have sailed down the Red Sea to the Indian Ocean (a voyage of over a thousand mile...</div></div></div></td><td class="link-enhancr-element" rowspan="2" style="width: 1px; background-color: #e5e5e5;"><div class="link-enhancr-element" style="width: 1px; background-color: #e5e5e5;"></div></td></tr><tr><td class="link-enhancr-element" style="width: 100%; vertical-align: middle; font-family: \'Arial\', \'Helvetica Neue\', \'Helvetica\', \'sans-serif\';"><div class="link-enhancr-element" style="padding: 7px 20px 9px 15px;"><a href="http://travel.yahoo.com/blogs/compass/echoes-sinbad-sailor-flickr-photo-day-200611534.html" class="link-enhancr-card-url link-enhancr-element" style="color: black; text-decoration: none !important;cursor:pointer !important;" target="_blank"><span class="link-enhancr-element link-enhancr-view-on" style="display: inline-block; line-height: 11px; max-width: 179px; min-width: 119px; overflow: hidden; max-height: 13px; word-break: break-all;" id="yui_3_13_0_ym1_1_1394599549111_2971"><span class="link-enhancr-element link-enhancr-mobile-no-resize" style="vertical-align:middle; font-size: 9px; line-height: 11px; color: #999999; -moz-text-size-adjust: none; -ms-text-size-adjust: none; -webkit-text-size-adjust:none; text-size-adjust:none;">View on <span style="font-weight: bold">travel.yahoo.com</span></span></span></a></div></td><td class="link-enhancr-element" style="vertical-align: middle; width: 100px; font-family: \'Arial\', \'Helvetica Neue\', \'Helvetica\', \'sans-serif\';"><div class="link-enhancr-element link-enhancr-preview-wrapper" style="padding: 9px 20px 12px 0px; max-width: 100px; min-width: 80px; overflow: hidden; text-align: right; line-height: 11px; max-height: 13px;"><span class="link-enhancr-element link-enhancr-preview-by link-enhancr-mobile-no-resize" style="vertical-align:middle; font-size: 9px; line-height: 11px; color: #999999; -moz-text-size-adjust: none; -ms-text-size-adjust: none; -webkit-text-size-adjust:none; text-size-adjust:none;">Preview by Yahoo</span></div></td></tr><tr class="link-enhancr-element"><td class="link-enhancr-element" colspan="6" style="height: 1px; background-color: #e5e5e5;"><div class="link-enhancr-element" style="height: 1px; background-color: #e5e5e5;"></div></td></tr></tbody></table></div><div>  <p id="link-enhancr-promo-email-try-pasting">    Try pasting another link to a story or even a video…    <p><span><br class="yui-cursor"></span></p>  </p></div><table><tbody><tr><td style="height:50px">    <span style="color: rgb(128, 128, 128);">      <font size="2">        P.S. Like what you see?  Share this story      </font>    </span>    <div contenteditable="false" style="vertical-align:middle; display:inline-block;">      <a class="enhancr-promo-facebook" href="https://www.facebook.com/sharer/sharer.php?u=http%3A%2F%2Fyahoomail.tumblr.com%2Fpost%2F79395405926%2Fbringing-links-to-life-with-link-preview" target="_blank" style="text-decoration: none !important;cursor:pointer !important;">        <img src="https://s.yimg.com/nq/a/img/thm/fb_icon_02202014.png" alt="Share on facebook" width="30">      </a>      <a class="enhancr-promo-twitter" href="https://twitter.com/intent/tweet?text=Bringing%20Links%20to%20Life%20with%20Link%20Preview&url=http%3A%2F%2Fyahoomail.tumblr.com%2Fpost%2F79395405926%2Fbringing-links-to-life-with-link-preview" target="_blank" style="text-decoration: none !important;cursor:pointer !important;">        <img src="https://s.yimg.com/nq/a/img/thm/twitter_icon_02202014.png" alt="Share on twitter" width="30">      </a>    </div></td></tr></tbody></table>'}),a.Tictac.attach.rollups.attachment_well=a.Handlebars.template(function(a,b,c,d,e){return this.compilerInfo=[4,">= 1.0.0"],c=this.merge(c,a.helpers),e=e||{},'<div class="attachments-well hidden compose-ignore" contenteditable="false"></div>'}),a.Tictac.attach.rollups.link_enhancr_onboarding_big_card=a.Handlebars.template(function(a,b,c,d,e){return this.compilerInfo=[4,">= 1.0.0"],c=this.merge(c,a.helpers),e=e||{},'<div style="width:450px; font-family: \'Georgia\', \'Times\', \'Times New Roman\', \'serif\';" contenteditable="false" id="enhancrCard_0" class="link-enhancr-attachment link-enhancr-element link-enhancr-onboarding-big-card"><table class="link-enhancr-element" cellspacing="0" cellpadding="0" style="width:450px; height:170px; position: relative; margin-top:5px; margin-bottom: 5px; display: block;" id="yui_3_13_0_ym1_1_1394599549111_2978"><tbody id="yui_3_13_0_ym1_1_1394599549111_2977"><tr class="link-enhancr-element"><td colspan="6" class="link-enhancr-element" style="height: 1px; background-color: #e5e5e5;"><div class="link-enhancr-element" style="height: 1px; background-color: #e5e5e5;"></div></td></tr><tr class="link-enhancr-element" id="yui_3_13_0_ym1_1_1394599549111_2976"><td rowspan="2" class="link-enhancr-element" style="width: 1px; background-color: #e5e5e5;"><div class="link-enhancr-element" style="width: 1px; background-color: #e5e5e5;"></div></td><td class="link-enhancr-element" rowspan="2" style="vertical-align: middle; width: 168px; height: 168px; background-color: #000000;"><div class="link-enhancr-element" style="width: 168px;" align="center"><a href="http://travel.yahoo.com/blogs/compass/echoes-sinbad-sailor-flickr-photo-day-200611534.html" class="link-enhancr-card-urlWrapper link-enhancr-element" style="text-decoration: none !important; color: #000000 !important;"><img alt="image" src="http://l.yimg.com/bt/api/res/1.2/XzqRo0dnWcSFxFBuUh16Vw--/YXBwaWQ9eW5ld3M7cT04NTt3PTYwMA--/http://media.zenfs.com/en-US/blogs/compass/dhow.jpg" class="link-enhancr-thumbnail-image link-enhancr-element" width="168" height="102" style="display: block; margin: auto;"></a></div></td><td rowspan="2" class="link-enhancr-element" style="width: 1px; background-color: #e5e5e5;"><div class="link-enhancr-element" style="width: 1px; background-color: #e5e5e5;"></div></td><td class="link-enhancr-element" colspan="2" style="width: 100%; vertical-align: middle; font-family: \'Georgia\', \'Times\', \'Times New Roman\', \'serif\';" id="yui_3_13_0_ym1_1_1394599549111_2975"><div class="link-enhancr-text-part link-enhancr-element" style="line-height:16.5px; background-color: #ffffff; height: 130px; width: 279px;" id="yui_3_13_0_ym1_1_1394599549111_2974"><div class="link-enhancr-element" style="word-wrap: break-word; padding: 7px 20px 0px 14px;" id="yui_3_13_0_ym1_1_1394599549111_2973"><span class="link-enhancr-element icon  icon-shrink link-enhancr-toggle link-enhancr-toggle-onboarding"></span><span class="link-enhancr-element icon icon-close link-enhancr-delete" id="yui_3_13_0_ym1_1_1394599549111_2972"></span><a href="http://travel.yahoo.com/blogs/compass/echoes-sinbad-sailor-flickr-photo-day-200611534.html" class="link-enhancr-card-urlWrapper link-enhancr-element" style="text-decoration: none !important; color: #000000 !important;"><span class="link-enhancr-element link-enhancr-card-title" style="margin: 0; font-weight: normal;margin-bottom: 4px; font-size: 18px; line-height: 21px; max-height: 43px; color: #000000; overflow: hidden !important; display: inline-block;">Echoes of Sinbad the sailor: Flickr photo of the day</span></a><div style="font-size: 13px; line-height: 20px; color: #999999; max-height: 81px; font-family: \'Georgia\', \'Times\', \'Times New Roman\', \'serif\';overflow: hidden;" class="link-enhancr-card-description link-enhancr-element">Since ancient times, Arab merchant dhows, carrying dates and fish, have sailed down the Red Sea to the Indian Ocean (a voyage of over a thousand mile...</div></div></div></td><td class="link-enhancr-element" rowspan="2" style="width: 1px; background-color: #e5e5e5;"><div class="link-enhancr-element" style="width: 1px; background-color: #e5e5e5;"></div></td></tr><tr><td class="link-enhancr-element" style="width: 100%; vertical-align: middle; font-family: \'Arial\', \'Helvetica Neue\', \'Helvetica\', \'sans-serif\';"><div class="link-enhancr-element" style="padding: 7px 20px 9px 15px;"><a href="http://travel.yahoo.com/blogs/compass/echoes-sinbad-sailor-flickr-photo-day-200611534.html" class="link-enhancr-card-url link-enhancr-element" style="color: black; text-decoration: none !important;cursor:pointer !important;" target="_blank"><span class="link-enhancr-element link-enhancr-view-on" style="display: inline-block; line-height: 11px; max-width: 179px; min-width: 119px; overflow: hidden; max-height: 13px; word-break: break-all;" id="yui_3_13_0_ym1_1_1394599549111_2971"><span class="link-enhancr-element link-enhancr-mobile-no-resize" style="vertical-align:middle; font-size: 9px; line-height: 11px; color: #999999; -moz-text-size-adjust: none; -ms-text-size-adjust: none; -webkit-text-size-adjust:none; text-size-adjust:none;">View on <span style="font-weight: bold">travel.yahoo.com</span></span></span></a></div></td><td class="link-enhancr-element" style="vertical-align: middle; width: 100px; font-family: \'Arial\', \'Helvetica Neue\', \'Helvetica\', \'sans-serif\';"><div class="link-enhancr-element link-enhancr-preview-wrapper" style="padding: 9px 20px 12px 0px; max-width: 100px; min-width: 80px; overflow: hidden; text-align: right; line-height: 11px; max-height: 13px;"><span class="link-enhancr-element link-enhancr-preview-by link-enhancr-mobile-no-resize" style="vertical-align:middle; font-size: 9px; line-height: 11px; color: #999999; -moz-text-size-adjust: none; -ms-text-size-adjust: none; -webkit-text-size-adjust:none; text-size-adjust:none;">Preview by Yahoo</span></div></td></tr><tr class="link-enhancr-element"><td class="link-enhancr-element" colspan="6" style="height: 1px; background-color: #e5e5e5;"><div class="link-enhancr-element" style="height: 1px; background-color: #e5e5e5;"></div></td></tr></tbody></table></div>'}),a.Tictac.attach.rollups.link_enhancr_onboarding_small_card=a.Handlebars.template(function(a,b,c,d,e){return this.compilerInfo=[4,">= 1.0.0"],c=this.merge(c,a.helpers),e=e||{},'<div style="width:450px; font-family: \'Georgia\', \'Times\', \'Times New Roman\', \'serif\';" contenteditable="false" id="enhancrCard_0" class="link-enhancr-attachment link-enhancr-element"><table class="link-enhancr-element" cellspacing="0" cellpadding="0" style="width:450px; height:60px; position: relative; margin-top:5px; margin-bottom: 5px; display: block;" id="yui_3_13_0_ym1_1_1394599549111_3009"><tbody id="yui_3_13_0_ym1_1_1394599549111_3008"><tr class="link-enhancr-element"><td colspan="6" class="link-enhancr-element" style="height: 1px; background-color: #e5e5e5;"><div class="link-enhancr-element" style="height: 1px; background-color: #e5e5e5;"></div></td></tr><tr class="link-enhancr-element" id="yui_3_13_0_ym1_1_1394599549111_3007"><td rowspan="2" class="link-enhancr-element" style="width: 1px; background-color: #e5e5e5;"><div class="link-enhancr-element" style="width: 1px; background-color: #e5e5e5;"></div></td><td class="link-enhancr-element" rowspan="2" style="vertical-align: middle; width: 58px; height: 58px; background-color: #000000;" id="yui_3_13_0_ym1_1_1394599549111_3020"><div class="link-enhancr-element" style="width: 58px;" align="center"><a href="http://travel.yahoo.com/blogs/compass/echoes-sinbad-sailor-flickr-photo-day-200611534.html" class="link-enhancr-card-urlWrapper link-enhancr-element" style="text-decoration: none !important; color: #000000 !important;"><img alt="image" src="http://l.yimg.com/bt/api/res/1.2/XzqRo0dnWcSFxFBuUh16Vw--/YXBwaWQ9eW5ld3M7cT04NTt3PTYwMA--/http://media.zenfs.com/en-US/blogs/compass/dhow.jpg" class="link-enhancr-thumbnail-image link-enhancr-element" width="58" height="35" style="display: block; margin: auto;"></a></div></td><td rowspan="2" class="link-enhancr-element" style="width: 1px; background-color: #e5e5e5;" id="yui_3_13_0_ym1_1_1394599549111_3019"><div class="link-enhancr-element" style="width: 1px; background-color: #e5e5e5;"></div></td><td class="link-enhancr-element" colspan="2" style="width: 100%; vertical-align: middle; font-family: \'Georgia\', \'Times\', \'Times New Roman\', \'serif\';" id="yui_3_13_0_ym1_1_1394599549111_3006"><div class="link-enhancr-text-part link-enhancr-element" style="line-height:16.5px; background-color: #ffffff; height: 34px; width: 389px;" id="yui_3_13_0_ym1_1_1394599549111_3005"><div class="link-enhancr-element" style="word-wrap: break-word; padding: 5px 20px 0px 9px;" id="yui_3_13_0_ym1_1_1394599549111_3004"><span class="link-enhancr-element icon  icon-expand link-enhancr-toggle link-enhancr-toggle-onboarding" id="yui_3_13_0_ym1_1_1394599549111_3003"></span><span class="link-enhancr-element icon icon-close link-enhancr-delete"></span><a href="http://travel.yahoo.com/blogs/compass/echoes-sinbad-sailor-flickr-photo-day-200611534.html" class="link-enhancr-card-urlWrapper link-enhancr-element" style="text-decoration: none !important; color: #000000 !important;" id="yui_3_13_0_ym1_1_1394599549111_3018"><span class="link-enhancr-element link-enhancr-card-title" style="margin: 0; font-weight: normal;font-size: 13px; line-height: 18px; max-height: 19px; color: #000000; overflow: hidden !important; display: inline-block;" id="yui_3_13_0_ym1_1_1394599549111_3017">Echoes of Sinbad the sailor: Flickr photo of the day</span></a><div style="font-size: 11px; line-height: 15px; color: #999999; max-height: 16px; margin-top: -2px; font-family: \'Arial\', \'Helvetica Neue\', \'Helvetica\', \'sans-serif\';overflow: hidden;" class="link-enhancr-card-description link-enhancr-element" id="yui_3_13_0_ym1_1_1394599549111_3010">Since ancient times, Arab merchant dhows, carrying dates and fish, ha...</div></div></div></td><td class="link-enhancr-element" rowspan="2" style="width: 1px; background-color: #e5e5e5;"><div class="link-enhancr-element" style="width: 1px; background-color: #e5e5e5;"></div></td></tr><tr id="yui_3_13_0_ym1_1_1394599549111_3014"><td class="link-enhancr-element" style="width: 100%; vertical-align: middle; font-family: \'Arial\', \'Helvetica Neue\', \'Helvetica\', \'sans-serif\';" id="yui_3_13_0_ym1_1_1394599549111_3016"><div class="link-enhancr-element" style="padding: 1px 20px 1px 10px;" id="yui_3_13_0_ym1_1_1394599549111_3015"><a href="http://travel.yahoo.com/blogs/compass/echoes-sinbad-sailor-flickr-photo-day-200611534.html" class="link-enhancr-card-url link-enhancr-element" style="color: black; text-decoration: none !important;cursor:pointer !important;" target="_blank"><span class="link-enhancr-element link-enhancr-view-on" style="display: inline-block; line-height: 11px; max-width: 289px; min-width: 229px; overflow: hidden; max-height: 13px; word-break: break-all;" id="yui_3_13_0_ym1_1_1394599549111_3002"><span class="link-enhancr-element link-enhancr-mobile-no-resize" style="vertical-align:middle; font-size: 9px; line-height: 11px; color: #999999; -moz-text-size-adjust: none; -ms-text-size-adjust: none; -webkit-text-size-adjust:none; text-size-adjust:none;">View on <span style="font-weight: bold">travel.yahoo.com</span></span></span></a></div></td><td class="link-enhancr-element" style="vertical-align: middle; width: 100px; font-family: \'Arial\', \'Helvetica Neue\', \'Helvetica\', \'sans-serif\';" id="yui_3_13_0_ym1_1_1394599549111_3013"><div class="link-enhancr-element link-enhancr-preview-wrapper" style="padding: 2px 20px 4px 0px;; max-width: 100px; min-width: 80px; overflow: hidden; text-align: right; line-height: 11px; max-height: 13px;" id="yui_3_13_0_ym1_1_1394599549111_3012"><span class="link-enhancr-element link-enhancr-preview-by link-enhancr-mobile-no-resize" style="vertical-align:middle; font-size: 9px; line-height: 11px; color: #999999; -moz-text-size-adjust: none; -ms-text-size-adjust: none; -webkit-text-size-adjust:none; text-size-adjust:none;" id="yui_3_13_0_ym1_1_1394599549111_3011">Preview by Yahoo</span></div></td></tr><tr class="link-enhancr-element"><td class="link-enhancr-element" colspan="6" style="height: 1px; background-color: #e5e5e5;"><div class="link-enhancr-element" style="height: 1px; background-color: #e5e5e5;"></div></td></tr></tbody></table></div>'}),a.Tictac.attach.rollups.enhanced_card_article=a.Handlebars.template(function(a,b,c,d,e){function f(a,b){var d,e="";return(d=c.cardHeight)?d=d.call(a,{hash:{},data:b}):(d=a.cardHeight,d=typeof d===H?d.apply(a):d),e+=I(d)+"px"}function g(a,b){return"auto"}function h(a,b){return"8"}function i(a,b){return"7"}function j(a,b){var d,e="";return e+='<td class="link-enhancr-element" rowspan="5" style="vertical-align: middle; width: ',(d=c.imageSize)?d=d.call(a,{hash:{},data:b}):(d=a.imageSize,d=typeof d===H?d.apply(a):d),e+=I(d)+"px; height: ",(d=c.imageSize)?d=d.call(a,{hash:{},data:b}):(d=a.imageSize,d=typeof d===H?d.apply(a):d),e+=I(d)+'px; background-color: #000000;border-collapse: collapse;"><div class="link-enhancr-element" style="width: ',(d=c.imageSize)?d=d.call(a,{hash:{},data:b}):(d=a.imageSize,d=typeof d===H?d.apply(a):d),e+=I(d)+'px;" align="center"><a href="',(d=c.cardUrl)?d=d.call(a,{hash:{},data:b}):(d=a.cardUrl,d=typeof d===H?d.apply(a):d),e+=I(d)+'" class="link-enhancr-card-urlWrapper link-enhancr-element" style="text-decoration: none !important; color: #000000 !important;"><img alt="image" src="',(d=c.image)?d=d.call(a,{hash:{},data:b}):(d=a.image,d=typeof d===H?d.apply(a):d),e+=I(d)+'" class="link-enhancr-thumbnail-image link-enhancr-element" width="',(d=c.imageWidth)?d=d.call(a,{hash:{},data:b}):(d=a.imageWidth,d=typeof d===H?d.apply(a):d),e+=I(d)+'" height="',(d=c.imageHeight)?d=d.call(a,{hash:{},data:b}):(d=a.imageHeight,d=typeof d===H?d.apply(a):d),e+=I(d)+'" style="display: block; margin: auto;"></a></div></td><td rowspan="5" class="link-enhancr-element" style="width: 1px; background-color: #e5e5e5; font-size: 0pt; border-collapse: collapse;"><div class="link-enhancr-element" style="width: 1px; background-color: #e5e5e5; font-size: 1pt;">&nbsp;</div></td>'}function k(a,b){return"14"}function l(a,b){return"9"}function m(a,b){return"6"}function n(a,b){return"5"}function o(a,b){var d,e="";return e+="height: ",(d=c.cardTextPartHeight)?d=d.call(a,{hash:{},data:b}):(d=a.cardTextPartHeight,d=typeof d===H?d.apply(a):d),e+=I(d)+"px;"}function p(a,b){return"icon-shrink"}function q(a,b){return"icon-expand"}function r(a,b){return"18px"}function s(a,b){return"13px"}function t(a,b){return"margin-bottom: 3px; font-size: 18px; line-height: 21px; max-height: 43px;"}function u(a,b){var d,e="";return e+="font-size: 13px; line-height: ",d=c.if.call(a,a.hasImage,{hash:{},inverse:J.program(34,w,b),fn:J.program(32,v,b),data:b}),(d||0===d)&&(e+=d),e+="px; max-height: 19px;"}function v(a,b){return"15"}function w(a,b){return"16"}function x(a,b){var d,e="";return e+='<div style="',d=c.if.call(a,a.useBigCard,{hash:{},inverse:J.program(39,z,b),fn:J.program(37,y,b),data:b}),(d||0===d)&&(e+=d),e+='overflow: hidden;" class="link-enhancr-card-description link-enhancr-element">',(d=c.description)?d=d.call(a,{hash:{},data:b}):(d=a.description,d=typeof d===H?d.apply(a):d),e+=I(d)+"</div>"}function y(a,b){return"font-size: 13px; line-height: 20px; color: #999999; max-height: 81px; font-family: 'Georgia', 'Times', 'Times New Roman', 'serif';"}function z(a,b){var d,e="";return e+="font-size: 11px; line-height: 15px; color: #999999; max-height: 16px; margin-top: ",d=c.if.call(a,a.hasImage,{hash:{},inverse:J.program(42,B,b),fn:J.program(40,A,b),data:b}),(d||0===d)&&(e+=d),e+="; font-family: 'Arial', 'Helvetica Neue', 'Helvetica', 'sans-serif';"}function A(a,b){return"-2px"}function B(a,b){return"1px"}function C(a,b){return"4"}function D(a,b){var d,e="";return e+='<span class="link-enhancr-video-width link-enhancr-element" title="',(d=c.videoWidth)?d=d.call(a,{hash:{},data:b}):(d=a.videoWidth,d=typeof d===H?d.apply(a):d),e+=I(d)+'"></span><span class="link-enhancr-video-height link-enhancr-element" title="',(d=c.videoHeight)?d=d.call(a,{hash:{},data:b}):(d=a.videoHeight,d=typeof d===H?d.apply(a):d),e+=I(d)+'"></span><span class="link-enhancr-video-src link-enhancr-element" title="',(d=c.videoSrc)?d=d.call(a,{hash:{},data:b}):(d=a.videoSrc,d=typeof d===H?d.apply(a):d),e+=I(d)+'"></span>'}this.compilerInfo=[4,">= 1.0.0"],c=this.merge(c,a.helpers),e=e||{};var E,F,G="",H="function",I=this.escapeExpression,J=this,K=c.blockHelperMissing;return G+='<div style="width:',(E=c.cardWidth)?E=E.call(b,{hash:{},data:e}):(E=b.cardWidth,E=typeof E===H?E.apply(b):E),G+=I(E)+"px; font-family: 'Georgia', 'Times', 'Times New Roman', 'serif';margin-top:5px; margin-bottom: 5px; background-color: #ffffff;\" contenteditable=\"false\" id=\"",(E=c.cardId)?E=E.call(b,{hash:{},data:e}):(E=b.cardId,E=typeof E===H?E.apply(b):E),G+=I(E)+'" class="link-enhancr-attachment link-enhancr-element"><table class="link-enhancr-element" cellspacing="0" cellpadding="0" border="0" style="width:',(E=c.cardWidth)?E=E.call(b,{hash:{},data:e}):(E=b.cardWidth,E=typeof E===H?E.apply(b):E),G+=I(E)+"px; height:",E=c.if.call(b,b.hasImage,{hash:{},inverse:J.program(3,g,e),fn:J.program(1,f,e),data:e}),(E||0===E)&&(G+=E),G+='; position: relative; display: block;"><tr class="link-enhancr-element" class="link-enhancr-element"><td class="link-enhancr-element" colspan="',E=c.if.call(b,b.hasImage,{hash:{},inverse:J.program(7,i,e),fn:J.program(5,h,e),data:e}),(E||0===E)&&(G+=E),G+='"  style="height: 1px; background-color: #e5e5e5; font-size: 1px; border-collapse: collapse;"><div class="link-enhancr-element" style="height: 1px; background-color: #e5e5e5; font-size: 1px; line-height:0px;">&nbsp;</div></td></tr><tr class="link-enhancr-element"><td rowspan="5" class="link-enhancr-element" style="width: 1px; background-color: #e5e5e5; font-size: 1pt; border-collapse: collapse;"><div class="link-enhancr-element" style="width: 1px; background-color: #e5e5e5; font-size: 1pt;">&nbsp;</div></td>',F={hash:{},inverse:J.noop,fn:J.program(9,j,e),data:e},(E=c.hasImage)?E=E.call(b,F):(E=b.hasImage,E=typeof E===H?E.apply(b):E),c.hasImage||(E=K.call(b,E,F)),(E||0===E)&&(G+=E),G+='<td rowspan="5" class="link-enhancr-element" style="width: ',E=c.if.call(b,b.useBigCard,{hash:{},inverse:J.program(13,l,e),fn:J.program(11,k,e),data:e}),(E||0===E)&&(G+=E),G+='px; background-color: #ffffff; font-size: 0pt; border-collapse: collapse;"><div class="link-enhancr-element" style="width: ',E=c.if.call(b,b.useBigCard,{hash:{},inverse:J.program(13,l,e),fn:J.program(11,k,e),data:e}),(E||0===E)&&(G+=E),G+="px; background-color: #ffffff; font-size: ",E=c.if.call(b,b.useBigCard,{hash:{},inverse:J.program(13,l,e),fn:J.program(11,k,e),data:e}),(E||0===E)&&(G+=E),G+='pt;">&nbsp;</div></td><td colspan="2" class="link-enhancr-element" style="height: ',E=c.if.call(b,b.useBigCard,{hash:{},inverse:J.program(17,n,e),fn:J.program(15,m,e),data:e}),(E||0===E)&&(G+=E),G+='px; background-color: #ffffff; font-size: 0pt; border-collapse: collapse;"><div class="link-enhancr-element" style="height: ',E=c.if.call(b,b.useBigCard,{hash:{},inverse:J.program(17,n,e),fn:J.program(15,m,e),data:e}),(E||0===E)&&(G+=E),G+="px; background-color: #ffffff; font-size: ",E=c.if.call(b,b.useBigCard,{hash:{},inverse:J.program(17,n,e),fn:J.program(15,m,e),data:e}),(E||0===E)&&(G+=E),G+='pt;">&nbsp;</div></td><td rowspan="5" class="link-enhancr-element" style="width: 20px; background-color: #ffffff; font-size: 0pt; border-collapse: collapse;"><div class="link-enhancr-element" style="width: 20px; background-color: #ffffff; font-size: 20pt;">&nbsp;</div></td><td class="link-enhancr-element" rowspan="5" width="1" style="width: 1px; background-color: #e5e5e5; font-size: 1pt; border-collapse: collapse;"><div class="link-enhancr-element" style="width: 1px; background-color: #e5e5e5; font-size: 1pt;">&nbsp;</div></td></tr><tr><td class="link-enhancr-element" colspan="2" style="width: 100%; vertical-align: middle; font-family: \'Georgia\', \'Times\', \'Times New Roman\', \'serif\';"><div class="link-enhancr-text-part link-enhancr-element" style="line-height:16.5px; background-color: #ffffff; ',F={hash:{},inverse:J.noop,fn:J.program(19,o,e),data:e},(E=c.hasImage)?E=E.call(b,F):(E=b.hasImage,E=typeof E===H?E.apply(b):E),c.hasImage||(E=K.call(b,E,F)),(E||0===E)&&(G+=E),G+=" width: ",(E=c.cardTextPartWidth)?E=E.call(b,{hash:{},data:e}):(E=b.cardTextPartWidth,E=typeof E===H?E.apply(b):E),G+=I(E)+'px;"><div class="link-enhancr-element" style="word-wrap: break-word; word-break: break-all;"><span class="link-enhancr-element icon  ',E=c.if.call(b,b.useBigCard,{hash:{},inverse:J.program(23,q,e),fn:J.program(21,p,e),data:e}),(E||0===E)&&(G+=E),G+=' link-enhancr-toggle"></span><span class="link-enhancr-element icon icon-close link-enhancr-delete"></span><a href="',(E=c.cardUrl)?E=E.call(b,{hash:{},data:e}):(E=b.cardUrl,E=typeof E===H?E.apply(b):E),G+=I(E)+'" class="link-enhancr-card-urlWrapper link-enhancr-element" style="text-decoration: none !important; color: #000000 !important; line-height: 100%; font-size: ',E=c.if.call(b,b.useBigCard,{hash:{},inverse:J.program(27,s,e),fn:J.program(25,r,e),data:e}),(E||0===E)&&(G+=E),G+='; display: block;"><span class="link-enhancr-element link-enhancr-card-title" style="margin: 0; font-weight: normal;',E=c.if.call(b,b.useBigCard,{hash:{},inverse:J.program(31,u,e),fn:J.program(29,t,e),data:e}),(E||0===E)&&(G+=E),G+=' color: #000000; overflow: hidden !important; display: inline-block;">',(E=c.title)?E=E.call(b,{hash:{},data:e}):(E=b.title,E=typeof E===H?E.apply(b):E),G+=I(E)+"</span></a>",F={hash:{},inverse:J.noop,fn:J.program(36,x,e),data:e},(E=c.hasDescription)?E=E.call(b,F):(E=b.hasDescription,E=typeof E===H?E.apply(b):E),c.hasDescription||(E=K.call(b,E,F)),(E||0===E)&&(G+=E),G+='</div></div></td></tr><tr><td colspan="2" class="link-enhancr-element" style="height: ',E=c.if.call(b,b.hasImage,{hash:{},inverse:J.program(15,m,e),fn:J.program(44,C,e),data:e}),(E||0===E)&&(G+=E),G+='px; background-color: #ffffff; font-size: 0pt; border-collapse: collapse;"><div class="link-enhancr-element" style="height: ',E=c.if.call(b,b.hasImage,{hash:{},inverse:J.program(15,m,e),fn:J.program(44,C,e),data:e}),(E||0===E)&&(G+=E),G+="px; background-color: #ffffff; font-size: ",E=c.if.call(b,b.hasImage,{hash:{},inverse:J.program(15,m,e),fn:J.program(44,C,e),data:e}),(E||0===E)&&(G+=E),G+='pt;"></div></td></tr><tr><td class="link-enhancr-element" style="vertical-align: middle; font-family: \'Arial\', \'Helvetica Neue\', \'Helvetica\', \'sans-serif\';"><div class="link-enhancr-element" style="font-size: 0pt;"><a href="',
(E=c.cardUrl)?E=E.call(b,{hash:{},data:e}):(E=b.cardUrl,E=typeof E===H?E.apply(b):E),G+=I(E)+'" class="link-enhancr-card-url link-enhancr-element" style="color: black; text-decoration: none !important;cursor:pointer !important;" target="_blank"><span class="link-enhancr-element link-enhancr-view-on" style="display: inline-block; line-height: 11px; max-width: ',(E=c.cardViewOnMaxWidth)?E=E.call(b,{hash:{},data:e}):(E=b.cardViewOnMaxWidth,E=typeof E===H?E.apply(b):E),G+=I(E)+"px; min-width: ",(E=c.cardViewOnMinWidth)?E=E.call(b,{hash:{},data:e}):(E=b.cardViewOnMinWidth,E=typeof E===H?E.apply(b):E),G+=I(E)+'px; overflow: hidden; max-height: 13px; word-break: break-all;"><span class="link-enhancr-element link-enhancr-mobile-no-resize" style="vertical-align:middle; font-size: 9px; line-height: 11px; color: #999999; -moz-text-size-adjust: none; -ms-text-size-adjust: none; -webkit-text-size-adjust:none; text-size-adjust:none;">',(E=c.viewOnMarkup)?E=E.call(b,{hash:{},data:e}):(E=b.viewOnMarkup,E=typeof E===H?E.apply(b):E),(E||0===E)&&(G+=E),G+="</span></span></a>",F={hash:{},inverse:J.noop,fn:J.program(46,D,e),data:e},(E=c.hasVideoData)?E=E.call(b,F):(E=b.hasVideoData,E=typeof E===H?E.apply(b):E),c.hasVideoData||(E=K.call(b,E,F)),(E||0===E)&&(G+=E),G+='</div></td><td class="link-enhancr-element" style="vertical-align: middle; width: ',(E=c.previewByMaxWidth)?E=E.call(b,{hash:{},data:e}):(E=b.previewByMaxWidth,E=typeof E===H?E.apply(b):E),G+=I(E)+"px; font-family: 'Arial', 'Helvetica Neue', 'Helvetica', 'sans-serif';\"><div class=\"link-enhancr-element link-enhancr-preview-wrapper\" style=\"max-width: ",(E=c.previewByMaxWidth)?E=E.call(b,{hash:{},data:e}):(E=b.previewByMaxWidth,E=typeof E===H?E.apply(b):E),G+=I(E)+"px; min-width: ",(E=c.previewByMinWidth)?E=E.call(b,{hash:{},data:e}):(E=b.previewByMinWidth,E=typeof E===H?E.apply(b):E),G+=I(E)+'px; overflow: hidden; text-align: right; line-height: 11px; max-height: 13px; font-size: 0pt;"><span class="link-enhancr-element link-enhancr-preview-by link-enhancr-mobile-no-resize" style="line-height: 11px; vertical-align:middle; font-size: 9px; line-height: 11px; color: #999999; -moz-text-size-adjust: none; -ms-text-size-adjust: none; -webkit-text-size-adjust:none; text-size-adjust:none;">',(E=c.previewPart)?E=E.call(b,{hash:{},data:e}):(E=b.previewPart,E=typeof E===H?E.apply(b):E),(E||0===E)&&(G+=E),G+='</span></div></td></tr></tr><tr><td colspan="2" class="link-enhancr-element" style="height: ',E=c.if.call(b,b.useBigCard,{hash:{},inverse:J.program(17,n,e),fn:J.program(13,l,e),data:e}),(E||0===E)&&(G+=E),G+='px; background-color: #ffffff; font-size: 0pt; border-collapse: collapse;"><div class="link-enhancr-element" style="height: ',E=c.if.call(b,b.useBigCard,{hash:{},inverse:J.program(17,n,e),fn:J.program(13,l,e),data:e}),(E||0===E)&&(G+=E),G+="px; background-color: #ffffff; font-size: ",E=c.if.call(b,b.useBigCard,{hash:{},inverse:J.program(17,n,e),fn:J.program(13,l,e),data:e}),(E||0===E)&&(G+=E),G+='pt;"></div></td></tr><tr class="link-enhancr-element" class="link-enhancr-element"><td class="link-enhancr-element" colspan="',E=c.if.call(b,b.hasImage,{hash:{},inverse:J.program(7,i,e),fn:J.program(5,h,e),data:e}),(E||0===E)&&(G+=E),G+='"  style="height: 1px; background-color: #e5e5e5; font-size: 1px; border-collapse: collapse;"><div class="link-enhancr-element" style="height: 1px; background-color: #e5e5e5; font-size: 1px; line-height:0px">&nbsp;</div></td></tr></table></div>'})},"1.0.0",{requires:["handlebars-base"]});YUI.add("tictac-attach-enhancr-card",function(a){"use strict";function b(a,b,c,d){var e,f,g,h=d.aTagNode,j=this;e=a,f="enhancrCard_"+t,t++,j.parentNode=b.cardParentNode,j.evtHandlers=[],j.url=a,j.tmStart=(new Date).getTime(),j.getType=function(){return d.cardType},g=h?h.get("text"):"",!b.cardInfo.title||d.cardType!==u.HLFS||d.linkSource&&"link-editor"===d.linkSource||h.set("text",b.cardInfo.title),i({scope:this,cardId:f,url:e,useBigCard:d.useBigCard,managerFn:c,isEnter:d.isEnter,aTagNode:h,cardInfo:b.cardInfo,urlDomain:b.urlDomain,originalLinkText:g})}function c(a,b,c){var d,e={},f=function(b,d,f,j){var k={};d=parseInt(d,10),f=parseInt(f,10),b.originImageWidth=d,b.originImageHeight=f,e=h(b,d,f),k=i(d,f),b.imageWidth=k.imageWidth,b.imageHeight=k.imageHeight,b.imageDetails=(j?"after":"before:")+a.imageWidth+"x"+a.imageHeight,g(b),c(b)},h=function(a){var b,c={};return b=v.CARD_WIDTH-(a.hasImage?(a.useBigCard?v.BIG_CARD_IM_WIDTH:v.SMALL_CARD_IM_WIDTH)+3*v.BORDER_WIDTH:2*v.BORDER_WIDTH)-(a.useBigCard?v.BIG_CARD_TEXT_PART_PADDING.left+v.BIG_CARD_TEXT_PART_PADDING.right:v.SMALL_CARD_TEXT_PART_PADDING.left+v.SMALL_CARD_TEXT_PART_PADDING.right),a.cardTextPartWidth=b,a.cardViewOnMaxWidth=b-v.PREVIEW_BY_MAX_WIDTH,a.cardViewOnMinWidth=a.cardViewOnMaxWidth-v.PREVIEW_BY_PADDING_RIGHT_COMPOSE,c=a.useBigCard?{width:v.BIG_CARD_IM_WIDTH,height:v.BIG_CARD_IM_HEIGHT}:{width:v.SMALL_CARD_IM_WIDTH,height:v.SMALL_CARD_IM_HEIGHT},a.cardTextPartHeight=a.useBigCard?v.BIG_CARD_IM_HEIGHT-v.BIG_CARD_VIEW_ON_PADDING.top-v.BIG_CARD_VIEW_ON_PADDING.bottom-v.BIG_CARD_VIEW_ON_HEIGHT-v.BIG_CARD_TEXT_PART_PADDING.top:v.SMALL_CARD_IM_HEIGHT-v.SMALL_CARD_VIEW_ON_HEIGHT-v.SMALL_CARD_VIEW_ON_PADDING.top-v.SMALL_CARD_VIEW_ON_PADDING.bottom-v.SMALL_CARD_TEXT_PART_PADDING.top,a.imageSize=a.useBigCard?v.BIG_CARD_IM_WIDTH:v.SMALL_CARD_IM_WIDTH,a.cardHeight=a.useBigCard?v.BIG_CARD_IM_PART_HEIGHT:v.SMALL_CARD_IM_PART_HEIGHT,c},i=function(a,b){var c,d;return d=e,a>d.width||b>d.height?(c=Math.max(a/d.width,b/d.height),a=Math.round(a/c),b=Math.round(b/c)):a<d.width&&b<d.height&&(c=Math.min(d.width/a,d.height/b),a=Math.round(a*c),b=Math.round(b*c)),{imageWidth:a,imageHeight:b}};a.imageHeight&&a.imageWidth?f(b,a.imageWidth,a.imageHeight,!1):(d=new Image,d.onload=function(){f(b,d.width,d.height,!0)},d.onerror=function(){b.hasImage=!1,g(b),c(b)},d.onabort=d.onerror,d.src=a.url)}function d(b,f,i){var j,k,l,m,n,o,p,r,t,v,w,x=this,y=q.enhanced_card_article,z=y(b),A=a.Node.create(z),B=f.removeFn,C=f.insertHTML,D=f.isEnter,E=f.isEnter||x.getType()!==u.HLFS;if(i)x._cardNode.replace(A);else if(s("enhancr_card_added",{count:x.age(),message:b.imageDetails}),x.getType()===u.HLFS)n=f.parentNode,o=f.getLastCardNode(n,f.aTagNode),l=n===o,D&&p||o.next()&&"P"===o.next().get("tagName").toUpperCase()||(m=o.get("id"),j='<p id="'+m+'"> &nbsp;</p>',k=a.Node.create(j),o.insert(k,"after")),o.insert(A,"after");else{r=a.Node.create("<div></div>"),r.append(A);var F=A.getAttribute("id");C(r.get("innerHTML"),E),A=a.one("#"+F)}A.all(".link-enhancr-mobile-no-resize").setAttribute("style","vertical-align:middle; font-size: 9px; line-height: 11px; color: #999999; -moz-text-size-adjust: none; -ms-text-size-adjust: none; -webkit-text-size-adjust:none; text-size-adjust:none;"),x.deleteHandler=function(a){a.halt(),f.aTagNode&&f.aTagNode.get("text")===b.originTitle&&f.aTagNode.set("text",f.originalLinkText||b.cardUrl),B(x)},x._cardNode=A,x.toggleHandler=function(e){var h,i=b;e.halt(),i.useBigCard=!i.useBigCard,i.title=i.originTitle,i.description=i.originDescription,i.viewOnMarkup=a.Tictac.attach.strings.str_enhancr_card_view_on.replace("{{link}}",'<span style="font-weight: bold">'+a.Escape.html(i.originUrlDomain)+"</span>"),i.hasImage?(h={url:i.image,imageWidth:i.originImageWidth,imageHeight:i.originImageHeight},a.each(x.evtHandlers,function(a){a.detach()}),c(h,i,function(a){d.apply(x,[a,f,!0])})):(g(i),d.apply(x,[i,f,!0]))},e(x),v=A.one(".link-enhancr-card-title"),t=A.one(".link-enhancr-card-description"),w=A.one(".link-enhancr-view-on"),v&&h(v,!0),t&&h(t,!0),w&&h(w,!0,w.one(".link-enhancr-view-on-domain"))}function e(b){if(b._cardNode){if(a.each(b.evtHandlers,function(a){a.detach()}),b.toggleHandler){var c=b._cardNode.one(".link-enhancr-toggle");c&&b.evtHandlers.push(c.once("click",b.toggleHandler))}if(b.deleteHandler){var d=b._cardNode.one(".link-enhancr-delete");d&&b.evtHandlers.push(d.once("click",b.deleteHandler))}}}function f(a,b){return a&&a.length>b&&(a=a.substring(0,b),a+="..."),a}function g(a){var b=a.useBigCard?a.hasImage?56:100:a.hasImage?58:67,c=a.useBigCard?a.hasImage?164:281:a.hasImage?79:90,d=a.title,e=a.description;b&&d&&(a.title=f(d,b)),c&&e&&(a.description=f(e,c))}function h(a,b,c){var d,e=!1,f=a.get("clientHeight"),g=c?c:a;if(a.get("scrollHeight")-f>5)for(e=!0,d=g.getContent();a.get("scrollHeight")-f>5&&d.length>0;)d=d.slice(0,-1),g.setHTML(d);e&&b&&(d=d.substring(0,d.length-3)+"...",g.setHTML(d))}function i(b){var e,f,h=b.scope,i=b.cardInfo,j=b.url,k=b.urlDomain?b.urlDomain:"",l=b.cardId,m=i.image,n=i.video,o=i.type,p={parentNode:h.parentNode,removeFn:b.managerFn.remove,getLastCardNode:b.managerFn.getLastCardNode,insertHTML:b.managerFn.insertHTML,isEnter:b.isEnter,aTagNode:b.aTagNode,originalLinkText:b.originalLinkText},q=a.Tictac.attach.strings.str_enhancr_card_view_on.replace("{{link}}",'<span style="font-weight: bold" class="link-enhancr-view-on-domain">'+a.Escape.html(k)+"</span>"),r={previewPart:i.previewPart,cardId:l,title:i.title,originTitle:i.title,cardUrl:j,hasImage:!!m.url,image:m.url,useBigCard:b.useBigCard,hasDescription:!!i.description,description:i.description,originDescription:i.description,cardWidth:v.CARD_WIDTH,cardTableWidth:v.CARD_WIDTH-2*v.BORDER_WIDTH,cardTextPartWidth:v.CARD_WIDTH-2*v.BORDER_WIDTH-(b.useBigCard?v.BIG_CARD_TEXT_PART_PADDING.left+v.BIG_CARD_TEXT_PART_PADDING.right:v.SMALL_CARD_TEXT_PART_PADDING.left+v.SMALL_CARD_TEXT_PART_PADDING.right),originUrlDomain:k,viewOnMarkup:q,hasVideoData:!1,type:o,useImageCard:"image"===o?!0:!1,previewByMaxWidth:v.PREVIEW_BY_MAX_WIDTH,previewByMinWidth:v.PREVIEW_BY_MIN_WIDTH};r.cardViewOnMaxWidth=r.cardTextPartWidth-v.PREVIEW_BY_MAX_WIDTH,r.cardViewOnMinWidth=r.cardViewOnMaxWidth-v.PREVIEW_BY_PADDING_RIGHT_COMPOSE,"video"===o&&n.html&&(e=a.Node.create(n.html),r.videoWidth=e.get("width"),r.videoHeight=e.get("height"),r.videoSrc=e.get("src"),r.hasVideoData=!0),r.hasImage?(f={url:m.url,imageWidth:m.width,imageHeight:m.height},c(f,r,function(a){d.apply(h,[a,p])})):(g(r),d.apply(h,[r,p]))}function j(a){var b=a.type,c=a.image.url;return"image"===b||"video"===b?!!c:"article"===b?c?!(!a.title&&!a.description):!(!a.title||!a.description):!1}function k(a,b){var c;if(a)return c=a.get("className")&&a.get("className").indexOf("link-enhancr-element")>=0?a.ancestor("div.link-enhancr-attachment",!0):a.ancestor(function(a){return"block"===a.getStyle("display")||a.get("id")===b.get("id")},!0),c.get("id")===b.get("id")&&p("Should not get the RTE container. There is a Problem."),c.get("className").indexOf("yahoo_quoted")>=0&&(c=a),c}function l(a,b){var c=a.ancestor(".link-enhancr-attachment",!1,function(a){return a===b});return!!c}function m(a,b,c){function d(){var a=(new Date).getTime()-e;return 50*Math.round(a/50)}var e=(new Date).getTime();r.getLinkEnhancements(a,{success:function(a,e){var f=j(a),g={cardInfo:a,urlDomain:e};f&&b(g),s("enhancr_card_call_success",{count:d()}),c(f)},fail:function(){p("Getting Link Info Failed"),s("enhancr_card_call_fail",{count:d()}),c(!1)}})}function n(b){var c=b.hasClass("link-enhancr-onboarding-big-card");b.replace(a.Node.create(c?q.link_enhancr_onboarding_small_card():q.link_enhancr_onboarding_big_card()))}var o=a.Tictac.base.utils,p=o.log,q=a.Tictac.attach.rollups,r=a.Tictac.attach.enhancr.Net,s=a.Tictac.attach.Stats.stat,t=0,u={DROPBOX:"dropbox",FLICKR:"flickr",HLFS:"platform-card"},v={CARD_WIDTH:450,BIG_CARD_IM_PART_HEIGHT:170,SMALL_CARD_IM_PART_HEIGHT:60,BIG_CARD_IM_WIDTH:168,BIG_CARD_IM_HEIGHT:168,SMALL_CARD_IM_WIDTH:58,SMALL_CARD_IM_HEIGHT:58,BORDER_WIDTH:1,SMALL_CARD_VIEW_ON_HEIGHT:13,BIG_CARD_VIEW_ON_HEIGHT:14,PREVIEW_BY_MAX_WIDTH:100,PREVIEW_BY_MIN_WIDTH:80,PREVIEW_BY_PADDING_RIGHT_COMPOSE:60,BIG_CARD_VIEW_ON_PADDING:{top:4,bottom:9},SMALL_CARD_VIEW_ON_PADDING:{top:4,bottom:5},BIG_CARD_TEXT_PART_PADDING:{top:6,right:20,left:14},SMALL_CARD_TEXT_PART_PADDING:{top:5,right:20,left:9}};a.mix(b.prototype,{deleteCard:function(){var b=this;b._cardNode&&b._cardNode.remove(!0),a.each(b.evtHandlers,function(a){a.detach()})},age:function(){var a=(new Date).getTime()-this.tmStart;return 50*Math.round(a/50)}}),a.augment(b.prototype,a.EventTarget);var w=function(){w.superclass.constructor.apply(this,arguments)};a.extend(w,a.Plugin.Base,{initializer:function(c){function d(a){var b,c=w.get("id"),d=function(a){for(var b,c;;){if(c=a.get("firstChild"),!c)return a;if(c.hasClass("link-enhancr-attachment"))return a;if(b=c.getComputedStyle("display"),"block"!==b&&"inline-block"!==b)return a;a=c}};if(a&&a.get("id")!==c&&a.ancestor("#"+c))return a;if(a=w.get("firstChild"),a=d(a),b=a.siblings(),b.size()){if(a=b.item(b.size()-1),!G&&"block"===a.getComputedStyle("display")&&!a.hasClass("signature"))return a;if("block"===a.getComputedStyle("display")&&-1===a.get("className").indexOf("quoted_text")&&!a.hasClass("signature"))return a;for(a=a.previous();a.previous()&&"block"!==a.getComputedStyle("display")&&a.hasClass("signature");)a=a.previous()}return a}function f(b){var c,d=v.config.doc,e=d.createRange();a.UA.ie||a.UA.gecko?e.setStartAfter(b):(e.selectNodeContents(b),e.collapse(!1)),c=d.getSelection(),c.removeAllRanges(),c.addRange(e)}function g(b,c){var d,e,f;c=c||a,f=c.config.doc,d=f.getSelection(),d.rangeCount&&(e=d.getRangeAt(0),e.deleteContents(),e.insertNode(b))}function h(b){var c,d,e,h,i=v.config.doc;f(b.getDOMNode()),a.UA.ie||a.UA.gecko?(c=b.cloneNode(),c.setAttribute("id",""),c.generateID(),a.UA.ie?(d=c.getDOMNode(),a.UA.ie>10&&(d.innerHTML=v.EditorSelection.CURSOR),g(d,v)):(h=a.Node.create("<div></div>").append(c).getHTML(),e=new v.EditorSelection,e.anchorNode=a.one(i.getSelection().anchorNode),e.focusNode=a.one(i.getSelection().focusNode),e.anchorOffset=i.getSelection().anchorOffset,c.append(v.EditorSelection.CURSOR),e.focusCursor(),t.execCommand("inserthtml",h))):(t.execCommand("insertparagraph"),e=i.getSelection(),!a.Lang.trim(e.anchorNode.textContent)&&e.anchorNode.children.length<1&&t.execCommand("insertlinebreak"))}function i(b,c){var d,e,h,i=null;return f(c.getDOMNode()),a.UA.ie?(e=a.Node.create("<div></div>"),e.setHTML(b),i=e.get("firstChild").get("id"),g(e.get("firstChild").getDOMNode(),v),h=v.config.doc.getSelection(),d=a.one(h.anchorNode)):(t.execCommand("inserthtml",b),d=k((new v.EditorSelection).anchorNode,w)),d.hasClass("link-enhancr-attachment")||(d=d.one(i?"#"+i:".link-enhancr-attachment:lastChild")),d&&d.setAttribute("contenteditable",!1),d}function j(c,e,g){var j,l={remove:K,getLastCardNode:N,insertHTML:function(b,c){var e,g,j=t.frame.get("container"),l=j.get("children"),m=l.item(l.size()-1);return t.focus(),e=new v.EditorSelection,e.anchorNode?m=e.anchorNode:(e=v.config.win.getSelection(),m=a.one(e.anchorNode)),m=!o||!o.ancestor("#"+j.get("id"))||G&&o.hasClass("yahoo_quoted")?d(m):k(o,j),h(m),g=i(b,m),o=g&&g.next()||H&&g.ancestor()&&g.ancestor().next()||o,c?o&&f(o.getDOMNode()):m&&f(m.getDOMNode()),g}};return A++,g.useBigCard=!0,e.cardInfo.previewPart=I,j=new b(c,e,l,g),r.push(j),t.fire("cardAdded"),j}var o,q=this,r=[],t=q.get("host"),v=t.getInstance(),w=t.frame.get("container"),x=t.get("toolbarNode"),y=x?x.one("#enhancr-spinner"):null,z=y?new a.comms.ui.Envelope(y):null,A=0,B=[],C=[],D={},E={},F=0,G=c.isReply,H=c.isDraft,I=a.Tictac.attach.strings.str_enhancr_card_preview_by,J="Yahoo",K=function(b){var c=a.Array.indexOf(r,b);b.deleteCard(),r.splice(c,1),A--,s("enhancr_card_removed")},L=function(){a.each(r,function(a){a._cardNode.ancestor()||K(a)},this)},M=function(a){return D[a]?!1:(D[a]=!0,F++,!0)},N=function(b,c){var d,e=c.ancestor(function(a){return a.get("id")===w.get("id")||a.ancestor()&&"block"===a.ancestor().getStyle("display")},!0),f=null,g=function(b){return a.Lang.trim(b),0!==b.indexOf("http")&&(b="http://"+b),b},h=function(a){var b,c,d,e,h,i=a.all("a");for("A"===a.get("tagName").toUpperCase()&&i.push(a),b=i.size(),c=b-1;c>=0;c--)if(d=i.item(c),e=d.get("id"),h=g(d.getAttribute("href")),D[h]&&D[h][e])return f=D[h][e],!0;return!1},i=function(a){var b=a.previous(function(a){return h(a)});return!b};return i(c)&&e.previous(function(a){return h(a)}),f&&(d=f._cardNode,d&&d.next()&&(b=d.next())),b.get("id")===w.get("id")?c:b},O=function(){var b="div[class*='link-enhancr-attachment'][id*='enhancrCard_']",c=w.all(b);c.size()&&q._set("hadCardsInOriginal",!0),a.each(c,function(b){var c,d="a[class*='link-enhancr-card-urlWrapper']",e=b.one(d),f=b.one("img[class*='link-enhancr-thumbnail-image']"),g=b.one("div[class*='link-enhancr-preview-by']"),h=b.one("span[class*='link-enhancr-card-config']"),i=b.one("a"),j=b.all("span[class*='link-enhancr-mobile-no-resize']");j.setAttribute("style","vertical-align:middle; font-size: 9px; line-height: 11px; color: #999999; -moz-text-size-adjust: none; -ms-text-size-adjust: none; -webkit-text-size-adjust:none; text-size-adjust:none;"),h&&h.get("title")&&(c=a.Tictac.base.utils.parseJSON(h.get("title"))),e&&(e.setAttribute("class","link-enhancr-card-urlWrapper link-enhancr-element"),e.setAttribute("style","text-decoration: none !important; color: #000000 !important;")),f&&f.setAttribute("class","link-enhancr-thumbnail-image link-enhancr-element"),g&&g.setAttribute("class","link-enhancr-preview-by link-enhancr-element"),b.setAttribute("contenteditable",!1),i&&i.setAttribute("contenteditable",!1)})};I=I.replace("{{img}}",J),B.push(t.once("renderComplete",O)),B.push(t.on("nodeChange",function(a){a.changedNode&&a.changedNode.get("id")!==w.get("id")&&(o=a.changedNode)})),B.push(w.on("paste",function(b){var c,d,e=k(b.target,w),f=function(a){return document.createTreeWalker(a.getDOMNode(),NodeFilter.SHOW_TEXT)};C.push(a.later(0,this,function(){w.all('div[class$="link-enhancr-attachment"]').setAttribute("contenteditable",!1),a.each(w.all('div[class$="link-enhancr-attachment"]'),function(a){a.all("br").remove(!0)})})),c=e.next(),c||(c=e.cloneNode(!0),d=f(c).firstChild(),d&&(d.parentNode.innerHTML="&nbsp;"),e.ancestor().append(c))})),B.push(w.on("click",function(a){var b,c=a.target,d=c.get("className"),e=c.ancestor('a[class*="link-enhancr-card-url"]',!0,function(a){return a===w});/\w*link-enhancr-delete\w*/.test(c.get("className"))?(a.halt(),b=c.ancestor('div[class*="link-enhancr-attachment"]',!1,function(a){return a===w}),b&&(b.remove(!0),t.fire("cardAdded"))):/\w*link-enhancr-toggle-onboarding\w*/.test(c.get("className"))?(a.halt(),b=c.ancestor('div[class*="link-enhancr-attachment"]',!1,function(a){return a===w}),b&&n(b)):d.indexOf("link-enhancr-element")>=0&&(!e||e.get("className").indexOf("link-enhancr-card-urlWrapper")>=0)?a.halt():d.indexOf("enhancr-promo-facebook")>=0?s("enhancr_promo_facebook"):d.indexOf("enhancr-promo-twitter")>=0&&s("enhancr_promo_twitter")})),q.loadingSpinner=z,B.push(q.on("destroy",function(){a.each(r,function(a){a.deleteCard()}),r=[],A=0,a.each(C,function(a){a.cancel()}),a.each(B,function(a){a.detach()})})),B.push(t.on("cardify",function(b,c){var d,e={isEnter:!1,aTagNode:null,cardType:c};a.each(b.details[0],function(a){d=a.cardInfo.url,j(d,a,e)})})),B.push(t.on("link",function(b){if(NeoConfig.linkEnhancrEnabled&&!q.get("disabled")){var c,d=b.node,e=k(d,w),f=a.Lang.trim(d.getAttribute("href")),g=b.trigger===a.Tictac.attach.enhancr.AutolinkPlugin.TRIGGERS.ENTER,h=b.linkSource,i=d.get("id")?d.get("id"):d.generateID(),n=x?x.one("#enhancr-spinner"):null,o=x?x.one(".save-draft-msg"):null,r=function(b){if(w&&w.getDOMNode()){var c,k=a.mix(b,{cardParentNode:e});c=j(f,k,{linkSource:h,isEnter:g,aTagNode:d,cardType:u.HLFS}),E[i]=c,D[f]=E}},s=function(a){F>0&&F--,n&&0===F&&(n.addClass("hidden"),z.stop(),o.show()),a||(A--,delete D[f])},t=/^[a-zA-Z0-9]+\:/;L(),t.test(f)&&(c=f.match(t)[0],"http:"!==c&&"https:"!==c)||M(f)&&!l(d,w)&&(n&&n.hasClass("hidden")&&(o.hide(),z.start(),n.removeClass("hidden")),p(f),m(f,r,s))}})),B.push(t.on("loadstate",function(){for(var a=0;a<r.length;a++){var b=r[a];if(b._cardNode){var c=b._cardNode.getAttribute("id"),d=w.one("#"+c);d&&d!==b._cardNode&&(b._cardNode=d,e(b))}}})),q._getCardList=function(){return r}},destructor:function(){this.fire("destroy")},destroySpinner:function(){this.loadingSpinner&&this.loadingSpinner.destroy()}},{NAME:"cards",NS:"cards",ATTRS:{host:{value:!1},hadCardsInOriginal:{readOnly:!0,value:!1,validator:function(b){return a.Lang.isBoolean(b)}},disabled:{value:!1,validator:function(b){return a.Lang.isBoolean(b)},getter:function(){var b=a.Tictac.base.mailpreferences.get("enhancrLinkPreviewEnabled")||"1";return"-1"===b?!0:!1}}}}),a.namespace("Tictac.attach.enhancr").CardPlugin=w,a.namespace("Tictac.attach.enhancr").Card=b,b.Types=u},"1.0.0",{requires:["tictac-attach-enhancr-net","tictac-attach-stats","tictac-base-mailpreferences","tictac-base-utils","array-extras","escape","querystring-stringify-simple","base","tictac-attach-rollups","event-custom","comms-ui-envelope"]});YUI.add("tictac-attach-neo",function(a){"use strict";function b(){return-1!==NeoConfig.attachmentServer.indexOf("-attach")&&-1===NeoConfig.attachmentServer.indexOf("cnh")&&-1===NeoConfig.attachmentServer.indexOf("cnb")}function c(){var a;return a=b()?"https://":NeoConfig.launch_protocol,a+=NeoConfig.attachmentServer+"/",a+=NeoConfig.isFullSSL&&!NeoConfig.isAttachSSL?window.location.host:[strings.str_cfg_base_intl,".",NeoConfig.farm,".mail.yahoo.","jp"===NeoConfig.intl?"co.jp":"com"].join(""),a+="/ya/upload_with_cred?output=xml"}a.namespace("Tictac.attach").Neo={neoConfig:NeoConfig,makeHTML5UploaderConf:function(){var a={UPLOAD_URL_BASE:c(),LAUNCH_PROTOCOL:location.protocol+"//",uploader:{multipleFiles:!0,simLimit:1}};return a},alert:function(b,c,d){var e=a.ui.Templates,f=a.common.Utils.substitute;a.use("common-ui-dialog-helper","_shared_module_offscreen_bin_modal_btn_ok",function(a){a.common.ui.DialogHelper.custom({hd:b,bd:c,ft:f(e._shared_module_offscreen_bin_modal_btn_ok.base,0,0,0,strings,e)},{ok:{handler:d},cancel:{handler:d}})})},dialog:function(b,c,d){a.use("common-ui-dialog-helper",function(a){a.common.ui.DialogHelper.confirm({hd:b,bd:c},d)})}},a.namespace("tictac.attach").Neo=a.Tictac.attach.Neo},"1.0.0",{requires:[]});YUI.add("tictac-attach-model-attachment",function(a){"use strict";function b(b,d){var h=this,i=["fid","mid","partId","tnef","disposition","displayable"],j=/[\w\W]+\\([^\\]+)$/;h.id=b,e(d.filename,"filename required"),h.rawFilename=(d.filename||"").replace(j,"$1"),h.filename=a.Escape.html(h.rawFilename),h.thumbnail=d.thumbnail||"",h.size=d.size||0,h.mimetype=d.type&&d.subtype?d.type+"/"+d.subtype:"",h.type=d.type||"",h.referencedInline=d.referencedInline||!1,h.diskfilename=d.diskfilename||"",h.uploadState=d.uploadState||"queued",h.hasProgress=!!d.hasProgress,h.retryCount=0,h.uploadStartTime=0,e(c(h.uploadState),"illegal upload state:"+h.uploadState),h.reason=d.reason||"",h.progress=d.progress||0,d.original&&(e(g.keys(d.original).length===i.length,"Attachment original didn't include all members"),f.each(i,function(a){e(g.owns(d.original,a),"Attachment original missing key: "+a)}),h.original=d.original),d.dropbox&&("undefined"==typeof d.dropbox.alf&&(d.dropbox.alf=!1),h.dropbox=d.dropbox)}function c(a){return!!d[a]}var d=a.Array.hash(["queued","started","failed","success"]),e=a.Tictac.base.utils.verify,f=a.Array,g=a.Object;b.prototype={setUploadState:function(a,b){var d=this;b=b||"",e(c(a),"illegal upload state: "+a),d.uploadState=a,d.reason=b},isUploadValid:function(){var a=this;return"success"===a.uploadState},isVirusFree:function(){var a=this;return!("uploadAVCannotClean"===a.reason||"uploadAVHasVirus"===a.reason)},isDropbox:function(){return!!this.dropbox},isUploadDone:function(){var a=this;return"success"===a.uploadState||"failed"===a.uploadState},isInline:function(){return this.isImage()&&(this.referencedInline===!0||"inline"===this.disposition||this.original&&"inline"===this.original.disposition)},setMimeType:function(a){var b,c=this;a=a||"",a.toLowerCase(),b=a.split("/"),c.mimetype=a,c.type=a.split("/")[0]},isImage:function(){return"image"===this.type},updateMid:function(a){var b=this;b.original&&"Draft"===b.original.fid&&(b.original.mid=a)}},a.namespace("Tictac.attach.model"),a.Tictac.attach.model.Attachment=b,a.namespace("tictac.attach.model").Attachment=b},"1.0.0",{requires:["tictac-base-utils","tictac-attach-utils","escape"]});YUI.add("tictac-attach-model-attachments",function(a){"use strict";function b(){var a=this;return a.map={},a.quotaViolation={},a.evts=[a.publish("added"),a.publish("updated"),a.publish("deleted"),a.publish("emptied"),a.publish("failures"),a.publish("quota",{emitFacade:!0}),a.publish("commit")],a}var c=a.Tictac.attach.model.Attachment,d=a.Tictac.base.utils.verify,e=a.Tictac.base.utils.log,f=a.Tictac.attach.Utils.isSvrResponseWarning,g=0,h={MAX_BYTES:26214400,MAX_COUNT:25};b.prototype={cleanup:function(){a.each(this.evts,function(a){a.detachAll()})},checkId:function(a){return this.map.hasOwnProperty(a)},sizeInBytes:function(b){return a.Array.reduce(a.Object.values(this.map),0,function(a,c){return!b&&c.isDropbox()?a:a+c.size})},count:function(b){return b=b||function(a){return!a.isDropbox()},a.Array.reduce(a.Object.values(this.map),0,function(a,c){return a+(b(c)?1:0)})},numFailures:function(){return a.Array.reduce(a.Object.values(this.map),0,function(a,b){return a+("failed"===b.uploadState?1:0)})},numFailuresAndWarnings:function(){return a.Array.reduce(a.Object.values(this.map),0,function(a,b){return a+("failed"===b.uploadState||f(b.reason)?1:0)})},areSendable:function(){return!a.Array.some(a.Object.values(this.map),function(a){return"success"!==a.uploadState})},areAnyUploading:function(){return a.Array.some(a.Object.values(this.map),function(a){return"started"===a.uploadState||"queued"===a.uploadState})},areAnyInfected:function(){return a.Array.some(a.Object.values(this.map),function(a){return!a.isVirusFree()})},areAllWarningOrSuccess:function(){return a.Array.every(a.Object.values(this.map),function(a){return"success"===a.uploadState||f(a.reason)})},areAllUploadsDone:function(){return!a.Array.some(a.Object.values(this.map),function(a){return!a.isUploadDone()})},precheckQuota:function(a,b,c){var d=this,e={};return d.sizeInBytes()+b>h.MAX_BYTES&&(e.size=!0),d.count()+a>h.MAX_COUNT&&(e.count=!0),e.count||e.size?(c||d.fireQuotaViolation(e),!0):!1},willFit:function(a){return!this.precheckQuota(0,a,!0)},add:function(a,b){var d,e,f=this;return g+=1,d="ATT_"+g,e=new c(d,a),f.map[d]=e,f.fire("added",e,b),b||f.fire("commit"),f.checkQuota(),d},get:function(a){var b=this;if(b.checkId(a))return b.map[a];throw["Bad attachment id (",a,"), deleted?"].join("")},getAll:function(b,c){var d=a.Object.values(this.map);return b||(d=a.Array.filter(d,function(a){return!a.isDropbox()})),c&&(d=a.Array.filter(d,function(a){return!a.isInline()})),d.sort(function(a,b){var c=parseInt(a.id.substr(4),10),d=parseInt(b.id.substr(4),10);return c-d})},order:function(b){var c,e=this.getAll();return d(this.checkId(b),"id not valid in order: "+b),a.Array.some(e,function(a,d){return a.id!==b?!1:(c=d,!0)}),c},del:function(a,b){var c=this,d=c.get(a);delete c.map[a],c.fire("deleted",d),b||c.fire("commit"),c.count()||c.fire("emptied"),c.checkQuota(),c.fire("failures",c.numFailuresAndWarnings())},commit:function(){this.fire("commit")},delDownToQuota:function(){var a,b=this,c=b.getAll();for(a=c.length-1;a>=0;a-=1){if(!b.isQuotaViolated())return;b.del(c[a].id)}},isQuotaViolated:function(){var a=this;return a.quotaViolation.size||a.quotaViolation.count},setUploadState:function(a,b){var c,d=this;return d.checkId(a)?(c=d.get(a),c.setUploadState(b.state,b.reason),d.fire("updated",c),b.squelchCommit||d.fire("commit"),d.checkQuota(),void("started"!==b.state&&d.fire("failures",d.numFailuresAndWarnings()))):void e("aborting setUploadState on "+a)},set:function(b,c,e){var f=this,g=f.get(b);d(a.Object.owns(g,c),"Invalid field:"+c),g[c]=e,f.fire("updated",g)},findDropbox:function(b){var c=this,d=null,e=c.getAll(!0);return a.Array.some(e,function(a){return a.isDropbox()&&a.dropbox.link===b.link?(d=a,!0):!1}),d},fireQuotaViolation:function(a){this.fire("quota",{violation:a})},updateMid:function(b){a.each(this.map,function(a){a.updateMid(b)})}},a.mix(b.prototype,{checkQuota:function(){var a=this,b={};a.sizeInBytes()>h.MAX_BYTES&&(b.size=!0),a.count()>h.MAX_COUNT&&(b.count=!0),(a.quotaViolation.size!==b.size||a.quotaViolation.count!==b.count)&&(a.quotaViolation=b,a.fireQuotaViolation(b))}}),a.namespace("Tictac.attach.model").Attachments=b,a.namespace("Tictac.attach.model.Attachments").conf=h,a.namespace("tictac.attach.model").Attachments=b,a.namespace("tictac.attach.model.Attachments").conf=h,a.augment(b,a.EventTarget,!0,null,{prefix:"attachments"})},"1.0.0",{requires:["array-extras","event-custom","tictac-base-utils","tictac-attach-model-attachment","tictac-attach-utils","tictac-att-filter"]});YUI.add("tictac-att-progressbar",function(a){"use strict";function b(){}b.prototype={render:function(b){var c=this;c.bar=a.Node.create('<span><span class="tt-progressbar-bar"></span></span>'),c.rail=a.Node.create('<div class="tt-progressbar-rail"></div>'),c.rail.append(c.bar),a.one(b).append(c.rail),c.width=c.rail.get("width"),c.set(0)},set:function(b){b=parseFloat(b),a.Lang.isNumber(b)&&this.bar.setStyle("width",Math.max(0,Math.min(100,b))+"%")},cleanup:function(){var a=this;a.bar.remove(!0),a.rail.remove(!0),a.bar=null,a.rail=null}},a.namespace("Tictac.widget").Progressbar=b},"1.0.0",{requires:["node"]});YUI.add("tictac-att-attachment-compose",function(a){"use strict";function b(){b.superclass.constructor.apply(this,arguments)}function c(){c.superclass.constructor.apply(this,arguments)}var d=a.Tictac.att;b.NAME="attachment",a.extend(b,d.Attachment,{activate:function(){var b=this,c=new a.Tictac.widget.Progressbar,d=this.getNode();c.render(b.getNode()),b.progressbar=c,d&&(d.addClass("tictac-att-uploading"),(d.one(".tictac-att-other-save-btn")||d.one(".tictac-att-thumb-save-options")).hide(),d.hasClass("tictac-att-other")&&d.one(".tictac-att-cancel-file-uploading").removeClass("hidden"))},setProgress:function(a){this.progressbar&&this.progressbar.set(a)},deactivate:function(){var a,b=this,c=this.getNode();b.progressbar&&(b.progressbar.cleanup(),b.progressbar=null),c&&(a=c.one(".tictac-att-other-save-btn")||c.one(".tictac-att-thumb-save-options"),a&&a.show(),c.removeClass("tictac-att-uploading"),c.hasClass("tictac-att-other")&&c.one(".tictac-att-cancel-file-uploading").addClass("hidden"))}}),d.AttachmentProgressbar=b,c.NAME="attachment",a.extend(c,d.Attachment,{activate:function(){this.getNode().addClass("tictac-att-uploading")},deactivate:function(){this.getNode().removeClass("tictac-att-uploading")}}),d.AttachmentSpinny=c},"1.0.0",{requires:["tictac-att-attachments","tictac-att-progressbar"]});YUI.add("tictac-attach-view",function(a){"use strict";function b(b,c,d){function e(a){return a.halt(),!1}var g=this;g.model=b,g.controller=c,g.rte=d.rte,g.stat=a.Tictac.attach.Controller.conf.stat,g.username=d.username?d.username:"The sender";var h=d.tray,i=d.rte.getDocRoot().ancestor(".inner");if(h)h.setAttribute("contentEditable","false");else if(j&&j.attachment_well){var k=j.attachment_well({});d.tray=h=a.Node.create(k)}i&&h&&i.append(h),g.tray=new a.Tictac.att.AttachmentTray({attachments:new a.Tictac.att.Collection,isCompose:!0,boundingBox:d.tray}),g.evtHandles=[g.tray.on("removeall",g.cmdRemoveAllAttachments,g),g.tray.on("norton",g.nortonClick,g),g.model.on("added",g.addAttachment,g),g.model.on("deleted",g.removeAttachment,g),g.model.on("updated",g.updateAttachment,g),g.model.on("failures",g.updateFailureText,g),g.model.on("emptied",g.updateAttachmentEmpty,g),g.model.after("quota",function(a){(a.violation.size||a.violation.count)&&g.onQuotaViolated(a.violation,a.isDialogHandled)}),g.tray.on("menu-item-selected",function(a){var b;a.attachment&&(b=a.attachment.getId(),"remove"===a.action?g.cmdRemoveAttachment(b):"download"===a.action?g.cmdDownloadAttachment(b):"save_dropbox"===a.action&&g.cmdSaveAttachmentToDropbox(b),"retry"===a.action&&a.attachment&&(this._attachmentMenu.allowSimClick(),g.cmdRetryAttachment(a.attachment.getId())))})];var l=0,m=[],n=d.tray;n&&(m.push(n.delegate("click",function(a){if(!a.target.ancestor(".tictac-att-thumb-save-options")){var b=new Date,c=b-l;c>1&&e(a),l=b}},".tictac-att-viewer")),m.push(n.delegate("key",function(a){13===a.keyCode&&a.shiftKey?e(a,!0):13===a.keyCode&&e(a)},"down:13",".tictac-att-thumb"))),d.dropbox&&f.hasTictacModule("tictac-dropbox")&&a.use("tictac-dropbox-cardhandler",function(a){g&&g.rte&&g.model&&g.username&&(g.cardHandler=new a.Tictac.dropbox.CardHandler(g.rte,g.model,g.username))})}function c(a){return a.isDropbox()?!1:e.filter(a)}function d(a,b){var c,d,e;a&&(a.setAttribute("tabindex",b),c=a.one("a.tictac-att-show-dd-icon"),d=a.one(".tictac-att-thumb-save-options"),e=a.one(".tictac-att-remove"),c&&c.setAttribute("tabindex",b),d&&d.setAttribute("tabindex",b),e&&e.setAttribute("tabindex",b))}var e=a.Tictac.att.filter,f=a.Tictac.base.utils,g=f.getVal,h=a.Tictac.attach.Utils.isSvrResponseWarning,i={ERROR_TITLE:"ERROR_TITLE",ERROR_SIZE:"ERROR_SIZE",ERROR_COUNT:"ERROR_COUNT",alert:function(){}},j=a.Tictac.attach.rollups,k=/[\w\W]+\.([^\.]+$)/;a.extend(b,a.Base,{updateFailureText:function(a){var b=this;return 0===a?void b.tray.hideError():void b.tray.showError(b.model.areAllWarningOrSuccess()?"tray:compose_warning":"tray:compose_error",a)},onQuotaViolated:function(a,b){var c,d=this;c=a.size?i.ERROR_SIZE:i.ERROR_COUNT,b||i.alert({hd:i.ERROR_TITLE,bd:c,restoreFocusNode:d.tray.get("boundingBox")}),d.model.delDownToQuota()},isDownloadable:function(a){return a.isUploadValid()&&!a.isDropbox()},addAttachment:function(b,d){var f,h=this,i=h.tray.get("boundingBox");if(!a.Tictac.att.filter.isInlineImage(b))return 0===h.model.count(c)?void h.tray.hide():void(c(b)&&(h.tray.show(),d&&!this._pendingScroll&&(this._pendingScroll=!0,setTimeout(function(){this._pendingScroll=!1,i.scrollIntoView()},0)),f=new a.Tictac.att["Attachment"+(b.hasProgress?"Progressbar":"Spinny")]({filename:b.filename,thumbnail:b.thumbnail,size:b.size}),f.setId(b.id),f.set("dropbox",b.dropbox?!0:!1),h.tray.addAttachment(f),b.isUploadDone()?(f.set("removable",!0),f.updateProperty("filetype",e.map(b.mimetype,b.filename.replace(k,"$1"),!1))):(f.updateProperty("cancelable",!0),f.activate(),h.tray.setStatus([b.id],"uploading")),h.isDownloadable(b)&&f.set("downloadable",!0),g(a,"Tictac.dropbox.controller")&&f.set("shareable",!0)))},updateAttachment:function(b){var d=this,e=d.tray.get("attachments"),f=e.get(b.id);f&&a.Lang.isNumber(b.size)&&f.update({size:b.size}),c(b)&&(b.hasProgress&&f.setProgress(b.progress),b.thumbnail&&f.updateProperty("thumbnail",b.thumbnail),f&&"success"===b.uploadState?d.successHandler(f,b):f&&"failed"===b.uploadState&&d.failureHandler(f,b))},successHandler:function(b,c){var f,g,i=this,j="compose:generic_warning",l=i.tray.get("boundingBox");switch(b.data.size=c.size,b.set("cancelable",!1),b.set("removable",!0),b.set("retryable",!1),b.updateProperty("error",{}),i.isDownloadable(c)&&b.set("downloadable",!0),c.reason){case"uploadAVNotScannable":j="compose:password_protection";break;case"uploadAVCleaned":j="compose:virus_cleaned"}b.updateProperty("error",h(c.reason)?a.Tictac.att.attError(j):{}),b.updateProperty("filetype",e.map(c.mimetype,c.filename.replace(k,"$1"))),b.deactivate(),i.tray.clearStatus([c.id],"uploading"),i.stat("view_upload_success"),f=l&&l.one('li[tabindex="0"]'),f&&d(f,-1),g=b.getNode(),g&&d(g,0)},failureHandler:function(b,c){var d=this,e="compose:generic_error";switch(c.reason){case"uploadAVCannotClean":case"uploadAVHasVirus":e="compose:virus_not_cleaned"}b.set("cancelable",!1),b.set("removable",!0),b.set("downloadable",!1),b.set("shareable",!1),a.UA.ie||b.set("retryable",!0),b.updateProperty("error",a.Tictac.att.attError(e)),b.deactivate(),d.tray.clearStatus([c.id],"uploading"),d.stat("view_upload_failure")},updateAttachmentEmpty:function(){this.tray.hide()},removeAttachment:function(a){var b,e,f,g,h=this,i=h.tray.get("boundingBox");c(a)&&(e=i.one("li[data-id="+a.id+"]"),b=e?e.previous("li")||e.next("li"):null,!b&&e&&(f=e.ancestor("div"),f.hasClass("tictac-att-thumb-cover")?(g=i.one(".tictac-att-files-cover"),b=g&&g.one("li")):f.hasClass("tictac-att-files-cover")&&(g=i.one(".tictac-att-thumb-cover"),b=g&&g.one("li:last-child"))),b&&d(b,0),h.tray.clearStatus([a.id],"uploading"),h.tray.removeAttachment(a.id))},cmdRemoveAllAttachments:function(){var a=this;a.controller.deleteAttachments(function(a){return!a.isDropbox()}),a.controller.saveDraft(),a.controller.trackClick("att_cmps_rmv")},cmdRemoveAttachment:function(a){var b=this;b.controller.trackClick("att_cmps_mnu_rmv"),b.controller.deleteAttachment(a),b.controller.saveDraft()},cmdRetryAttachment:function(a){this.controller.trackClick("att_cmps_mnu_rtry"),this.controller.retryAttachment(a)},cmdDownloadAttachment:function(b){var c=this,d=c.tray,e=a.Tictac.att.downloader;d.setStatus([b],"scanning"),c.controller.getDownloadInfo(b,function(a){a.aid=b,e.setStats({stat:c.stat}),e.download(d,[a])})},cmdSaveAttachmentToDropbox:function(b){var c=this,d=c.tray;c.controller.trackClick("att_save_to_dropbox"),c.stat("dropbox_saveto",{message:"compose"}),d.setStatus([b],"scanning"),c.controller.getDownloadInfo(b,function(e){e.aid=b,a.use("tictac-dropbox-controller",function(a){a.Tictac.dropbox.controller.saveTo(d,[e],{stat:c.stat})})})},nortonClick:function(){this.controller.trackClick("att_cmps_nrtn")},render:function(){this.tray.render()},cleanup:function(){var b=this;b.tray.destroy(),b.tray=null,b.controller=null,a.each(b.evtHandles,function(a){a.detach&&a.detach()}),delete b.evtHandles,b.cardHandler&&b.cardHandler.cleanup()}}),a.namespace("Tictac.attach").View=b,a.namespace("Tictac.attach.View").conf=i,a.namespace("tictac.attach").View=b,a.namespace("tictac.attach.View").conf=i},"1.0.0",{requires:["base-base","node","tictac-base-utils","tictac-attach-utils","tictac-att-attachment-tray","tictac-att-filter","tictac-att-attachment-compose","tictac-att-attachment-error","tictac-att-attachments","tictac-attach-rollups","tictac-att-downloader"]});YUI.add("tictac-attach-uploader-form",function(a){"use strict";function b(){return a.UA.ie?"IE"+a.UA.ie:a.UA.safari?"Safari"+a.UA.safari:a.UA.chrome?"Chrome"+a.UA.chrome:a.UA.gecko?"Firefox"+a.UA.gecko:"unknown"}function c(a){var b=this;if(!i.UPLOAD_URL_BASE)throw"You must configure UPLOAD_URL_BASE'";return b.type="FORM",b.selectFilesButton=a.selectFilesButton,b.instanceId=j++,b.fileMap={},b.fileCount=0,k[b.instanceId]=b,b.evtHandles=[],b}var d=['<form method="post" enctype="multipart/form-data" ','class="attachment-button-form"></form>'].join(""),e=['<input type="file" id="attachment-button-input" ','name="uploadfile" style="position: absolute; ',"top: 0; right: 0; z-index: 100; opacity: 0; ",'filter: alpha(opacity=0); display:block;">'].join(""),f=['<iframe id="FILE_ID" name="FILE_ID" ','style="display:none;"></iframe>'].join(""),g=["<script>window.onunload=function(){","parent.UploaderService.onIframeUpdate(",'"INSTANCE_ID", "FILE_ID");};',"</script>"].join(""),h=function(a,b){i.stat("form_tt_"+a,b)},i={IFRAME_USE_TIMEOUTS:!0,IFRAME_UPLOAD_TIMEOUT_MS:15e5,IFRAME_POLL_INTERVAL_MS:2e3,IFRAME_MAX_POLL_ATTEMPTS:15,REDIRECT_URL_BASE:document.location.protocol+"//"+document.location.host,UPLOAD_URL_BASE:"",BUILD_ID:0,stat:function(a,b){n("STAT: "+a+":"+b)},stopwatch:function(){n("STOPWATCH not conf'ed."),this.stop=function(){}}},j=0,k={},l=0,m=a.Tictac.base.utils,n=m.log,o=m.verify;window.UploaderService={onIframeUpdate:function(a,b){var c=k[a];c&&c.onIframeUpdate(b)},handlePostRedirectResponse:function(b){var c,d;b&&"?"===b.charAt(0)&&(b=b.substring(1)),d=a.QueryString.parse(b),n("postRedirectResponse parsed "+b,d),o(d.hasOwnProperty("instanceId")&&k[d.instanceId],"UploaderForm unmapped instanceId:"+d.instanceId),c=k[d.instanceId],c.onPostResponse(d)}},c.NAME="tictac-attach-uploader-form",a.mix(c.prototype,{cleanup:function(){var b=this;a.Array.each(b.evtHandles,function(a){a.detach()}),b.selectFilesButton.detachAll(),delete k[b.instanceId]},render:function(b){var c=a.Node.create(d),f=a.Node.create(e),g=this,h=g.evtHandles;b.append(c.append(g.selectFilesButton.append(f))),g.container=b,h=h.concat([f.on("change",g.onFileSelected,g),f.on("click",g.onAttachButtonClicked,g)])},simulateClick:function(){var a=this,b=a.container.one("#attachment-button-input");b._node.click()},startUpload:function(b){function c(){g.abandon(f,"Attachment_UploadNoResponse")}o(a.Lang.isArray(b.fileList)&&1===b.fileList.length,"startUpload got invalid evt.fileList");var d,e=b.currentTarget.ancestor("form"),f=b.fileList[0],g=this;g.fire("fileuploadstart",{file:f}),d=g.makeIframeId(f.id),f.iframe=g.injectIframe(f,d),e.set("target",d),e.set("action",g.makeUploadURL(f.id)),e._node.submit(),h("FormUploader",{message:"onFileSelect"}),f.stopwatch=new i.stopwatch("AttachmentUpload"),f.stopwatch.attType="form",i.IFRAME_USE_TIMEOUTS&&(f.timeout=setTimeout(c,i.IFRAME_UPLOAD_TIMEOUT_MS)),e._node.reset()},cancel:function(a){var b=this,c=b.fileMap[a];o(c,"uploaderForm can't cancel "+a),b.clearCallbacks(c),delete b.fileMap[c.id],c.iframe&&c.iframe.remove(!0),h("Attachment_UploadCancelled"),b.fire("uploadcancel",{file:c})}},!0),a.mix(c.prototype,{makeIframeId:function(a){return l+=1,a+"_"+l},onAttachButtonClicked:function(){this.fire("attachbuttonclick")},onFileSelected:function(a){var b=a.currentTarget,c={name:b.get("value")},d=this;c.name&&(c.id="FORM_FILE_"+d.fileCount,d.fileCount+=1,d.fileMap[c.id]=c,a.fileList=[c],d.fire("fileselect",a))},injectIframe:function(a,b){var c=this;o(c.container,"You forgot to call UploaderForm.render");var d=f.replace(/FILE_ID/g,b),e=c.container.appendChild(d),h=e._node,i=h.contentDocument||h.contentWindow.document;return i.open("text/html","replace"),i.write(g.replace("INSTANCE_ID",c.instanceId).replace("FILE_ID",a.id)),i.close(),e},onIframeUpdate:function(a){var b=this.fileMap[a];return b?(this.clearCallbacks(b),void(b.interval=setInterval(this.makeIframePoller(b),i.IFRAME_POLL_INTERVAL_MS))):void n("UploaderForm IframeLoad for unknown file")},clearCallbacks:function(a){a.timeout&&(clearTimeout(a.timeout),delete a.timeout),a.interval&&(clearInterval(a.interval),delete a.interval),a.evtIframeLoad&&(a.evtIframeLoad.detach(),delete a.evtIframeLoad)},makeIframePoller:function(c){function d(d){var e,g;try{e=d.pathname}catch(i){g="uploaderFormUploadServerHangUp_Error_"+i.message}return e?e:(g=g||"uploaderFormUploadServerHangUp",m+=1,m>2&&(f.abandon(c,g),h("AttachUploadIframeError",{message:a.UA.os+"-"+b()})),null)}function e(){var a=k&&k.location,b=d(a);return o+=1,o>=i.IFRAME_MAX_POLL_ATTEMPTS?void f.abandon(c,"Attachment_UploadTimeout"):b?-1!==b.indexOf("attach.php")?(n("UploaderForm iframe success for "+c.id),f.clearCallbacks(c),void(c.processed=!0)):void(a!==l&&-1===b.indexOf("ya/upload")&&f.abandon(c,"Attachment_UploadUnexpectedResponse")):void 0}var f=this,g=c.iframe._node,j=g.contentDocument||g.contentWindow.document,k=g.contentWindow||j,l=k.location,m=0,o=0;return e},abandon:function(a,b){var c=this;h("abandon",{message:b}),c.clearCallbacks(a),delete c.fileMap[a.id],a.iframe.remove(!0),c.fire("uploaderror",{file:a,reason:b})},makeUploadURL:function(a){var b,c=this;return b=[i.REDIRECT_URL_BASE,"/neo/php/attach.php?instanceId=",c.instanceId,"&bid=",i.BUILD_ID,"&fileId=",a].join(""),[i.UPLOAD_URL_BASE,"?resulturl=",encodeURIComponent(b)].join("")},onPostResponse:function(b){var c,d=this,e="uploadcomplete",f=a.Tictac.attach.Utils;o(b.fileId,"onPostResponse no file id"),n("onPostResponse",b),c=d.fileMap[b.fileId],c.iframe.remove(!0),delete d.fileMap[c.id],c.diskfilename=b.diskfilename,c.mimetype=b.mimetype,c.size=parseInt(b.filesize,10),e=f.isSvrResponseSuccess(b.errorcode)||f.isSvrResponseWarning(b.errorcode)?"uploadcomplete":"uploaderror",c.stopwatch&&(c.stopwatch.attSize=c.size,c.stopwatch.stop(),delete c.stopwatch),d.clearCallbacks(c),c.reason=b.errorcode,h("server_response",{message:c.reason}),d.fire(e,{file:c})}},!0),a.namespace("Tictac.attach").UploaderForm=c,a.namespace("Tictac.attach.UploaderForm").conf=i,a.namespace("tictac.attach").UploaderForm=c,a.namespace("tictac.attach.UploaderForm").conf=i,a.augment(c,a.EventTarget,!0,null,{prefix:"uploaderform"})},"1.0.0",{requires:["event-custom","querystring-parse-simple","tictac-base-utils","tictac-attach-utils"]});YUI.add("tictac-attach-controller",function(a){"use strict";function b(a){return parseInt(i(a,"size","0"),10)||0}function c(a,b,c,d){var e=this;e.uploader=a,e.model=b,e.switchUploaderType=c,e.composeView=d,e.getDownloadInfo=function(a,b){d.attGetDownloadInfo(a,b)},e.aidsByFids={},e.evtHandles=[],e.setUploader(a),d&&e.evtHandles.push(d.on("compose:getDisplayMessageResponse",function(a){a&&e._processGDM(a)}))}function d(b,c){var d;return a.Object.some(b.aidsByFids,function(a,b){return a===c?(d=b,!0):!1}),d}function e(a,b){return a.aidsByFids[b]}function f(a,b,c){return a.model.checkId(c)?!1:(j("aborting "+b+" on "+c),!0)}function g(a,b,c){function d(){b.thumbnail||a.model.set(b.id,"thumbnail",c),j(c)}var e=new Image;return e.src=c,e.complete?void d():(e.onload=d,void a.thumbnailRequests.push(e))}var h=a.Tictac.base.utils,i=h.getVal,j=h.log,k=h.verify,l=5,m=3e4,n=2e3,o={stat:function(){j("stat not conf'ed.")}},p=function(a,b){o.stat("controller_"+a,b)};c.prototype={setUploader:function(a){var b=this;b.uploader=a,b.evtHandles=b.evtHandles.concat([a.on("fileselect",b.fileselect,b),a.on("fileuploadstart",b.fileuploadstart,b),a.on("filedrop",b.filedrop,b),a.on("uploadprogress",b.uploadprogress,b),a.on("uploadcomplete",b.uploadcomplete,b),a.on("uploaderror",b.uploaderror,b),a.on("uploadcancel",b.uploadcancel,b),a.on("uploadfatalerror",b.uploadfatalerror,b),a.on("attachbuttonclick",b.attachButtonClick,b)]),b.thumbnailRequests=[]},uploadfatalerror:function(){var a=this;k("HTML5"===a.uploader.type,"controller only handles fatal errors for HTML5"),a.deleteAttachments(),a.switchUploaderType(!0),window.yui.fire("stat:feature_fail",{feature_group:"COMPOSE_ATTACH",message:"ATTACHCOMPUTER"})},attachButtonClick:function(){this.trackClick("cmps_attfl",{t1:"cmpsTb"})},startUpload:function(c,d,e){var f=this;a.Array.each(d,function(a){var c={filename:a.name,size:b(a),hasProgress:a.hasProgress};e?(c.dropbox={alf:!0},p("db_upload_start",{count:1,size:c.size}),window.yui.fire("stat:feature_invoke",{feature_group:"COMPOSE_ATTACH",message:"ATTACHDROPBOX"})):window.yui.fire("stat:feature_invoke",{feature_group:"COMPOSE_ATTACH",message:"ATTACHCOMPUTER"}),f.aidsByFids[a.id]=f.model.add(c,!0)}),f.model.commit(),f.uploader.startUpload(c,e)},fileselect:function(c){var d,f,g=this,h=g.model,k=c.fileList,l=0,m=0,n=i(a,"Tictac.dropbox.controller");return j("controller fileselect",k),l=a.Array.reduce(k,0,function(a,c){var d=b(c);return m=Math.max(m,d),a+d}),n&&n.dialogIfTooBig(m,k.length>1)?void 0:n&&!h.willFit(l)?(d=function(a){g.startUpload(c,k,a)},f=function(){a.Array.each(k,function(a){var b=e(g,a.id);b&&(g.deleteAttachment(b),j("deleted attachment "+b))})},void n.attachLargeFiles(k.length>1,h,g,d,f)):void(h.precheckQuota(k.length,l)||g.startUpload(c,k))},fileuploadstart:function(a){var b=a.file,c=this,d=e(c,b.id),g=c.model,h=g.get(d);f(c,"fileuploadstart",d)||(h.uploadStartTime||(h.uploadStartTime=(new Date).getTime()),c.model.setUploadState(d,{state:"started"}),j("controller fileuploadstart",b))},filedrop:function(a){this.trackClick("att_cmps_dnd_mlti",{ltxt:a.numberOfFiles})},uploadprogress:function(a){var b=a.file,c=this,d=e(c,b.id);f(c,"uploadprogress",d)||c.model.set(d,"progress",b.percentLoaded)},uploadcomplete:function(b){var c=b.file,d=this,g=d.model,i=e(d,c.id),k=g.get(i);if(k.isDropbox()?window.yui.fire("stat:feature_complete",{feature_group:"COMPOSE_ATTACH",message:"ATTACHDROPBOX_SUCCESS"}):window.yui.fire("stat:feature_complete",{feature_group:"COMPOSE_ATTACH",message:"ATTACHCOMPUTER_SUCCESS"}),!f(d,"uploadcomplete",i)){if(j("controller uploadcomplete",b),a.Lang.isNumber(c.size)){if("FORM"===d.uploader.type&&!g.willFit(c.size))return void d.handleFormSizeViolation(i);k.size=c.size}k.diskfilename=c.diskfilename,k.setMimeType(c.mimetype),k.retryCount>0&&p("controller_uploadretrysuccess"),k.isDropbox()&&c.dropboxLink&&(k.dropbox.link=c.dropboxLink,a.mix(k.dropbox,h.parseJSON(b.data)),p("db_upload_success",{count:1,size:c.size})),d.model.setUploadState(i,{state:"success",reason:c.reason}),!k.isDropbox()&&k.isImage()?d.updateThumbnailURLs():d.saveDraft()}},uploaderror:function(b){var c=b.file,d=this,f=e(d,c.id),g=d.model,h=g.get(f),i=d.uploader,k=(new Date).getTime()-h.uploadStartTime;return!h.isDropbox()&&b.transferFailed&&i.retryUpload&&(0===h.retryCount||m>k&&h.retryCount<l)?(h.retryCount++,void setTimeout(function(){i.retryUpload(c.id)},n)):(j("controller uploaderror",b),"HTML5"===i.type&&b.transferFailed&&p("uploaderror"),h.isDropbox()&&p("db_upload_failure",{count:1,size:c.size}),"FORM"===i.type&&"uploadFileSizeError"===c.reason?void d.handleFormSizeViolation(f):(a.Lang.isNumber(c.size)&&(h.size=c.size),g.setUploadState(f,{state:"failed",reason:c.reason}),void(h.isDropbox()?window.yui.fire("stat:webservice_fail",{feature_group:"COMPOSE_ATTACH",message:c.reason,visible:"yes",api:"DropboxAttachmentUpload"}):window.yui.fire("stat:webservice_fail",{feature_group:"COMPOSE_ATTACH",message:c.reason,visible:"yes",api:"AttachmentUpload"}))))},uploadcancel:function(a){var b=a.file,c=this,d=e(c,b.id);k(!c.model.checkId(d),"Unexpected uploadcancel: "+b.id),j("got uploadcancel")},cancelUploadsInProgress:function(){var b,c=this;a.Array.each(c.model.getAll(),function(a){b=d(c,a.id),b&&!a.isUploadDone()&&(j("cancelling upload: "+a.id+" (fid: "+b+")"),c.uploader.cancel(b),c.model.setUploadState(a.id,{state:"failed",reason:"cancelled"}))})},deleteAttachments:function(b){var c=this,d=0;return a.Array.each(this.model.getAll(!0),function(a){(!b||b(a))&&(c.deleteAttachment(a.id),d+=1)}),d},deleteAttachment:function(a){var b=this,c=this.model.get(a),e=d(b,a);b.model.del(a),e&&(c.isUploadDone()||b.uploader.cancel(e),delete b.aidsByFids[e])},retryAttachment:function(a){var b=this;"HTML5"===b.uploader.type&&(b.cancelUploadsInProgress(),b.switchUploaderType(!1)),b.deleteAttachment(a),b.uploader.simulateClick()},trackClick:function(){a.Tictac.attach.Utils.trackClick.apply(this,arguments)},cleanup:function(){var b=this;b.thumbnailTimer&&b.thumbnailTimer.cancel(),a.each(b.evtHandles,function(a){a.detach&&a.detach()}),delete b.evtHandles,a.each(b.thumbnailRequests,function(a){a.onload=null}),delete b.thumbnailRequests},handleFormSizeViolation:function(b){var c=this,e=c.model,f=i(a,"Tictac.dropbox.controller"),g=1,h=d(c,b);return delete c.aidsByFids[h],e.del(b),g+=c.deleteAttachments(function(a){return!a.isDropbox()&&!a.isUploadDone()}),f?void f.attachLargeFiles(g>1,e,c):void e.fireQuotaViolation({size:!0})},updateThumbnailURLs:function(){var b=this,c=3e3;if(!b.thumbnailTimer){if(b.awaitingGetMsgResponse)return void(b.thumbnailTimer=a.later(c,this,function(){b.thumbnailTimer=null,b.updateThumbnailURLs()}));b.awaitingGetMsgResponse=!0,b.saveDraft()}},saveDraft:function(){var a=this;a.composeView.attGetMsg(function(b){a._processGDM(b)},!0)},_processGDM:function(b){var c=this,d=b.attachments,e=c.model.getAll();c.awaitingGetMsgResponse=!1,b&&b.mid&&b.part&&(d&&a.Lang.isArray(d)&&a.Array.each(d,function(d){var f,h,i;for(f=0,h=e.length;h>f;f++)if(e[f].thumbnail&&d.thumbnailurl&&e[f].thumbnail===a.Lang.trim(d.thumbnailurl)||!e[f].thumbnail&&e[f].filename===a.Lang.trim(d.filename)&&e[f].size===d.size){i=e[f];break}i&&(d.thumbnailurl&&i.isUploadValid()&&!i.thumbnail&&g(c,i,d.thumbnailurl),i.original=i.original||{},i.original.mid=b.mid,i.original.partId=d.partId,i.original.fid="Draft",i.original.disposition=d.disposition,i.original.displayable=d.isDisplayable,i.original.tnef=d.tnefId||d.tnef)}),c.composeView&&c._updateInlineImages(b))},_updateInlineImages:function(b){var c,d,e,f,g,h,i=/http(s)?:\/\/[^\/ ]*\.yahoo\.com\/ya\/download\?[^\"\']*/g,j=/http(s)?:\/\/[^\/ ]*\.yahoo\.com\/ya\/download\?[^\"\']*/,k=this.composeView,l=[],m=[];if(b&&b.part&&k.cdo.get("isRichText")){for(c=NeoConfig.hasConv?k.baseNode:k.getRTEDocNode(),e=0,f=b.part.length;f>e;e++)if(b.part[e].text){d=b.part[e].text;break}if(d){for(g=i.exec(d);g;)l.push(g[0]),g=i.exec(d);h=c.all("img"),h.each(function(a){var b=a.get("src");j.test(b)&&m.push(a)}),m.length===l.length&&a.Array.each(m,function(a,b){a.set("src",l[b])})}}}},a.augment(c,a.EventTarget),a.namespace("Tictac.attach").Controller=c,a.namespace("Tictac.attach.Controller").conf=o,a.namespace("tictac.attach").Controller=c,a.namespace("tictac.attach.Controller").conf=o},"1.0.0",{requires:["tictac-attach-neo","tictac-attach-uploader-form","tictac-attach-model-attachments","tictac-attach-utils","tictac-base-stats","tictac-base-utils"]});/*
YUI 3.16.0 (build 3.16.0-ym15)
Copyright 2014 Yahoo! Inc. All rights reserved.
Licensed under the BSD License.
http://yuilibrary.com/license/
*/

YUI.add("file-html5",function(e,t){var n=e.Lang,r=e.bind,i=e.config.win,s=function(e){var t=null;s.isValidFile(e)?t=e:s.isValidFile(e.file)?t=e.file:t=!1,s.superclass.constructor.apply(this,arguments),t&&s.canUpload()&&(this.get("file")||this._set("file",t),this.get("name")||this._set("name",t.name||t.fileName),this.get("size")!=(t.size||t.fileSize)&&this._set("size",t.size||t.fileSize),this.get("type")||this._set("type",t.type),t.hasOwnProperty("lastModifiedDate")&&!this.get("dateModified")&&this._set("dateModified",t.lastModifiedDate))};e.extend(s,e.Base,{initializer:function(t){this.get("id")||this._set("id",e.guid("file"))},_uploadEventHandler:function(e){var t=this.get("xhr");switch(e.type){case"progress":this.fire("uploadprogress",{originEvent:e,bytesLoaded:e.loaded,bytesTotal:this.get("size"),percentLoaded:Math.min(100,Math.round(1e4*e.loaded/this.get("size"))/100)}),this._set("bytesUploaded",e.loaded);break;case"load":if(t.status>=200&&t.status<=299){this.fire("uploadcomplete",{originEvent:e,data:e.target.responseText});var n=t.upload,r=this.get("boundEventHandler");n.removeEventListener("progress",r),n.removeEventListener("error",r),n.removeEventListener("abort",r),t.removeEventListener("load",r),t.removeEventListener("error",r),t.removeEventListener("readystatechange",r),this._set("xhr",null)}else this.fire("uploaderror",{originEvent:e,data:t.responseText,status:t.status,statusText:t.statusText,source:"http"});break;case"error":this.fire("uploaderror",{originEvent:e,data:t.responseText,status:t.status,statusText:t.statusText,source:"io"});break;case"abort":this.fire("uploadcancel",{originEvent:e});break;case"readystatechange":this.fire("readystatechange",{readyState:e.target.readyState,originEvent:e})}},startUpload:function(t,n,i){this._set("bytesUploaded",0),this._set("xhr",new XMLHttpRequest),this._set("boundEventHandler",r(this._uploadEventHandler,this));var s=new FormData,o=i||"Filedata",u=this.get("xhr"),a=this.get("xhr").upload,f=this.get("boundEventHandler");e.each(n,function(e,t){s.append(t,e)}),s.append(o,this.get("file")),u.addEventListener("loadstart",f,!1),a.addEventListener("progress",f,!1),u.addEventListener("load",f,!1),u.addEventListener("error",f,!1),a.addEventListener("error",f,!1),a.addEventListener("abort",f,!1),u.addEventListener("abort",f,!1),u.addEventListener("loadend",f,!1),u.addEventListener("readystatechange",f,!1),u.open("POST",t,!0),u.withCredentials=this.get("xhrWithCredentials"),e.each(this.get("xhrHeaders"),function(e,t){u.setRequestHeader(t,e)}),u.send(s),this.fire("uploadstart",{xhr:u})},cancelUpload:function(){var e=this.get("xhr");e&&e.abort()}},{NAME:"file",TYPE:"html5",ATTRS:{id:{writeOnce:"initOnly",value:null},size:{writeOnce:"initOnly",value:0},name:{writeOnce:"initOnly",value:null},dateCreated:{writeOnce:"initOnly",value:null},dateModified:{writeOnce:"initOnly",value:null},bytesUploaded:{readOnly:!0,value:0},type:{writeOnce:"initOnly",value:null},file:{writeOnce:"initOnly",value:null},xhr:{readOnly:!0,value:null},xhrHeaders:{value:{}},xhrWithCredentials:{value:!0},boundEventHandler:{readOnly:!0,value:null}},isValidFile:function(e){return i&&i.File&&e instanceof File},canUpload:function(){return i&&i.FormData&&i.XMLHttpRequest}}),e.FileHTML5=s},"3.16.0",{requires:["base"]});
/*
YUI 3.16.0 (build 3.16.0-ym15)
Copyright 2014 Yahoo! Inc. All rights reserved.
Licensed under the BSD License.
http://yuilibrary.com/license/
*/

YUI.add("uploader-queue",function(e,t){var n=function(){this.queuedFiles=[],this.uploadRetries={},this.numberOfUploads=0,this.currentUploadedByteValues={},this.currentFiles={},this.totalBytesUploaded=0,this.totalBytes=0,n.superclass.constructor.apply(this,arguments)};e.extend(n,e.Base,{_currentState:n.STOPPED,initializer:function(){},_uploadStartHandler:function(e){var t=e;t.file=e.target,t.originEvent=e,this.fire("uploadstart",t)},_uploadErrorHandler:function(e){var t=this.get("errorAction"),r=e,i,s;r.file=e.target,r.originEvent=e,this.numberOfUploads-=1,delete this.currentFiles[e.target.get("id")],this._detachFileEvents(e.target),e.target.cancelUpload(),t===n.STOP?this.pauseUpload():t===n.RESTART_ASAP?(i=e.target.get("id"),s=this.uploadRetries[i]||0,s<this.get("retryCount")&&(this.uploadRetries[i]=s+1,this.addToQueueTop(e.target)),this._startNextFile()):t===n.RESTART_AFTER&&(i=e.target.get("id"),s=this.uploadRetries[i]||0,s<this.get("retryCount")&&(this.uploadRetries[i]=s+1,this.addToQueueBottom(e.target)),this._startNextFile()),this.fire("uploaderror",r)},_startNextFile:function(){if(this.queuedFiles.length>0){var e=this.queuedFiles.shift(),t=e.get("id"),n=this.get("perFileParameters"),r=n.hasOwnProperty(t)?n[t]:n;this.currentUploadedByteValues[t]=0,e.on("uploadstart",this._uploadStartHandler,this),e.on("uploadprogress",this._uploadProgressHandler,this),e.on("uploadcomplete",this._uploadCompleteHandler,this),e.on("uploaderror",this._uploadErrorHandler,this),e.on("uploadcancel",this._uploadCancelHandler,this),e.set("xhrHeaders",this.get("uploadHeaders")),e.set("xhrWithCredentials",this.get("withCredentials")),e.startUpload(this.get("uploadURL"),r,this.get("fileFieldName")),this._registerUpload(e)}},_registerUpload:function(e){this.numberOfUploads+=1,this.currentFiles[e.get("id")]=e},_unregisterUpload:function(e){this.numberOfUploads>0&&(this.numberOfUploads-=1),delete this.currentFiles[e.get("id")],delete this.uploadRetries[e.get("id")],this._detachFileEvents(e)},_detachFileEvents:function(e){e.detach("uploadstart",this._uploadStartHandler),e.detach("uploadprogress",this._uploadProgressHandler),e.detach("uploadcomplete",this._uploadCompleteHandler),e.detach("uploaderror",this._uploadErrorHandler),e.detach("uploadcancel",this._uploadCancelHandler)},_uploadCompleteHandler:function(t){this._unregisterUpload(t.target),this.totalBytesUploaded+=t.target.get("size"),delete this.currentUploadedByteValues[t.target.get("id")],this.queuedFiles.length>0&&this._currentState===n.UPLOADING&&this._startNextFile();var r=t,i=this.totalBytesUploaded,s=Math.min(100,Math.round(1e4*i/this.totalBytes)/100);r.file=t.target,r.originEvent=t,e.each(this.currentUploadedByteValues,function(e){i+=e}),this.fire("totaluploadprogress",{bytesLoaded:i,bytesTotal:this.totalBytes,percentLoaded:s}),this.fire("uploadcomplete",r),this.queuedFiles.length===0&&this.numberOfUploads<=0&&(this.fire("alluploadscomplete"),this._currentState=n.STOPPED)},_uploadCancelHandler:function(e){var t=e;t.originEvent=e,t.file=e.target,this.fire("uploadcancel",t)},_uploadProgressHandler:function(t){this.currentUploadedByteValues[t.target.get("id")]=t.bytesLoaded;var n=t,r=this.totalBytesUploaded,i=Math.min(100,Math.round(1e4*r/this.totalBytes)/100);n.originEvent=t,n.file=t.target,this.fire("uploadprogress",n),e.each(this.currentUploadedByteValues,function(e){r+=e}),this.fire("totaluploadprogress",{bytesLoaded:r,bytesTotal:this.totalBytes,percentLoaded:i})},startUpload:function(){this.queuedFiles=this.get("fileList").slice(0),this.numberOfUploads=0,this.currentUploadedByteValues={},this.currentFiles={},this.totalBytesUploaded=0,this._currentState=n.UPLOADING;while(this.numberOfUploads<this.get("simUploads")&&this.queuedFiles.length>0)this._startNextFile()},pauseUpload:function(){this._currentState=n.STOPPED},restartUpload:function(){this._currentState=n.UPLOADING;while(this.numberOfUploads<this.get("simUploads"))this._startNextFile()},forceReupload:function(e){var t=e.get("id");this.currentFiles.hasOwnProperty(t)&&(e.cancelUpload(),this._unregisterUpload(e),this.addToQueueTop(e),this._startNextFile())},addToQueueTop:function(e){this.queuedFiles.unshift(e)},addToQueueBottom:function(e){this.queuedFiles.push(e)},cancelUpload:function(e){var t,r,i;if(e){t=e.get("id");if(this.currentFiles[t])this.currentFiles[t].cancelUpload(),this._unregisterUpload(this.currentFiles[t]),this._currentState===n.UPLOADING&&this._startNextFile();else for(r=0,len=this.queuedFiles.length;r<len;r++)if(this.queuedFiles[r].get("id")===t){this.queuedFiles.splice(r,1);break}}else{for(i in this.currentFiles)this.currentFiles[i].cancelUpload(),this._unregisterUpload(this.currentFiles[i]);this.currentUploadedByteValues={},this.currentFiles={},this.totalBytesUploaded=0,this.fire("alluploadscancelled"),this._currentState=n.STOPPED}this.queuedFiles.length===0&&this.numberOfUploads<=0&&(this.fire("alluploadscomplete"),this._currentState=n.STOPPED)}},{CONTINUE:"continue",STOP:"stop",RESTART_ASAP:"restartasap",RESTART_AFTER:"restartafter",STOPPED:"stopped",UPLOADING:"uploading",NAME:"uploaderqueue",ATTRS:{simUploads:{value:2,validator:function(e){return e>=1&&e<=5}},errorAction:{value:"continue",validator:function(e){return e===n.CONTINUE||e===n.STOP||e===n.RESTART_ASAP||e===n.RESTART_AFTER}},bytesUploaded:{readOnly:!0,value:0},bytesTotal:{readOnly:!0,value:0},fileList:{value:[],lazyAdd:!1,setter:function(t){var n=t;return e.Array.each(n,function(e){this.totalBytes+=e.get("size")},this),t}},fileFieldName:{value:"Filedata"},uploadURL:{value:""},uploadHeaders:{value:{}},withCredentials:{value:!0},perFileParameters:{value:{}},retryCount:{value:3}}}),e.namespace("Uploader"),e.Uploader.Queue=n},"3.16.0",{requires:["base"]});
/*
YUI 3.16.0 (build 3.16.0-ym15)
Copyright 2014 Yahoo! Inc. All rights reserved.
Licensed under the BSD License.
http://yuilibrary.com/license/
*/

YUI.add("uploader-html5",function(e,t){function i(){i.superclass.constructor.apply(this,arguments)}var n=e.Lang.sub,r=e.Uploader.Queue;e.UploaderHTML5=e.extend(i,e.Widget,{_fileInputField:null,_buttonBinding:null,queue:null,initializer:function(){this._fileInputField=null,this.queue=null,this._buttonBinding=null,this._fileList=[],this.publish("fileselect"),this.publish("uploadstart"),this.publish("fileuploadstart"),this.publish("uploadprogress"),this.publish("totaluploadprogress"),this.publish("uploadcomplete"),this.publish("alluploadscomplete"),this.publish("uploaderror"),this.publish("dragenter"),this.publish("dragover"),this.publish("dragleave"),this.publish("drop")},renderUI:function(){var t=this.get("contentBox"),n=this.get("selectFilesButton");n.setStyles({width:"100%",height:"100%"}),t.append(n),this._fileInputField=e.Node.create(i.HTML5FILEFIELD_TEMPLATE),t.append(this._fileInputField)},bindUI:function(){this._bindSelectButton(),this._setMultipleFiles(),this._setFileFilters(),this._bindDropArea(),this._triggerEnabled(),this.after("multipleFilesChange",this._setMultipleFiles,this),this.after("fileFiltersChange",this._setFileFilters,this),this.after("enabledChange",this._triggerEnabled,this),this.after("selectFilesButtonChange",this._bindSelectButton,this),this.after("dragAndDropAreaChange",this._bindDropArea,this),this.after("tabIndexChange",function(){this.get("selectFilesButton").set("tabIndex",this.get("tabIndex"))},this),this._fileInputField.on("change",this._updateFileList,this),this._fileInputField.on("click",function(e){e.stopPropagation()},this),this.get("selectFilesButton").set("tabIndex",this.get("tabIndex"))},_rebindFileField:function(){this._fileInputField.remove(!0),this._fileInputField=e.Node.create(i.HTML5FILEFIELD_TEMPLATE),this.get("contentBox").append(this._fileInputField),this._fileInputField.on("change",this._updateFileList,this),this._setMultipleFiles(),this._setFileFilters()},_bindDropArea:function(e){var t=e||{prevVal:null},n=this.get("dragAndDropArea");t.prevVal!==null&&(t.prevVal.detach("drop",this._ddEventHandler),t.prevVal.detach("dragenter",this._ddEventHandler),t.prevVal.detach("dragover",this._ddEventHandler),t.prevVal.detach("dragleave",this._ddEventHandler)),n!==null&&(n.on("drop",this._ddEventHandler,this),n.on("dragenter",this._ddEventHandler,this),n.on("dragover",this._ddEventHandler,this),n.on("dragleave",this._ddEventHandler,this))},_bindSelectButton:function(){this._buttonBinding=this.get("selectFilesButton").on("click",this.openFileSelectDialog,this)},_ddEventHandler:function(t){t.stopPropagation(),t.preventDefault();if(e.Array.indexOf(t._event.dataTransfer.types,"Files")>-1)switch(t.type){case"dragenter":this.fire("dragenter");break;case"dragover":this.fire("dragover");break;case"dragleave":this.fire("dragleave");break;case"drop":var n=t._event.dataTransfer.files,r=[],i=this.get("fileFilterFunction"),s;i?e.each(n,function(t){var n=new e.FileHTML5(t);i(n)&&r.push(n)}):e.each(n,function(t){r.push(new e.FileHTML5(t))}),r.length>0&&(s=this.get("fileList"),this.set("fileList",this.get("appendNewFiles")?s.concat(r):r),this.fire("fileselect",{fileList:r})),this.fire("drop",{fileList:r})}},_setButtonClass:function(e,t){t?this.get("selectFilesButton").addClass(this.get("buttonClassNames")[e]):this.get("selectFilesButton").removeClass(this.get("buttonClassNames")[e])},_setMultipleFiles:function(){this.get("multipleFiles")===!0?this._fileInputField.set("multiple","multiple"):this._fileInputField.set("multiple","")},_setFileFilters:function(){this.get("fileFilters").length>0?this._fileInputField.set("accept",this.get("fileFilters").join(",")):this._fileInputField.set("accept","")},_triggerEnabled:function(){this.get("enabled")&&this._buttonBinding===null?(this._bindSelectButton(),this._setButtonClass("disabled",!1),this.get("selectFilesButton").setAttribute("aria-disabled","false")):!this.get("enabled")&&this._buttonBinding&&(this._buttonBinding.detach(),this._buttonBinding=null,this._setButtonClass("disabled",!0),this.get("selectFilesButton").setAttribute("aria-disabled","true"))},_getFileList:function(){return this._fileList.concat()},_setFileList:function(e){return this._fileList=e.concat(),this._fileList.concat()},_updateFileList:function(t){var n=t.target.getDOMNode().files,r=[],i=this.get("fileFilterFunction"),s;i?e.each(n,function(t){var n=new e.FileHTML5(t);i(n)&&r.push(n)}):e.each(n,function(t){r.push(new e.FileHTML5(t))}),r.length>0&&(s=this.get("fileList"),this.set("fileList",this.get("appendNewFiles")?s.concat(r):r),this.fire("fileselect",{fileList:r})),this._rebindFileField()},_uploadEventHandler:function(e){switch(e.type){case"file:uploadstart":this.fire("fileuploadstart",e);break;case"file:uploadprogress":this.fire("uploadprogress",e);break;case"uploaderqueue:totaluploadprogress":this.fire("totaluploadprogress",e);break;case"file:uploadcomplete":this.fire("uploadcomplete",e);break;case"uploaderqueue:alluploadscomplete":this.queue=null,this.fire("alluploadscomplete",e);break;case"file:uploaderror":case"uploaderqueue:uploaderror":this.fire("uploaderror",e);break;case"file:uploadcancel":case"uploaderqueue:uploadcancel":this.fire("uploadcancel",e)}},openFileSelectDialog:function(){var e=this._fileInputField.getDOMNode();e.click&&e.click()},upload:function(t,n,r){var i=n||this.get("uploadURL"),s=r||this.get("postVarsPerFile"),o=t.get("id");s=s.hasOwnProperty(o)?s[o]:s,t instanceof e.FileHTML5&&(t.on("uploadstart",this._uploadEventHandler,this),t.on("uploadprogress",this._uploadEventHandler,this),t.on("uploadcomplete",this._uploadEventHandler,this),t.on("uploaderror",this._uploadEventHandler,this),t.on("uploadcancel",this._uploadEventHandler,this),t.startUpload(i,s,this.get("fileFieldName")))},uploadAll:function(e,t){this.uploadThese(this.get("fileList"),e,t)},uploadThese:function(t,n,i){if(!this.queue){var s=n||this.get("uploadURL"),o=i||this.get("postVarsPerFile");this.queue=new r({simUploads:this.get("simLimit"),errorAction:this.get("errorAction"
),fileFieldName:this.get("fileFieldName"),fileList:t,uploadURL:s,perFileParameters:o,retryCount:this.get("retryCount"),uploadHeaders:this.get("uploadHeaders"),withCredentials:this.get("withCredentials")}),this.queue.on("uploadstart",this._uploadEventHandler,this),this.queue.on("uploadprogress",this._uploadEventHandler,this),this.queue.on("totaluploadprogress",this._uploadEventHandler,this),this.queue.on("uploadcomplete",this._uploadEventHandler,this),this.queue.on("alluploadscomplete",this._uploadEventHandler,this),this.queue.on("uploadcancel",this._uploadEventHandler,this),this.queue.on("uploaderror",this._uploadEventHandler,this),this.queue.startUpload(),this.fire("uploadstart")}else this.queue._currentState===r.UPLOADING&&(this.queue.set("perFileParameters",this.get("postVarsPerFile")),e.each(t,function(e){this.queue.addToQueueBottom(e)},this))}},{HTML5FILEFIELD_TEMPLATE:"<input type='file' style='visibility:hidden; width:0px; height: 0px;'>",SELECT_FILES_BUTTON:'<button type="button" class="yui3-button" role="button" aria-label="{selectButtonLabel}" tabindex="{tabIndex}">{selectButtonLabel}</button>',TYPE:"html5",NAME:"uploader",ATTRS:{appendNewFiles:{value:!0},buttonClassNames:{value:{hover:"yui3-button-hover",active:"yui3-button-active",disabled:"yui3-button-disabled",focus:"yui3-button-selected"}},dragAndDropArea:{value:null,setter:function(t){return e.one(t)}},enabled:{value:!0},errorAction:{value:"continue",validator:function(e){return e===r.CONTINUE||e===r.STOP||e===r.RESTART_ASAP||e===r.RESTART_AFTER}},fileFilters:{value:[]},fileFilterFunction:{value:null},fileFieldName:{value:"Filedata"},fileList:{value:[],getter:"_getFileList",setter:"_setFileList"},multipleFiles:{value:!1},postVarsPerFile:{value:{}},selectButtonLabel:{value:"Select Files"},selectFilesButton:{valueFn:function(){return e.Node.create(n(e.UploaderHTML5.SELECT_FILES_BUTTON,{selectButtonLabel:this.get("selectButtonLabel"),tabIndex:this.get("tabIndex")}))}},simLimit:{value:2,validator:function(e){return e>=1&&e<=5}},uploadURL:{value:""},uploadHeaders:{value:{}},withCredentials:{value:!0},retryCount:{value:3}}}),e.UploaderHTML5.Queue=r},"3.16.0",{requires:["widget","node-event-simulate","file-html5","uploader-queue"]});
YUI.add("tictac-attach-yuipatch",function(a){"use strict";a.Uploader.Queue.prototype.restartUpload=function(){for(this._currentState=a.Uploader.Queue.UPLOADING;this.numberOfUploads<this.get("simUploads")&&this.queuedFiles.length;)this._startNextFile()},a.FileHTML5.prototype._uploadEventHandler=function(a){var b=this.get("xhr");switch(a.type){case"progress":this.fire("uploadprogress",{originEvent:a,bytesLoaded:a.loaded,bytesTotal:this.get("size"),percentLoaded:Math.min(100,Math.round(1e4*a.loaded/this.get("size"))/100)}),this._set("bytesUploaded",a.loaded);break;case"load":if(b.status>=200&&b.status<=299){this.fire("uploadcomplete",{originEvent:a,data:a.target.responseText});var c=b.upload,d=this.get("boundEventHandler");c.removeEventListener("progress",d,!1),c.removeEventListener("error",d,!1),c.removeEventListener("abort",d,!1),b.removeEventListener("load",d,!1),b.removeEventListener("error",d,!1),b.removeEventListener("readystatechange",d,!1),this._set("xhr",null)}else this.fire("uploaderror",{originEvent:a,status:b.status,statusText:b.statusText,data:b.responseText,source:"http"});break;case"error":this.fire("uploaderror",{originEvent:a,status:b.status,statusText:b.statusText,source:"io"});break;case"abort":this.fire("uploadcancel",{originEvent:a});break;case"readystatechange":this.fire("readystatechange",{readyState:a.target.readyState,originEvent:a})}}},"1.0.0",{requires:["file-html5","uploader-queue"]});YUI.add("tictac-attach-customuploader-html5",function(a){"use strict";function b(){var c=this;b.superclass.constructor.apply(c,arguments),c.set("errorAction",a.Uploader.Queue.STOP)}b.NAME="tictac-attach-customuploader-html5",a.extend(b,a.UploaderHTML5,{cancelUpload:function(a){var b=this,c=b.queue;c.cancelUpload(a),c.queuedFiles.length||c.numberOfUploads||b.cleanUpQueue()},_uploadEventHandler:function(a){var c=this,d=this.queue;b.superclass._uploadEventHandler.apply(c,arguments),"uploaderqueue:uploaderror"!==a.type&&"file:uploaderror"!==a.type||d.queuedFiles.length||d.numberOfUploads||c.cleanUpQueue()},_ddEventHandler:function(c){var d=this,e=c._event.dataTransfer;"drop"===c.type&&a.Array.indexOf(e.types,"Files")>-1&&d.fire("customdrop",{numberOfFiles:e.files.length}),b.superclass._ddEventHandler.apply(d,arguments)},cleanUpQueue:function(){var a=this;a.queue.cancelUpload(),a.queue=null}}),a.namespace("Tictac.attach").CustomUploaderHTML5=b,a.namespace("tictac.attach").CustomUploaderHTML5=b},"1.0.0",{requires:["uploader-html5","tictac-attach-yuipatch"]});YUI.add("tictac-attach-strings",function(a){a.namespace("Tictac.attach").strings={str_attach_drag_here:"將附件檔案拖曳到這裡",str_attach_form_fallback_dialog_body:"無法附加這個檔案。請再試一次。",str_attach_form_fallback_dialog_title:"上傳時出錯",str_attach_html5_attach_button:"夾帶檔案 [或拖曳]",str_attach_opt_menu:"從我的電腦附加檔案",str_enhancr_card_preview_by:"{{img}} 預覽",str_enhancr_card_view_on:"檢視於 {{link}}",str_link_preview_tutorial_subject:"Bringing Links to Life with Link Preview",last:null}},"1.0.0");YUI.add("tictac-attach-uploader-html5",function(a){"use strict";function b(a){var b;return window.DOMParser?b=(new window.DOMParser).parseFromString(a,"text/xml"):(b=new ActiveXObject("Microsoft.XMLDOM"),b.async=!1,b.loadXML(a)),b}function c(b){var c,d=this,e=a.Tictac.attach.strings;return a.mix(b,m.uploader,!0),c=new a.Tictac.attach.CustomUploaderHTML5(b),d.dropArea=b.dropArea,d.yuiImpl=c,d.type="HTML5",d.evtHandles=[],d.getCredRetry=0,d.credWaitTimer=null,d.dropArea.appendChild(a.Tictac.attach.rollups.dragdrop({drag_here:b.dragndropStr||e.str_attach_drag_here})),d.dropArea.setStyle("position","relative"),d.tictacDropAreaNode=d.dropArea.one(".tictac-attach-droparea"),d.tictacDropAreaNode.hide(),d.btnTooltip=b.btnTooltip||e.str_attach_html5_attach_button,c.set("uploadURL",m.UPLOAD_URL_BASE),c.set("dragAndDropArea",d.dropArea),d.evtHandles=d.evtHandles.concat([d.convert(c,"uploadcomplete",d.onUploadComplete),d.convert(c,"uploaderror",d.onUploadError),d.convert(c,"uploadprogress",d.onUploadProgress),d.dropArea.on(["dragenter","dragover"],d.onDragOverOrEnter,d),d.dropArea.on("drop",d.onDrop,d),c.on("customdrop",d.onCustomDrop,d),m.dropNode.on(["dragenter","dragover"],d.onDragOverOrEnter,d),d.convert(c,"fileselect",d.onRefire),d.convert(c,"fileuploadstart",d.onRefire),d.convert(c,"uploadcancel",d.onRefire),d.convert(c,"alluploadscomplete",d.onRefire),d.convert(c,"totaluploadprogress",d.onRefire),q.on("updateUploadURL",d.setCredential,d),q.on(["dragenter","dragover"],d.onDragOverOrEnter,d),q.on("drop",d.onDrop,d),c.get("selectFilesButton").on("click",function(a){a.halt(),a.target&&a.target.blur&&a.target.blur()})]),d.get=c.get,j(c.get("appendNewFiles"),"appendNewFiles has to be true or fileFromFid breaks"),m.UPLOAD_URL_BASE&&m.LAUNCH_PROTOCOL?void d.fetchCredential():void i("uploaderHtml5: only external svc uploads will work since UPLOAD_URL_BASE and LAUNCH_PROTOCOL not configured.")}function d(a){return a.id=a.get("id"),a.name=a.get("name"),a.hasProgress=!0,a.size=a.get("size"),a}function e(b){return b.fileList?b.fileList=a.Array.map(b.fileList,function(a){return new d(a)}):b.file&&(b.file=new d(b.file)),b}var f,g,h=a.Tictac.base.utils,i=h.log,j=h.verify,k=h.getVal,l=a.Tictac.attach.Neo.neoConfig,m={UPLOAD_URL_BASE:"",LAUNCH_PROTOCOL:"",dropNode:a.one("body"),rteContainer:a.one("body"),stat:function(){i("stat not conf'ed.")},stopwatch:function(){i("STOPWATCH not conf'ed."),this.stop=function(){}},simpleRelogin:function(){i("relogin!")},uploader:{multipleFiles:!0,simLimit:1}},n=10,o=1e3,p=n*o,q={},r=function(a,b){m.stat("html5_tt_"+a,b)};a.augment(q,a.EventTarget),c.NAME="tictac-attach-uploader-html5",c.isBrowserCapable=function(){return a.UA.chrome>=8||a.UA.gecko>=4||a.UA.safari>=536.25||a.UA.ie>=10},a.mix(c.prototype,{convert:function(a,b,c){var d=this;return a.on(b,function(a){c.call(d,new e(a),b)})},render:function(){var a,b=this;b.yuiImpl.render.apply(b.yuiImpl,arguments),a=b.yuiImpl.get("selectFilesButton"),a.setStyles({width:"",height:""}),a.setAttribute("title",b.btnTooltip),b.evtHandles.push(a.on("click",b.onAttachButtonClicked,b))},cleanup:function(){var b=this;a.Array.each(b.evtHandles,function(a){a.detach()}),b.evtHandles=null,b.yuiImpl.destroy(),b.yuiImpl=null},doUpload:function(b){var c=this,d=b.fileList,e=c.yuiImpl.get("postVarsPerFile");a.Array.each(d,function(a){e[a.get("id")]={filename:a.get("name"),filesize:a.get("size")}}),c.yuiImpl.get("uploadURL")===m.UPLOAD_URL_BASE&&r("no_cred",{message:l.neoguid}),i("uploadThese on ",d),r("onFileSelect"),c.yuiImpl.uploadThese(d,c.yuiImpl.get("uploadURL"),e)},doExternalUpload:function(b,c){var d,e=this,f=b.fileList,g=e.yuiImpl;g.queue=null,a.Array.each(f,function(a){d=a.startUpload,a.startUpload=function(b,e,f){c.configureUpload(a,function(e){b=e.url||b,f=e.fileFieldName||"file",a.set("xhrWithCredentials",e.xhrWithCredentials||!1),a.set("uploadSvc",c),d.call(a,b,e.postVars,f)})}}),i("doExternalUpload on ",f),g.uploadThese(f)},startUpload:function(a,b){var c=this;if(b)return void c.doExternalUpload(a,b);if(f){if((new Date).getTime()-g<6e5)return void c.doUpload(a);f=null,c.fetchCredential()}c.evtHandles.push(c.once("credentialSetSuccessful",c.doUpload,c,a)),c.credWaitTimer||(c.credWaitTimer=setTimeout(function(){c.getCredRetry=n,c.fire("uploadfatalerror")},p))},retryUpload:function(b){var c=this,d=c.yuiImpl.queue,e=c.fileFromId(b);r("retry",{message:l.neoguid}),d?(d.addToQueueTop(e),d._currentState=a.Uploader.Queue.UPLOADING,d._startNextFile()):c.yuiImpl.uploadThese([e])},cancel:function(b){var c,d=this,e=d.yuiImpl,f=e.queue;if(f)if(b){c=d.fileFromId(b);try{f.cancelUpload(c),r("Attachment_UploadCancelled")}catch(g){}}else a.Array.each(this.yuiImpl.get("fileList"),function(a){d.cancel(a)})},simulateClick:function(){var a=this,b=a.yuiImpl.get("selectFilesButton");b._node.click()}},!0),a.mix(c.prototype,{setCredVal:function(a){f=a,g=(new Date).getTime()},setCredential:function(){var a=[m.UPLOAD_URL_BASE,"&",f].join("");this.yuiImpl.set("uploadURL",a),this.yuiImpl.queue&&this.yuiImpl.queue.set("uploadURL",a)},fetchCredential:function(){function b(a,b){if(d.yuiImpl){if(b=b.response||b.responseText,f=h.parseJSON(b),f=k(f,"Response.cred"),!f)return r("CredentialSetFailedCallback",{message:l.neoguid}),r("CredFetchSuccessData",{message:(b+"").substr(0,27)}),void(d.getCredRetry<n&&setTimeout(function(){d.fetchCredential(),d.getCredRetry++},o));clearTimeout(d.credWaitTimer),d.credWaitTimer=null,d.setCredential(),d.fire("credentialSetSuccessful"),g=(new Date).getTime(),r("CredentialSetSuccessful",{message:l.neoguid}),d.getCredRetry&&r("CredentialSetSuccessful_retry"),d.getCredRetry=0}}function c(b,c){d.yuiImpl&&(r("CredentialSetFailed",{message:c.status+"_"+c.statusText+"_"+l.neoguid}),d.getCredRetry>=n||setTimeout(function(){302===c.status?(a.once("net:reloginSuccessful",function(){d.fetchCredential()}),m.simpleRelogin()):d.fetchCredential(),d.getCredRetry++},o))}var d=this,e=[m.LAUNCH_PROTOCOL,document.location.host,"/ya/upload_get_cred?r=",(new Date).getTime().toString(36)].join("");return f?void d.setCredential():void a.io(e,{on:{success:b,failure:c}})},fileFromId:function(b){var c=a.Array.find(this.yuiImpl.get("fileList"),function(a){return a.id===b});return j(c,"No file found with id: "+b),c},onAttachButtonClicked:function(){this.fire("attachbuttonclick")},onCustomDrop:function(a){this.fire("filedrop",a)},onDrop:function(){var a=this;a.tictacDropAreaNode&&a.tictacDropAreaNode.hide()},onDragOverOrEnter:function(b){var c=this,d=b._event.dataTransfer,e=c.tictacDropAreaNode;return!(-1!==a.Array.indexOf(d.types,"Files")||d.types.contains&&d.types.contains("application/x-moz-file")),e&&(e.show(),c.dropAreaTimer&&(clearTimeout(c.dropAreaTimer),c.dropAreaTimer=null),c.dropAreaTimer=setTimeout(function(){e.hide()},100)),!0},fileToSvc:function(b){var c=this,d=a.Tictac.attach.Utils,e=b.get("uploadSvc");return e?e:{parseServerResponse:c.parseServerResponse,isSvrResponseSuccess:d.isSvrResponseSuccess,isSvrResponseWarning:d.isSvrResponseWarning}},onUploadComplete:function(a){var b=this,c=a.file,d=b.fileToSvc(c);d.parseServerResponse(c,a.data),d.isSvrResponseSuccess(c.reason)||d.isSvrResponseWarning(c.reason)?a.type="uploadcomplete":a.type="uploaderror",i("uploaderHTML5 firing uploadcomplete: "+c.reason),r("success",{message:c.reason}),b.fire(a.type,a)},onUploadError:function(a){var b,c,d=this,e=a.file,f=this.yuiImpl,g=f.queue,h=d.fileToSvc(e);h.parseServerResponse(e,a.data),a.transferFailed=!0,g.queuedFiles.length&&g.restartUpload(),"io"===a.source?r("failure_uploaderror_io",{message:l.neoguid}):(c=(a.data+"").match(/<Error>([0-9A-Za-z]*?)<\/Error>/),b=c?c[1]:"parseerror_"+a.status+"_"+a.statusText,r("failure",{messsage:b})),e.get("isDropbox")&&r("db_upload_try_failure"),e.fire("uploaderror",a)},onUploadProgress:function(a){a.file.percentLoaded=a.percentLoaded,this.fire("uploadprogress",a)},onRefire:function(a,b){b||(b=a.type.substring(a.type.indexOf(":")+1)),this.fire(b,a)},parseServerResponse:function(c,d){var e,f;return c.reason="unknown",e=b(d),d=e.firstChild,d.getElementsByTagName||(d=e.childNodes[1]),(f=d.getElementsByTagName("attachment")[0])?void a.Array.each(f.childNodes,function(a){var b,d,e={id:"diskfilename",type:"mimetype",name:"name",size:"size",code:"reason"};b=a.nodeName,d=a.text||a.textContent,e[b]&&(c[e[b]]=d,"size"===b&&(c.size=parseInt(c.size,10)))}):(c.reason=d.getElementsByTagName("Error")[0],void(c.reason&&(c.reason=c.reason.text)))}}),a.augment(c,a.EventTarget,!0,null,{prefix:"Uploaderhtml5"}),a.namespace("Tictac.attach").UploaderHTML5=c,a.Tictac.attach.UploaderHTML5.conf=m,a.namespace("tictac.attach").UploaderHTML5=c,a.namespace("tictac.attach.UploaderHTML5").conf=m},"1.0.0",{requires:["array-extras","event-custom","io","tictac-attach-customuploader-html5","tictac-attach-neo","tictac-attach-rollups","tictac-attach-strings","tictac-attach-utils","tictac-base-utils"]});YUI.add("tictac-attach-main",function(a){"use strict";function b(){return NeoConfig.autolinkEnabled}function c(a){var b=this,c=b.getPreferredUploaderClassName(),d=function(){b.switchUploaderType.apply(b,arguments)};return b.evtHandles=[],j(f.UploaderHTML5.conf,f.Stats.makeStatConf()),j(f.UploaderForm.conf,f.Stats.makeStatConf()),j(f.Controller.conf,f.Stats.makeStatConf()),b.btnNode=a.attach,b.btnContainer=a.attachContainer,b.dropArea=a.dropArea,b.btnAttachCloud=b.configDropbox(a.dropbox),a.flickr&&(b.btnAttachFlickr=b.configFlickr(a.flickr,a.rte,a.username)),b.model=new f.model.Attachments,b.uploader=b.createUploader(c),b.controller=new f.Controller(b.uploader,b.model,d,a.composeView),b.view=new f.View(b.model,b.controller,a),b.uploader.render(a.attachContainer),b.view.render(),b.stat=f.Controller.conf.stat,b.attachMenuSelector=a.attachMenuSelector,b.btnAttachOption=b.configAttachOpt(a.attachOption),a.composeView&&b.evtHandles.push(a.composeView.on("compose:saveSuccess",function(a){a.mid&&b.model.updateMid(a.mid)})),b.configAutolink(a),b}var d,e,f=a.Tictac.attach,g=a.Tictac.base.utils,h=g.getVal,i=f.strings,j=f.Utils.configure,k=!1,l=g.log;c.prototype={configAutolink:function(a){var c,d=this,e={};b()&&(d._rte=a.rte,d._rte.plug(f.enhancr.AutolinkPlugin),c=a.composeView.cdo.get("origin"),d._rte.after("isRichChange",function(a){d._rte.rte.autolink.set("linkingEnabled",a.newVal)}),d._rte.rte.autolink.set("linkingEnabled",d._rte.get("isRich")),d.evtHandles.push(a.composeView.on("renderComplete",function(){d._rte.rte.fire("renderComplete"),d.onRenderComplete()}),a.composeView.cdo.on("sending",function(){d.onMessageSent(a.composeView.cdo.get("origin"))})),e.isNew=!c.action,e.isDraft="Draft"===c.fid,e.isReply=!(e.isNew||e.isDraft),d._rte.rte.on("cardAdded",function(){a.composeView._setDirty()}),d._rte.rte.set("toolbarNode",a.composeView.baseNode.one(".bottomToolbar")),d._rte.plug(f.enhancr.CardPlugin,e),d.evtHandles.push(a.composeView.on("closeChange",function(){d._rte.rte.cards.destroySpinner()})))},onMessageSent:function(b){var c=["reply_sender","reply_all","forward"];this.hadCardsInOriginal&&-1!==a.Array.indexOf(c,b.action)&&this.stat("enhancr_fwd_or_reply",{message:b.action})},onRenderComplete:function(){var a=this,b=this._rte.rte.frame.get("container"),c="div[class*='link-enhancr-attachment'][id*='enhancrCard_']";a.hadCardsInOriginal=!!b.one(c)},configDropbox:function(b){var c,e=this;return b&&g.hasTictacModule("tictac-dropbox")&&a.use("tictac-dropbox-controller",function(a){c=b.one("a").on("click",function(){a.Tictac.dropbox.controller.attachFrom(e.model)}),e.evtHandles.push(c),d=h(a,"Tictac.dropbox.strings"),b.one("a").set("text",d.str_share_from_db),c=a.on("compose:dropbox:chooser",function(){a.Tictac.dropbox.controller.attachFrom(e.model)}),e.evtHandles.push(c),a.fire("compose:dropbox:ready")}),b},configFlickr:function(b,c,d){var f,i=this;return b&&g.hasTictacModule("tictac-flickr-controller")&&a.use("tictac-flickr-controller",function(a){f=b.one("a").on("click",function(){a.Tictac.flickr.Controller.shareFrom(c,d)}),i.evtHandles.push(f),e=h(a,"Tictac.flickr.strings"),b.one("a").set("text",e.str_share_from_flickr)}),b},configAttachOpt:function(b){var c,d,e,f=this;return b&&(c=b.one("a").once("click",function(){e=a.one(f.attachMenuSelector),d=e.on("menuSelected",function(){f.uploader.simulateClick()}),f.evtHandles.push(d)}),f.evtHandles.push(c),b.one("a").set("text",i.str_attach_opt_menu)),b},cleanup:function(){var b=this;b.btnNode.remove(!0),b.btnContainer.remove(!0),b.uploader.cleanup(),b.controller.cleanup(),b.view.cleanup(),b.model.cleanup(),a.each(b.evtHandles,function(a){a.detach&&a.detach()})},getPreferredUploaderClassName:function(){var a=f.UploaderHTML5.isBrowserCapable();return!k&&a?"HTML5":"Form"},createUploader:function(a){return new f["Uploader"+a]({dropArea:this.dropArea,selectFilesButton:this.btnNode.cloneNode(!0)})},switchUploaderType:function(a){function b(){l("switching uploader type to "+d),c.uploader.cleanup(),c.btnContainer.all("*").each(function(a){a.remove(!0)}),"Form"===d&&(c.forceFormUploader=!0),c.uploader=c.createUploader(d),c.controller.setUploader(c.uploader),c.uploader.render(c.btnContainer),c.stat("ToggleFormActivated")}var c=this,d="HTML5"===c.uploader.type?"Form":"HTML5";return a?f.Neo.alert(i.str_attach_form_fallback_dialog_title,i.str_attach_form_fallback_dialog_body,b):b()}},j(f.UploaderHTML5.conf,f.Neo.makeHTML5UploaderConf()),a.namespace("Tictac.attach").AttachmentComposer=c,a.namespace("tictac.attach").AttachmentComposer=c,a.augment(c,a.EventTarget,!0,null,{prefix:"attachmentcomposer"})},"1.0.0",{requires:["event-custom","tictac-att-filter","tictac-attach-enhancr-autolink","tictac-attach-enhancr-card","tictac-attach-neo","tictac-attach-stats","tictac-attach-model-attachments","tictac-attach-view","tictac-attach-controller","tictac-attach-uploader-form","tictac-attach-uploader-html5","tictac-attach-strings","tictac-attach-utils","tictac-base-utils","tictac-base-mailpreferences"]});YUI.add("mail-ui-composeview-compose-loader",function(B){var A=function(C){this.context=C.context||{};this.workspace=C.workspace||null;this.is_tab_deactive=C.force||false;this.tabs=C.tabs||null;this.strings=C.strings||{};this.openAsDraft=C.openAsDraft||false;this.composeDeps=["_shared_module_toolbar_compose","_shared_module_compose_message_header_fresh","_shared_module_offscreen_bin_compose","_shared_module_offscreen_bin_compose_menu_color_picker","_shared_module_offscreen_bin_compose_menu_spellcheck","_shared_module_offscreen_bin_compose_modal_cancel_compose","_shared_module_offscreen_bin_compose_menu_spell_langs","_shared_module_compose_reply","mail-ui-authorview-conv"];};A.prototype.addModule=function(C){this.composeDeps.push(C);};A.prototype.removeModule=function(D){var C=this.composeDeps.indexOf(D);if(C>-1){this.composeDeps.splice(C,1);}};A.prototype.load=function(){var E=this,D=new B.common.Utils.Stopwatch("Compose","start"),C=[].concat(E.composeDeps);E.stopwatch=D;B.fire("Y.mail.ui.Workspace:composeMessage:start");E.prefetch_message();C.push(B.bind(this.show_compose,E));B.fire("load-load-address-book-contacts");D.start(1,"moduleLoad");B.use.apply(B,C);};A.prototype.prefetch_message=function(){var F=this,E=this.context.cdo;if(B.mail.Core.feature("composev3").isOn()){E=this.context.draft;}if(E&&!E.get("passive")){var G=F.context.oMsg,D=F.context.fid,C=new B.mail.Services.MessageService({stopwatch:F.stopwatch,cacheKey:"ComposeOrigin"});C.get(G.mid,D);}};A.prototype.show_compose=function(){var D=this,H,G=D.strings.str_tabs_compose_fresh,F=D.context.action,E=D.context.widget,C=D.stopwatch;C.start(1,"initView");window.UploaderService=window.UploaderService||B.mail.UploaderService;H=new B.mail.ui.AuthorViewConv();C.action=F;D.context.stopwatch=C;if(B.mail.Core.feature("composev3").isOn()&&D.context&&D.context.calCompose){D.context.cbfn=function(J,K){B.use("mail-services-calservice",function(L){L.Mail.Services.calService.setCalDraft(J,K);});};}H.initCompose(D.context,D.openAsDraft);if(D.context.oMsg&&D.context.oMsg.header){G=B.common.Utils.escapeHtml(B.common.Utils.unescapeHtml(D.context.oMsg.header.subject));}H.set("title",G);if(E){D.prepare_tab_for_compose(H,E,F);}else{var I=D.composify_tab(H);if(!I){return;}}H.bindComposeView();B.common.Utils.log({"m":"composeView bound to the tab with which it is housed"});D.show_compose_end(H);};A.prototype.prepare_tab_for_compose=function(D,G,F){var I=this,J=G&&G.msgPane,C=G.tab||I.tabs.getActiveTab(),E=F==="reply_all"||F==="reply_sender"||F==="forward",K=!I.context.hasMsgList&&E&&J&&NeoConfig.send_confirm_nav_enabled;if(K){var H=I.context.oMsg&&I.context.oMsg.header&&I.context.oMsg.header.subject;D.backToMessageTab=function(M){var L=function(){if(H){C.set("title",H);}else{C.set("title",null);}C.set("canDeactivate",-1);C.once("widgetChange",function(N){C.set("canDeactivate",1);B.fire("bindContentWidget",{cw:N.newVal,tab:C});});D.after("closeChange",function(){C.set("widget",G);});C.removeChild(D);};if(M==="next"||M==="prev"){B.use("mail-ui-messagelist-base","mail-ui-messagepane-next-prev",function(){J&&J.stepMail(M,L,0,0,1);});}else{L();}};}C.set("title",D.get("title"));C.once("widgetChange",function(L){L.prevVal.after("closeChange",function(M){if(M.newVal){C.removeChild(L.prevVal);}});L.newVal.after("closeChange",function(M){if(M.newVal){C.set("close",1);}});B.fire("bindContentWidget",{cw:L.newVal,tab:C});});C.set("hideToolbar",true);C.set("widget",D);};A.prototype.composify_tab=function(G){var E=this,D=E.stopwatch,C;var F=E.workspace.addContentWidget({s_label:G.get("title"),widget:G,forcePane:false,noToolbar:true,sync:true,isRemovable:true,noScroll:E.context.noScroll});if(!F){return false;}else{F.detach("closeHalted");F.on("closeHalted",function(H){H.halt(true);});}if(B.mail.Core.feature("composev3").isOn()){C=G.view;}else{C=G.subview;}C.once("renderComplete",function(){D.stop();});return true;};A.prototype.show_compose_end=function(D){var C=this;B.fire("Y.mail.ui.Workspace:composeMessage:complete");if(C.context.callFromLaunch){!NeoConfig.noDarla&&B.common.Utils.loadDarlaAndExecute(function(E){E.fire("darlaEvent",{action:(NeoConfig.low_bandwidth)?"launch_compose_low":(NeoConfig.isSSL?"launch_compose_ssl":"launch_compose")});},false);}D.on("closeChange",function(){B.fire("Nav:ComposeClosed");});};A.prototype.create_conv_compose_view=function(F,E,C,H,G){if(B.mail.Core.feature("composev3").isOn()){var D=new B.mail.Controller.ComposeController(C,G,F,H,E);D.bindComposeView();return D;}else{return new B.mail.ui.ConvComposeView(F,E,C,H,G);}};if(window.LH!==undefined&&window.sessionStorage!==undefined){sessionStorage.setItem("MTTC",Math.round(Neo.performance.now()));}B.namespace("mail.ui.Compose").ComposeLoader=A;B.fire("mail-ui-composeview-compose-loader:loaded");},"1.0.0",{requires:["mail-platform","common-utils","common-utils-stats","mail-services-message-service","tictac-attach-main"]});YUI.add("common-ui-lozengeDD",function(B){B.namespace("common.ui");var H=B.common.Utils;var F=function(J){var K=this;K.inputUl=null;K.insertBefore=null;K.dummyElement=null;K.targetNode=null;K.selectMultipleLozenges=false;K.composeView=J.composeView,K.composeHeader=J.composeView.baseNode.one(".compose-header");K.firstMove=true;K.allInputBoxes=K.composeHeader.all("div div.ac-input");K.clonedLozenge=null;K.wasHighlighted=false;K.dd=new B.mail.DD({start:K.start,end:K.end,move:K.move,scope:K,node:K.composeHeader,dragSelector:J.dragSelector});H.setSelect(this.composeHeader,false);};var A=function(K){this.init(K);var J=this.getTargetNode(K);if(J){K.dd.proxy.setXY([-100,-100]);this.dummyElement.setStyle("opacity",0);}};var D=function(N){var O=this,M=O.getTargetNode(N),K=N.dd.proxy,J;var L=function(R,P){var Q=O.insertBefore;if(K.inRegion(P)){O.inputUl=P.one("ul");O.allInputBoxes.removeClass("focus");P.addClass("focus");Q=null;J=O.inputUl.all("li");J.each(function(S){if(O.clonedLozenge.inRegion(S)){if(!Q){Q=S;}}});if(!Q){Q=J.item(J.size()-1);}Q.insert(O.dummyElement,Q);}else{if(P.hasClass("focus")){P.removeClass("focus");O.inputUl=null;}}O.insertBefore=Q;};if(K){if(O.firstMove){O.firstMove=false;M.setStyle("display","none");O.composeHeader.all(".hLozenge").each(function(P){P.removeClass("focus");});}K.setStyle("top",N.pageY);K.setStyle("left",N.pageX);K.setXY([N.pageX,N.pageY]);if(K.inRegion(O.composeHeader)){O.allInputBoxes.each(function(P){L(N,P);});}}};var E=function(L){var M=this,K=this.getTargetNode(L),J=M.insertBefore;if(K){L.dd.proxy.remove().destroy(true);if(M.inputUl&&J){K.remove();M.inputUl.get("parentNode").removeClass("focus");if(!this.selectMultipleLozenges){J.insert(K,J);}else{K.each(function(N){J.insert(N,J);N.removeClass("focus");});}M.composeView.dirty=true;}else{if(this.wasHighlighted){K.addClass("focus");}}M.dummyElement.remove().destroy(true);M.dummyElement=null;K.setStyle("display","inline-block");K.removeAttribute("style");L.dd.proxy=null;M.targetNode=null;M.selectedLozenges=false;M.firstMove=true;M.insertBefore=null;L.notDragging=false;M.wasHighlighted=false;M.selectMultipleLozenges=false;}};var C=function(){return this.targetNode||null;};var I=function(L){var P=this,K,J=0,O;var N=function(){M(L);if(P.targetNode){var Q=P.targetNode.cloneNode(true);Q.replaceClass("hLozenge","dd-hLozengeBox");Q.one("input").remove();L.dd.proxy=B.Node.create('<div style="position:absolute"></div>');L.dd.proxy.appendChild(Q);P.clonedLozenge=Q;P.dummyElement=P.targetNode.cloneNode(true);}};var M=function(R){var S,Q=R.target;S=(B.Node.getDOMNode(Q)).nodeName;if(S==="LI"&&Q.hasClass("hLozenge")){P.targetNode=Q;}else{P.targetNode=Q.ancestor("li.hLozenge");}return P.targetNode;};K=L.target.ancestor("ul");if(!K){P.targetNode=null;}else{if(L.target.hasClass("lozenge-edit")){P.targetNode=null;L.notDragging=true;}else{if(K.one("li.focus")){O=M(L);P.targetNode=K.all("li.focus");J=P.targetNode.size();if(J===1||!O.hasClass("focus")){if(O.hasClass("focus")){P.wasHighlighted=true;}N();}else{P.wasHighlighted=true;L.dd.proxy=B.Node.create('<div style="z-index: 999" class="contactDragProxy"><span></span><b class="counter">'+J+"</b></div>");P.clonedLozenge=L.dd.proxy;if(!P.dummyElement){P.dummyElement=P.targetNode.item(0).cloneNode(true);}P.selectMultipleLozenges=true;}}else{N();}}}if(L.dd.proxy){B.one("body").append(L.dd.proxy);}};var G=function(){this.dd.destroy();};F.prototype={destroy:G,start:A,end:E,move:D,getTargetNode:C,init:I};B.common.ui.lozengeDD=F;},"1.0.0",{requires:["common-ui-dd","common-utils"]});